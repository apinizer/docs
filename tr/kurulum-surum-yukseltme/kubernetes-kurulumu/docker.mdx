---
title: "Private/Local Docker Registry Kullanımı"
description: 'Private/Local Docker Registry kullanımı, eğer Apinizer''ın çalıştığı sunucuların hub.docker.com''a erişimi yok ise sürüm güncelleme işlemlerini gerçekleştirmenin en kolay yoludur.'
---

## Neden Docker Kayıt Defteri'ne İhtiyacınız Var?

Public Docker image'ları herhangi bir zamanda güncellenebilir. Önceki imaj ile aynı etikete sahip bir imaj güncellemesini durduracak hiçbir şey yoktur.

İmaj dosyalarını kendi sisteminize indirip kullanmayı seçtiğinizde güncellemelerin yayınlanması üzerinde kontrol sahibi olursunuz.

<Info>
  **Internete bağlı olmayan sunucular**

  Local Docker Kayıt Defteri (Local Docker Registry) kullanımı, eğer Apinizer'ın çalıştığı sunucuların hub.docker.com'a erişimi yok ise sürüm güncelleme işlemlerini gerçekleştirmenin en kolay yoludur.
</Info>

## Apinizer İmajlarının Private/Local Docker Registry ile kullanımı

Kubernetes'te Apinizer deploy dosyalarına yazım örneği aşağıdaki şekildedir:

```yaml
image: <MY_REGISTRY_ADDRESS>/apinizer-manager:<APINIZER_VERSION>
```

<Warning>
  Bu işlem Kubernetes 1.24.x sürümünden sonra ImagePullSecret bilgisi ile birlikte ayarlanmalıdır. Detaylı bilgi için bir sonraki adımı inceleyebilirsiniz.
</Warning>

### Apinizer eğer sisteminizde Kubernetes +1.24.x sürümü kuruldu ise

Öncelikle her bir namespace için ilgili docker registry'nin bilgilerini içeren bir secret oluşturulur:

```bash
kubectl create secret docker-registry <MY_REGISTRY_KEY> \
  --docker-server=<REGISTRY_SERVER> \
  --docker-username=<USERNAME> \
  --docker-password=<PASSWORD> \
  --docker-email=<EMAIL> \
  -n <NAMESPACE>
```

Bir önceki adımda oluşturulan secret bu adımda her bir secret kendi namespace'indeki serviceaccount'a olmak üzere eklenir. Apinizer için varsayılan serviceaccount ismi **default**'tur.

```bash
kubectl patch serviceaccount default -n <NAMESPACE> -p '{"imagePullSecrets": [{"name": "<MY_REGISTRY_KEY>"}]}'
```

Oluşturulan secret'lar ve kullanılan serviceaccount'lar aşağıdaki komutlar ile kontrol edilebilir.

```bash
kubectl get secrets -A
kubectl get serviceaccount -n <NAMESPACE>
```

Bu işlemlerden sonra bu namespace'lerde yeni oluşan her bir pod, ImagePullSecrets değeri dolu olarak gelecektir.

### Apinizer eğer sisteminizde Kubernetes 1.18.x sürümü ve Docker uygulamaları ile kuruldu ise

Varsayılan olarak docker, docker kayıt defterine bağlanmak için https kullanır. Ancak, özellikle güvenilir bir ağ üzerindeyseniz, güvenli olmayan bir kayıt defterini kullanmak için kullanım örnekleri olabilir. Bu, dahili kullanım için CA imzalı sertifika ihtiyacını veya **tüm docker** düğümlerinde kendinden imzalı sertifikaya güvenmeyi ortadan kaldırır. Güvensiz Kayıt Defteri'ni Docker Engine'e eklemenin adımları aşağıda verilmiştir.

**/etc/docker/daemon.json** dosya içindeki tüm satırlar silinip aşağıdaki satır eklenir.

```bash
vi /etc/docker/daemon.json
```

```json
{
  "insecure-registries" : ["<MY_REGISTRY_ADDRESS>"],
  "registry-mirrors":["https://<MY_REGISTRY_ADDRESS>"]
}
```

<Warning>
  Yukarıdaki satırı **/etc/docker/daemon.json** docker registry'e bağlanacak tüm sunucular üzerinde yapılması gerekmektedir.
</Warning>

Yukarıdaki değişiklikleri yaptıktan sonra Docker'ı yeniden başlatın.

```bash
systemctl restart docker
```
