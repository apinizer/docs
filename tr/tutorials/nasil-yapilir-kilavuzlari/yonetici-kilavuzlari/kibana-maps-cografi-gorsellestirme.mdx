# Kibana Maps ile Apinizer'a Gelen İsteklerin Coğrafi Olarak Görselleştirilmesi

Bu dokümanda, Apinizer'da kullanılan geolocation verilerinin Kibana Maps özelliği ile hangi şehirlerden istek geldiğinin harita üzerinde nasıl görselleştirileceği anlatılacaktır.

Apinizer'da 2025 versiyonu ile birlikte geolocation özelliğini kullanabilirsiniz. Geolocation özelliğini kullanmak için ilgili dökümanı [bakınız](/apinizer-dokumantasyonu/apinizer-da-geolocation-kullanarak-cografi-erisim-kontrolue-120522090.html).

## 1) Apinizer Üzerinden Sağlanan Geolocation Verisi

Apinizer'da gelen isteğin coğrafi konum verisi, Elasticsearch'te aşağıdaki gibi bir JSON formatında temsil edilmektedir.

```json
{
  "toClientBody": "[]",
  "loc": {
    "lat": 41.0,
    "lon": 28.0
  }
}
```

Lat (latitude) ve lon (longitude) değerleri, bir noktanın Dünya üzerindeki konumunu belirlemek için kullanılan coğrafi koordinatlardır.

**Örneğin:**

- Latitude: 41.0082° N, Longitude: 28.9784° E (İstanbul, Türkiye)
- Latitude: 40.7128° N, Longitude: 74.0060° W (New York, ABD)

## 2) Kibana'ya Veri Aktarma

### 2.1) Index Pattern Oluşturma

Kibana'ya veri aktarma adımında, Kibana **kurulumu** ve **entegrasyonu** sağlanmalıdır. Kibana kurulumu için ilgili dökümana [bakınız](/apinizer-dokumantasyonu/api-trafik-loglarini-kibana-ile-goersellestirme-91684981.html).

Kurulum sonrası Kibana'da, **Stack Management → Index Patterns** sayfasında, '**Create Index Pattern**' bölümünden yeni bir index pattern oluşturulabilir:

Elasticsearch'te kullanılan **data stream** seçilerek adımlar tamamlanır ve oluşturma işlemi gerçekleştirilir:

Oluşturma işlemi tamamlandıktan sonra, ilgili alanları (**fields**) aşağıdaki sayfada görebilirsiniz:

### 2.2) Mevcut Index Pattern'i Kontrol Etme

Kibana daha önce **kurulduysa** ve **index pattern mevcutsa** aşağıdaki **Stack Management →Index Patterns** sayfasıdan Kibanaya eklediğiniz indeksi yenileyin. Arama kısmına **'loc'** yazarak ilgili değerin var olduğunu kontrol etmelisiniz.

Kibana, bu **'loc'** verilerini (**enlem ve boylam**) kullanarak, **harita** üzerinde gelen isteklerin **görselleştirilmesini** sağlar.

## 3) Kibana Maps ile Harita Paneli Eklemek ve Görselleştirmesi

**Kibana** ana sayfasında, sol menüdeki "**Maps**" sekmesine tıklayın. Bu, harita görselleştirmeleri oluşturmak için kullanacağınız uygulamadır:

**Add layer** butonuna tıklayın. **Documents** seçeneğini tercih edin:

Index pattern'ı seçtikten sonra, 'loc' alanı otomatik seçilecek. Ardından, '**Add layer'** butonuna tıklayıp katmanı **ekleyip** isim vererek **kaydedebilirsiniz**:

## 4) Sonuç

Bu dokümanda, Apinizer'a gelen isteklerin **IP bilgileri coğrafi verilere dönüştürülüp** Elasticsearch'e gönderildikten sonra, **Kibana Maps** kullanılarak hangi şehirlerden istek geldiği adım adım **görselleştirilmiştir**.

Bu yapı sayesinde, kullanıcı erişimleri şehir bazında analiz edilebilir.

Harita üzerinde gelen istekler, **yeşil işaretçilerle** gösterilecektir:
