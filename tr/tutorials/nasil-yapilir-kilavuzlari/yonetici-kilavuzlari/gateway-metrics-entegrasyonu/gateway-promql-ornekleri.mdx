# Apinizer Gateway için Örnek PromQL Sorguları

Aşağıda, Apinizer Gateway metriklerini analiz etmek için kullanabileceğiniz örnek PromQL sorguları bulunmaktadır.

## API Trafik Analizleri

### 1. Toplam API İstek Sayısı (1 saat için)

```promql
sum(increase(apinizer_api_traffic_total_count_total[1h]))
```

### 2. API Başına İstek Sayısı (5 dakika için)

```promql
sum by (api_name) (increase(apinizer_api_traffic_total_count_tagged_total[5m]))
```

### 3. API Başarı Oranı (%) (10 dakika için)

```promql
(sum(increase(apinizer_api_traffic_success_count_total[10m])) / sum(increase(apinizer_api_traffic_total_count_total[10m]))) * 100
```

### 4. En Yüksek Hata Oranına Sahip API'ler (5 dakika için)

```promql
topk(5, sum by (api_name) (increase(apinizer_api_traffic_error_count_tagged_total[15m])) / sum by (api_name) (increase(apinizer_api_traffic_total_count_tagged_total[15m])))
```

### 5. API Başına Ortalama Yanıt Süresi (5 dakika için)

```promql
sum by (api_name) (rate(apinizer_api_traffic_total_time_tagged_seconds_sum[5m])) / sum by (api_name) (rate(apinizer_api_traffic_total_time_tagged_seconds_count[5m]))
```

## Harici Bağlantı Analizleri

### 1. Hedef URL Başına Hata Oranı

```promql
sum by (url) (increase(apinizer_external_requests_total_count_tagged_total[5m])) / sum by (url) (increase(apinizer_external_requests_total_count_tagged_total[5m]))
```

### 2. En Yavaş Servisler (Ortalama Yanıt Süresi)

```promql
topk(5, sum by (url) (rate(apinizer_external_response_time_seconds_sum[5m])) / sum by (url) (rate(apinizer_external_response_time_seconds_count[5m])))
```

## Cache Analizleri

### 1. Cache İsabet Oranı (%)

```promql
(sum(increase(apinizer_api_traffic_cache_hits_count_total[5m])) / sum(increase(apinizer_api_traffic_total_count_total[5m]))) * 100
```

### 2. API Başına Cache İsabet Oranı (%)

```promql
sum by (api_name) (increase(apinizer_api_traffic_cache_hits_count_tagged_total[5m])) / sum by (api_name) (increase(apinizer_api_traffic_total_count_tagged_total[5m])) * 100
```

## JVM Analizleri

### 1. Bellek Kullanım Yüzdesi

```promql
sum(jvm_memory_used_bytes) / sum(jvm_memory_max_bytes) * 100
```

### 2. Garbage Collection Süresi

```promql
sum(rate(jvm_gc_pause_seconds_sum[5m]))
```

### 3. Thread Sayısı

```promql
sum(jvm_threads_live_threads)
```
