---
title: "Örnek PromQL Sorguları"
description: "Apinizer Gateway metriklerini analiz etmek için kullanabileceğiniz örnek PromQL sorgularını sağlar. API trafik analizleri, harici bağlantı analizleri, cache analizleri ve JVM analizleri için hazır sorgu örnekleri içerir. Bu sorguları Prometheus veya Grafana'da kullanarak Gateway performansını izleyebilir ve analiz edebilirsiniz."
---

## API Trafik Analizleri

### Toplam API İstek Sayısı

<Card title="1 Saat İçin Toplam İstek Sayısı" icon="chart-line">
  Belirtilen zaman aralığındaki toplam API istek sayısını hesaplar.
</Card>

```promql
sum(increase(apinizer_api_traffic_total_count_total[1h]))
```

### API Başına İstek Sayısı

<Card title="5 Dakika İçin API Başına İstek Sayısı" icon="layer-group">
  Her API için ayrı ayrı istek sayısını hesaplar.
</Card>

```promql
sum by (api_name) (increase(apinizer_api_traffic_total_count_tagged_total[5m]))
```

### API Başarı Oranı

<Card title="10 Dakika İçin Başarı Oranı (%)" icon="check-circle">
  Başarılı isteklerin toplam isteklere oranını yüzde olarak hesaplar.
</Card>

```promql
(sum(increase(apinizer_api_traffic_success_count_total[10m])) / sum(increase(apinizer_api_traffic_total_count_total[10m]))) * 100
```

### En Yüksek Hata Oranına Sahip API'ler

<Card title="15 Dakika İçin En Yüksek Hata Oranı" icon="exclamation-triangle">
  Hata oranı en yüksek olan ilk 5 API'yi listeler.
</Card>

```promql
topk(5, sum by (api_name) (increase(apinizer_api_traffic_error_count_tagged_total[15m])) / sum by (api_name) (increase(apinizer_api_traffic_total_count_tagged_total[15m])))
```

### API Başına Ortalama Yanıt Süresi

<Card title="5 Dakika İçin Ortalama Yanıt Süresi" icon="clock">
  Her API için ortalama yanıt süresini hesaplar.
</Card>

```promql
sum by (api_name) (rate(apinizer_api_traffic_total_time_tagged_seconds_sum[5m])) / sum by (api_name) (rate(apinizer_api_traffic_total_time_tagged_seconds_count[5m]))
```

## Harici Bağlantı Analizleri

### Hedef URL Başına Hata Oranı

<Card title="5 Dakika İçin URL Başına Hata Oranı" icon="network-wired">
  Her harici URL için hata oranını hesaplar.
</Card>

```promql
sum by (url) (increase(apinizer_external_requests_total_count_tagged_total[5m])) / sum by (url) (increase(apinizer_external_requests_total_count_tagged_total[5m]))
```

### En Yavaş Servisler

<Card title="5 Dakika İçin En Yavaş Servisler" icon="tachometer-alt">
  Ortalama yanıt süresi en yüksek olan ilk 5 servisi listeler.
</Card>

```promql
topk(5, sum by (url) (rate(apinizer_external_response_time_seconds_sum[5m])) / sum by (url) (rate(apinizer_external_response_time_seconds_count[5m])))
```

## Cache Analizleri

### Cache İsabet Oranı

<Card title="5 Dakika İçin Genel Cache İsabet Oranı (%)" icon="database">
  Tüm API'ler için genel cache isabet oranını yüzde olarak hesaplar.
</Card>

```promql
(sum(increase(apinizer_api_traffic_cache_hits_count_total[5m])) / sum(increase(apinizer_api_traffic_total_count_total[5m]))) * 100
```

### API Başına Cache İsabet Oranı

<Card title="5 Dakika İçin API Başına Cache İsabet Oranı (%)" icon="tags">
  Her API için ayrı ayrı cache isabet oranını hesaplar.
</Card>

```promql
sum by (api_name) (increase(apinizer_api_traffic_cache_hits_count_tagged_total[5m])) / sum by (api_name) (increase(apinizer_api_traffic_total_count_tagged_total[5m])) * 100
```

## JVM Analizleri

### Bellek Kullanım Yüzdesi

<Card title="Anlık Bellek Kullanım Yüzdesi" icon="memory">
  JVM'in kullandığı bellek miktarının maksimum bellek miktarına oranını yüzde olarak hesaplar.
</Card>

```promql
sum(jvm_memory_used_bytes) / sum(jvm_memory_max_bytes) * 100
```

### Garbage Collection Süresi

<Card title="5 Dakika İçin GC Süresi" icon="recycle">
  Garbage Collection işlemlerinin toplam süresini hesaplar.
</Card>

```promql
sum(rate(jvm_gc_pause_seconds_sum[5m]))
```

### Thread Sayısı

<Card title="Anlık Thread Sayısı" icon="microchip">
  JVM'de çalışan aktif thread sayısını gösterir.
</Card>

```promql
sum(jvm_threads_live_threads)
```
