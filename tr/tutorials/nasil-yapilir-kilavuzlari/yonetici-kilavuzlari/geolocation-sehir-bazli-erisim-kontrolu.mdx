---
title: "Apinizer'da Geolocation Kullanarak Coğrafi Erişim Kontrolü"
description: "Geolocation özelliği kullanarak belirli şehirlerden gelen istekleri engelleme veya izin verme"
---

Bu döküman, Apinizer platformu üzerinde **geolocation** (coğrafi konum) özelliği kullanılarak belirli şehirlerden gelen isteklerin nasıl **engelleneceğini** veya **izin verileceğini** anlatmaktadır.

Çalışma sonunda, bu gelen isteklerin hangi şehirlerden geldiğini görselleştirmek için **Kibana Map** üzerinden gösterim yapacağız.

## 1) Geolocation Verisi Sağlama

Bu veriyi sağlamak için [MaxMind](https://www.maxmind.com/), [IpGeolocation](http://ipgeolocation.io) hizmetlerinden yararlanabilirsiniz. Bu hizmetler, IP ve şehir bilgisini içeren veritabanlarını indirmenize olanak tanır.

Bu adımda, **MaxMind'in** sunduğu ücretsiz **GeoLite2 City** **veritabanını** indirerek nasıl kullanılacağını anlatacağız.

Apinizer, **geolocation** verisini elde etmek için genellikle istemci IP adresini kullanır. Gelen IP adresi, bir veritabanı üzerinden sorgulanarak isteğin hangi şehirden geldiği belirlenir.

Sayfaya kayıt işlemi tamamlandıktan sonra, aşağıda belirtilen kırmızı işaretli alana giderek GeoLite2 City bölümünde zip dosyasını indiriyoruz ve bunu çıkartarak .mmdb uzantılı dosyamızı elde ediyoruz:

<Frame caption="MaxMind GeoLite2 City Veritabanı İndirme">
  <img
    src="/images/tutorials/nasil-yapilir-kilavuzlari/yonetici-kilavuzlari/geolocation-erisim-kontrolu/01-maxmind-download.png"
    alt="MaxMind GeoLite2 City Veritabanı İndirme"
    width="1000"
  />
</Frame>

## 2) Geolocation Veritabanının Apinizer'a Entegrasyonu

**Administration → System Settings → IP Geolocation Setting** sayfasından **.mmdb** uzantılı dosya buraya eklenir ve deploy edilir.

<Frame caption="IP Geolocation Setting Sayfası">
  <img
    src="/images/tutorials/nasil-yapilir-kilavuzlari/yonetici-kilavuzlari/geolocation-erisim-kontrolu/02-geolocation-settings.png"
    alt="IP Geolocation Setting Sayfası"
    width="1000"
  />
</Frame>

## 3) XFF Aktifleştirme ve Allowed/Blocked IP List Politikası Ekleme

Apinizer üzerinden, **X-Forwarded-For (XFF)** header bilgisi kullanılarak, isteklerde **(request)** istemcinin **(client)** gerçek **IP** adresi **belirlenebilir**.

**Allowed IP** politikası ile belirli IP adreslerinden veya belirli şehirlerden gelen isteklere **izin verilebilir**. **Blocked IP** politikası kullanılarak ise bu istekler **engellenebilir**.

XFF bilgisini kullanabilmek için, Proxy ayarları üzerinden Settings sekmesinde aktif edebilirsiniz:

<Frame caption="X-Forwarded-For (XFF) Aktifleştirme">
  <img
    src="/images/tutorials/nasil-yapilir-kilavuzlari/yonetici-kilavuzlari/geolocation-erisim-kontrolu/03-xff-settings.png"
    alt="X-Forwarded-For Aktifleştirme"
    width="1000"
  />
</Frame>

Bu Proxy'e Blocked IP List politikasını ekleyerek, İstanbul üzerinden gelen istekleri engelleyelim:

<Frame caption="Blocked IP List Politikası Ekleme">
  <img
    src="/images/tutorials/nasil-yapilir-kilavuzlari/yonetici-kilavuzlari/geolocation-erisim-kontrolu/04-blocked-ip-policy.png"
    alt="Blocked IP List Politikası"
    width="1000"
  />
</Frame>

IP Geolocation alanından İstanbul seçilir ve kaydedilir:

<Frame caption="İstanbul Şehri Seçimi">
  <img
    src="/images/tutorials/nasil-yapilir-kilavuzlari/yonetici-kilavuzlari/geolocation-erisim-kontrolu/05-istanbul-selection.png"
    alt="İstanbul Şehri Seçimi"
    width="1000"
  />
</Frame>

## 4) Erişimin Engellenmesi ve Sonuç

İstanbul lokasyonundaki bir IP adresi ile servise yapılan istekte erişim engellendi:

<Frame caption="Erişim Engellendi Sonucu">
  <img
    src="/images/tutorials/nasil-yapilir-kilavuzlari/yonetici-kilavuzlari/geolocation-erisim-kontrolu/06-access-blocked.png"
    alt="Erişim Engellendi"
    width="1000"
  />
</Frame>

## Özet

1. Apinizer platformu üzerinde İstanbul'dan gelen istekleri nasıl engellediğimizi anlattık.
2. MaxMind'in sunduğu GeoLite2 City veritabanını indirip, bu veriyi Apinizer'a entegre ettik.
3. X-Forwarded-For (XFF) header bilgisi ile istemcilerin gerçek IP adreslerini belirleyerek, belirli şehirlerden gelen istekleri kontrol ettik.
4. İstanbul'dan gelen istekleri engellemek için Block Ip List politikalarını kullanarak, İstanbul'u seçtik ve bu şehirden gelen erişimi başarıyla engelledik.

<Warning>
  Kibana üzerinden gelen isteklerin hangi şehirlerden geldiğini görselleştirmek için [Kibana Maps ile Coğrafi Görselleştirme](/apinizer-dokumantasyonu/kibana-maps-ile-apinizer-a-gelen-isteklerin-cografi-olarak-goersellestirilmesi-120522244.html) dokümantasyonuna bakınız.
</Warning>
