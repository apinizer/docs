---
title: "DB-2-API: Stored Procedure Çağırma"
description: "Apinizer Platformu'nda DB-2-API üzerinde stored procedure çağırma işlemlerini sağlar. Oracle veritabanındaki stored procedure'leri REST API endpoint'leri olarak yayınlayabilir, IN ve OUT parametreleri ile çalışabilir."
---

## Apinizer DB to API Tasarımcısı ile Oracle Veritabanında Procedure Çağrımı

> **Önemli**
>
> Apinizer **OracleTypes.CURSOR** desteklememektedir. Sadece basit procedure çağrımları servis olarak sunabilmektedir.

## 1. DB-2-API Oluşturma

**Yönetim → Geliştirme → API Creator** → **DB-2-API** ile yeni bir API tanımlanır.

<Frame caption="DB-2-API Oluşturma">
  <img
    src="/images/db2api-creation.png"
    alt="DB-2-API Oluşturma"
    width="1200"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

DB-2-API'nin ad ve açıklama alanları doldurulup **Kaydet ve İlerle (Save and Next)** butonuna tıklanır.

<Frame caption="DB-2-API Ayarları">
  <img
    src="/images/db2api-settings-stored-proc.png"
    alt="DB-2-API Ayarları"
    width="1200"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

## 2. Metot Oluşturma

**Ekle (Add)** butonuna tıklayarak method/endpoint oluşturma paneli açılır.

<Frame caption="Endpoint Ekleme">
  <img
    src="/images/add-endpoint-stored-proc.png"
    alt="Endpoint Ekleme"
    width="1200"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

### 2.1 Sadece IN Parametresi Kullanan Prosedür Çağrımı

Demo olarak kullanılan Oracle veritabanı prosedürü aşağıdaki örnekte görülmektedir:

```sql
create or replace PROCEDURE sampleProcedureWithInParams (
  pId IN NUMBER, 
  pName IN VARCHAR2, 
  pDesc IN VARCHAR2, 
  pCost IN NUMBER, 
  pPrice IN NUMBER, 
  pCat IN NUMBER
) IS 
begin 
  INSERT INTO "TEST"."PRODUCTS" (
    PRODUCT_ID, 
    PRODUCT_NAME, 
    DESCRIPTION, 
    STANDARD_COST, 
    LIST_PRICE, 
    CATEGORY_ID
  ) VALUES (pId, pName, pDesc, pCost, pPrice, pCat); 
  commit; 
end;
```

<Frame caption="Metot Oluşturma - IN Parametreleri">
  <img
    src="/images/method-creation-in-params.png"
    alt="Metot Oluşturma - IN Parametreleri"
    width="1200"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

### 2.2 IN ve OUT Parametresi Alan Prosedür Çağrımı

#### A. Demo olarak kullanılan Oracle veritabanı prosedürü aşağıda görülmektedir:

```sql
create or replace PROCEDURE sampleProcedureWithInOutParams (
  pId IN NUMBER, 
  pName OUT VARCHAR2
) IS 
begin 
  select PRODUCT_NAME into pName 
  from PRODUCTS 
  where PRODUCT_ID = pId; 
  commit; 
end;
```

<Frame caption="Metot Oluşturma - IN/OUT Parametreleri">
  <img
    src="/images/method-creation-in-out-params.png"
    alt="Metot Oluşturma - IN/OUT Parametreleri"
    width="1200"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

#### B. Demo olarak kullanılan Oracle veritabanı prosedürü aşağıda görülmektedir:

```sql
create or replace PROCEDURE sampleProcedureWithInOutCursorParams (
  cat_id IN NUMBER, 
  total_cost OUT NUMBER, 
  cursoroutparam OUT SYS_REFCURSOR
) IS 
begin 
  SELECT sum (standard_cost) INTO total_cost 
  FROM PRODUCTS 
  where category_id = cat_id; 
  
  OPEN cursoroutparam FOR 
    SELECT * FROM PRODUCTS 
    where category_id = cat_id; 
end;
```

<Frame caption="Metot Oluşturma - IN/OUT Cursor Parametreleri">
  <img
    src="/images/method-creation-in-out-cursor-params.png"
    alt="Metot Oluşturma - IN/OUT Cursor Parametreleri"
    width="1200"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

## 3. API Tanım Belgelerini Görüntüleme

**Mesaj İçeriğini Göster (Show Sample Message Body)** linkine tıklayarak mesaj içeriği görüntülenebilir.

<Frame caption="Show Sample Message Body">
  <img
    src="/images/show-sample-message-body-stored-proc.png"
    alt="Show Sample Message Body"
    width="1200"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

## 4. API Proxy Oluşturma

DB-2-API ekranından **API Proxy Oluştur (Create API Proxy)** butonuna tıklanarak anında API Proxy oluşturulabilir.

<Frame caption="API Proxy Oluştur">
  <img
    src="/images/create-api-proxy-stored-proc.png"
    alt="API Proxy Oluştur"
    width="1200"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

API Proxy'i oluştururken aşağıdaki görselde bulunan alanlar doldurularak **Kaydet** butonuna tıklanır.

<Frame caption="API Proxy Oluşturma Formu">
  <img
    src="/images/api-proxy-creation-form-stored-proc.png"
    alt="API Proxy Oluşturma Formu"
    width="1200"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

### 4.1 API Proxy'yi Canlıya Alma

API Proxy, tanımı yapılmış ortam (environment) üzerine hızlı bir şekilde yüklenip , istemcilerin tüketimine açılabilir.

Bu işlemin yönetimi API Proxy ekranındaki **Yükle ** butonuyla açılan diyalog üzerinden gerçekleştirilebilir.

<Frame caption="Deploy Dialog">
  <img
    src="/images/deploy-dialog-stored-proc.png"
    alt="Deploy Dialog"
    width="1200"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

## 5. Test Etme

### 5.1 IN Procedure'ünün Test Edilmesi

İlgili metodun beklediği parametreler isteğe eklenip çalıştırıldığında aşağıdaki başarılı yanıt dönmektedir.

<Frame caption="IN Procedure Test Sonucu">
  <img
    src="/images/test-result-in-proc.png"
    alt="IN Procedure Test Sonucu"
    width="1200"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

### 5.2 OUT Cursor Procedure'ünün Test Edilmesi

İlgili metodun beklediği parametreler isteğe eklenip çalıştırıldığında aşağıdaki başarılı yanıt dönmektedir.

<Frame caption="OUT Cursor Procedure Test Sonucu">
  <img
    src="/images/test-result-out-cursor-proc.png"
    alt="OUT Cursor Procedure Test Sonucu"
    width="1200"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

### 5.3 OUT Procedure Test Edilmesi

İlgili metodun beklediği parametreler isteğe eklenip çalıştırıldığında aşağıdaki başarılı yanıt dönmektedir.

<Frame caption="OUT Procedure Test Sonucu">
  <img
    src="/images/test-result-out-proc.png"
    alt="OUT Procedure Test Sonucu"
    width="1200"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>
