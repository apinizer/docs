---
title: "Script-2-API Kullanımı"
description: "Apinizer Platformu'nda Script-2-API kullanımını sağlar. JavaScript veya Groovy script dilleri ile metotlar oluşturarak REST API oluşturabilir, özel tanımlı değişkenler ile mesaj bölümlerini kod içinde kullanabilir, güncelleyebilir veya silebilir."
---

## 1. Script-2-API Oluşturma

Script-2-API ekranında kolay bir şekilde API'nin genel bilgileri girilerek REST API tanımlaması yapılır.

<Frame caption="Script-2-API Oluşturma">
  <img
    src="/images/script2api-creation.png"
    alt="Script-2-API Oluşturma"
    width="1000"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

### 1.1. /sendMail Metodunu Oluşturma

Aşağıdaki görselde, **/sendMail** metodu istek mesajının gövdesinden eposta bilgileri alınarak eposta gönderme işlemini Groovy diliyle oluşturulmaktadır.

Metot eklemek için **Ekle (Add)** butonuna tıklanıp metot bilgileri girilip **Kaydet** tuşuna basılır.

<Frame caption="Metot Ekleme">
  <img
    src="/images/add-method-sendmail.png"
    alt="Metot Ekleme"
    width="1000"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

**Dene (Try It)** butonuna tıklanarak script kodu test edilebilir.

Groovy kodu;

```groovy
import javax.mail.*
import javax.mail.internet.*
import groovy.json.JsonSlurper
import groovy.json.JsonOutput

try {
    requestHeaderMapFromClient.put('statusCode', 0);
    def jsonSlurper = new JsonSlurper()
    def jsonMessage = jsonSlurper.parseText(requestBodyTextFromClient)
    
    String from = jsonMessage.sender;
    if (from.equals("bilgi.apinizer")){
        from="info@apinizer.com";
    } else if(from.equals("apinizer.hata")){
        from="warning@apinizer.com";
    } else {
        statusCode=400;
        requestErrorMessageFromClient = JsonOutput.toJson([
            isTheOperationSuccessful: false, 
            errorMessage: 'Hatalı gönderen bilgisi', 
            errorCode:'01-ERR-02'
        ])
        return;
    }
    
    String to=jsonMessage.reciever;
    String cc=jsonMessage.recieverInformation;
    String bcc=jsonMessage.recieverInformation;
    
    if(!to?.trim() && !cc?.trim() && !bcc?.trim()){
        requestErrorMessageFromClient = JsonOutput.toJson([
            isTheOperationSuccessful: false, 
            errorMessage: 'En az bir alıcı eklenmeli', 
            errorCode:'01-ERR-03'
        ])
        statusCode=400;
        return;
    }
    
    String subject=jsonMessage.subject;
    if(subject?.trim()){
        subject=""
    }
    
    String content=jsonMessage.content;
    if(content?.trim()){
        content=""
    }
    
    String mimeType=jsonMessage.contentType;
    if(mimeType?.trim()){
        mimeType="text/html;charset=utf-8"
    }
    
    // Init constants of sender email account.
    String email = "apinizer.hata"
    String password = ""
    String host = "mail.apinizer.com"
    String port = "25" // "465" "587"
    
    // Set up properties.
    Properties props = System.getProperties()
    props.put("mail.smtp.user", email)
    props.put("mail.smtp.host", host)
    props.put("mail.smtp.port", port)
    props.put("mail.smtp.auth", "false")
    props.put("mail.smtp.starttls.enable", "false")
    props.put("mail.smtp.socketFactory.class", "javax.net.ssl.SSLSocketFactory")
    props.put("mail.smtp.ssl.trust", host) // Change host to "*" if you want to trust all host.
    
    Session session = Session.getInstance(props, new javax.mail.Authenticator() {
        protected PasswordAuthentication getPasswordAuthentication() {
            return new PasswordAuthentication(email, password);
        }
    });
    
    // Set up message.
    MimeMessage message = new MimeMessage(session)
    message.setFrom(new InternetAddress(from))
    if(to?.trim()){
        message.addRecipients(Message.RecipientType.TO, new InternetAddress(to))
    }
    if(cc?.trim()){
        message.addRecipients(Message.RecipientType.CC, new InternetAddress(cc))
    }
    if(bcc?.trim()){
        message.addRecipients(Message.RecipientType.BCC, new InternetAddress(bcc))
    }
    message.setSubject(subject)
    message.setContent(content, mimeType)
    
    try {
        // Send mail.
        Transport.send(message)
    } catch (MessagingException e) {
        e.printStackTrace();
        statusCode=500;
        responseErrorMessageToClient = JsonOutput.toJson([
            isTheOperationSuccessful: false, 
            errorMessage: 'Error occurred while sending mail:' + e.getMessage(), 
            errorCode:'01-ERR-04'
        ])
        return;
    }
    
    statusCode=200;
    responseBodyTextToClient = JsonOutput.toJson([
        isTheOperationSuccessful: true, 
        errorMessage: '', 
        errorCode:''
    ])
} catch (MessagingException e) {
    e.printStackTrace();
    statusCode=500;
    responseErrorMessageToClient = JsonOutput.toJson([
        isTheOperationSuccessful: false, 
        errorMessage: 'Error occurred while sending mail:' + e.getMessage(), 
        errorCode:'01-ERR-05'
    ])
    return;
}
```

Eposta gönderirken isteğin gövdesinde aşağı JSON gövdesi olmalıdır;

```json
{
 "sender":"info@apinizer.com",
 "reciever":"user@apinizer.com",
 "recieverInformation":null,
 "secretReceivers":null,
 "subject":"test",
 "content":"test",
 "contentType":"text/html;charset=utf-8"
}
```

Başarılı yanıt döndüğünde aşağı şablondaki mesaj şablon örneğiyle karşılaşılır;

```json
{
 "isTheOperationSuccessful":true,
 "errorMessage":"",
 "errorCode":""
}
```

Hatalı yanıt döndüğünde aşağı şablondaki mesaj şablon örneğiyle karşılaşılır;

```
Script Error: {
 "isTheOperationSuccessful":false,
 "errorMessage":"Error occurred while sending mail:Invalid Addresses",
 "errorCode":"01-ERR-04"
}
```

## 2. API Tanım Belgelerini Görüntüleme

Mail API'ye ait API tanım dosyalarına erişmek için **Spec'leri Göster (Show Specs)** linkine tıklanır.

<Frame caption="Spec'leri Göster">
  <img
    src="/images/show-specs-script2api.png"
    alt="Spec'leri Göster"
    width="1000"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

<Frame caption="Spec Bilgisi">
  <img
    src="/images/spec-info-script2api.png"
    alt="Spec Bilgisi"
    width="1000"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

## 3. API Proxy Oluşturma

Script-2-API ekranından **API Proxy Oluştur (Create API Proxy)** butonuna tıklanarak anında API Proxy oluşturulabilir.

<Frame caption="API Proxy Oluştur">
  <img
    src="/images/create-api-proxy-script2api.png"
    alt="API Proxy Oluştur"
    width="1000"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

API Proxy'yi oluştururken aşağıdaki görselde bulunan girdi alanları doldurularak **Kaydet** butonuna tıklanır.

<Frame caption="API Proxy Oluşturma Formu">
  <img
    src="/images/api-proxy-creation-form-script2api.png"
    alt="API Proxy Oluşturma Formu"
    width="1000"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

### 3.1 API Proxy'yi Canlıya Alma

Mail API Proxy, tanımı yapılmış ortam (environment) üzerine hızlı bir şekilde yüklenip , istemcilerin tüketimine açılabilir.

Bu işlemin yönetimi API Proxy ekranındaki **Yükle ** butonuyla açılan diyalog üzerinden gerçekleştirilebilir.

<Frame caption="Deploy Dialog">
  <img
    src="/images/deploy-dialog-script2api.png"
    alt="Deploy Dialog"
    width="1000"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

Bu işlem, aynı şekilde Script-2-API ekranında **API Proxy'leri Yönet (Manage API Proxies)** linkinden yönetilebilir.

<Frame caption="Manage API Proxies">
  <img
    src="/images/manage-api-proxies.png"
    alt="Manage API Proxies"
    width="1000"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>

## 4. Test Etme

API Proxy sayfası üzerinden **/sendMail** metodunun test edilmesini içeren görsel aşağıdadır.

<Frame caption="Test Sonucu">
  <img
    src="/images/test-result-sendmail.png"
    alt="Test Sonucu"
    width="1000"
    height="700"
    style={{ borderRadius: '0.5rem' }}
  />
</Frame>
