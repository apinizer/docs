---
title: Görevler Arası SOAP XML Veri Aktarımı ve Kullanımı
---

# Görevler Arası SOAP XML Veri Aktarımı ve Kullanımı

**Senaryo:** SOAP XML verisi dönen bir web servis çağrılacak, dönen sonuç içerisindeki array tipindeki elemanların her biri belirli bir format ile başka bir API'ye gönderilecektir.

Bu durumda iki tane API Call konnektörünü görev olarak eklenmelidir. Birincisi okuma diğeri ise döngü içinde yazma için gereklidir.

## Görev-1: API Call konnektörü ile veri okuma

- Görevlerin listelendiğin diyalogtan API Call seçeneğine tıklanır.
- Görevin bir kez çalışacağını belirtmek için "Once" seçeneği seçilir.
- Veri okumasının yapılacağı ilgili web servis erişim bilgileri girilir.
- Bir sonraki görevde web servisden dönen veriyi kullanabilmek için output anahtar bilgisine **"soap Response"** değeri verilir. (Bu değer adını istediğiniz şekilde isimlendirebilirsiniz.)

![Görev-1: API Call konnektörü ile veri okuma](/images/api-call-once-config.png)

Bu görev çalıştırıldığında bu örnekte aşağıdaki SOAP XML Verisi dönmektedir, yani **soapResponse** değeri içerisinde aşağıdaki veri olacaktır:

```xml
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:example="http://www.example.com">
 <soapenv:Header></soapenv:Header>
 <soapenv:Body>
  <example:users>
   <example:user>
    <example:id>1</example:id>
    <example:name>user 1</example:name>
    <example:description>description of user 1</example:description>
   </example:user>
   <example:user>
    <example:id>2</example:id>
    <example:name>user 2</example:name>
    <example:description>description of user 2</example:description>
   </example:user>
   <example:user>
    <example:id>3</example:id>
    <example:name>user 3</example:name>
    <example:description>description of user 3</example:description>
   </example:user>
  </example:users>
 </soapenv:Body>
</soapenv:Envelope>
```

## Görev-2: API Call konnektörü ile API'ye veri gönderme

- Görevlerin listelendiğin diyalogtan API Call seçeneğine tıklanır.
- Önceki görevden gelen dizi verisi üzerinde döngü ile çalışılacağını belirtmek için "Loop" seçeneği seçilir.
- Bir önceki görevde girilen output anahtar bilgisi **("soapResponse")** değerinin neresinin dizi olarak işlenmesi gerektiği bilgisi XPath olarak yazılır.
- XPath yazılırken bir önceki veri üzerinde XML olarak işlem yapılmasını belirtmek için **"#/"** işareti, anahtar bilgisine **("soapResponse )** eklenir. Sonrasında XPath olarak dizi elemanlarının olduğu path girilir. SOAP Xml içerisinde genellikle namespace'ler yer aldığından bu namespace'ler ile XPath yazılması zor olabilir. Bu durumda XPath içerisinde **local-name()** "metodu yazılması önerilmektedir. Bu örnek için XPath yazan yere şu yazılmalıdır: **"&#123;&#123;soapResponse#//*[local-name()='Items']/*[local-name()='Item']&#125;&#125;"**
- Verinin gönderileceği erişilmek istenen ilgili API erişim bilgileri girilir.
- Gönderilmek istenen şablon mesaj bilgisi girilir. Şablon mesaj bilgisi içerisinde döngüdeki elemanların değerleri kullanılmak istenirse **"LOOP_VARIABLE"** ifadesi ile ilgili eleman içindeki verinin şablona eklenmesi sağlanır. LOOP_VARIABLE ile beraber döngü için hedef gösterilen eleman içindeki SOAP XML verisine erişilecek XPath bilgisi girilmelidir.

![Görev-2: API Call konnektörü ile API'ye veri gönderme](/images/api-call-loop-config.png)

Bu örnekte, bir önceki görevden dönen **xmlResponse** verisi üzerinde **"&#123;&#123;xmlResponse#/root/users/user&#125;&#125;"** ifadesi çalıştırıldığında 3 adet eleman döner ve bu görevin 3 kez çalışacağını gösterir.

İlk çalışmada LOOP_VARIABLE değeri içinde aşağıdaki XML olacaktır.

```xml
<example:user>
 <example:id>1</example:id>
 <example:name>user 1</example:name>
 <example:description>description of user 1</example:description>
</example:user>
```

Bu XML üzerinde çalıştırılmak istenen şablon aşağıdaki gibi olduğunu düşünelim:

```json
{
 "test_id":"{{LOOP_VARIABLE#//*[local-name()='id']/text()}}",
 "test_name":"{{LOOP_VARIABLE#//*[local-name()='name']/text()}}",
 "test_description":"{{LOOP_VARIABLE#//*[local-name()='description']/text()}}"
}
```

Burada hedef veriyi almak için LOOP_VARIABLE yanında kullanılan XPath'in text() metodu ile bittiğine dikkat edilmelidir.

Bu durumda API Call ile gönderilecek istek gövdesi aşağıdaki şekilde olacaktır:

```json
{
 "test_id": "1",
 "test_name": "user 1",
 "test_description": "Description of user 1"
}
```
