---
title: "JWT Validasyonu"
description: "JWT Validasyonu"
---


Bu senaryoda **Swagger PetStore** isimli **REST** mimaride oluşturulmuş bir **API'ye,** gönderilen JWT'nin **J****OSE Validation** poliçesi ile kontrol edilmesi anlatılacaktır.

Aşağıdaki görselde bir isteğe uygulanacak olan JOSE Validation iş akışı yer almaktadır.  

<img src="/images/tutorials/j1.jpg" alt="JOSE Validation İş Akışı" width="1000" />

## 1) API Proxy'nin Oluşturulması

Bu senaryoda Swagger Petstore([https://petstore.swagger.io](https://petstore.swagger.io/)) isimli REST API kullanılacaktır.  

İlk olarak bu adresin **API Proxy** olarak tanımlanması gereklidir.

Bunun için **Development **menüsü altında yer alan **API Proxies** seçeneğine tıklanır. 

<img src="/images/tutorials/j2.png" alt="API Proxies Menüsü" width="200" />

  

Açılan sayfada daha önceden herhangi bir **proxy** tanımı yapılmadığı için **No records found!** yazısı yer alır.

Burada sağ üst köşede yer almakta olan **Create** butonuna tıklanır ve yeni bir **P****roxy** oluşturulmaya başlanır.

<img src="/images/tutorials/j3.png" alt="Create Butonu" width="600" />

  

Bu kısımda oluşturulacak olan **API Proxy'nin** hangi tipte olduğunun seçilmesi gerekmektedir.

Bu senaryoda kullanılacak olan API'nin türü **Swagger 2.X** olacağı için bu tür seçilir.

**Enter URL** ifadesine tıklanarak kullanılacak olan API'nin adresinin girileceği ekrana geçiş yapılır.

<img src="/images/tutorials/4.png" alt="Enter URL Ekranı" width="600" />

  

Aşağıdaki görselde de görüldüğü üzere **URL kısmına erişim sağlanacak adres girilerek Parse** butonuna tıklanır. 

<img src="/images/tutorials/5.png" alt="URL Girme Ekranı" width="1000" />

  

Parse işlemi yapıldıktan sonra ise aşağıdaki görselde yer alan ekran gelmektedir. 

<img src="/images/tutorials/6.png" alt="Parse Sonrası Ekran" width="1000" />

Bu ekran üzerinden API Proxy'ye ait ayarlar yapılabilmektedir. Bu ayarlar hakkında detaylı bilgi almak için [API Proxy Oluşturma](/tr/gelistirici/api-proxy-olusturma/api-proxy-olusturma) dokümanını ziyaret edebilirsiniz.  

Senaryomuzda kullanılacak olan Api Proxy'nin ayarları aşağıdaki gibidir.

<img src="/images/tutorials/7.png" alt="API Proxy Ayarları" width="1000" />

  

Kaydetme işleminden sonra ise açılan sayfada **Develop** sekmesine tıklanır.

<img src="/images/tutorials/8.png" alt="Develop Sekmesi" width="1000" />

  

Burada **REST API'ye **ait **endpoint'ler** listelenmektedir. 

**All **ifadesiyle **tüm metodlara** veya **tek bir** **metoda** **JOSE Validation** poliçesi eklenebilir.  

<img src="/images/tutorials/9.png" alt="Endpoint'ler Listesi" width="1000" />

  

JOSE Validationda**imza doğrulamasını** yapabilmek için **JSON Web Keypair Sets** eklenmesi gerekmektedir.

## 2) JSON Web Keypair Sets

JSON Web Keypair Sets eklemek için sol menüden Secret Manager altından JSON Web Keypair Sets menüsüne girilir.

<img src="/images/tutorials/10.png" alt="JSON Web Keypair Sets Menüsü" width="200" />

  

Açılan ekranda sağ üst köşede yer alan dikdörtgen içerisine alınmış **Create****** butonuna tıklanır.

<img src="/images/tutorials/11.png" alt="Create Butonu" width="600" />

  

Bu doküman içerisinde JSON Web Keypair Sets'in Apinizer ile veya Keycloak(3.party bir yazılım) ile üretilmesi üzerinde durulacaktır.

  

**2.1) Apinizer Üzerinden JWK Üretilmesi:**

Bu senaryoda Name alanı **testjwk senaryo** olarak kullanılacaktır.

**Generate JWK** seçeneği ile ve istenen algoritma kullanılarak JWK oluşturulur.

<img src="/images/tutorials/12.png" alt="Generate JWK Ekranı" width="1000" />  

  

Generate butonu kullanılması sonucu JWK oluşturulmaktadır. Oluşan Public Key doğrulama işlemlerinde kullanılmaya hazırdır.

<img src="/images/tutorials/13.png" alt="JWK Oluşturuldu" width="1000" />

Son adım olarak **Save And Deploy** butonuna tıklayarak kaydedilir.

  

**2.2) Keycloak Üzerinden JWK Üretilmesi :**

Keycloak üzerinden Realm Settings > Keys menüsünden Public key alanına basılarak Public key alınır.

<img src="/images/tutorials/14.png" alt="Keycloak Public Key" width="1000" />

  

<img src="/images/tutorials/15.png" alt="Keycloak Public Key Detay" width="1000" />

  

Public key, 3.party bir araçla JWK'ya dönüştürülmelidir. Bunun için şu adres kullanılabilir: [https://russelldavies.github.io/jwk-creator/](https://russelldavies.github.io/jwk-creator/)  

JWK'a dönüştürülen public keyi Apinizer'a Kaydetmek için;

  * Sol menüden Secret Manager menüsünün altından JSON Web Keypair Sets sayfasına gidilir.  

  * Bu senaryoda Name alanı **testjwk senaryo** olarak kullanılacaktır.
  * **Paste the content of the JWT** seçeneği seçilir ve ilgili alana JWK girilir.  

  * **Key id** alanına ise Keycloak 'da bulunan **Kid** alanındaki değer girilir ve ardına **Save and Deploy** butonuna tıklayarak kaydedilir.

<img src="/images/tutorials/16.png" alt="JWK Paste Ekranı" width="1000" />  

## 3) Authentication Poliçesinin Eklenmesi

Artık **JOSE Validation****** poliçesi kullanılabilir duruma gelmiştir. 

API Proxy'lerin listelendiği sayfaya gidilir ve buradan **Swagger Petstore **isimli proxy seçilir.

Daha sonra ise **Develop **sekmesine gelinir, **Add Policy** butonuna tıklanır.

Açılan sayfada **JOSE Validation********** poliçesi seçilir.

<img src="/images/tutorials/17.png" alt="JOSE Validation Poliçesi Seçimi" width="1000" />

  

Seçilen

<img src="/images/tutorials/18.png" alt="JOSE Validation Ayarları" width="1000" />

  

Bu ekran üzerinde yer alan ifadeler tek tek incelenmek istenirse [JWKS Yapılandırması](/tr/admin/gizlilik-yonetimi/jwks-yapilandirma) sayfasını ziyaret edebilirsiniz.  

Bu senaryo içerisinde kullanılacak olan ayarlamalar aşağıdaki görselde yer aldığı gibidir bu değişiklikleri yaptıktan sonra sağ üst köşede yer alan **Save** butonuna tıklanır.

<img src="/images/tutorials/19.png" alt="JOSE Validation Ayarları Detay" width="1000" />

## 4) API Proxy'nin Test Edilmesi

**Swagger Petstore** isimli proxy seçilir. 

**Develop** sekmesi altında yer alan **/pet/findByStatus****** isimli endpoint seçilir. 

**Test Endpoint** ifadesine tıklanarak bu endpoint test edilir.

URL' de istenilen**status** değeri **pending****** olarak girilir, **Send** butonuna basıldığında dönen yanıtın bir hata mesajı olduğu görülür. 

**Header** içerisine **Authorization header** yerleştirilir ve keycloak'tan veya Apinizer'dan üretilmiş **token bilgisi** burada kullanılır.

**Send** butonuna tıkladığında alınan cevap görsel üzerinde aşağıda yer alan dikdörtgen içerisindeki ifadedir.

<img src="/images/tutorials/20.png" alt="Test Endpoint Sonucu" width="1000" />  

  

Eğer uygun olmayan token değeri kullanılırsa hata alınacaktır.

×