---
title: SOAP Web Servise Security Manager Provider Aracılığıyla Plain-Text Authentication Poliçesinin Uygulanması
---

# SOAP Web Servise Security Manager Provider Aracılığıyla Plain-Text Authentication Poliçesinin Uygulanması

Bu senaryoda **Calculator** isimli bir **SOAP web servisine** **Plain-Text Authentication** poliçesinin uygulanması test edilecektir.

Aşağıdaki grafikte yer alan numaralandırmalar işlemlerin **yapılış sırasına aittir.**

- **Apinizer** içerisinde yer alan **Security Manager, API Client'tan Plain-Text türünde authentication** bilgisini ister. Bu **authentication** bilgisi doğru ise iki numaralı alana geçiş yapılır.
- **Apinizer, Backend API'ye** istekte bulunur.
- **Backend API, Apinizer'a** yanıt verir.
- **Apinizer, API Client'a** yanıt verir.

![Senaryo Akışı](/images/soap-plain-text-auth-scenario.png)

## API Proxy'nin Oluşturulması

Calculator isimli web servise [http://www.dneonline.com/calculator.asmx?WSDL](http://www.dneonline.com/calculator.asmx?WSDL) adresinden erişim sağlanabilmektedir.

İlk olarak bu adresin **API Proxy** olarak tanımlanması gereklidir.

Bunun için **Development** menüsü altında yer alan **API Proxies** seçeneğine tıklanır.

![API Proxies Menüsü](/images/api-proxies-menu.png)

Açılan sayfada daha önceden herhangi bir **proxy** tanımı yapılmadığı için **No records found!** yazısı yer alır.

Burada sağ üst köşede yer almakta olan **Create** butonuna tıklanır ve yeni bir **proxy** oluşturmaya başlanır.

![Create Butonu](/images/create-button.png)

Eklenecek API proxy bir SOAP web servis olduğu için **WSDL menüsünden** **Enter URL** ifadesine tıklanarak kullanılacak olan web servisin adresinin girileceği ekrana geçiş yapılır.

![WSDL Enter URL](/images/wsdl-enter-url.png)

Aşağıdaki görselde de görüldüğü üzere **URL kısmına erişim sağlanacak adres girilerek Parse** butonuna tıklanır.

![Parse WSDL](/images/parse-wsdl.png)

Çözümlemeyi yaptıktan sonra ise aşağıdaki görselde yer alan ekran karşımıza çıkmaktadır. Bu ekran üzerinden API Proxy'ye ait ayarlar yapabilmektedir.

- **Usage** alanı ile oluşturmuş olunan API Proxy'nin kim tarafından kullanacağı belirtilir. Burada **publisher, consumer, publisher and consumer** gibi seçenekler yer almaktadır.
- **Protocol Transformation** sekmesi altında yer alan iki farklı seçenek bulunmaktadır;
  - **Pass-Through SOAP** web servis üzerinde hiçbir transform işlemi yapmadan SOAP web servis haliyle kullanılmasına olanak sağlar.
  - **REST to SOAP to REST** ise bu SOAP web servisin REST mimari içerecek bir yapıda kullanılmasına olanak sağlar.
- **Addresses** sekmesi altında yer alan iki API adresinden biri veya her ikisi de seçilebilir eğer iki adres de seçilecek olursa Apinizer **Load Balance** işlemini kendisi gerçekleştirecektir.
- **Relative Path** ise oluşturulan API Proxy'nin erişime açılacak adresidir.
- **Category List** alanı da oluşturulan API Proxy'nin kategorilendirilmesine olanak sağlar.
- Bu ayarlamalar yapıldıktan sonra API Proxy kaydedilir.

![API Proxy Ayarları](/images/api-proxy-settings-soap.png)

Kaydetme işleminden sonra ise açılan sayfada **Develop** sekmesine tıklanır.

![Develop Sekmesi](/images/develop-tab.png)

Burada web servise ait olan **metotlar** görülmektedir.

- Bu metotların üstünde yer alan **All** ifadesiyle eklenecek olan poliçeler **tüm metotlara** uygulanabilmektedir.
- Oluşturulan API Proxy deploy edilir. Bunun için yukarıda orta kısımda yer alan **Deploy** butonuna tıklanır.
- Sonraki adımda **Credentials** ekleyerek oluşturulan API Proxy'ye hangi kullanıcıların erişim sağlayacağı belirtilir.

![Metotlar ve Deploy](/images/methods-deploy.png)

## Credentials Oluşturulması

Eklenecek **Credential'a** ait bilgiler **username = apinizer**, **password = 123123aA** olacak şekildedir.

Bunun için **Identity Management** menüsüne gelinir.

Burada ise **Credential Management** menüsü altında yer alan **Credentials** menüsüne tıklanır.

![Credentials Menüsü](/images/credentials-menu.png)

Açılan ekranda sağ üst köşede yer alan dikdörtgen içerisine alınmış **Create** butonuna tıklanır.

![Create Credential](/images/create-credential.png)

Burada gerekli olan alanlar daha önceden belirtilen bilgilerle doldurulur ve **Save and Deploy** butonuna tıklayarak oluşturulan **credential** kaydedilir.

![Credential Form](/images/credential-form.png)

Bu **credential öğesinin** erişim sağlayacağı proxy'nin seçilmesi gerekmektedir. Oluşturulan **credential'ın** üzerine gelip yanda yer alan menüden **Edit** seçeneğine tıklanır.

![Edit Credential](/images/edit-credential.png)

Açılan ekran üzerinden **API Proxy ACL** sekmesine tıklanır, bu sekme içerisinde yer alan ve görsel üzerinde kırmızı dikdörtgen içerisinde belirtilen butona tıklanır.

![API Proxy ACL](/images/api-proxy-acl.png)

Açılan sayfada şu an üzerinde çalışılan projede bulunan **API Proxy'ler** listelenmektedir. **Calculator** isimli **proxy** seçilir.

**Add** butonuna tıklayarak oluşturulan **Credential** öğesinin bu **proxy'ye erişimi olacağı belirtilir.**

![Add API Proxy](/images/add-api-proxy.png)

Daha önceden boş bir şekilde görünen listede artık bir adet **API Proxy** bulunmaktadır.

Sağ üst köşede yer alan **Save and Deploy** butonuna tıklanır ve yapılan işlem kaydedilir.

![Save and Deploy](/images/save-deploy-credential.png)

## Authentication Poliçesinin Eklenmesi

Artık **Plain-Text Authentication** poliçesi eklenebilir duruma gelmiştir.

API Proxy'lerin listelendiği sayfaya gidilir ve buradan **Calculator** isimli proxy seçilir.

Daha sonra ise **Develop** sekmesine gelinir, **Add Policy** butonuna tıklanır.

Açılan sayfada **Plain-Text Authentication** poliçesi seçilir.

![Add Policy](/images/add-policy-plain-text.png)

Bu ekran üzerinde yer alan ifadeler tek tek incelenecek olursa,

- **Identity/Role/Group Service** alanında seçilecek olan değer **Security Manager** değeridir. Çünkü credentials kontrolü **Security Manager** tarafından gerçekleştirilecektir.
- **Variable for username** ve **variable for password** ifadeleri ile de kullanıcı adı ve parola bilgisinin hangi değişken ile alınacağı seçilir. Bu senaryoda bu değerler **header** içerisinden alınacaktır.
- **Clear Authentication Information** seçeneği seçilirse gelen mesaj içerisinde authentication bilgisi silinir.
- **Add Client Info To Header** seçeneği backend API'ye gidecek Header içerisinde istemciye ait bilgilerin bulunup bulunmayacağını belirtir.
- Bu seçenek aktif duruma gelirse **Authenticated User Header Name** isminde başka bir parametre ortaya çıkmaktadır.
- Burada yer alan **X-Authenticated-UserId** ifadesi ise backend API'ye gidecek olan istemci bilgisinin hangi başlık ismi ile gideceğini belirtmektedir.

![Plain-Text Authentication Ayarları](/images/plain-text-auth-settings.png)

Poliçe kaydolduğu zaman kırmızı dikdörtgen içerisine alınmış ikon görülmektedir.

Yapılan işlemin geçerli olması için proxy'nin **Redeploy** olması gerekmektedir. Şimdi proxy'nin içerisinde yer alan metotların test işlemi gerçekleştirilebilir.

![Policy Added](/images/policy-added.png)

## API Proxy'nin Test Edilmesi

**Add** metodunu seçtikten sonra **Test Method** butonuna tıklanır.

![Test Method](/images/test-method.png)

Body içerisinde istenilen değerler yazıldıktan sonra **Send** butonuna tıklanır ve **backend API'ye** istekte bulunulur.

![Test Request](/images/test-request-no-auth.png)

Aşağıdaki görselde de görüldüğü üzere **backend API'ye** hiçbir **authentication** bilgisi gönderilmediği için yanıt olarak dikdörtgen içerisinde yer alan hata mesajı alınır.

![Error Response](/images/error-response-no-auth.png)

Bu sefer header içerisine **username** ve **password** ifadeleri girilip test yeniden gerçekleştirilir.

**Backend API'ye** gönderilecek olan **headers** içerisinde **username = apinizer**, **password = 123123aA** değerleri girilir.

**Send** butonuna tıkladığında alınan cevap görsel üzerinde aşağıda yer alan dikdörtgen içerisindeki ifadedir.

![Success Response](/images/success-response-with-auth.png)
