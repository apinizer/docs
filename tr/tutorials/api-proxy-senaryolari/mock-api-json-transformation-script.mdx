---
title: Oluşturulan Mock API Üzerinden JSON Transformation ve Script Poliçesinin Uygulanması
description: Apinizer üzerinde Mock API oluşturma, JSON Transformation ve Script poliçelerini uygulama, API Proxy oluşturma ve test etme adımlarını içeren detaylı senaryo rehberi.
---

Bu senaryoda Apinizer üzerinde oluşturulan Mock API'ye **JSON Transformation** ve **Script** poliçesinin uygulanması test edilecektir.

Aşağıdaki grafikte yer alan numaralandırmalar işlemlerin **yapılış sırasına aittir.**

- **API Client**, **Apinizer'a istekte** bulunur.
- **Apinizer**, **Cars Mock API**'ye istekte bulunur.
- **Cars Mock API**'den dönen yanıt içerisinde yer alan **tip, yıl, fiyat** **key'leri** **JSON Transformation poliçesi** uygulanarak **type, year, price key** ifadelerine dönüştürülür ve Apinizer'a iletilir.
- **Script poliçesinin** çalışması ise **opsiyoneldir.** Çünkü bu poliçe **API Client'dan** gelen **istek içerisinde** herhangi bir **Order By parametresi** varsa çalışmaktadır.
- **Apinizer'dan API Client'a yanıt** verilir.

<img src="/images/tutorials/mock-api-json-transformation-scenario.png" alt="Senaryo Akışı" width="1000" />

## Mock API'nin Oluşturulması

İlk olarak istekte bulunulacak **Mock API'nin** tasarımı gerçekleştirilir.

Bunun için **Development** menüsü altında yer alan **API Creator** menüsünde bulunan **Mock API** seçeneği seçilir.

<img src="/images/tutorials/mock-api-menu.png" alt="Mock API Menüsü" width="200" />

Daha önceden herhangi bir **Mock API** oluşturulmadığı için **No records found** ifadesi sayfada yer almaktadır.

Sağ üst köşede yer alan **Create** butonuna tıklanır ve **Mock API** oluşturmaya başlanır.

<img src="/images/tutorials/create-mock-api.png" alt="Create Mock API" width="1000" />

Bu ekran üzerinde yer alan ifadeler tek tek incelenecek olursa,

- İki farklı şekilde **Mock API** oluşturma seçeneği yer almaktadır.
- **Blank** ifadesi seçili olduğunda **Name** ve **Description** ifadeleri yer almaktadır.
- **Name** alanı ile API'nin ismi belirlenir.
- **Description** ifadesi ile de bu API'ye ait açıklamalar yazılabilir.
- **Generate Crud Operations** ifadesi ile de oluşturulacak Mock API içerisinde **GET**, **POST**, **DELETE**, **PUT** operasyonlarının hazır bir şekilde gelmesi belirtilir.

<img src="/images/tutorials/import-spec-option.png" alt="Import Spec Seçeneği" width="1000" />

- Eğer **Import Spec** seçeneği seçilirse aşağıda yer alan görseldeki gibi sayfa oluşacaktır.
- Bu ifade ile hazırda bulunan bir **API** Apinizer'a dahil edilebilir.
- **API Spec Type** ifadesi altında yer alan seçenekler eklenecek olan API'nin hangi tipte olduğu belirtilir.
- **Import Type** ise ekleme işleminin nasıl yapılacağını belirtir.

Bu senaryoda boş bir **Mock API** oluşturulacaktır bu yüzden "Blank" ifadesi seçilir ve ilgili alanlar görseldeki gibi doldurulur.

**Save and Next** butonuna tıklanarak işlem kaydedilip bir sonraki adıma geçilir.

<img src="/images/tutorials/mock-api-definition.png" alt="Mock API Definition" width="1000" />

Bu ekran üzerinde yer alan ifadeler tek tek incelenecek olursa,

- **Definition - API Information** alanında API'ye ait isim ve açıklama bilgisi görülmektedir.
- **API Endpoints -Endpoints of the API** alanında ise **Mock API'nin** sahip olduğu **endpoint'ler** yer almaktadır.
- Yine bu alan içerisinde bulunan **Add** butonu ile yeni bir endpoint eklenebilir ya da var olan endpoint'ler seçilerek bunlar üzerinde de değişiklikler yapılabilir.

<img src="/images/tutorials/response-body-edit.png" alt="Response Body Edit" width="1000" />


<Info>
    Bu senaryoda "GET" türünde "/getCarList" isimli endpoint üzerinden testler gerçekleştirilecektir.
</Info>

İlgili endpoint seçildikten sonra oluşacak olan sayfada yer alan alanlar incelenecek olursa;

- **HTTP Method** alanı ile oluşturulacak endpoint'in türü belirlenmektedir.
- Hemen yanında yer alan alanda ise endpoint'in ismi belirtilir.
- **Description** ifadesi ile de bu endpoint'e bir açıklama eklenebilir.
- **Response Information - Enter Response Details** alanı ile istek yapıldığı zaman alınacak olan yanıtlar belirlenir.
- Bu alan içerisinde yer alan içerisinde "+" bulunan buton ile de yeni yanıtlar oluşturulabilir.
- Bu senaryoda sadece **"200"** yanıtı dönen bir **response** tasarımı gerçekleştirilecektir.
- İçerisinde kalem ikonu bulunan buton ise ilgili dönecek yanıtın düzenleme işlemlerinin gerçekleştirilmesini sağlar.

<img src="/images/tutorials/create-api-proxy-button.png" alt="Create API Proxy Button" width="1000" />

Bu ekran üzerinde yer alan ifadeler tek tek incelenecek olursa,

- **Response Body** içerisinde endpoint'e istekte bulunduğunda alınacak yanıt belirtilmektedir.
- Bu alan içerisinde tipi, yılı ve fiyatı verilen bir liste bulunmaktadır.
- **Status Code** alanı ile dönecek olan yanıtın türü , **Response Content Type** alanı ile de dönecek olan içeriğin tipi belirlenir.
- Yanıt içerisinde bir **Headers** parametresi gönderilecek olursa eğer **Headers** alanı içerisinde belirtilir.
- Bu yanıt içerisinde bir koşul oluşturmak istenirse de **Condition** alanı içerisinden kural tanımı yapılabilir.
- Bu yapılan değişikliklerden sonra ise **Edit** butonuna tıklanarak düzenlemeler kaydedilir.


<img src="/images/tutorials/api-proxy-settings-mock.png" alt="API Proxy Settings" width="1000" />

Sağ alt köşede yer alan **Save** butonuna tıklanarak değişiklikler kaydedilir.

Sağ üst köşede yer alan **Create API Proxy** butonu ile de Mock API'den bir API Proxy oluşturulur.
<img src="/images/tutorials/deploy-proxy-mock.png" alt="Deploy Proxy" width="1000" />


## Mock API'den API Proxy Oluşturulması

Proxy'nin kullanımı ve kategorisi belirlenir.

Proxy'ye uygun bir **Relative Path** verilir ve sağ üst köşede yer alan **Save** butonuna tıklanır.
<img src="/images/tutorials/test-endpoint-mock.png" alt="Test Endpoint" width="1000" />


**Deploy** butonuna tıklanır ve **proxy** deploy edilir.

<img src="/images/tutorials/response-without-policy.png" alt="Response Without Policy" width="1000" />

**Develop** menüsü altında yer alan **/getCarList** endpoint'i seçilir ve **Test Endpoint** butonuna tıklanır.

<img src="/images/tutorials/add-policy-json-transformation.png" alt="Add Policy" width="1000" />
<Info>
    İlk olarak gerçekleştirilecek testte hiçbir şekilde poliçe uygulaması yapılmayacaktır.

</Info>

URL alanı içerisinde bulunan adrese istekte bulunulduğunda yanıt olarak **Response** alanı içerisinde yer alan **JSON verisi** görülmektedir.

Dönen yanıt incelenecek olunursa eğer içerisinde **"tip"**, **"yil"** ve **"fiyat"** **key** ifadeleri bulunan bir liste dönmektedir.
<img src="/images/tutorials/select-json-transformation.png" alt="Select JSON Transformation" width="1000" />


## JSON Transformation Poliçesinin Eklenmesi

Senaryoda yer alan **key** ifadelerinin değişmesini sağlamak için bir poliçe eklenmesi gereklidir.

Bu poliçede API'den Client'a yanıt olarak gidecek olan alan içerisinde yer alacaktır.

Aşağıdaki görselde görülen alanda yer alan **Add Policy** ifadesine tıklanır.
<img src="/images/tutorials/json-transformation-settings.png" alt="JSON Transformation Settings" width="1000" />


Açılan ekranda aşağıdaki görselde de işaretlenmiş olan **JSON Transformation** poliçesi seçilir.

<img src="/images/tutorials/response-with-json-transformation.png" alt="Response With JSON Transformation" width="1000" />

Bu ekran üzerinde yer alan ifadeler incelenecek olursa;

- **Description** alanı ile kullanılacak olan poliçeye açıklama eklenebilir.
- **Configuration - Enter the policy configurations** alanı ile de değiştirilecek mesaj için gerekli olan **Jolt Değeri** yazılır.
- **Test Jolt** ifadesi ile de yazılan konfigürasyon test edilir.
- Oluşturulan poliçe **Save** butonuna tıklanarak kaydedilir.
- Yapılan değişikliklerin geçerli olması için **Redeploy** butonuna tıklanır.
- Seçili olan endpoint'in test edilmesine geçilir.
<img src="/images/tutorials/add-script-policy.png" alt="Add Script Policy" width="1000" />


Aşağıdaki görselde de görüldüğü üzere, belirtilen **endpoint'e** istekte bulunulduğunda **Mock API'den** dönmekte olan yanıttaki **key** ifadelerinin değiştiği görülmektedir.

<img src="/images/tutorials/script-policy-settings.png" alt="Script Policy Settings" width="1000" />

## Script Poliçesinin Eklenmesi

Sırada ise istemciden gönderilecek "Order By" parametre değerine göre sıralama yapacak olan **script'in** çalıştırılması vardır.

Bunun için Mock API'den istemciye gönderilen yanıtın bulunduğu alana **Script poliçesinin** eklenmesi gereklidir.

**Add Policy** ifadesine tıklanır ve buradan **Script poliçesi** seçilir.
<img src="/images/tutorials/policy-order.png" alt="Policy Order" width="1000" />



Bu ekran üzerinde yer alan ifadeler tek tek incelenecek olursa,

- **Script Language** alanı ile oluşturulacak olan **Script'in** hangi programlama dili ile yazılacağı seçilir.
- **Script Body** alanı içerisinde hem script yazılacak alan hem de script yazarken kullanımı kolaylaştıran hazır fonksiyonlar bulunmaktadır.
- Bu senaryoda **ResponseBodyTextToClient** isimli fonksiyon kullanılacaktır.
- Diğer hazır fonksiyonlar hakkında bilgi almak için [buradaki](/tr/gelistirici/politikalar/script) linke tıklayabilirsiniz.
- Kullanılacak olan script yazıldıktan sonra ise **Save** butonuna tıklanır ve poliçe kaydedilir.

<img src="/images/tutorials/test-without-order.png" alt="Test Without Order" width="1000" />

Proxy üzerinde son yapılan eklemelerin ardından **Redeploy** edilir.

İlk olarak **JSON Transformation** poliçesinin çalıştırılıp daha sonra **Script** poliçesinin çalıştırılması gereklidir.

Bunun için **JSON Transformation** poliçesine ait ikonun sona alınması gereklidir. Oluşturulmak istenen kullanım aşağıdaki görselde yer almaktadır.
<img src="/images/tutorials/test-with-order-year.png" alt="Test With Order Year" width="1000" />


## API Proxy'nin Test Edilmesi

**Test Endpoint** ifadesine tıklanır.

İlk testte mock API'ye hiçbir query parametresi gönderilmez ve "Response" alanı içerisinde yer alan cevap elde edilir.
<img src="/images/tutorials/test-with-order-price.png" alt="Test With Order Price" width="1000" />


Daha sonra ise **order=year** query parametresi eklenerek alınacak olan yanıtın yıla göre sıralanması sağlanır.
<img src="/images/tutorials/mock1.png" alt="Test With Order Price" width="1000" />


Son olarak **order=price** query parametresi eklenerek alınacak olan yanıtın yıla göre sıralanması sağlanır.

<img src="/images/tutorials/mock2.png" alt="Test With Order Price" width="1000" />
