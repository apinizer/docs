---
title: "İlk Sorgunun Yavaş Gelmesi"
description: "Elasticsearch'te belirli bir süre sorgulamalara ara verildiğinde ilk sorgunun yavaş gelmesi sorununu çözebilir. Refresh interval ve idle after ayarlarını optimize ederek sorgu performansını iyileştirebilir ve ilk sorgu gecikmelerini minimize edebilir."
---

## Çözüm Seçenekleri

### 1. Index Search Idle After Ayarlama

Bir shard'ın, aramanın idle olduğu kabul edilene kadar ne kadar süreyle arama alamayacağı veya istek alamayacağını belirten değeri değiştirir.

```bash
index.search.idle.after=30sn
```

<Note>
- Bu değer arttırıldığında, refresh işlemi için iki sorgu arasında geçmesi gereken süre artar.
- Bu sorunu sadece biraz daha uzun vadede olması için öteler.
- Eğer sık sorgulanan bir sistem ise düşünülebilir.
</Note>

### 2. Index Refresh Interval Ayarlama

Index'te yapılan son değişiklikleri arama için görünür hale getiren refresh işleminin ne sıklıkta gerçekleştirileceğini belirten değeri değiştirir.

```bash
index.refresh_interval=1sn
```

<Note>
- Bu değer arttırıldığında refresh'in belirli sürelerde otomatik yapılması sağlanır.
- Bu sorgu sonuçlarında belirli süre boyunca güncel olmayan verilerin gelebilmesine ve sistem kaynaklarının daha fazla tüketilmesine yol açar.
- Eğer sık sorgulanma yapılmıyorsa ama sorgulama yapan uygulamanın performanslı olması gerekiyorsa ayarlanması önem arz eder.
- Bu yenileme süresinin fine-tune edilmesi ihtiyacınıza göre değişir.
</Note>

## Index Ayarını Değiştirme

<Info>
`elasticsearch.yml` dosyasında index bazlı ayarlar yapılamaz.

Index bazlı ayarlar ya index template kullanarak ya da index ayar API'si kullanılarak değiştirilebilir.
</Info>

### API Kullanımı

#### Tüm Index'lerde Ayarlama

Aşağıda tüm index'lerde bu ayarın API kullanımı ile ayarlanması gösterilmiştir:

```bash
curl -X PUT "<ELASTICSEARCH_IP>:9200/_all/_settings?preserve_existing=true&ignore_unavailable=true" \
  --header 'Content-Type:application/json' \
  -d '{
    "index": {
      "refresh_interval": "5s"
    }
  }'
```

#### Belirli Index'te Ayarlama

Aşağıda sadece belirtilen index'te bu ayarın API kullanımı ile ayarlanması gösterilmiştir:

```bash
curl -X PUT "<ELASTICSEARCH_IP>:9200/apinizer-log-apiproxy-<INDEX_KEY>/_settings?preserve_existing=true&ignore_unavailable=true" \
  --header 'Content-Type:application/json' \
  -d '{
    "index": {
      "refresh_interval": "5s"
    }
  }'
```

### Index Template Kullanımı

Aşağıda sadece ilgili index için Index Template kullanılarak bu ayarın ayarlanması gösterilmiştir:

<Note>
Index Template kullanımı, yeni oluşturulacak index'ler için otomatik olarak bu ayarların uygulanmasını sağlar.
</Note>

```json
{
  "data_stream": {},
  "index_patterns": [
    "<INDEX_PATTERN_NAME>"
  ],
  "template": {
    "mappings": { ... },
    "settings": {
      "index": {
        "lifecycle": {
          "name": "<ILM_POLICY_NAME>"
        },
        "number_of_replicas": "0",
        "number_of_shards": "1",
        "refresh_interval": "5s"
      }
    }
  }
}
```
