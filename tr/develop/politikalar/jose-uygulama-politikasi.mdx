---
title: "JOSE Uygulama Politikası"
description: "İstek veya yanıttan JWT üretebilir, imzalayabilir ve isteğe bağlı olarak şifreleyebilirsiniz"
---

<Tip>
    Bu doküman spesifik bir politikanın detaylı kullanımını anlatır. Eğer Apinizer politika yapısını ilk kez kullanıyorsanız veya politikaların genel çalışma prensiplerini öğrenmek istiyorsanız, öncelikle [Politika Nedir?](/tr/concepts/temel-kavramlar/politika-nedir) sayfasını okumanızı öneririz.
</Tip>

## Genel Bakış

### Amacı Nedir?

- API Proxy (API Vekil Sunucusu) yanıt veya isteğini JOSE standartlarına uygun biçimde JWT olarak yeniden paketleyerek tüketici entegrasyonlarını basitleştirmek.
- Uygulama servisleri arasında taşınan claim verilerini imza ve şifreleme katmanları ile güvence altına almak.
- JWK kasası ile entegre çalışarak anahtar yönetiminin merkezi ve denetlenebilir biçimde sürdürülmesini sağlamak.
- Koşul motoru desteğiyle belirli endpoint, header ya da ortam kombinasyonlarında dinamik olarak tetiklenmek.
- Ek claim haritası ve veri manipülasyonu hedefleri sayesinde kurumlara özgü token zenginleştirmelerini kod değişikliği olmadan yönetmek.

### Çalışma Prensibi

1. **İstek Gelişi**: API Gateway'e gelen her HTTP/HTTPS isteği için, istemin kaynak IP adresi tespit edilir.
2. **Politika Kontrolü**: JOSE Uygulama politikası aktif ise, sistem aşağıdaki sırayla kontrol yapar:
- Condition (koşul) tanımlı mı? Varsa koşul sağlanıyor mu?
- Politika aktif mi (active=true)?
- Variable kullanılıyor mu yoksa Apinizer default mı?
3. **Token Üretim ve Güvenlik Katmanı**: Hedef alan belirlendikten sonra claim seti toplanır, ek claim haritası eklenir, imza ve isteğe bağlı şifreleme için anahtar kaynağı (Embedded JWK veya Dynamic HTTP) seçimine göre işlem uygulanır.
4. **Karar Verme**:
- **Eşleşme Var**: Üretilen JWT belirtilen hedefe (gövde, Authorization header, değişken veya EMPTY) yazılır ve trafik devam eder.
- **Eşleşme Yok**: Politika devre dışı kalır, istek orijinal içeriğiyle iletilir.
5. **Hata İşleme**: Politika kuralına uymayan istekler için özelleştirilebilir HTTP durum kodu ve hata mesajı döndürülür.

## Özellikler ve Yetenekler

### Temel Özellikler

- **Esnek JOSE Hedefi**: Token üretim çıktısı gövde (BODY), Authorization header (AUTHORIZATION_HEADER), seçilen değişken (CHOOSE_FROM_VARIABLE) veya boş hedef (EMPTY) olarak ayarlanabilir; yanıt manipülasyonlarını kolaylaştırır.
- **JWT Claims Claim ve Escape JSON String**: Hedef EMPTY değilse, ham verinin hangi claim adıyla payload’a yazılacağı (jwtClaimsClaim) ve JSON string’in escape edilip edilmeyeceği (escapeJsonString) ayarlanabilir.
- **Hazır Claim Anahtarları**: Issuer, Subject, Audience, Expiration, Issue Time, JWT ID ve Type (header’a tip bilgisi ekleme) gibi çekirdek claim alanları anahtar/kilit kombinasyonlarıyla yönetilir.
- **Ek Claim Haritası**: Tür kontrollü MapValue desteğiyle metin, liste veya sayısal claim’ler arayüzden eklenip düzenlenebilir.
- **Aktif/Pasif Durum Kontrolü**: Politikanın aktif veya pasif durumunu kolayca değiştirme (active/passive toggle). Pasif durumda politika uygulanmaz ancak yapılandırması saklanır.
- **Koşul Bazlı Uygulama**: Query Builder ile karmaşık koşullar oluşturarak politikanın ne zaman uygulanacağını belirleme (örn: sadece belirli endpoint’lere veya header değerlerine göre).

### İleri Düzey Özellikler

- **Anahtar Kaynağı Modu (Key Source Mode)**: İmza ve şifreleme için anahtar **Embedded** (Secret Manager’daki JWK) veya **Dynamic HTTP** (HTTP isteği ile uzaktan anahtar çekme) olarak seçilebilir.
- **Dinamik Anahtar Çekme (Dynamic Key Fetching)**: Dynamic HTTP seçildiğinde HTTP isteği (Test Console), Key Extraction Variable, Key Format (AUTO_DETECT, PUBLIC_KEY, PRIVATE_KEY, CERTIFICATE, JWK_JSON), Key Algorithm, Kid (isteğe bağlı), cache ayarları (Apply By değişkeni, Capacity, TTL, Cache Storage Type, Respect Cache Invalidation Headers, Connection Timeout, Error Handling Type), Retry on Key Error, Invalidate Cache on Validation Error ve **Try It (Parse Response)** butonu ile test edilebilir.
- **JWK Yönetim Entegrasyonu**: Embedded modda Secret Manager üzerinden JWK arama, seçim, güncelleme ve yeni anahtar üretimi tek tıklamayla yapılır.
- **Çift Katmanlı Güvenlik**: Aynı istekte imza ve şifreleme kombinasyonu uygulanarak token bütünlüğü ve gizliliği eşzamanlı sağlanır.
- **Veri Manipülasyonu Senkronizasyonu**: Oluşturulan JWT/JWE için Injection Target (encoded claims target) ve decode sonrası değişken ataması (decoded claims target variable) ile zincir politikalar arasında veri paylaşımı yapılır.
- **Export/Import Özelliği**: Politika yapılandırmasını ZIP dosyası olarak export etme. Farklı ortamlara (Development, Test, Production) import etme. Versiyon kontrolü ve yedekleme imkanı.
- **Policy Group ve Proxy Group Desteği**: Birden fazla politikayı Policy Group içinde yönetme. Proxy Group’lara toplu politika atama. Merkezi güncelleme ve deploy işlemleri.
- **Deploy ve Versiyonlama**: Politika değişikliklerini canlı ortama deploy etme. Hangi API Proxy’lerde kullanıldığını görme (Policy Usage). Proxy Group ve Policy Group kullanım raporları.

## Kullanım Senaryoları

| Senaryo | Durum | Çözüm (Politika Uygulaması) | Beklenen Davranış / Sonuç |
|---------|-------|----------------------------|---------------------------|
| Mikroservis Yanıtını JWT'ye Dönüştürme | Servis düz metin JSON döndürüyor, tüketici JWT bekliyor | `joseTarget=BODY`, hazır claim'ler aktif, imza açık | Yanıt JWT formatında döner, tüketici ek iş yapmaz |
| Header Üzerinden JWT Taşıma | Mobil istemci Authorization header'ında imzalı token istiyor | `joseTarget=AUTHORIZATION_HEADER`, `addTypeToHeader=true`, `typeValue=JWT` | Token `Authorization: JWT <token>` olarak eklenir |
| Çoklu Audience Yönetimi | Aynı API farklı hedef sistemlere token iletiyor | `addAudience=true`, audience listesine çoklu değer eklenir | Token `aud` claim'i çoklu değer içerir |
| İç Sistem Anahtarıyla İmza | Issuer tarafında imzalanmış token tercih ediliyor | `sign=true`, `signByIssuer=true` seçilir | Gateway imza anahtarı istemez, issuer imzası korunur |
| Çift Katmanlı Güvenlik | Dış entegrasyon imza+şifreleme kombinasyonu zorunlu kılıyor | `sign=true`, `encrypt=true`, uygun JWK'lar veya Dynamic HTTP seçilir | Token önce imzalanır sonra seçilen yöntemle şifrelenir |
| Veri Manipülasyonu Zinciri | Sonraki politika decode edilmiş claim'lere ihtiyaç duyuyor | `encodedClaimsTargetForDataManipulation` ile token'ın yazılacağı hedef, decoded claims için değişken atanır | Decode edilmiş claim'ler tanımlanan değişkende saklanır |
| Uzaktan Anahtar ile İmza/Şifreleme | Anahtar bir HTTP endpoint’ten alınacak | Key Source Mode = DYNAMIC_HTTP, HTTP Request ve Key Extraction Variable tanımlanır, Try It ile test edilir | Çalışma anında anahtar uzaktan çekilir ve cache’lenebilir |

## Politika Parametrelerini Yapılandırma

Bu adımda, kullanıcı **yeni bir politika oluşturabilir** ya da **mevcut politika parametrelerini yapılandırarak** erişim kurallarını belirleyebilir. Tanımlanan parametreler, politikanın çalışma şeklini (örneğin hangi hedefe token yazılacağı, koşullu aktivasyonlar, imza/şifreleme kaynağı vb.) doğrudan etkiler. Bu sayede politika hem kuruma özel gereksinimlere göre özelleştirilebilir hem de merkezi olarak yönetilebilir.

### Yeni JOSE Uygulama Politikası Oluşturma

<img src="/images/develop/politikalar/jose-imp1.png" alt="JOSE Uygulama Politikası"  />

<img src="/images/develop/politikalar/jose-imp2.png" alt="JOSE Uygulama Politikası" />


### Yapılandırma Adımları

| Adım | Açıklama / İşlem |
|------|------------------|
| **Adım 1: Oluşturma Sayfasına Gitme** | - Sol menüden **Development → Global Settings → Global Policies → JOSE Uygulama Politikası** bölümüne gidin.<br />- Sağ üstteki **[+ Create]** butonuna tıklayın. |
| **Adım 2: Temel Bilgileri Girme (Definition sekmesi)** | **Policy Status (Politika Durumu):** Sadece okunur; Aktif veya Pasif durumu gösterir. Yeni politikalar varsayılan olarak aktiftir. Toggle ile değiştirilebilir.<br /><br />**Name (Ad) — Zorunlu:** Örnek: `Production_JOSE`. Benzersiz isim girin; boşlukla başlamaz; max 255 karakter. Sistem otomatik kontrol eder: yeşil tik = kullanılabilir, kırmızı çarpı = mevcut isim.<br /><br />**Description (Açıklama):** Örnek: "Çıkış gövdesini imzalı JWT'ye dönüştürür". Maks. 1000 karakter; politikanın amacını açıklar. |
| **Adım 3: Politika Yapılandırması (Policy Configuration)** | **JOSE Target (İmzalanacak/Şifrelenecek Hedef) — Zorunlu:** BODY, AUTHORIZATION_HEADER, CHOOSE_FROM_VARIABLE veya EMPTY seçin.<br /><br />**JOSE Target Variable (Hedef Değişken) — Koşullu:** Sadece JOSE Target = CHOOSE_FROM_VARIABLE iken görünür; zorunludur. Proje değişkeni seçin (Değişken Seç / Farklı Seç / Kaldır butonları). Seçilen değişkende **Güncelle (Update Variable)** ile düzenleme yapılabilir.<br /><br />**JWT Claims Claim (Raw Data için Claim Adı):** Sadece JOSE Target ≠ EMPTY iken görünür. Ham verinin JWT payload’da hangi claim adıyla yazılacağını belirler; varsayılan `data`. Tüm gövdeye yerleştirmek için boş bırakılabilir.<br /><br />**Escape JSON String (JSON String'i, String Olarak Kullan):** Sadece JOSE Target ≠ EMPTY iken görünür. Toggle; claim adı için JSON string’in string olarak kullanılıp kullanılmayacağını seçer. |
| **Adım 4: Claim Ayarları (Claim Ayarları paneli)** | **Add Issue Time (Issue Time Ekle):** Toggle; `iat` claim’i eklenir.<br /><br />**Add JWT ID (Üretilmiş ID Ekle):** Toggle; `jti` claim’i eklenir.<br /><br />**Add Type to Header (Tip Bilgisi Ekle):** Toggle; header’a tip bilgisi eklenir.<br /><br />**Type Value (Tip Değeri) — Koşullu, zorunlu:** Sadece Add Type to Header açıkken görünür; örn. `JWT`.<br /><br />**Add Issuer (Issuer Ekle):** Toggle.<br /><br />**Issuer — Koşullu, zorunlu:** Sadece Add Issuer açıkken görünür.<br /><br />**Add Audience (Audience Ekle):** Toggle.<br /><br />**Audience List (Audience Listesi) — Koşullu, zorunlu:** Sadece Add Audience açıkken görünür. Metin kutusuna değer yazıp onaylayarak chip olarak ekleyin; listeden tıklayarak kaldırabilirsiniz. En az bir değer gerekir.<br /><br />**Add Subject (Subject Ekle):** Toggle.<br /><br />**Subject — Koşullu, zorunlu:** Sadece Add Subject açıkken görünür.<br /><br />**Add Expiration Time (Expiration Time Ekle):** Toggle.<br /><br />**Expiration Time Value (Expiration Time Value) — Koşullu, zorunlu:** Sadece Add Expiration Time açıkken görünür; sayı, min 0.<br /><br />**Expiration Time Unit (Expiration Time Unit) — Koşullu, zorunlu:** Sadece Add Expiration Time açıkken görünür; süre birimi (örn. SECOND, MINUTE, HOUR).<br /><br />**Additional Claim Map (Additional Claim Listesi):** Tablo: Anahtar, Tip (valueType), Değer, işlem sütunu. **+** butonu ile yeni claim ekleyin; satır menüsünden Düzenle / Kaldır. Claim Ekle/Düzenle diyaloğunda: Key (Anahtar), Value Type (Tip), Value (Değer) zorunludur. |
| **Adım 5: İmza Konfigürasyonu — JWS Uygulama Ayarları (Signature paneli)** | **Sign (İmzala):** Toggle; token imzası açılır/kapanır.<br /><br />**Sign by Issuer (İstemci JWK'sı ile İmzala):** Toggle; issuer tarafından imza kullanılır.<br /><br />Aşağıdaki alanlar sadece **Sign** açık ve **Sign by Issuer** kapalı iken görünür:<br /><br />**Key Source Mode (Anahtar Kaynağı Modu) — Zorunlu:** EMBEDDED veya DYNAMIC_HTTP.<br /><br />**— EMBEDDED seçiliyse:**<br />• **Dijital İmzalama için JWK (jwkIdForValidationAndSign) — Zorunlu:** Açılır liste (Secret Manager’daki imza JWK’ları), **Temizle** ve **Yeni** butonları. Seçilen JWK tabloda (Ad, Açıklama, Tip, Algoritma) gösterilir; satıra tıklayarak düzenleme/detay açılır.<br /><br />**— DYNAMIC_HTTP seçiliyse:**<br />• **HTTP İstek Yapılandırması (httpRequest):** Test Console bileşeni; servis URL ve istek (method, header, body vb.) tanımlanır. Zorunlu; kaydetmeden önce URL dolu olmalı.<br />• **Key Extraction Variable (Anahtar Çıkarma Değişkeni) — Zorunlu:** HTTP yanıtından anahtarın çıkarılacağı değişken; değişken seçici ile atanır.<br />• **Key Format (Anahtar Formatı) — Zorunlu:** AUTO_DETECT, PUBLIC_KEY, PRIVATE_KEY, CERTIFICATE, JWK_JSON.<br />• **Key Algorithm (Anahtar Algoritması) — Zorunlu:** Algoritma listesi (örn. NONE, RS256, ES256 …).<br />• **Kid (Anahtar ID) — İsteğe bağlı:** Metin; placeholder "Opsiyonel - JWK Set seçimi için".<br />• **Enable Cache (Önbelleği Etkinleştir):** Toggle; açıldığında aşağıdaki cache alanları görünür ve cache açıkken zorunludur:<br />  - **Apply By (Uygula Kriteri):** Cache’in hangi değişkene göre uygulanacağı; değişken seçici — zorunlu.<br />  - **Capacity (Kapasite):** Sayı, min 1 — zorunlu.<br />  - **TTL:** Sayı, min 1 (saniye) — zorunlu.<br />  - **Cache Storage Type (Önbellek Depolama Tipi):** LOCAL veya DISTRIBUTED — zorunlu.<br />  - **Respect Cache Invalidation Headers (Cache Geçersiz Kılma Başlıklarına Uy):** Checkbox.<br />  - **Cache Connection Timeout (Cache Bağlantı Zaman Aşımı, saniye):** Sayı, min 1 — zorunlu.<br />  - **Cache Error Handling Type (Cache Bağlantı Hatası İçin Aksiyon):** CONTINUE vb. — zorunlu.<br />• **Retry on Key Error (Anahtar Getirme Hatasında Tekrar Dene):** Toggle.<br />• **Invalidate Cache on Validation Error (Doğrulama Hatasında Cache'i Temizle ve Anahtarı Yeniden Getir):** Toggle; sadece cache açıkken görünür.<br />• **Yanıtı Ayrıştır (Parse Response / Try It):** Buton; yapılandırmayı test eder; başarılıysa algılanan Key Format / Algorithm otomatik atanabilir. |
| **Adım 6: Şifreleme Konfigürasyonu — JWE Uygulama Ayarları (Encrypt paneli)** | **Encrypt (Şifrele):** Toggle.<br /><br />**Encryption Method (Şifrele Metodu) — Koşullu, zorunlu:** Sadece Encrypt açıkken görünür; şifreleme metodu listesinden seçin.<br /><br />**Encrypt by Issuer (İstemci JWK'sı ile Şifrele):** Toggle; issuer tarafında şifreleme kullanılır.<br /><br />Aşağıdaki alanlar sadece **Encrypt** açık ve **Encrypt by Issuer** kapalı iken görünür:<br /><br />**Key Source Mode (Anahtar Kaynağı Modu) — Zorunlu:** EMBEDDED veya DYNAMIC_HTTP.<br /><br />**— EMBEDDED seçiliyse:**<br />• **Şifreleme için JWK (jwkIdForDecryptionAndEncryption) — Zorunlu:** Açılır liste (Secret Manager’daki şifreleme JWK’ları), Temizle ve Yeni butonları. Seçilen JWK tabloda gösterilir.<br /><br />**— DYNAMIC_HTTP seçiliyse:**<br />• **HTTP İstek Yapılandırması:** Test Console; URL ve istek — zorunlu.<br />• **Key Extraction Variable — Zorunlu.**<br />• **Key Format — Zorunlu.**<br />• **Key Algorithm — Zorunlu.**<br />• **Kid — İsteğe bağlı.**<br />• **Enable Cache:** Toggle; açıldığında: Apply By, Capacity, TTL, Cache Storage Type, Respect Cache Invalidation Headers, Cache Connection Timeout, Cache Error Handling Type (hepsi cache açıkken zorunlu).<br />• **Retry on Key Error:** Toggle.<br />• **Invalidate Cache on Validation Error:** Toggle (cache açıkken görünür).<br />• **Yanıtı Ayrıştır (Try It):** Buton. |
| **Adım 7: Data Manipülasyonu (Data Manipülasyonu paneli)** | **Encoded Claims Target for Data Manipulation (Oluşturulan JWT/JWE için Injection Target) — Zorunlu:** Token’ın yazılacağı hedef: BODY, AUTHORIZATION_HEADER veya CHOOSE_FROM_VARIABLE.<br /><br />**Decoded Claims Target Variable (Target for Decoded Claims için Hedef Değişken) — Koşullu, zorunlu:** Sadece Injection Target = CHOOSE_FROM_VARIABLE iken görünür. Decode edilmiş claim’lerin yazılacağı proje değişkeni; Değişken Seç / Farklı Seç / Kaldır ve Güncelle butonları ile atanır. |
| **Adım 8: Koşul Tanımlama (Condition sekmesi) — İsteğe bağlı** | **Condition** sekmesine geçin. Query Builder ile koşul kuralları tanımlayın; politikanın hangi durumda aktif olacağı belirlenir.<br /><br />Örnekler: Ortam bazlı `Header = X-Environment, Equals, production`; API Key `Header = X-API-Key, Starts With = PROD-`; Endpoint `Path = /api/admin/*`. Koşul tanımlanmazsa politika her zaman uygulanır. |
| **Adım 9: Hata Mesajı Özelleştirme (Error Message Customization sekmesi) — İsteğe bağlı** | **Error Message Customization** sekmesine gidin. Erişim reddedildiğinde dönecek HTTP durum kodu ve mesajı özelleştirin.<br /><br />Varsayılan: `{ "statusCode": 403, "message": "[Default hata mesajı]" }`. Özel: `{ "statusCode": 403, "errorCode": "[CUSTOM_ERROR_CODE]", "message": "[Özel mesaj]" }`. |
| **Adım 10: Kaydetme** | Sağ üstteki **[Save]** butonuna tıklayın.<br /><br />**Kontrol listesi:** Benzersiz isim; JOSE Target ve (CHOOSE_FROM_VARIABLE ise) JOSE Target Variable; Add Type to Header ise Type Value; Add Issuer ise Issuer; Add Audience ise en az bir Audience; Add Subject ise Subject; Add Expiration Time ise Expiration Time Value + Unit; Sign açıksa ve Sign by Issuer kapalıysa Key Source Mode’a göre EMBEDDED’da JWK seçili, DYNAMIC_HTTP’da URL + Key Extraction Variable + Key Format (+ cache açıksa Apply By, Capacity, TTL vb.); Encrypt açıksa Encryption Method ve (Encrypt by Issuer kapalıysa) aynı JWK/Dynamic HTTP kuralları; Encoded Claims Target; CHOOSE_FROM_VARIABLE ise Decoded Claims Target Variable.<br /><br />**Sonuç:** Politika listeye eklenir; API’lere bağlanabilir; global politikaysa otomatik uygulanır. |

**Sekmeler (Definition dışında):** Definition, Condition, Error Message Customization; sayfa modunda ayrıca **API Proxies Using Policy** ve **API Proxy Groups Using Policy** sekmeleri görünür.

**Koşullar** ve **Hata Mesajı Özelleştirme** panellerinin açıklaması için [Politika Nedir?](/tr/concepts/temel-kavramlar/politika-nedir) sayfasındaki [Koşullar](/tr/concepts/temel-kavramlar/politika-nedir#koşullar) ve [Hata Mesajı Özelleştirme (Error Message Customization)](/tr/concepts/temel-kavramlar/politika-nedir#hata-mesajı-özelleştirme-error-message-customization) bölümlerini inceleyebilirsiniz.

## Politikayı Silme

Bu politikanın silme adımları ve kullanımdayken uygulanacak işlemler için [Politika Yönetimi](/tr/develop/api-proxy-konfigurasyonu/politika-yonetimi) sayfasındaki [Akıştan Politika Kaldırma](/tr/develop/api-proxy-konfigurasyonu/politika-yonetimi#akıştan-politika-kaldırma) bölümüne bakabilirsiniz.

## Politikayı Dışa/İçe Aktarma

Bu politikanın dışa aktarma (Export) ve içe aktarma (Import) adımları için [Export/Import](/tr/admin/secrets-management/export-import) sayfasına bakabilirsiniz.

## Politikayı API'ye Bağlama

Bu politikanın API’lere nasıl bağlanacağına ilişkin süreç için [Politika Yönetimi](/tr/develop/api-proxy-konfigurasyonu/politika-yonetimi) sayfasındaki [Politikayı API’ye Bağlama](/tr/develop/api-proxy-konfigurasyonu/politika-yonetimi#akisa-politika-ekleme) bölümüne bakabilirsiniz.

## İleri Düzey Özellikler

| Özellik | Açıklama ve Adımlar |
|---------|---------------------|
| **Dinamik Claim Haritalama** | - `Additional Claim Map` tablosundan **+** butonuna basın.<br />- Claim anahtarını ve uygun `valueType` bilgisini seçin.<br />- Değer alanını doldurup kaydedin; değişiklik anında listeye yansır. |
| **Embedded JWK ile İmza/Şifreleme** | - İmza veya şifreleme panelinde Key Source Mode = EMBEDDED iken ilgili JWK seçicisini açın.<br />- Var olan anahtarı seçin veya **New** seçeneğiyle Secret Manager’a yönlenin.<br />- Güncel JWK kaydedildiğinde politika formu otomatik güncellenir. |
| **Dynamic HTTP ile Anahtar Çekme** | - Key Source Mode = DYNAMIC_HTTP seçin.<br />- HTTP Request alanında Test Console ile servis URL ve isteği tanımlayın.<br />- Key Extraction Variable (zorunlu), Key Format, Key Algorithm belirleyin; cache açacaksanız Apply By değişkeni, Capacity, TTL ve diğer cache alanlarını doldurun.<br />- **Parse Response (Try It)** ile yanıtı test edin; başarılıysa algılanan format/algoritma otomatik atanabilir. |
| **Token Zinciri Manipülasyonu** | - **Oluşturulan JWT/JWE için Injection Target** alanından token’ın yazılacağı hedefi (BODY, AUTHORIZATION_HEADER veya CHOOSE_FROM_VARIABLE) seçin.<br />- CHOOSE_FROM_VARIABLE ise decode edilmiş veriyi başka politikaya aktaracak **Target for Decoded Claims için Hedef Değişken** değişkenini tanımlayın.<br />- İlgili ikinci politikada aynı değişkeni kaynak olarak kullanarak veri akışını tamamlayın. |

## Best Practices

### Yapılması Gerekenler ve En İyi Uygulamalar

| Kategori | Açıklama / Öneriler |
|----------|---------------------|
| **Claim Tasarımı** | **Kötü:** Gereksiz tüm alanları claim olarak eklemek.<br />**İyi:** Sadece işlevsel claim’leri tanımlamak.<br />**En İyi:** Düzenli claim denetimleri ile minimal ama yeterli seti sürdürmek. |
| **JWK ve Dinamik Anahtar Yönetimi** | **Kötü:** Süresi dolmuş anahtarları veya hatalı Dynamic HTTP URL’ini kullanmaya devam etmek.<br />**İyi:** Embedded JWK rotasyonunu manuel aralıklarla yapmak; Dynamic HTTP’de Try It ile test edip cache kullanmak.<br />**En İyi:** Secret Manager üzerinden otomatik rotasyon (Embedded) veya cache + retry/invalidate ayarları (Dynamic HTTP) ile güvenilir anahtar tedariki. |
| **İmza ve Şifreleme Kombinasyonu** | **Kötü:** Aynı token’a gereksiz yere hem imza hem şifreleme eklemek.<br />**İyi:** Güvenlik gereksinimine göre sadece biriyle yetinmek.<br />**En İyi:** Hassas veride önce imza sonra şifreleme uygulayarak tam güvenlik sağlamak. |
| **Veri Manipülasyonu** | **Kötü:** Decode edilmiş veriyi boş isimli değişkenlere yazmak.<br />**İyi:** Anlamlı değişken isimleri kullanmak.<br />**En İyi:** Politikalar arası veri akışını belgelemek ve standart isimler belirlemek. |
| **Hata Mesajı Stratejisi** | **Kötü:** Varsayılan hata mesajını tüm ortamda bırakmak.<br />**İyi:** Ortam bazlı özel mesajlar hazırlamak.<br />**En İyi:** Hata mesajlarında izlenebilirlik için referans kodları bulundurmak. |

### Güvenlik En İyi Uygulamaları

| Güvenlik Alanı | Açıklama / Uyarılar |
|----------------|---------------------|
| **Anahtar Saklama** | Embedded modda JWK’ları sadece Secret Manager içerisinde tutun; Dynamic HTTP’de kullanılan endpoint’in güvenliği ve cache’in erişim kısıtları önemlidir. |
| **Token Yaşam Süresi** | Expiration değerlerini kısa tutun, Sliding veya Refresh token mekanizmaları kurun. |
| **Issuer ve Audience Doğruluğu** | `issuer` ve `audienceList` değerlerini kurumsal naming standardına göre belirleyip revizyonlarda güncelleyin. |
| **Ek Claim Hijyeni** | Ek claim’lerde kişisel veri varsa şifreleme zorunlu hale getirin ve veri minimizasyonu uygulayın. |
| **İmza Anahtarı Yetkileri** | JWK düzenleme yetkisini ROLE_API_SECURITY ile sınırlandırın, audit loglarını takip edin. |

### Kaçınılması Gerekenler

| Kategori | Açıklama / Uyarılar |
|----------|---------------------|
| **Tutarsız Claim Yapısı** | **Neden kaçınılmalı:** Şema dışı claim’ler tüketici tarafında parse hatasına yol açar.<br />**Alternatif:** Claim değişikliklerini sürüm kontrollü olarak devreye alın. |
| **Yanlış JWK veya Dynamic Key Eşlemesi** | **Neden kaçınılmalı:** Eksik veya farklı algoritmaya sahip JWK/format seçimi token doğrulamasını bozar.<br />**Alternatif:** İlgili algoritma için filtrelenmiş JWK listesini (Embedded) veya doğru Key Format/Algorithm ve Try It (Dynamic HTTP) kullanın. |
| **Sonsuz Token Süresi** | **Neden kaçınılmalı:** Güvenlik ihlali durumunda token iptali mümkün olmaz.<br />**Alternatif:** Kısa süreli token ve revocation list tasarlayın. |
| **Hedef Alan Uyumsuzluğu** | **Neden kaçınılmalı:** Yanıt gövdesi yerine header’a yazılan token tüketilmeyebilir.<br />**Alternatif:** Entegrasyon dökümanı doğrultusunda hedef alanı netleştirin. |

### Performans İpuçları

| Kriter | Öneri / Etki |
|--------|--------------|
| **Token Boyutu** | **Öneri:** Gereksiz claim’leri kaldırın ve JSON minimal formatta tutun.<br />**Etki:** Gönderim süresi ve bant genişliği düşer. |
| **Şifreleme Metodu** | **Öneri:** Donanım desteği olan algoritmaları (örn. A256GCM) tercih edin.<br />**Etki:** CPU kullanımı azalır, gecikme düşer. |
| **Ek Claim Sayısı** | **Öneri:** MapValue tablosunda sadece gerekli claim’leri tanımlayın.<br />**Etki:** Token boyutu küçülür, doğrulama süresi kısalır. |
| **Koşul Motoru** | **Öneri:** Query Builder’da gereksiz nested koşullardan kaçının.<br />**Etki:** Politika değerlendirme süreci hızlanır. |
| **Embedded JWK Lookup** | **Öneri:** Sık kullanılan JWK’ları cacheleyen Secret Manager seçeneklerini aktif edin.<br />**Etki:** İmza/şifreleme sırasında I/O gecikmeleri azalır. |
| **Dynamic HTTP Cache** | **Öneri:** Enable Cache açık, Capacity ve TTL uygun değerlerde olsun; böylece uzak anahtar tekrarlı çekilmez.<br />**Etki:** Gecikme ve dış servis yükü azalır. |

## Sık Sorulan Sorular (SSS)

| Kategori | Soru | Cevap |
|----------|------|--------|
| **Genel** | JOSE Uygulama Politikası hangi durumlarda kullanılır? | Token üretimi, claim yönetimi ve güvenli iletim gerektiren entegrasyonlarda kullanılır; özellikle tüketicinin JWT beklediği senaryolarda etkilidir. |
| **Genel** | İmza ve şifrelemeyi aynı anda açmak zorunlu mu? | Hayır, gereksinime göre sadece imza veya sadece şifreleme kullanılabilir; her ikisi birden hassas veriler için önerilir. |
| **Teknik** | JWK seçimi nasıl yapılır? | Key Source Mode = EMBEDDED iken Secret Manager JWK listesi açılır; uygun algoritma ve amaçla eşleşen anahtar seçilir veya yeni anahtar oluşturulur. |
| **Teknik** | Dynamic HTTP ile anahtar nasıl kullanılır? | Key Source Mode = DYNAMIC_HTTP seçilir; HTTP Request (Test Console) ile URL ve istek, Key Extraction Variable (zorunlu), Key Format ve Key Algorithm tanımlanır. İsteğe bağlı cache ve Try It (Parse Response) ile test edilir. |
| **Teknik** | Değişkenden hedef seçince ne olur? | JOSE Target = CHOOSE_FROM_VARIABLE ise politika token’ı belirtilen proje değişkenine yazar; başka politikalar veya backend bu değişkeni okuyabilir. |
| **Kullanım** | Audience listesine nasıl değer eklenir? | `Add Audience` aktif edilerek giriş kutusuna değer yazılır ve onaylanır; her değer chip olarak listelenir. |
| **Kullanım** | Type Value ne zaman zorunlu? | `Add Type to Header` açıkken header’a eklenecek tip değeri (örn. `JWT`) zorunludur. |
| **Kullanım** | Hata mesajını özelleştirmek zorunda mıyım? | Zorunlu değil; ancak tüketici tarafı için yönlendirici bilgi gerekiyorsa Error Message sekmesinde özelleştirme yapılabilir. |
