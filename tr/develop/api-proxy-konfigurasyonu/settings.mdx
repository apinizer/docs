---
title: "API Proxy Genel Ayarları"
description: "API Proxy için CORS, Cache, XML Hata Mesaj Şablonları, İletilen IP Başlık Parametreleri, ProCrypt Entegrasyonu, API Tanım Dosyası Gizleme ve Bakım Modu ayarlarını yapılandırabilirsiniz."
---

## Ayarlar Sekmesi

[API Proxy](/tr/concepts/temel-kavramlar/api-proxy-nedir) için CORS, Cache, XML Hata Mesaj Şablonları, İletilen IP Başlık Parametreleri, ProCrypt Entegrasyonu, API Tanım Dosyası Gizleme ve Bakım Modu ayarlarının yapıldığı bölümdür. Bu ayarlar [mesaj işleme ve politika uygulama](/tr/concepts/temel-kavramlar/mesaj-isleme-ve-politika-uygulama) sürecinde kullanılır.


<img
  src="/images/develop/api-proxy-konfigurasyonu/ayarlar-sekmesi.png"
  alt="Ayarlar Sekmesi"
  width="1000"
  height="667"
/>

<Info>
Eğer ayarların üzerinde "Global Ayarlar aktif" şeklinde bir uyarı yer alıyor ise bu API Proxy'nin bir Global Settings ayarına bağlı olduğunu ve bu paneldeki ayarların API Proxy Settings içerisinden yönetildiğini ifade eder. Uyarının üzerine tıklandığı zaman ilgili ayara gidilir.
</Info>

## CORS Ayarları

[CORS (Cross-Origin Resource Sharing)](https://en.wikipedia.org/wiki/Cross-origin_resource_sharing) ayarlarının yapıldığı bölümdür.

Bu alan aktifleştirildiğinde **Yapılandır** _(Configure)_ butonu aktif olur ve ilgili ayarları içeren ekranın açılmasını sağlar.

<img
  src="/images/develop/api-proxy-konfigurasyonu/cors-ayarlari.png"
  alt="CORS Ayarları"
  width="1000"
  height="700"
/>

### CORS Ayarları Alanları

| Alan | Açıklama |
|---|---|
| **İstek Başlıkları** _(Request Headers)_ | |
| Origin | Preflight isteğin gönderildiği orijin (domain, protocol, port) bilgisi yer alır. |
| Access-Control-Request-Method | Preflight isteği ile asıl istekte gönderilecek olan HTTP metodu belirtilir. |
| Access-Control-Request-Headers | Preflight isteği ile asıl istekte gönderilecek olan HTTP başlıkları belirtilir. |
| Access-Control-Max-Age | Preflight isteğine ait cevabın başka bir preflight isteği göndermeden ne kadar süre önbellekte kalacağı saniye olarak verilir. |
| Access-Control-Allow-Headers | API Proxy'nin erişim için izin verdiği başlık değerleri girilir. Eğer preflight istekte Access-Control-Request-Headers belirtilmiş ise cevap üzerinde bu başlık yer alır. Asıl istekte hangi HTTP başlıklarının kullanılabileceği bilgisini içerir. |
| Access-Control-Allow-Methods | Sunucuya erişim gerçekleştirilirken izin verilen HTTP metodu veya metotları yer alır. API Proxy'nin erişim için izin verdiği metotlar listeden işaretlenerek seçilir: GET, POST, PUT, HEAD, OPTIONS, DELETE, PATCH, TRACE, ALL |
| **Yanıt Başlıkları** _(Response Headers)_ | |
| Access-Control-Allow-Origin | API Proxy'nin izin verdiği orijin değerleri girilir. Eğer bu alana `*` değeri girilirse tüm orijinler istek gönderebilir. |
| Access-Control-Allow-Credentials | Asıl istekte kimlik bilgilerinin olup olmadığı değeri girilir. |
| Access-Control-Expose-Headers | İstemcilerin erişebileceği diğer başlıklar girilir. |

<Info>
Ön tanımlı mevcut olan Orijin ve Başlık değerlerine yenilerine eklemek için [CORS Orijin Değerleri](/tr/admin/system-settings/on-tanimli-degerler/cors-orijin-degerleri) ve [CORS Başlıkları](/tr/admin/system-settings/on-tanimli-degerler/cors-basliklari) sayfalarını ziyaret edebilirsiniz.
</Info>

## Önbellek Ayarları

API Proxy'den dönen yanıtlar ön belleğe alınarak istemciden gelen istekler Backend API'ye gönderilmeden önbellekten yanıtlanabilir. Buna ilişkin ayarların yönetildiği bölümdür. Önbellek anahtarı oluştururken [variable](/tr/concepts/temel-kavramlar/variable) kullanılabilir.

<img
  src="/images/develop/api-proxy-konfigurasyonu/onbellek-ayarlari.png"
  alt="Önbellek Ayarları"
  width="1000"
  height="700"
/>

### Önbellek Ayarları Alanları

| Alan | Açıklama |
|---|---|
| **Sadece HTTP Get İsteklerini Önbelleğe Al** _(Cache only HTTP Get Requests)_ | Bu seçenek aktifleştirilirse yalnızca HTTP Get isteklerinin yanıtları önbelleğe alınır. |
| **Önbellek Anahtar Tipi** _(Cache Key Type)_ | Önbellek Anahtar Tipi için iki seçenek vardır:<br/><br/>• **Query Parametreleri Kullan** _(Use Query Params)_: Önbelleğe alma işlemi için oluşturulacak olan anahtarın istekteki HTTP Query parametrelerine göre belirlenmesi için kullanılır. Örneğin sorgu parametresi `/metodAdı?param1=value1&param2=value2` şeklinde olduğunda önbellekte tutulacak anahtar `param1=value1&param2=value2` değerinden oluşur ve bir daha istek bu şekilde geldiğinde önbellekteki sonuç döner.<br/><br/>• **Özel Anahtar Oluştur** _(Create Custom Key)_: Önbelleğe alma işlemi için oluşturulacak olan anahtarın istekteki seçilecek alanlar ile oluşturulması için kullanılır. Bu değer seçildiğinde "Değişken Listesi" tablosunda belirtilecek alanlar ile anahtar oluşturulur. |
| **Kapasite** _(Capacity)_ | Önbellekte saklanabilecek maksimum yanıt sayısıdır. Bu alan zorunludur. |
| **Önbellek Geçersizleme İçin Yetki Gerekir** _(Invalidation Requires Authn)_ | Header'da Cache-Control anahtarına `no-cache`, `no-store` veya `max-age=0` değerlerinden biri gönderilerek, mevcut önbellek geçersiz hale getirilebilir. Önbelleği geçersiz kılmak için yetkilendirme gerekiyorsa bu alan seçilir. |
| **Yetkisiz İsteklerin Ele Alınması** _(Handling Action)_ | Önbelleği geçersiz kılmak için yetkilendirme gerekiyorsa yetkisiz istekler için yapılacak işlem seçilir:<br/><br/>• **DEVAM ET** _(Continue)_: Bu seçenek seçilirse, Cache-Control başlık bilgisinde `no-cache`, `no-store` veya `max-age=0` değerlerinden biri gönderildiğinde eğer gönderen kişi yetkilendirilmemiş ise bu değer gönderilmemiş gibi çalışmasına devam eder.<br/><br/>• **DUR** _(Stop)_: Bu seçenek seçilirse, Cache-Control başlık bilgisinde `no-cache`, `no-store` veya `max-age=0` değerlerinden biri gönderildiğinde eğer gönderen kişi yetkilendirilmemiş ise akışı durdurur ve hata mesajı döner.<br/><br/>Bu alan "Önbellek Geçersizleme İçin Yetki Gerekir" seçeneği işaretlendiğinde aktif hale gelir. |
| **Depolama Tipi** _(Storage Type)_ | Önbellek verilerinin saklanma şeklini belirler:<br/><br/>• **Local** _(Yerel)_: Önbellek verileri sadece ilgili Gateway node'unda saklanır.<br/><br/>• **Distributed** _(Dağıtık)_: Önbellek verileri tüm Gateway node'ları arasında paylaşılır ve senkronize edilir.<br/><br/>Bu alan zorunludur. |
| **TTL (saniye)** _(TTL - seconds)_ | Önbelleğe alınan yanıtın geçerli olacağı süre saniye olarak girilir. Bu alan zorunludur. |
| **Null/Boş Değerleri Önbelleğe Al** _(Cache Null Value)_ | Boş değerlerin de önbelleğe alınması isteniyorsa işaretlenir. |

## XML Hata Yanıt Şablonunu Özelleştirme

API Proxy'den istemciye herhangi bir hata döndürüleceği zaman kullanılacak olan yanıt şablonlarının hazırlanması için kullanılır.

Herhangi bir şablon aktifleştirildiğinde varsayılan şablon görüntülenir ve istenirse özelleştirilebilir.

Bu alan aktifleştirildiğinde **Yapılandır** _(Configure)_ butonu aktif olur ve ilgili ayarları içeren ekranın açılmasını sağlar.

### XML Hata Yanıt Şablonu Ayarları

| Alan | Açıklama |
|---|---|
| **Yanıt Mesajında Özel Karakterlere İzin Ver** _(Permit Special Chars in Response Message)_ | Yanıtın hata mesajının içinde bulunabilecek özel karakterler XML mesaj yapısını bozabilir. Bunlara izin verilip verilmeyeceğini belirler. |
| **XML** | XML tipindeki hata şablonu bu alanda düzenlenebilir. |
| **İçerik Tipi** _(Content Type)_ | Döndürülecek yanıtın içerik tipidir. |

## JSON Hata Yanıt Şablonunu Özelleştirme

Aktifleştirildiğinde, istemci, döndürülen hatayı verilen JSON yanıt şablonunda görüntüler.

Bu alan aktifleştirildiğinde **Yapılandır** _(Configure)_ butonu aktif olur ve ilgili ayarları içeren ekranın açılmasını sağlar.

### JSON Hata Yanıt Şablonu Ayarları

| Alan | Açıklama |
|---|---|
| **Yanıt Mesajında Özel Karakterlere İzin Ver** _(Permit Special Chars in Response Message)_ | Yanıtın hata mesajının içinde bulunabilecek özel karakterler JSON mesaj yapısını bozabilir. Bunlara izin verilip verilmeyeceğini belirler. |
| **JSON** | JSON tipindeki hata şablonu bu alanda düzenlenebilir. |
| **İçerik Tipi** _(Content Type)_ | Döndürülecek yanıtın içerik tipidir. |

### Yer Tutucular (Placeholders)

Yanıt şablonlarının içerisinde `#...#` şeklindeki değerler, hata mesajının ilgili kısmının koyulacağı yer tutucular _(placeholders)_ olarak kullanılır.

| Yer Tutucu | Açıklama |
|---|---|
| `#CORRELATIONID#` | Apinizer, gelen her istek için biricik (unique) bir anahtar oluşturarak isteğin akış boyunca izlenebilmesini sağlar. Bu anahtarı kullanılarak örneğin uygulamaların log kayıtları ile Apinizer üzerindeki log kayıtlarının ilişkilendirilerek takip edilmesi mümkün hale gelir. |
| `#FAULTCODE#` | İstemciye döndürülecek hata kodunun yanıt mesajı içinde koyulacağı yeri belirler. |
| `#FAULTMESSAGE#` | İstemciye döndürülecek hata iletisinin yanıt mesajı içinde koyulacağı yeri belirler. |
| `#FAULTMESSAGE_FIRSTLINE#` | İstemciye döndürülecek hata iletisinin ilk satırı veya ilk 150 karakteri alınarak, yanıt mesajı içine koyulur. |
| `#FAULTSTATUSCODE#` | İstemciye döndürülecek HTTP Durum Kodunun yanıt mesajı içinde koyulacağı yeri belirler. |
| `#RESPONSEFROMAPI#` | Backend API'den dönen bir yanıt varsa, bu yanıtın istemciye döndürülecek yanıt mesajı içinde koyulacağı yeri belirler. |
| `#RESPONSEFROMAPI_FIRSTLINE#` | Backend API'den dönen bir yanıtın ilk satırı veya ilk 150 karakteri alınarak, istemciye döndürülecek yanıt mesajı içine koyulur. |

<Info>
İstenirse her iki şablon da aktifleştirilebilir. Her iki şablon da aktifse hangisinin kullanılacağına şu kriterlere göre karar verilir:

1. Content-Type başlığının içeriği JSON ise JSON Hata Yanıt Şablonu kullanılır.
2. Content-Type başlığının içeriği boş ve API Proxy'nin tipi REST ise JSON Hata Yanıt Şablonu kullanılır.
3. Bunların geçerli olmadığı durumda XML Hata Yanıt Şablonu kullanılır.
</Info>

<Warning>
Eğer her iki şablon da aktifleştirilmemişse ya da hatanın nedeni API Proxy'nin bulunamamış olması ise (adres yanlış olabilir, API Proxy yüklenmemiş olabilir) bu durumda, `text/plain;charset=utf-8` başlığı ile şu yanıt gövdesi döner:

`[#CORRELATIONID#],[#FAULTCODE#],[#FAULTMESSAGE#],[#FAULTSTATUSCODE#],[#RESPONSEFROMAPI#]`
</Warning>

<Info>
Eğer API Proxy'nin [Yönlendirme (Routing)](/tr/develop/yonlendirme/http-yonlendirme) sekmesinde, "Hedef API'den Hata Dönmesi Durumunda Yanıt Şablonunu Uygulama (Ignore Error Response Template In Case Of Error On Backend API)" seçeneği işaretlenmiş ise bu bölümde tanımlanmış olan şablonlar kullanılmaz, Backend API'nin hata yanıtı olduğu gibi istemciye gönderilir.
</Info>

## İletilen IP Başlık Ayarı

Eğer API Proxy bir Yük Dengeleyici (Load Balancer) ya da Vekil Sunucunun (Proxy Server) arkasındaysa, istemciden gelen istek API Proxy'e bu katman tarafından yönlendirileceği için istemcinin IP değeri API Proxy ya da Backend API tarafından bilinemez. Bu nedenle, Yük Dengeleyici ya da Vekil Sunucular, orijinal istemcinin IP değerini bir başlık ile iletebilirler. İletilen IP Başlık Parametreleri ayarı, yazılım/donanıma göre değişiklik gösterebilen bu başlığın adının belirtilerek istemci IP'sinin API Proxy ve Backend API tarafından erişilebilir olmasını sağlar.

**İletilen IP Başlığı Ayarlarını Yapılandırma ekranına ait görsele aşağıda yer verilmiştir:**

<img
  src="/images/develop/api-proxy-konfigurasyonu/iletilen-ip-basligi-ayarlari.png"
  alt="İletilen IP Başlığı Ayarları"
  width="1000"
  height="700"
/>

### İletilen IP Başlığı Ayarları

| Alan | Açıklama |
|---|---|
| **İletilen IP Başlığı** _(Forwarded IP Header Parameter)_ | Eğer istemci bir Yük Dengeleyici ya da Geçit Sunucu arkasındaysa, bu parametre kullanılarak istemcinin gerçek IP numarasına ulaşılır. |
| **Kullanılacak IP** _(IP to Use)_ | İstek birden fazla vekilden geçmiş ise XFF değeri içinde birden fazla IP adresi birikebilir. Bu durumda hangi adresin alınacağına bu alan ile karar verilir. |

## API Tanım Dosyasını Gizleme

Etkinleştirildiğinde, kullanıcıların API Proxy'nin dış erişim adresi üzerinden API Tanım dosyasına erişmesi engellenir. Fakat bu ayarın Yönetim Konsolu üzerinden gözüken tanım dosyaları için bir etkisi yoktur.

<Warning>
API Proxy bir Proxy Grup içinde ise ve Tanım Dosyası kapalı ise, Proxy Grup Tanım Dosyasında saklı olan API Proxy'nin tanım dosyası gözükmez, eğer Proxy Gruptaki tüm Proxy'lerin tanım dosyaları kapalı ise kullanıcı erişim hatası alır.
</Warning>

<Info>
API Proxy Tanım dosyalarına erişim için [Genel Bilgi Sekmesi](/tr/develop/api-proxy-konfigurasyonu/overview) sayfasını ziyaret edebilirsiniz.
</Info>

## API Bakım Modu

Bakım Modu özelliği, etkinleştirildiğinde, API şu anda bakımda olduğunu belirten bir mesaj döndürecektir. API önceden tanımlanmış bir HTTP durum kodu ve mesaj yapısı ile yanıt verir.

**Bakım Modu Ayarlarını Yapılandırma ekranına ait görsele aşağıda yer verilmiştir:**

<img
  src="/images/develop/api-proxy-konfigurasyonu/bakim-modu-ayarlari.png"
  alt="Bakım Modu Ayarları"
  width="1000"
  height="700"
/>

### Bakım Modu Ayarları

| Alan | Açıklama |
|---|---|
| **HTTP Durum Kodu** _(HTTP Status Code)_ | Varsayılan HTTP durum kodudur. |
| **Mesaj** _(Message)_ | Mesaj şablonu bu alanda düzenlenebilir. |
| **İçerik Tipi** _(Content Type)_ | Döndürülecek yanıtın içerik tipidir. |

## API Trafik Log Ayarlarını Konfigure Etme

API Proxy'e gelen istek ve dönen yanıt mesajları API Proxy'nin yüklendiği ortamdaki API Proxy Trafik Log Konnektörlerine gönderilerek loglanır.

Log kayıtları iki tip veri içerir:

* Bunlardan ilki metrik verilerdir. Metrik verilerin saklanması isteğe bağlı değildir.
* İkincisi ise; İstemci → API Proxy, API Proxy → Backend API, Backend API → API Proxy, API Proxy → İstemci sırası ile iletilen istek ve yanıt mesajlarının, bu 4 bölgedeki içeriklerini oluşturan başlık (header), parametre (parameter) ve gövde (body) alanlarından oluşan kayıtlardır. Bu alanlardan hangilerinin log kayıtlarında bulunacağı ihtiyaca göre ya da log sunucusunun kaynak tüketimi baz alınarak belirlenebilir.

Varsayılan olarak projenin tüm mesaj bölgelerindeki log alanları aktiftir.

Varsayılan olarak tüm log alanlarının aktif gelmesine rağmen, özellikle Üretim (Production) Ortamlarında log verisinin aşırı büyümemesi için Body alanlarının pasife alınması tercih edilebilir.

**Log Ayarları konfigürasyonunu içeren görsele aşağıda yer verilmiştir:**

<img
    src="/images/develop/api-proxy-konfigurasyonu/log-ayarlari-settings.png"
    alt="Log Ayarları"
    width="1000"
    height="700"
/>

Log ayarları için kullanılan alanlar aşağıdaki tabloda görülmektedir.

| Alan | Açıklama |
|---|---|
| **Başlık** _(Header)_ | İlgili bölgedeki mesajın Başlık alanındaki değerlerin loglanmasını sağlar. |
| **Gövde** _(Body)_ | İlgili bölgedeki mesajın Gövde alanındaki değerin loglanmasını sağlar. |
| **Parametre** _(Parameter)_ | İlgili bölgedeki mesajın Parametre alanındaki değerlerin loglanmasını sağlar. |
| **Konnektörler** | İlgili logların hangi konnektöre gönderileceğini seçmek için kullanılır. |

Log Ayarları bölümünde, log ayarları API Proxy bazlı olarak yönetilir.

<Info>
    Log ayarları hakkında detaylı bilgi için [API Proxy Log Ayarları (Geliştirici İçin)](/tr/develop/api-proxy-konfigurasyonu/api-trafik-log-ayarlari) sayfasını ziyaret edebilirsiniz.
</Info>

## Sonraki Adımlar

<CardGroup cols={2}>
  <Card title="Genel Bilgi Sekmesi" icon="info-circle" href="/tr/develop/api-proxy-konfigurasyonu/overview">
    API Proxy genel bilgileri
  </Card>
  <Card title="Design" icon="pencil" href="/tr/develop/api-proxy-konfigurasyonu/design">
    API Proxy tasarım sekmesi
  </Card>
  <Card title="Endpoint Konfigürasyonu" icon="link" href="/tr/develop/api-proxy-konfigurasyonu/endpoint-konfigurasyonu">
    REST endpoint konfigürasyonu
  </Card>
  <Card title="SOAP Metod Konfigürasyonu" icon="code" href="/tr/develop/api-proxy-konfigurasyonu/soap-metod-konfigurasyonu">
    SOAP metod konfigürasyonu
  </Card>
  <Card title="API Trafik Log Ayarları" icon="database" href="/tr/develop/api-proxy-konfigurasyonu/api-trafik-log-ayarlari">
    API Proxy trafik log ayarları
  </Card>
</CardGroup>
