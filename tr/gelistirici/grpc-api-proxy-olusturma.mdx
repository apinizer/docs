---
title: "gRPC API Proxy Oluşturma"
description: 'Protobuf dosyasından gRPC API Proxy oluşturma, proto file import, service ve method tanımları, routing yapılandırması'
---

gRPC API Proxy, gRPC servislerinizi Apinizer platformu üzerinden yönetmek ve güvenli bir şekilde expose etmek için kullanılır. gRPC, Google tarafından geliştirilen yüksek performanslı bir RPC (Remote Procedure Call) framework'üdür ve Protocol Buffers (protobuf) formatını kullanır.

## gRPC API Proxy Nedir?

gRPC API Proxy, gRPC servislerinizin önünde duran bir katmandır. İstemcilerden gelen gRPC isteklerini alır, güvenlik, doğrulama, dönüştürme gibi politikaları uygular ve ardından backend gRPC servisinize yönlendirir.

<CardGroup cols={2}>
  <Card title="Protobuf Formatı" icon="file-code">
    gRPC API Proxy, Protocol Buffers (protobuf) formatında mesaj işleme yapar. Bu format, JSON'dan daha kompakt ve hızlıdır.
  </Card>
  <Card title="HTTP/2 Protokolü" icon="network-wired">
    gRPC, HTTP/2 protokolü üzerinde çalışır ve çoklu akış (multiplexing) desteği sağlar.
  </Card>
  <Card title="Streaming Desteği" icon="stream">
    Unary, Server Streaming, Client Streaming ve Bidirectional Streaming metodlarını destekler.
  </Card>
  <Card title="Yüksek Performans" icon="gauge">
    Binary protobuf formatı sayesinde JSON'a göre daha yüksek performans sağlar.
  </Card>
</CardGroup>

## gRPC API Proxy Oluşturma Yöntemleri

gRPC API Proxy oluşturmak için birkaç yöntem mevcuttur:

<AccordionGroup>
  <Accordion title="Protobuf (.proto) Dosyasından Import">
    En yaygın yöntem, protobuf (.proto) dosyasından import etmektir. Bu yöntem, servislerinizi, metodlarınızı ve mesaj tiplerinizi otomatik olarak içe aktarır.
  </Accordion>
  
  <Accordion title="Manuel Oluşturma">
    Protobuf dosyası olmadan da manuel olarak gRPC API Proxy oluşturabilirsiniz. Bu durumda servisleri ve metodları manuel olarak tanımlamanız gerekir.
  </Accordion>
  
  <Accordion title="Mevcut API Proxy'den Kopyalama">
    Mevcut bir gRPC API Proxy'yi kopyalayarak yeni bir proxy oluşturabilirsiniz. Bu yöntem, benzer servisler için zaman kazandırır.
  </Accordion>
</AccordionGroup>

## Protobuf Dosyasından Import

### Adım 1: API Proxy Oluşturma Sayfasına Gidin

1. Sol taraftaki ana menüde **Geliştirme → API Proxy'ler (Development → API Proxies)** ögesini seçin.
2. Açılan arayüzde sağ üstteki **+Create** butonuna tıklayın.
3. **gRPC API** seçeneğini seçin.

### Adım 2: Protobuf Dosyasını Yükleyin

Protobuf dosyasını yüklemek için üç yöntem mevcuttur:

#### Yöntem 1: Dosya Yükleme

1. **Dosya Yükle (Upload File)** butonuna tıklayın.
2. Bilgisayarınızdan `.proto` dosyasını seçin.
3. Dosya otomatik olarak parse edilir ve servis bilgileri görüntülenir.

:::info Protobuf Dosyası Formatı
Protobuf dosyası, gRPC servislerinizi tanımlayan bir dosyadır. Dosya içinde `service`, `rpc`, `message` gibi tanımlar bulunur.
:::

#### Yöntem 2: URL'den Yükleme

1. **URL Gir (Enter URL)** bağlantısına tıklayın.
2. Protobuf dosyasının URL'sini girin.
3. **Parse** butonuna tıklayın.
4. Dosya parse edilir ve servis bilgileri görüntülenir.

#### Yöntem 3: Metin Olarak Yapıştırma

1. **Metin Olarak Yapıştır (Paste as Text)** seçeneğini seçin.
2. Protobuf içeriğini metin alanına yapıştırın.
3. **Parse** butonuna tıklayın.
4. İçerik parse edilir ve servis bilgileri görüntülenir.

### Adım 3: Servis Bilgilerini Kontrol Edin

Parse işlemi tamamlandıktan sonra, aşağıdaki bilgiler görüntülenir:

* **Package**: Protobuf package adı
* **Servisler**: Tüm gRPC servisleri
* **Metodlar**: Her servis için RPC metodları
* **Mesaj Tipleri**: Request ve response mesaj tipleri
* **Streaming Tipi**: Unary, Server Streaming, Client Streaming veya Bidirectional Streaming

### Adım 4: Routing Yapılandırması

#### Client Route (Relative Path)

Client Route, API Proxy'nin dış dünyaya açılan endpoint'idir. İstemciler bu endpoint üzerinden gRPC servisine erişir.

**Örnek:**
```
Relative Path: /grpc/user-service
```

Bu durumda gRPC servisine şu şekilde erişilir:
```
{apinizer-gateway}/grpc/user-service
```

#### Upstream Target (Backend Address)

Upstream Target, backend gRPC servisinizin adresidir. API Proxy, istekleri bu adrese yönlendirir.

**Yapılandırma Formatı:**
```
host:port
```

**Örnek:**
```
backend-grpc.example.com:50051
```

:::info gRPC Port
gRPC servisleri genellikle 50051 gibi özel portlarda çalışır. Backend servisinizin port numarasını doğru belirttiğinizden emin olun.
:::

### Adım 5: gRPC Routing Yapılandırması

gRPC için özel routing yapılandırması yapmanız gerekebilir. Daha fazla bilgi için [gRPC Routing](/tr/gelistirici/gRPC-routing) sayfasına bakabilirsiniz.

### Adım 6: API Proxy'yi Kaydedin

1. Tüm bilgileri kontrol edin.
2. **Relative Path** alanını doldurun (zorunlu).
3. **Upstream Target** bilgisini girin (host:port formatında).
4. Sağ üstteki **Kaydet (Save)** butonuna tıklayın.

**gRPC API Proxy başarıyla oluşturuldu!**

## Protobuf Dosyası Yapısı

Protobuf dosyası genellikle şu yapıya sahiptir:

```protobuf
syntax = "proto3";

package com.example.service;

// Mesaj tanımları
message UserRequest {
  string user_id = 1;
}

message UserResponse {
  string user_id = 1;
  string name = 2;
  string email = 3;
}

// Servis tanımı
service UserService {
  // Unary RPC
  rpc GetUser(UserRequest) returns (UserResponse);
  
  // Server Streaming RPC
  rpc ListUsers(UserRequest) returns (stream UserResponse);
  
  // Client Streaming RPC
  rpc CreateUsers(stream UserRequest) returns (UserResponse);
  
  // Bidirectional Streaming RPC
  rpc ChatUsers(stream UserRequest) returns (stream UserResponse);
}
```

## gRPC Metod Tipleri

gRPC dört farklı metod tipini destekler:

<CardGroup cols={2}>
  <Card title="Unary RPC" icon="arrow-right">
    Tek bir request, tek bir response. En yaygın kullanılan metod tipidir.
    
    **Örnek:**
    ```protobuf
    rpc GetUser(UserRequest) returns (UserResponse);
    ```
  </Card>
  <Card title="Server Streaming RPC" icon="arrow-down">
    Tek bir request, çoklu response. Sunucu bir stream gönderir.
    
    **Örnek:**
    ```protobuf
    rpc ListUsers(UserRequest) returns (stream UserResponse);
    ```
  </Card>
  <Card title="Client Streaming RPC" icon="arrow-up">
    Çoklu request, tek bir response. İstemci bir stream gönderir.
    
    **Örnek:**
    ```protobuf
    rpc CreateUsers(stream UserRequest) returns (UserResponse);
    ```
  </Card>
  <Card title="Bidirectional Streaming RPC" icon="arrows-rotate">
    Çoklu request, çoklu response. Her iki taraf da stream gönderir.
    
    **Örnek:**
    ```protobuf
    rpc ChatUsers(stream UserRequest) returns (stream UserResponse);
    ```
  </Card>
</CardGroup>

## Import Sonrası Yapılandırma

API Proxy oluşturulduktan sonra, aşağıdaki yapılandırmaları yapabilirsiniz:

### 1. gRPC Routing Yapılandırması

gRPC Routing, metodların nasıl yönlendirileceğini belirler. Daha fazla bilgi için [gRPC Routing](/tr/gelistirici/gRPC-routing) sayfasına bakabilirsiniz.

### 2. Politikalar Ekleme

API Proxy'nize güvenlik, doğrulama, dönüştürme gibi politikalar ekleyebilirsiniz. Daha fazla bilgi için [Politika Yönetimi](/tr/gelistirici/politika-yonetimi) sayfasına bakabilirsiniz.

:::note gRPC Politikaları
gRPC için bazı politikalar özel olarak uygulanabilir. Örneğin, protobuf mesajlarını doğrulama veya dönüştürme politikaları.
:::

### 3. Test Etme

gRPC API Proxy'nizi test etmek için gRPC client araçları kullanabilirsiniz. Apinizer Test Console, gRPC test desteği sağlar.

### 4. Deployment

API Proxy'nizi ortam(lar)a deploy etmek için [Deployment Versioning](/tr/gelistirici/deployment-versioning) sayfasına bakabilirsiniz.

## Yaygın Senaryolar

### Senaryo 1: Internal gRPC Servisini Expose Etme

Internal bir gRPC servisini dış dünyaya expose etmek:

1. gRPC servisinizin `.proto` dosyasını yükleyin.
2. Relative Path belirleyin (örneğin: `/grpc/user-service`).
3. Upstream Target olarak internal servisin adresini kullanın (örneğin: `internal-grpc.example.com:50051`).
4. Güvenlik politikaları ekleyin (mTLS, Authentication).
5. Kaydedin ve deploy edin.

### Senaryo 2: gRPC Servis Versiyonlama

Farklı versiyonlar için ayrı API Proxy'ler oluşturmak:

1. Her versiyon için ayrı `.proto` dosyası kullanın.
2. Farklı Relative Path'ler kullanın (örneğin: `/grpc/v1/user-service`, `/grpc/v2/user-service`).
3. Her versiyon için ayrı politikalar tanımlayın.
4. Versiyonlar arasında geçiş stratejisi belirleyin.

### Senaryo 3: gRPC'den REST'e Dönüştürme

gRPC servisini REST API olarak expose etmek:

1. gRPC API Proxy oluşturun.
2. REST dönüştürme politikaları ekleyin.
3. gRPC metodlarını REST endpoint'lerine map edin.
4. Request/Response dönüştürmelerini yapılandırın.

## En İyi Uygulamalar

<CardGroup cols={2}>
  <Card title="Protobuf Dosyası Kalitesi" icon="file-code">
    Protobuf dosyanızın geçerli ve güncel olduğundan emin olun. Geçersiz dosyalar import sırasında hata verebilir.
  </Card>
  <Card title="Relative Path Stratejisi" icon="route">
    Relative Path'ler için tutarlı bir isimlendirme kuralı kullanın. Örneğin: `/grpc/{servis-adı}/{versiyon}`
  </Card>
  <Card title="Backend Adresi" icon="server">
    Backend adreslerini environment variable olarak tanımlayın. Bu, farklı ortamlar için esneklik sağlar.
  </Card>
  <Card title="mTLS Güvenliği" icon="shield">
    gRPC için mutlaka mTLS (mutual TLS) güvenliği kullanın. gRPC servisleri genellikle internal network'te çalışır ve güvenlik kritiktir.
  </Card>
  <Card title="Streaming Performansı" icon="stream">
    Streaming metodları için performans optimizasyonları yapın. Büyük veri akışları için buffer ayarlarını optimize edin.
  </Card>
  <Card title="Error Handling" icon="circle-exclamation">
    gRPC error kodlarını (status codes) doğru şekilde handle edin. gRPC, HTTP status kodlarından farklı bir error sistemi kullanır.
  </Card>
</CardGroup>

## Sorun Giderme

### Import Hatası

**Sorun:** Protobuf dosyası import edilemiyor.

**Çözüm:**
* Protobuf dosyasının geçerli syntax'a sahip olduğundan emin olun (proto2 veya proto3).
* Dosyanın tüm bağımlılıklarının (import edilen dosyalar) mevcut olduğundan emin olun.
* URL erişilebilirliğini kontrol edin.
* Dosya boyutunun limit içinde olduğundan emin olun.

### Servisler Görünmüyor

**Sorun:** Import sonrası servisler görünmüyor.

**Çözüm:**
* Protobuf dosyasında `service` tanımlarının doğru olduğundan emin olun.
* Package adının doğru tanımlandığını kontrol edin.
* RPC metodlarının doğru şekilde tanımlandığını kontrol edin.

### Routing Hatası

**Sorun:** İstekler backend'e yönlendirilmiyor.

**Çözüm:**
* Upstream Target adresinin doğru formatda olduğundan emin olun (host:port).
* Backend gRPC servisinizin erişilebilir olduğunu kontrol edin.
* gRPC Routing yapılandırmasını kontrol edin.
* Port numarasının doğru olduğundan emin olun.

### Streaming Hatası

**Sorun:** Streaming metodları çalışmıyor.

**Çözüm:**
* Streaming metodlarının doğru tanımlandığını kontrol edin.
* HTTP/2 desteğinin aktif olduğundan emin olun.
* Timeout ayarlarını kontrol edin (streaming için daha uzun timeout gerekebilir).

## Sonraki Adımlar

<CardGroup cols={2}>
  <Card title="gRPC Routing" icon="route" href="/tr/gelistirici/gRPC-routing">
    gRPC Routing yapılandırmasını öğrenin
  </Card>
  <Card title="Politika Yönetimi" icon="shield" href="/tr/gelistirici/politika-yonetimi">
    Politikalar eklemeyi öğrenin
  </Card>
  <Card title="mTLS Güvenliği" icon="lock" href="/tr/gelistirici/politikalar/mTLS">
    mTLS güvenliği hakkında bilgi edinin
  </Card>
  <Card title="Deployment" icon="rocket" href="/tr/gelistirici/deployment-versioning">
    Deployment yapmayı öğrenin
  </Card>
</CardGroup>
