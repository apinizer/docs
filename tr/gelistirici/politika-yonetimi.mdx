---
title: "Politika Yönetimi"
description: "API Proxy'de mesaj akışı sırasında istek ve yanıt mesajlarına uygulanacak politikaları yönetebilir. Pre-flow ve post-flow politikaları ekleyebilir, koşullu politikalar tanımlayabilir ve hata durumunda çalışacak politikaları yapılandırabilir. Politikaları aktif/pasif hale getirebilir, sıralamasını değiştirebilir ve görsel akış diyagramı üzerinden yönetebilir."
---

## Mesaj Akışı

### İstemci (Client)

Arayüzde sol taraftaki çerçeve içinde gösterilir. API Proxy'e istek gönderen paydaştır. Akışı başlatır. İstemciden çıkan mesaj, politikalar uygulandıktan sonra Backend API'ye ulaşır.

### Backend API

API Proxy ile istemcinin doğrudan erişimine kapatılan ve istemciden saklanan, istekleri API Proxy'den alıp yanıtlarını API Proxy'e döndüren orijinal API'dır. Arayüzünde sağ taraftaki çerçeve ile gösterilir. Backend API'nin yanıtı, politikalar uygulandıktan sonra İstemciye gönderilir.

Backend API kutusundaki API bağlantısına tıklandığı zaman Backend API'nin API Tanım Belgesi görüntülenir.

## Mesaj İşleme Süreci

Bir mesaj API Proxy'ye geldiğinde şu adımlar izlenir:

```
İstemci İsteği
   │
   ▼
┌─────────────────────────────────┐
│ 1. Mesaj Alınır                │
│    - Request parse edilir       │
│    - Header'lar okunur          │
│    - Body parse edilir          │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 2. Pre-flow Çalıştırılır        │
│    - Authentication             │
│    - Authorization              │
│    - Rate Limiting              │
│    - Validation                 │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 3. Koşullar Kontrol Edilir     │
│    - IF-THEN-ELSE yapısı        │
│    - Conditional policies       │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 4. Yönlendirme Yapılır         │
│    - Upstream Target seçilir    │
│    - Load balancing uygulanır  │
└──────────────┬──────────────────┘
               │
               ▼
         Backend API
               │
               ▼
┌─────────────────────────────────┐
│ 5. Post-flow Çalıştırılır      │
│    - Response Transformation    │
│    - Data Masking               │
│    - Logging                    │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 6. Yanıt Gönderilir            │
│    - Response formatlanır      │
│    - İstemciye gönderilir       │
└─────────────────────────────────┘
```

## Politikalar Nedir?

Politikalar, istek ve yanıt mesajları üzerinde gerçekleştirilmesi istenen güvenlik, mesajları filtreleme, doğrulama, dönüştürme ya da zenginleştirme, kısmen iş mantığı uygulama, hata yönetimi vb. işlemleri tarif etmek üzere yapılan konfigürasyonlardır. API Gateway, İstemci ile Backend API arasındaki mesaj akışı sırasında, bu konfigürasyonlar ile kendisine tanıtılan politikaları işletir.

Bu bölümde genel olarak politikalar üzerinde yapılabilecek işlemler anlatılmaktadır. Herhangi bir politika hakkında detaylı bilgi edinmek için [Politikalar (Policies)](/tr/gelistirici/politikalar) bölümünden ilgili politikaya ilişkin dokümantasyona bakabilirsiniz.

## Politikaların Yeri ve Çalışma Sırası

Politikalar 3 farklı noktaya eklenebilir:

1. **API Proxy Grubu**: Bir API Proxy Grubuna eklenen bir politika, sadece istek API Proxy Grup üzerinden gelmiş ise işletilir.
2. **API Proxy**: Bir API Proxy'ye eklenen bir politika, o API Proxy'nin bütün metot/endpoint'leri için işletilir.
3. **Metot/Endpoint**: Bir metot/endpoint'e eklenen bir politika, yalnızca o metot/endpoint için işletilir.

<Info>
  API Proxy'nin herhangi bir metot/endpoint'i için herhangi bir politikanın eklenmiş olması durumunda metot/endpoint yanında çark ikonu bulunur.
</Info>

### Politikaların İşletilme Sırası

Politikalar, mesajın akış sırasında;

* **İstek mesajı için**: API Proxy Grup → API Proxy → metot/endpoint sırasıyla
* **Yanıt mesajı için**: metot/endpoint → API Proxy → API Proxy Grup sırasıyla

işletilir. Her seviyede, o seviyedeki politikalar mesajın akış yönündeki sıralamaya göre işleme alınır.

## Politikaların Uygulanma Sırası

Politikalar tanımlandıkları sırayla çalıştırılır. Bu sıra kritik öneme sahiptir:

<CardGroup cols={2}>
  <Card title="1. Pre-flow Policies" icon="arrow-down">
    İstek backend'e gönderilmeden önce çalışan politikalar:
    * Authentication
    * Authorization
    * Rate Limiting
    * Validation
  </Card>
  <Card title="2. Conditional Policies" icon="code-branch">
    Koşullara bağlı olarak çalışan politikalar:
    * IF-THEN-ELSE yapısı
    * Mesaj içeriğine göre
    * Header değerlerine göre
  </Card>
  <Card title="3. Route Step" icon="route">
    Backend'e yönlendirme:
    * Upstream Target seçimi
    * Load balancing
    * Failover
  </Card>
  <Card title="4. Post-flow Policies" icon="arrow-up">
    Backend'den yanıt geldikten sonra çalışan politikalar:
    * Response Transformation
    * Data Masking
    * Logging
  </Card>
</CardGroup>

### Pre-flow Policies

İstek backend'e gönderilmeden önce çalışan politikalar:

<AccordionGroup>
  <Accordion title="Güvenlik Politikaları">
    * **Authentication**: Kimlik doğrulama
      * OAuth2 / OIDC / JWT
      * Basic / Digest Authentication
      * mTLS
    * **Authorization**: Yetkilendirme
      * IP Whitelist/Blacklist
      * API Key kontrolü
      * Role-based Access Control
  </Accordion>
  
  <Accordion title="Trafik Yönetimi">
    * **Rate Limiting**: İstek hızı sınırlama
    * **Quota Management**: Kota yönetimi
    * **Time Restriction**: Zaman kısıtlaması
  </Accordion>
  
  <Accordion title="Doğrulama">
    * **Schema Validation**: JSON/XML şema doğrulama
    * **Message Size**: Mesaj boyutu kontrolü
    * **Content-Type**: İçerik tipi kontrolü
  </Accordion>
</AccordionGroup>

### Post-flow Policies

Backend'den yanıt geldikten sonra çalışan politikalar:

<AccordionGroup>
  <Accordion title="Response Transformation">
    * **Format Conversion**: JSON ↔ XML dönüştürme
    * **Data Mapping**: Veri eşleştirme
    * **Field Removal**: Alan kaldırma
    * **Field Addition**: Alan ekleme
  </Accordion>
  
  <Accordion title="Data Masking">
    * **Sensitive Data Masking**: Hassas veri maskeleme
    * **Field Encryption**: Alan şifreleme
    * **PII Protection**: Kişisel bilgi koruma
  </Accordion>
  
  <Accordion title="Logging">
    * **Request Logging**: İstek kaydı
    * **Response Logging**: Yanıt kaydı
    * **Audit Logging**: Denetim kaydı
  </Accordion>
</AccordionGroup>

### Hata Durumunda Politikaların İşletilme Sırası

Hata durumunda işletilecek olan politikalar "Hata Politikası Ekle" seçeneği ile eklenir.

Akışın herhangi bir noktasında hata olması durumunda normal akış kesilerek öncelikle varsa hata yanıt şablonu hata mesajına uygulanır.

Sonrasında "Hata Politikaları" hattına eklenen politikalar sağdan sola doğru sırasıyla işletilir.

## Politika Uygulama Örnekleri

### Örnek 1: Basit Mesaj İşleme

```
İstek: GET /api/v1/products
   │
   ▼
1. Pre-flow: OAuth2 Authentication ✓
   │
   ▼
2. Pre-flow: Rate Limiting ✓
   │
   ▼
3. Route: Backend'e yönlendirme
   │
   ▼
4. Post-flow: Response Logging ✓
   │
   ▼
Yanıt: 200 OK
```

### Örnek 2: Koşullu Politika Uygulama

```
İstek: POST /api/v1/products
   │
   ▼
1. Pre-flow: OAuth2 Authentication ✓
   │
   ▼
2. Conditional Policy:
   IF Content-Type == "application/json" THEN
      └─ JSON Schema Validation ✓
   ELSE IF Content-Type == "application/xml" THEN
      └─ XML Schema Validation ✓
   │
   ▼
3. Route: Backend'e yönlendirme
   │
   ▼
4. Post-flow: Response Transformation ✓
   │
   ▼
Yanıt: 201 Created
```

### Örnek 3: Hata Durumunda Politika Uygulama

```
İstek: GET /api/v1/products
   │
   ▼
1. Pre-flow: OAuth2 Authentication ✗ (Token geçersiz)
   │
   ▼
2. Fault Handler Policy:
   └─ Error Response Transformation
   └─ Error Logging
   │
   ▼
Yanıt: 401 Unauthorized
```

## Politika Yönetimi İşlemleri

### Akışa Politika Ekleme

Bir politika eklemek için geliştirme sekmesinde ilgili akış bölümüne (Pre-flow, Post-flow, vb.) tıklayarak politika ekleme diyalogunu açabilirsiniz.

### Akıştaki Politikayı Güncelleme

Var olan bir politikanın ikonuna tıklandığı zaman, o politikanın bilgilerinin güncellenebileceği bir pencere açılır.

### Seçilen Politikayı Activate/Deactivate Etme

Bir politika, eklenmiş olduğu metot/endpoint ya da API Proxy'den silinmeden geçici olarak kullanımdan kaldırılabilir. Bunun için politika güncellenmek üzere açılır ve açılan pencerenin en üst kısmındaki **Deactivate** tuşuna tıklanır.

Politikalar devre dışı kaldığında, ikonların renkleri değişerek gri bir görünüme kavuşur.

### Bütün Politikaları Activate/Deactivate Etme

Metot/endpoint bölümünde, orta bölümün alt kısmında **Bütün Politikaları Kapat (Disable All Policies)** bağlantısı belirir. Bu bağlantıya tıklandığı zaman, eğer **Hepsi (All)** seçeneğinde ise API Proxy üzerine eklenmiş olan bütün politikalar; eğer herhangi bir metot içerisindeyse sadece o metot içerisinde eklenmiş olan tüm politikalar devre dışı kalır.

Kullanımdan kaldırılmış olan politikalar daha sonra politika güncelleme penceresinden tek tek ya da **Bütün Politikaları Aç (Activate All Policies)** bağlantısına tıklanarak toplu olarak yeniden etkinleştirilebilir.

<Warning>
  Eğer API Proxy bir API Proxy Grubu'na eklenmişse ve bu API Proxy Grubu üzerinden politikalar uygulanmışsa, bütün politikaların kapatılması API Proxy Grubu'ndan gelen politikaları etkilemez, bu politikalar aktif olarak kalır.
</Warning>

### Akıştan Politika Kaldırma

Fare silinmek istenen politikanın üzerine getirildiğinde, politikayı silecek bir ikon belirir. Bu ikona tıklanarak politika silinebilir.

<Info>
  Geliştirme sekmesinde gerçekleştirilen politika silme işlemi, politikanın sadece bu akıştan kaldırılmasını sağlar. Politika tanımı sistemden silinmez ve diğer yerlerde kullanılmaya devam edebilir.
</Info>

## Politika Uygulama Best Practices

<CardGroup cols={2}>
  <Card title="Sıralama Önceliği" icon="list-ol">
    * Güvenlik politikaları önce çalışmalı
    * Rate limiting authentication'dan sonra
    * Validation transformation'dan önce
  </Card>
  <Card title="Performans" icon="gauge">
    * Ağır işlemleri sona bırakın
    * Cache kullanımını değerlendirin
    * Gereksiz politikaları kaldırın
  </Card>
  <Card title="Hata Yönetimi" icon="triangle-exclamation">
    * Fault handler politikaları tanımlayın
    * Hata mesajlarını özelleştirin
    * Hata loglama yapın
  </Card>
  <Card title="Test" icon="flask">
    * Politikaları ayrı ayrı test edin
    * Senaryo bazlı test yapın
    * Performans testi yapın
  </Card>
</CardGroup>

## Sonraki Adımlar

<CardGroup cols={2}>
  <Card title="Message Flow & Policy Pipeline" icon="diagram-project" href="/tr/genel-bakis/apinizeri-anlamak/temel-kavramlar-ve-terminoloji/message-flow-ve-policy-pipeline">
    Message Flow ve Policy Pipeline kavramını öğrenin
  </Card>
  <Card title="Koşullu Politika Çalıştırma" icon="code-branch" href="/tr/apinizer-anlama/temel-kavramlar/kosullu-politika-calistirma">
    Koşullu politika çalıştırmayı öğrenin
  </Card>
  <Card title="Politikalar" icon="shield" href="/tr/gelistirici/politikalar">
    Tüm politikalar hakkında detaylı bilgi alın
  </Card>
  <Card title="Global Configurations" icon="cog" href="/tr/gelistirici/gelistirici-kilavuzu/politika-yonetimi/global-configurations/global-policies">
    Global politika yapılandırmalarını öğrenin
  </Card>
</CardGroup>
