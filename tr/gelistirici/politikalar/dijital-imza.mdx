---
title: "Dijital İmza"
description: "İstek mesajının seçilen bölümünü belirtilen anahtar veya sertifika ile imzalayabilir ve hedef değişkene yazabilirsiniz. Dijital imza oluşturarak mesaj bütünlüğünü ve kimlik doğrulamayı sağlayabilirsiniz"
---

<Tip>
Bu doküman spesifik bir politikanın detaylı kullanımını anlatır. Eğer Apinizer politika yapısını ilk kez kullanıyorsanız veya politikaların genel çalışma prensiplerini öğrenmek istiyorsanız, öncelikle [Politika Nedir?](/tr/apinizer-anlama/temel-kavramlar/politika-nedir) sayfasını okumanızı öneririz.
</Tip>

## Genel Bakış

### Amacı Nedir?

- İstek veya yanıt mesajının kritik bölümlerine dijital imza ekleyerek bütünlük ve inkâr edilemezlik sağlar.
- Gizli anahtarların merkezi yönetimi sayesinde imzalama sürecini standartlaştırıp denetlenebilir hale getirir.
- Farklı `API Proxy (API Vekil Sunucusu)` akışlarında yeniden kullanılabilir imza şablonları oluşturarak bakım maliyetini azaltır.
- Mesaj üzerine imza algoritması bilgisini isteğe bağlı ekleyerek doğrulama tarafının dinamik uyarlanmasına imkân tanır.

### Çalışma Prensibi

1. **İstek Gelişi**: API Gateway'e gelen her HTTP/HTTPS isteği için, istemin kaynak IP adresi tespit edilir.
2. **Politika Kontrolü**: Dijital İmza politikası aktif ise, sistem aşağıdaki sırayla kontrol yapar:
   - Condition (koşul) tanımlı mı? Varsa koşul sağlanıyor mu?
   - Politika aktif mi (active=true)?
   - Variable kullanılıyor mu yoksa Apinizer default mı?
3. **Dijital İmza Üretimi**: Tanımlı her imza kuralı için kaynak değişkendeki metin okunur, seçilen özel anahtar/sertifika ve algoritma ile imzalanır, çıktı seçilen kodlama (Base64/Hex) ile hedef değişkene yazılır; algoritma değişkeni tanımlıysa aynı anda güncellenir.
4. **Karar Verme**:
   - **Eşleşme Var**: Kaynak değişkende veri bulunursa imza üretilir ve hedef değişkene yerleştirilir.
   - **Eşleşme Yok**: Kaynak veri boşsa imza atlanır, hedef değişken boş değerle güncellenir ve akış devam eder.
5. **Hata İşleme**: Politika kuralına uymayan istekler için özelleştirilebilir HTTP durum kodu ve hata mesajı döndürülür.

## Özellikler ve Yetenekler

### Temel Özellikler

- **Çoklu İmza Tanımı**: Tek politika altında farklı mesaj alanlarını farklı algoritmalar ve anahtarlarla imzalama olanağı sağlar.
- **Değişken Tabanlı Hedefleme**: İmzalanacak veri ve imzanın yazılacağı alan için değişken seçimi yaparak hem istekte hem yanıtta esneklik sunar.
- **Sertifika/Anahtar Entegrasyonu**: Gizli anahtarlar veya sertifikalar Apinizer Secret Manager üzerinden seçilir, revokasyon kontrolleri otomatik yapılır.
- **Aktif/Pasif Durum Kontrolü**: Politikanın aktif veya pasif durumunu kolayca değiştirme (active/passive toggle). Pasif durumda politika uygulanmaz ancak yapılandırması saklanır.
- **Koşul Bazlı Uygulama**: Query Builder ile karmaşık koşullar oluşturarak politikanın ne zaman uygulanacağını belirleme (örn: sadece belirli endpoint'lere veya header değerlerine göre).

### İleri Düzey Özellikler

- **Dinamik Algoritma Yayını**: `signatureAlgorithmVar` kullanılarak uygulanan algoritma adı mesaj içine yazdırılabilir ve tüketici sistemlere bilgi sağlar.
- **Gelişmiş Değişken Yönetimi**: Variable Update Dialog ile mevcut değişkenler üzerinde düzenleme yapmadan seçilip güncellenebilir.
- **Anında Anahtar/Sertifika Oluşturma**: Yapılandırma ekranından yeni Crypto Key veya sertifika kayıtları oluşturularak bekleme süresi olmadan politika güncellenir.
- **Export/Import Özelliği**: Politika yapılandırmasını ZIP dosyası olarak export etme. Farklı ortamlara (Geliştirme, Test, Canlı Ortam) import etme. Versiyon kontrolü ve yedekleme imkanı.
- **Policy Group ve Proxy Group Desteği**: Birden fazla politikayı Policy Group içinde yönetme. Proxy Group'lara toplu politika atama. Merkezi güncelleme ve deploy işlemleri.
- **Deploy ve Versiyonlama**: Politika değişikliklerini canlı ortama deploy etme. Hangi API Proxy'lerde kullanıldığını görme (Policy Usage). Proxy Group ve Policy Group kullanım raporları.

## Kullanım Senaryoları

| Senaryo | Durum | Çözüm (Politika Uygulaması) | Beklenen Davranış / Sonuç |
|---------|-------|----------------------------|---------------------------|
| REST Yanıtında JSON İmzalama | Dış sistemler yanıt gövdesinin bütünlüğünü doğrulamak istiyor | `sourceVar=response.content`, `signatureVar=response.header.X-Signature`, algoritma `SHA256withRSA`, Base64 çıktı, Crypto Key seç | Yanıt gönderilmeden önce imza hesaplanır, başlığa eklenir, doğrulama tarafı imzayı kontrol eder |
| SOAP İsteğinde Body İmzalama | ESB, gelen SOAP body'i imzalamak zorunda | `sourceVar=request.soap.body`, `signatureVar=request.soap.header.Signature`, algoritma `SHA1withRSA`, Hex çıktı, sertifika seç | İmza SOAP header'a eklenir, alt sistemler mesajın değişmediğini teyit eder |
| IoT Mesajında Algoritma Bildirimi | IoT ağ geçidi imzalama algoritmasını dinamik bildirmek istiyor | `signatureAlgorithmVar=request.header.X-Sign-Alg` tanımlanır, algoritma `SHA512withECDSA` | Mesaj hem imza hem algoritma adıyla zenginleşir, cihaz güncellemeye gerek kalmadan çalışır |
| Çoklu Alan İmzalama | Birden fazla JSON alanı ayrı anahtarlarla imzalanacak | İki farklı tanım ile farklı `sourceVar` ve Crypto Key seçilir | Her alan için bağımsız imza üretilir, tüketici taraf kombinasyon doğrulaması yapar |
| Mikroservisler Arası Yetkilendirme | Servisler arası çağrılarda kimlik doğrulaması için imza gerekiyor | İstek üstbilgisine imza eklenir, Condition ile sadece dahili çağrılarda çalışır | Mikroservis gelen isteğin gerçekten beklenen servisten geldiğini doğrular |
| Arşivleme Öncesi İmza | Belgeler saklanmadan önce değişmezlik garantisi isteniyor | Policy Group üzerinden toplu atanır, `sourceVar` belge içeriği, imza metadata alanına yazılır | Arşivlenen her belge imzalı hale gelir, denetimlerde kanıtlanabilirlik sağlanır |
| (opsiyonel) Veri Maskeleme Sonrası İmza | Maskelenmiş alanların değişmediğini göstermek için | Maskeleme politikası ardından çalıştırılır, aynı alan üzerine imza atılır | Maskelenmiş verinin bütünlüğü korunur, zincir halinde izlenebilir |

## Politika Parametrelerini Yapılandırma

Bu adımda, kullanıcı **yeni bir politika oluşturabilir** ya da **mevcut politika parametrelerini yapılandırarak** erişim kurallarını belirleyebilir. Tanımlanan parametreler, politikanın çalışma şeklini (örneğin hangi IP'lerin izinli olacağı, coğrafi kısıtlamalar, koşullu aktivasyonlar vb.) doğrudan etkiler. Bu sayede politika hem kuruma özel gereksinimlere göre özelleştirilebilir hem de merkezi olarak yönetilebilir.

### Yeni Dijital İmza Politikası Oluşturma

<img src="/images/gelistirici/politikalar/dijital-imza-1.png" alt="Dijital İmza Politikası Yapılandırma" width="1000" />

#### Yapılandırma Adımları

| Adım | Açıklama / İşlem |
|------|------------------|
| **Adım 1: Oluşturma Sayfasına Gitme** | - Sol menüden **Development → Global Settings → Global Policies → Dijital İmza** bölümüne gidin.<br />- Sağ üstteki **[+ Create]** butonuna tıklayın. |
| **Adım 2: Temel Bilgileri Girme** | **Policy Status (Politika Durumu):** Aktif/Pasif durumu gösterir. Yeni politikalar varsayılan olarak aktiftir.<br /><br />**Name (İsim) Zorunlu:**<br />Örnek: `Production_DigitalSign`<br />- Benzersiz isim girin, boşlukla başlamaz.<br />- Sistem otomatik kontrol eder. Yeşil tik: kullanılabilir. Kırmızı çarpı: mevcut isim.<br /><br />**Description (Açıklama):**<br />Örnek: "Yanıt payload'ına HSM anahtarıyla imza ekler."<br />- Maks. 1000 karakter.<br />- Politikanın amacını açıklayın. |
| **Adım 3: İmza Tanımlarını Oluşturma** | **[+ Add]** butonu ile imza tanımı açın.<br />- **sourceVar** (imzalanacak veri kaynağı): İmzalanacak veriyi içeren değişkeni seçin.<br />- **signatureVar** (imzanın yazılacağı hedef): İmzanın yazılacağı değişkeni seçin.<br />- **signatureAlgorithm**: İmza algoritmasını seçin (örn: SHA256withRSA, SHA512withECDSA).<br />- **outputEncodingType**: İmza çıktısının kodlama tipini seçin (BASE64 veya HEXADECIMAL).<br />- **signatureAlgorithmVar** (isteğe bağlı): Algoritma bilgisinin yazılacağı değişkeni seçin. |
| **Adım 4: Anahtar/Sertifika Seçimi** | **KEY** seçilirse:<br />- Crypto Key listesinden özel anahtar seçin veya yeni anahtar oluşturun.<br /><br />**CERTIFICATE** seçilirse:<br />- Sertifika listesinden seçin.<br />- ⚠️ Revoke edilmiş sertifikalar kırmızı etiketlenir, kullanılmamalıdır. |
| **Adım 5: Çoklu Tanım ve Sıralama (Varsa)** | - Farklı mesaj bölümleri için ek tanımlar ekleyin.<br />- Her tanımı düzenleyerek farklı algoritma veya kodlama atayabilirsiniz.<br />- Gerekmiyorsa tanımı **[Delete]** ile kaldırın. |
| **Adım 6: Koşul Tanımlama (İsteğe Bağlı)** | - **Condition** sekmesine geçin.<br />- Koşullar, politikanın hangi durumda aktif olacağını belirler.<br /><br />**Örnekler:**<br />- Ortam bazlı: `Header = X-Environment, Operator = Equals, Value = production`<br />- API Key bazlı: `Header = X-API-Key, Starts With = PROD-`<br />- Endpoint bazlı: `Path = /api/admin/*`<br /><br />Koşul tanımlamazsa politika her zaman aktif<br /><br /> |
| **Adım 7: Hata Mesajı Özelleştirme (İsteğe Bağlı)** | - **Error Message Customization** sekmesine gidin.<br />- Erişim reddedildiğinde dönecek mesajı özelleştirin.<br /><br />**Varsayılan:**<br />`{ "statusCode": 500, "message": "Digital Signature policy failed! Error message is: {0}" }`<br /><br />**Özel:**<br />`{ "statusCode": 500, "errorCode": "ERR-088-CUSTOM", "message": "İmza üretilemedi, lütfen destinasyon alanını kontrol edin." }` |
| **Adım 8: Kaydetme** | - Sağ üstteki **[Save]** butonuna tıklayın.<br /><br />**Kontrol Listesi:**<br />- Benzersiz isim<br />- Zorunlu alanlar dolu<br />- En az bir imza tanımı mevcut<br /><br />**Sonuç:**<br />- Politika listeye eklenir.<br />- API'lere bağlanabilir.<br />- Global politikaysa otomatik uygulanır. |

**Koşullar** ve **Hata Mesajı Özelleştirme** panellerinin açıklaması için [Politika Nedir?](/tr/apinizer-anlama/temel-kavramlar/politika-nedir) sayfasındaki [Koşullar](/tr/apinizer-anlama/temel-kavramlar/politika-nedir#koşullar-conditions) ve [Hata Mesajı Özelleştirme (Error Message Customization)](/tr/apinizer-anlama/temel-kavramlar/politika-nedir#hata-mesajı-özelleştirme-error-message-customization) bölümlerini inceleyebilirsiniz.

## Politikayı Silme

Bu politikanın silme adımları ve kullanımdayken uygulanacak işlemler için [Politika Nedir?](/tr/gelistirici/politikalar/politika-nedir) sayfasındaki [Politikayı Silme](/tr/gelistirici/politikalar/politika-nedir#politikayı-silme) bölümüne bakabilirsiniz.

## Politikayı Dışa/İçe Aktarma

Bu politikanın dışa aktarma (Export) adımları ve kullanılabilecek seçenekler için [Politika Nedir?](/tr/gelistirici/politikalar/politika-nedir) sayfasındaki [Politikayı Dışa/İçe Aktarma](/tr/gelistirici/politikalar/politika-nedir#politikayı-dışa-içe-aktarma) bölümüne bakabilirsiniz.

## Politikayı API'ye Bağlama

Bu politikanın API'lere nasıl bağlanacağına ilişkin süreç için [Politika Yönetimi](/tr/gelistirici/api-proxy-konfigurasyonu/politika-yonetimi) sayfasındaki [Politikayı API'ye Bağlama](/tr/gelistirici/api-proxy-konfigurasyonu/politika-yonetimi#akışa-politika-ekleme) bölümüne bakabilirsiniz.

## İleri Düzey Özellikler

| Özellik | Açıklama ve Adımlar |
|---------|---------------------|
| **Dinamik Algoritma Bildirimi** | - `signatureAlgorithmVar` için uygun header/body değişkenini belirleyin.<br />- İmza tanımında değişkeni seçin.<br />- Tüketici uygulamanın bu alanı okuyup doğrulama algoritmasını otomatik seçmesini sağlayın. |
| **Revokasyon Takibi** | - Sertifika seçimi sırasında revokasyon durumunu kontrol edin.<br />- Revoked sertifika seçilirse kullanımdan kaçının.<br />- **Güncel sertifika ile politikayı yeniden deploy edin.** |
| **Çok Katmanlı İmza Zinciri** | - Aynı mesaj için birden fazla imza tanımı ekleyin.<br />- Tanımların sırasını veri bağımlılığına göre düzenleyin.<br />- Hedef değişkenleri farklı header'lara veya body alanlarına yönlendirerek zincirli imza oluşturun. |

## Best Practices

### Yapılması Gerekenler ve En İyi Uygulamalar

| Kategori | Açıklama / Öneriler |
|----------|---------------------|
| **Anahtar Yönetimi** | **Kötü:** Expire olmuş sertifikayla imza atmak.<br />**İyi:** Sertifika yenilendiğinde politikayı güncellemek.<br />**En İyi:** Sertifika yenileme tarihlerini izleyip otomatik alarm kurmak. |
| **Değişken Seçimi** | **Kötü:** Aynı değişkeni hem kaynak hem hedef olarak kullanmak.<br />**İyi:** Kaynak ve hedefi ayrı ayrı tanımlamak.<br />**En İyi:** Tüketici beklentisine göre header/body ayrımı yapmak ve dökümante etmek. |
| **Algoritma Kullanımı** | **Kötü:** Varsayılan algoritmayı rastgele seçmek.<br />**İyi:** Uygulama gereksinimine uygun algoritmayı belirlemek.<br />**En İyi:** Güvenlik ekibi tarafından onaylanmış algoritma listesini kullanmak. |
| **Çoklu Tanım Yönetimi** | **Kötü:** Tüm alanları tek tanımda birleştirmek.<br />**İyi:** Farklı alanlara özel tanımlar oluşturmak.<br />**En İyi:** Tanımların açıklama alanlarını doldurup denetimlerde referans vermek. |
| **Hata Mesajları** | **Kötü:** Varsayılan hata mesajını kapatıp boş bırakmak.<br />**İyi:** Genel bir hata mesajı sağlamak.<br />**En İyi:** Operasyon ekiplerinin anlayacağı özelleştirilmiş mesaj ve hata kodu tanımlamak. |

### Güvenlik En İyi Uygulamaları

| Güvenlik Alanı | Açıklama / Uyarılar |
|----------------|---------------------|
| **Anahtar Depolama** | Anahtarları sadece Secret Manager üzerinden yönetin; dışa aktarıp manuel dağıtmayın. |
| **Sertifika Revokasyonu** | Revoked sertifikalar kırmızı etiketle gösterilir, kesinlikle kullanılmamalıdır. |
| **Erişim Kontrolü** | Politika düzenleme yetkisini minimum kullanıcıya verin, IAM denetimlerini düzenli yapın. |
| **Loglama** | İmza başarısızlıklarını güvenlik loglarına yönlendirin, olağan dışı tekrar denemeleri analiz edin. |
| **Algoritma Güvenliği** | Zayıf algoritmaları (MD2, MD5) sadece geriye dönük uyumluluk zorunluluğu varsa kullanın, aksi halde modern seçenekleri tercih edin. |

### Kaçınılması Gerekenler

| Kategori | Açıklama / Uyarılar |
|----------|---------------------|
| **Boş Kaynak Alanları** | **Neden kaçınılmalı:** Boş içerik imza üretmez, hedef değişken de boş kalır.<br />**Alternatif:** Kaynak değişkeni önceden doğrulayın veya Condition ile filtreleyin. |
| **Tek Anahtar Bağımlılığı** | **Neden kaçınılmalı:** Anahtar revokasyonunda tüm API'ler durur.<br />**Alternatif:** Policy Group içinde yedek anahtar ile ikinci politika hazırlayın. |
| **Test Edilmemiş Değişiklikler** | **Neden kaçınılmalı:** Yanlış algoritma veya hedef değişken üretim ortamında hataya yol açar.<br />**Alternatif:** Önce Geliştirme ortamında export/import ile test edin. |
| **Hata Mesajı Gizleme** | **Neden kaçınılmalı:** Operasyon ekipleri sorunu belirleyemez.<br />**Alternatif:** Özel hata kodu ve açıklayıcı mesaj tanımlayın. |

### Performans İpuçları

| Kriter | Öneri / Etki |
|--------|--------------|
| **İmza Tanımı Sayısı** | **Öneri:** Gereksiz tanımları kaldırın.<br />**Etki:** Her tanım ek CPU maliyeti getirir. |
| **Algoritma Seçimi** | **Öneri:** ECDSA gibi daha hafif algoritmaları değerlendirin.<br />**Etki:** İşlem süresi azalır, throughput artar. |
| **Anahtar Boyutu** | **Öneri:** Güvenlik politikalarına uygun minimum anahtar uzunluğunu kullanın.<br />**Etki:** Gereğinden uzun anahtarlar gecikmeyi artırır. |
| **Koşul Kullanımı** | **Öneri:** Politikanın sadece gerekli isteklerde çalışması için Condition tanımlayın.<br />**Etki:** Trafik azaltılır, CPU yükü düşer. |
| **Sıralama Yönetimi** | **Öneri:** Politikayı akışta olabilecek en geç aşamada çalıştırın.<br />**Etki:** Önceki politikaların başarısız olması durumunda boşa imza üretimi yapılmaz. |

## Sık Sorulan Sorular (SSS)

| Kategori | Soru | Cevap |
|----------|-----------|-----------|
| **Genel** | Politika kaç farklı imza tanımı destekler? | Pratikte sınırlama yoktur; her tanım ayrı satır olarak eklenebilir, ancak performans etkisini göz önünde bulundurun. |
| **Genel** | Sertifika ve Crypto Key arasında nasıl seçim yapmalıyım? | Sertifika özel anahtar içeriyorsa kullanabilirsiniz; aksi halde Crypto Key seçerek HSM veya anahtar kasasındaki kayıtları tercih edin. |
| **Teknik** | İmza algoritmasını isteğe bağlı nasıl paylaşırım? | İmza tanımında `signatureAlgorithmVar` seçin; politika çalıştığında algoritma adı bu değişkene yazılır. |
| **Teknik** | Mesaj gövdesi JSON değilse politika çalışır mı? | Evet, değişken ile işaret edilen veri düz metin olduğu sürece imzalanır; veri formatı politikadan bağımsızdır. |
| **Kullanım** | Global politikayı local kopyaya dönüştürmek zorunda mıyım? | Hayır, ancak localize ederek API bazlı özelleştirme yapabilirsiniz; globalde yapılan değişiklikler otomatik yayılır. |
| **Kullanım** | Hata durumunda hangi logları incelemeliyim? | Policy loglarında `POLICY_DIGITALSIGN` hata kodunu ve özelleştirilmiş mesajı arayın; ayrıca Gateway genel loglarını kontrol edin. |


