---
title: 'Mesaj Akışı ve Politika Yönetimi'
description: 'Mesaj akışı, politika yönetimi, politika ekleme, güncelleme, silme'
---

## Mesaj Akışı

Geliştirme sekmesi, mesaj akışı sırasında istek ve yanıt mesajlarına uygulanacak politikaların biçimlendirildiği sekmedir. Arayüz de bu akışı gösterecek şekilde tasarlanmıştır. Böylece kullanıcı görsel olarak bir istek mesajının hangi politikalar hangi sırada uygulandıktan sonra Backend API'ye gönderileceğini ve Backend API'den dönen yanıt mesajı istemciye iletilmeden önce hangi sırada hangi politikaların uygulanacağını görme olanağı kazanır.

İstemci ile Backend API arasındaki akış,

- İstemciden çıkıp Backend API'ye giden istek mesajını sembolize eden bir ok,
- Backend API'den çıkıp İstemciye giden yanıt mesajını sembolize eden bir ok,
- İstek ya da yanıt mesajı üzerinde uygulanan politikaları ve uygulanma sırasını gösteren ikonlar

ile gösterilmektedir.

Bu bölümde politikaların detaylarına girilmeyecektir. Politikalarla ilgili detaylı bilgi için [Politikalar (Policies)](/tr/gelistirici/politikalar/politika-nedir) sayfasına bakılabilir.

### İstemci (Client)

Arayüzde sol taraftaki çerçeve içinde gösterilir. API Proxy'e istek gönderen paydaştır. Akışı başlatır. İstemciden çıkan mesaj, politikalar uygulandıktan sonra Backend API'ye ulaşır.

### Backend API

API Proxy ile istemcinin doğrudan erişimine kapatılan ve istemciden saklanan, istekleri API Proxy'den alıp yanıtlarını API Proxy'e döndüren orijinal API'dir. Arayüzünde sağ taraftaki çerçeve ile gösterilir. Backend API'nin yanıtı, politikalar uygulandıktan sonra İstemciye gönderilir.

Backend API kutusundaki **API** bağlantısına tıklandığı zaman Backend API'nin API Tanım Belgesi görüntülenir.

## Politika Yönetimi

Politikalar, istek ve yanıt mesajları üzerinde gerçekleştirilmesi istenen güvenlik, mesajları filtreleme, doğrulama, dönüştürme ya da zenginleştirme, kısmen iş mantığı uygulama, hata yönetimi vb. işlemleri tarif etmek üzere yapılan konfigürasyonlardır. API Gateway, İstemci ile Backend API arasındaki mesaj akışı sırasında, bu konfigürasyonlar ile kendisine tanıtılan politikaları işletir.

Bu bölümde genel olarak politikalar üzerinde yapılabilecek işlemler anlatılmaktadır. Herhangi bir politika hakkında detaylı bilgi edinmek için [Politikalar (Policies)](/tr/gelistirici/politikalar/politika-nedir) bölümünden ilgili politikaya ilişkin dokümantasyona bakabilirsiniz.

### Politikaların Yeri ve Çalışma Sırası

Politikalar 3 farklı noktaya eklenebilir:

- API Proxy Grubu
- API Proxy
- Metot/Endpoint

Bir API Proxy Grubuna eklenen bir politika, sadece istek API Proxy Grup üzerinden gelmiş ise işletilir.

Bir API Proxy'ye eklenen bir politika, o API Proxy'nin bütün metot/endpoint'leri için işletilir.

Bir metot/endpoint'e eklenen bir politika, yalnızca o metot/endpoint için işletilir.

Aşağıdaki görselde bu 3 noktaya da eklenmiş olan politikalara ilişkin bir örnek bulunmaktadır.

Görselde **GET - findByStatus** adlı metot/endoint'i seçilmiş olan API Proxy'nin, **Proxy Group - 1** adlı bir API Proxy Grubu'na eklenmiş olduğu görülmektedir.

İşaretlenmiş olan alanlar, politikaların nereye eklendiğine bağlı olarak görüntülendikleri yerlerdir.

- 1 numaralı çerçeve ile işaretlenen alanda, bu API Proxy için herhangi bir metot/endpoint seçilmeden, bütün metot/endpoint'ler için geçerli olacak şekilde eklenmiş ve istek mesajlarına uygulanacak olan politikalar görülür. **Hepsi (All)** yazısı bunu ifade eder.
- 2 numaralı çerçeve ile işaretlenen alanda, seçilmiş olan metot/endpoint için geçerli olacak şekilde ve istek mesajlarına uygulanacak olan politikalar görülür.
- 3 numaralı çerçeve ile işaretlenen alanda, seçilmiş olan metot/endpoint için geçerli olacak şekilde ve yanıt mesajlarına uygulanacak olan politikalar görülür.
- 4 numaralı çerçeve ile işaretlenen alanda, bu API Proxy için herhangi bir metot/endpoint seçilmeden, bütün metot/endpoint'ler için geçerli olacak şekilde eklenmiş ve yanıt mesajlarına uygulanacak olan politikalar görülür. **Hepsi (All)** yazısı bunu ifade eder.

Bu API Proxy herhangi bir API Proxy Grubuna eklenmiş, eklenen API Proxy Grupta politikalar bulunuyor ve istek API Proxy Grup üzerinden geldiyse request hattındakiler uygulanır daha sonra response hattı üzerindeki politikalar da uygulanır. Ancak bu sayfada gösterilmez.

API Proxy'nin herhangi bir metot/endpoint'i için herhangi bir politikanın eklenmiş olması durumunda metot/endpoint yanında çark ikonu bulunur.

Eğer API Proxy'nin belirli bir metot/endpoint'i seçilmezse (ya da **Hepsi (All)**) seçilirse, aşağıdaki görselde gösterildiği gibi 2 bölge görünür.

- 1 numaralı çerçeve ile işaretlenen alanda, bu API Proxy'nin bütün metot/endpoint'leri için geçerli olacak şekilde eklenmiş ve istek mesajlarına uygulanacak olan politikalar görülür.
- 2 numaralı çerçeve ile işaretlenen alanda, bu API Proxy'nin bütün metot/endpoint'leri için geçerli olacak şekilde eklenmiş ve yanıt mesajlarına uygulanacak olan politikalar görülür.

## Politikaların İşletilme Sırası

Politikalar, mesajın akış sırasında;

- İstek mesajı için API Proxy Grup → API Proxy → metot/endpoint sırasıyla
- Yanıt mesajı için metot/endpoint → API Proxy → API Proxy Grup sırasıyla

işletilir. Her seviyede, o seviyedeki politikalar mesajın akış yönündeki sıralamaya göre işleme alınır.

Aşağıdaki görselde bu durum özetlenmiş, politikaların işleme alınma sıraları numaralandırılarak gösterilmiştir.

### Hata Durumunda Politikaların İşletilme Sırası

Hata durumunda işletilecek olan politikalar "Hata Politikası Ekle" seçeneği ile eklenir.

Akışın herhangi bir noktasında hata olması durumunda normal akış kesilerek öncelikle varsa hata yanıt şablonu hata mesajına uygulanır.

Sonrasında "Hata Politikaları" hattına eklenen politikalar sağdan sola doğru sırasıyla işletilir.

### Akışa Politika Ekleme

Bir politika eklemek için;

- Politikanın eklenmek istediği varlık seçilir. Örneğin API Proxy'nin bütün metot/endpoint'leri için uygulanması istenen bir politika için, o API Proxy'nin metot/endpoint alanında **Hepsi (All)** seçilir.
- Politikanın istek mesajına mı yanıt mesajına mı ekleneceğine göre uygun alandaki **+ Politika Ekle (Add Policy)** ikonuna tıklanır.

- Açılan pencereden eklenmek istenen politikanın tipi seçilir. Bu pencerede görünen politika tipleri, aktif API Proxy'nin tipine ve hangi bölge politika eklenmek istendiğine göre değişir.

"Eklenmek istenen politika seçildiğinde, o politikaya ilişkin konfigürasyon bilgisinin girilebileceği bir pencere açılır. Bu pencereden farklı şekillerde politika eklenebilir:"

- Var olan bir global politikayı eklemek için politika penceresinde, en üstte politika tipinin yanındaki **Global Politikalardan Seç (Select From Global Policies)** bağlantısına tıklanır. Açılan pencereden uygun politika seçilerek işlem tamamlanır.
- Yerel politika oluşturmak için herhangi özel işlem yapmadan açılan pencerede girilen veriler ile yerel politika oluşturulması sağlanır.

### Akıştaki Politikayı Güncelleme

Var olan bir politikanın ikonuna tıklandığı zaman, o politikanın bilgilerinin güncellenebileceği bir pencere açılır.

### Seçilen Politikayı Activate/Deactivate Etme

Bir politika, eklenmiş olduğu metot/endpoint ya da API Proxy'den silinmeden geçici olarak kullanımdan kaldırılabilir. Bunun için politika güncellenmek üzere açılır ve açılan pencerenin en üst kısmındaki **Deactivate** tuşuna tıklanır.

### Bütün Politikaları Activate/Deactivate Etme

Metot/endpoint bölümünde, orta bölümün alt kısmında **Bütün Politikaları Kapat (Disable All Policies)** bağlantısı belirir. Bu bağlantıya tıklandığı zaman, eğer **Hepsi (All)** seçeneğinde ise API Proxy üzerine eklenmiş olan bütün politikalar; eğer herhangi bir metot içerisindeyse sadece o metot içerisinde eklenmiş olan tüm politikalar devre dışı kalır. Kullanımdan kaldırılmış olan politikalar daha sonra politika güncelleme penceresinden tek tek ya da **Bütün Politikaları Aç (Activate All Policies)** bağlantısına tıklanarak toplu olarak yeniden etkinleştirilebilir.

Politikalar devre dışı kaldığında, ikonların renkleri değişerek gri bir görünüme kavuşur.

Eğer API Proxy bir API Proxy Grubu'na eklenmişse ve bu API Proxy Grubu üzerinden politikalar uygulanmışsa, bütün politikaların kapatılması API Proxy Grubu'ndan gelen politikaları etkilemez, bu politikalar aktif olarak kalır.

### Akıştan Politika Kaldırma

Fare silinmek istenen politikanın üzerine getirildiğinde, politikayı silecek bir ikon belirir. Bu ikona tıklanarak politika silinebilir.

Geliştirme sekmesinde gerçekleştirilen politika silme işleminde;

- politika yerel ise tamamen silinir,
- politika global ise yalnızca bu metot/endpoint ya da API Proxy ile ilişkisi kaldırılır, politikanın kendisi silinmez. Daha sonra tekrar eklenebilir. Bir global politikanın tamamen silinmesi isteniyorsa, silme işleminin Global Politikalar arayüzlerinden yapılması gerekir.

