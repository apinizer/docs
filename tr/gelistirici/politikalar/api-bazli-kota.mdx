---
title: 'API BazlÄ± Kota'
description: 'API BazlÄ± Kota politikasÄ±, belirli zaman periyotlarÄ±nda API lere gelen toplam istek sayÄ±sÄ±nÄ± sÄ±nÄ±rlandÄ±rarak kullanÄ±m kotasÄ± yÃ¶netimi saÄŸlar'
---

**ğŸ’¡ Politikalar hakkÄ±nda bilginiz var mÄ±?**\
Bu dokÃ¼man spesifik bir politikanÄ±n detaylÄ± kullanÄ±mÄ±nÄ± anlatÄ±r. EÄŸer Apinizer politika yapÄ±sÄ±nÄ± ilk kez kullanÄ±yorsanÄ±z veya politikalarÄ±n genel Ã§alÄ±ÅŸma prensiplerini Ã¶ÄŸrenmek istiyorsanÄ±z, Ã¶ncelikle [Politika Nedir?](/tr/gelistirici/politikalar/politika-nedir) sayfasÄ±nÄ± okumanÄ±zÄ± Ã¶neririz.

API TabanlÄ± Kota politikasÄ±, API kullanÄ±mÄ±nÄ± belirli zaman periyotlarÄ± (saat, gÃ¼n, hafta, ay) boyunca sÄ±nÄ±rlandÄ±ran bir kaynak yÃ¶netim mekanizmasÄ±dÄ±r.

## AmacÄ± Nedir?

- **KullanÄ±m KotasÄ± YÃ¶netimi**: API kullanÄ±mÄ±nÄ± saatlik, gÃ¼nlÃ¼k, haftalÄ±k veya aylÄ±k periyotlarda sÄ±nÄ±rlandÄ±rarak kaynak tÃ¼ketimini kontrol eder ve adil kullanÄ±m saÄŸlar.
- **Ä°ÅŸ Modeli ve FiyatlandÄ±rma DesteÄŸi**: FarklÄ± mÃ¼ÅŸteri segmentleri iÃ§in Ã¶zelleÅŸtirilmiÅŸ kota planlarÄ± sunar (Free: 1000 istek/ay, Basic: 10K/ay, Premium: 100K/ay, Enterprise: Unlimited), abonelik modellerini destekler.
- **Maliyet KontrolÃ¼ ve BÃ¼tÃ§e YÃ¶netimi**: Cloud servis maliyetlerini tahmin edilebilir kÄ±lar, mÃ¼ÅŸteri baÅŸÄ±na kaynak tÃ¼ketimini izler, beklenmedik maliyet artÄ±ÅŸlarÄ±nÄ± Ã¶nler.
- **SLA ve Servis Kalitesi Garantisi**: Servis seviyesi sÃ¶zleÅŸmelerini yerine getirir, tÃ¼m kullanÄ±cÄ±larÄ±n API kaynaklarÄ±na eriÅŸimini garanti eder, kaynak tÃ¼kenmesini Ã¶nler.
- **Abuse ve KÃ¶tÃ¼ye KullanÄ±m Ã–nleme**: AÅŸÄ±rÄ± kullanÄ±mÄ± tespit eder ve engeller, API kaynaklarÄ±nÄ±n adil daÄŸÄ±lÄ±mÄ±nÄ± saÄŸlar, hizmet kesintilerini Ã¶nler.

## Ã‡alÄ±ÅŸma Prensibi

- **Ä°stek GeliÅŸi**: API Gateway'e gelen her HTTP/HTTPS isteÄŸi iÃ§in, istemin kaynak bilgileri (IP, kullanÄ±cÄ±, API key vb.) ve zaman damgasÄ± tespit edilir.
- **Politika KontrolÃ¼**: API TabanlÄ± Kota politikasÄ± aktif ise, sistem aÅŸaÄŸÄ±daki sÄ±rayla kontrol yapar:
  - Condition (koÅŸul) tanÄ±mlÄ± mÄ±? Varsa koÅŸul saÄŸlanÄ±yor mu?
  - Politika aktif mi (active=true)?
  - Variable kullanÄ±lÄ±yor mu yoksa Apinizer default mÄ±?
- **Quota Key OluÅŸturma ve SayaÃ§ KontrolÃ¼**: Her istek iÃ§in benzersiz bir kota anahtarÄ± oluÅŸturulur (format: `quota:{policy_id}:{apply_by_value}:{period}`). Apply By parametresi varsa (IP adresi, kullanÄ±cÄ± ID, API key), bu deÄŸer anahtara dahil edilir. Hazelcast cache'den mevcut kota kullanÄ±m sayacÄ± sorgulanÄ±r. Detail List tanÄ±mlÄ±ysa, hedef deÄŸer ile karÅŸÄ±laÅŸtÄ±rÄ±lÄ±r ve eÅŸleÅŸen kuralÄ±n kotasÄ± kullanÄ±lÄ±r, yoksa varsayÄ±lan kota uygulanÄ±r.
- **Karar Verme**:
  - **Kota AÅŸÄ±lmadÄ±ysa**:
    - SayaÃ§ 1 artÄ±rÄ±lÄ±r ve cache'e senkron olarak yazÄ±lÄ±r
    - Ä°stek backend'e iletilir
    - Kota bilgisi veritabanÄ±na asenkron olarak gÃ¼ncellenir (API yanÄ±t sÃ¼resini etkilemez)
    - Rate limit statistics aktifse response header'larÄ±na kalan kota bilgisi eklenir (X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset)
  - **Kota AÅŸÄ±ldÄ±ysa**:
    - HTTP 429 (Too Many Requests) hatasÄ± dÃ¶nÃ¼lÃ¼r, istek iÅŸlenmez
    - Kota yenileme zamanÄ± response header'Ä±nda belirtilir
    - Cache hatasÄ± durumunda Cache Error Handling politikasÄ± devreye girer (REJECT: istek reddedilir, ALLOW: istek devam eder)
- **Hata Ä°ÅŸleme**: Politika kuralÄ±na uymayan istekler iÃ§in Ã¶zelleÅŸtirilebilir HTTP durum kodu ve hata mesajÄ± dÃ¶ndÃ¼rÃ¼lÃ¼r.

## Veri Depolama Mimarisi

API TabanlÄ± Kota politikasÄ±, veri tutarlÄ±lÄ±ÄŸÄ± ve kalÄ±cÄ±lÄ±ÄŸÄ± saÄŸlamak iÃ§in iki katmanlÄ± bir depolama stratejisi kullanÄ±r:

**Cache (Hazelcast) - Birincil Katman:**
- GerÃ§ek zamanlÄ± kota kontrolleri iÃ§in kullanÄ±lÄ±r
- Her API isteÄŸinde senkron olarak gÃ¼ncellenir
- YÃ¼ksek performans ve dÃ¼ÅŸÃ¼k gecikme saÄŸlar
- DaÄŸÄ±tÄ±k sistemlerde tÃ¼m Gateway instance'larÄ± aynÄ± sayaÃ§larÄ± paylaÅŸÄ±r

**VeritabanÄ± - Ä°kincil Katman:**
- Uzun vadeli kota verilerinin kalÄ±cÄ± saklanmasÄ± iÃ§in kullanÄ±lÄ±r
- API yanÄ±t sÃ¼resini etkilememek iÃ§in asenkron olarak gÃ¼ncellenir
- Sistem yeniden baÅŸlatÄ±ldÄ±ÄŸÄ±nda veya cache hatasÄ± durumunda veri kaybÄ±nÄ± Ã¶nler
- Raporlama, analitik ve faturalama iÃ§in gÃ¼venilir veri kaynaÄŸÄ± saÄŸlar
- Kota geÃ§miÅŸi ve kullanÄ±m istatistikleri iÃ§in arÅŸiv tutar

**Senkronizasyon Stratejisi:**
BaÅŸarÄ±lÄ± her istek sonrasÄ±nda kota bilgileri iki aÅŸamada gÃ¼ncellenir:
- Ã–ncelikle Hazelcast cache hÄ±zlÄ±ca gÃ¼ncellenir (senkron) - API yanÄ±t sÃ¼resine dahil
- ArdÄ±ndan veritabanÄ± gÃ¼ncellemesi asenkron olarak gerÃ§ekleÅŸtirilir - API yanÄ±t sÃ¼resini etkilemez

Bu yaklaÅŸÄ±m, yÃ¼ksek performans ve veri dayanÄ±klÄ±lÄ±ÄŸÄ± arasÄ±nda optimal bir denge kurar.

## Ã–zellikler ve Yetenekler

### Temel Ã–zellikler

- **Kota SayÄ±sÄ± Limiti**: Belirli bir zaman periyodunda izin verilen maksimum toplam istek sayÄ±sÄ±nÄ± belirler (minimum 1, tam sayÄ±).
- **Uzun DÃ¶nem Zaman AralÄ±ÄŸÄ± DesteÄŸi**: Saat, GÃ¼n, Hafta ve Ay bazÄ±nda kota periyotlarÄ± tanÄ±mlama. Periyot uzunluÄŸu Ã§arpanÄ± ile Ã¶zelleÅŸtirilebilir zaman aralÄ±klarÄ± (Ã¶rn: 7 gÃ¼n, 3 ay).
- **Apply By DeÄŸiÅŸkeni**: Kota'nÄ±n hangi kritere gÃ¶re uygulanacaÄŸÄ±nÄ± belirler (kullanÄ±cÄ± ID bazlÄ±, API Key bazlÄ±, mÃ¼ÅŸteri ID bazlÄ±, abonelik tipi bazlÄ±). Her deÄŸiÅŸken deÄŸeri iÃ§in ayrÄ± kota sayacÄ± tutulur.
- **Aktif/Pasif Durum KontrolÃ¼**: PolitikanÄ±n aktif veya pasif durumunu kolayca deÄŸiÅŸtirme (active/passive toggle). Pasif durumda politika uygulanmaz ancak yapÄ±landÄ±rmasÄ± saklanÄ±r.
- **KoÅŸul BazlÄ± Uygulama**: Query Builder ile karmaÅŸÄ±k koÅŸullar oluÅŸturarak politikanÄ±n ne zaman uygulanacaÄŸÄ±nÄ± belirleme (Ã¶rn: sadece belirli endpoint'lere veya kullanÄ±cÄ± tiplerine gÃ¶re).

### Ä°leri DÃ¼zey Ã–zellikler

- **Hedef BazlÄ± FarklÄ± Kotalar (Detail List)**: Belirli hedef deÄŸerler (kullanÄ±cÄ± seviyeleri, abonelik planlarÄ±, mÃ¼ÅŸteri segmentleri) iÃ§in Ã¶zel kota kurallarÄ± tanÄ±mlama. Regex desteÄŸi ile esnek hedef eÅŸleÅŸmeleri. Her hedef iÃ§in ayrÄ± kota sayÄ±sÄ± ve zaman periyodu.
- **Interval Window Type DesteÄŸi**: SLIDING (Kayan Pencere) - Her istek zamanÄ±ndan geriye doÄŸru pencere uygulanÄ±r, son N gÃ¼n/saat iÃ§indeki kullanÄ±m. FIXED (Sabit Pencere) - Belirli zaman dilimlerinde sayaÃ§ sÄ±fÄ±rlanÄ±r (her ayÄ±n 1'i, her haftanÄ±n baÅŸÄ±), daha yaygÄ±n kullanÄ±m.
- **Cache BaÄŸlantÄ± ve Hata YÃ¶netimi**: Cache sunucusu baÄŸlantÄ± timeout sÃ¼resi ayarlama (saniye). Cache eriÅŸilemezse davranÄ±ÅŸ belirleme: REJECT (gÃ¼venlik ve fatura doÄŸruluÄŸu Ã¶ncelikli) veya ALLOW (kullanÄ±labilirlik Ã¶ncelikli).
- **Rate Limit Ä°statistikleri**: Response header'larÄ±nda kalan kota bilgisi gÃ¶sterme (X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset). Client'larÄ±n ve dashboard'larÄ±n kota durumunu takip edebilmesi.
- **DaÄŸÄ±tÄ±k Mimari DesteÄŸi**: Merkezi Hazelcast cache kullanÄ±mÄ± sayesinde birden fazla Gateway instance'Ä± aynÄ± kota sayaÃ§larÄ±nÄ± paylaÅŸÄ±r. KullanÄ±cÄ± hangi gateway'e baÄŸlanÄ±rsa baÄŸlansÄ±n tutarlÄ± kota takibi garantisi.
- **Export/Import Ã–zelliÄŸi**: Politika yapÄ±landÄ±rmasÄ±nÄ± ZIP dosyasÄ± olarak export etme. FarklÄ± ortamlara (Development, Test, Production) import etme. Versiyon kontrolÃ¼ ve yedekleme imkanÄ±.
- **Policy Group ve Proxy Group DesteÄŸi**: Birden fazla politikayÄ± Policy Group iÃ§inde yÃ¶netme. Proxy Group'lara toplu politika atama. Merkezi gÃ¼ncelleme ve deploy iÅŸlemleri.
- **Deploy ve Versiyonlama**: Politika deÄŸiÅŸikliklerini canlÄ± ortama deploy etme. Hangi API Proxy'lerde kullanÄ±ldÄ±ÄŸÄ±nÄ± gÃ¶rme (Policy Usage). Proxy Group ve Policy Group kullanÄ±m raporlarÄ±.

## Politika KonfigÃ¼rasyonu

Politika konfigÃ¼rasyonu iÃ§in kullanÄ±lan alanlar aÅŸaÄŸÄ±daki tabloda gÃ¶rÃ¼lmektedir.

| Alan | AÃ§Ä±klama |
| :--- | :------- |
| **Ä°sim (Name)** | PolitikanÄ±n kullanÄ±mÄ±nÄ± ve yÃ¶netimini kolaylaÅŸtÄ±rmak iÃ§in isim yazÄ±labilir. PolitikalarÄ±n yÃ¶netimi ve seÃ§imi sÄ±rasÄ±nda bu isme ihtiyacÄ±nÄ±z olacaktÄ±r. |
| **AÃ§Ä±klama (Description)** | PolitikanÄ±n kullanÄ±mÄ±nÄ± ve yÃ¶netimini kolaylaÅŸtÄ±rmak iÃ§in aÃ§Ä±klama yazÄ±labilir. |
| **YanÄ±t BaÅŸlÄ±ÄŸÄ±nda Rate Limit Ä°statistiklerini GÃ¶ster (Show Rate Limit Statistics in Response Header)** | AktifleÅŸtirilir ise yanÄ±t baÅŸlÄ±ÄŸÄ±nda Rate Limit istatistiklerini gÃ¶sterir. |
| **Uygula (Apply by)** | Belirli bir deÄŸiÅŸken Ã¼zerinden bu politikanÄ±n Ã§alÄ±ÅŸmasÄ± iÃ§in deÄŸiÅŸken seÃ§ilebilir. Opsiyoneldir. |
| **Kota SayÄ±sÄ± (Quota Count)** | Belirli bir zaman periyodunda izin verilen maksimum toplam istek sayÄ±sÄ±dÄ±r. |
| **Periyot UzunluÄŸu (Interval Time Amount)** | SeÃ§ilen zaman birimi cinsinden, kota periyodunun sÃ¼resini belirten sayÄ±sal deÄŸer. |
| **Zaman Birimi (Interval Time Unit)** | ONE_HOUR (Saat), ONE_DAY (GÃ¼n), ONE_WEEK (Hafta), ONE_MONTH (Ay) |
| **Hedef BazlÄ± Ã–zel Kota KurallarÄ± (Detail List)** | Her hedef iÃ§in Ã¶zel kota sÄ±nÄ±rlarÄ± tanÄ±mlanÄ±r. |
| **Periyot Tipi (Interval Window Type)** | SLIDING (Kayan Pencere) veya FIXED (Sabit Pencere) |
| **Cache BaÄŸlantÄ±sÄ± Zaman AÅŸÄ±m SÃ¼resi (Cache Connection Timeout (Second))** | Cache baÄŸlantÄ±sÄ± iÃ§in zaman aÅŸÄ±mÄ± sÃ¼resi belirtilir. |
| **Cache BaÄŸlantÄ± HatasÄ± Eylemi (Action for Cache Connection Error)** | EÄŸer politika cache sunucusuna baÄŸlantÄ± sorunu yaÅŸarsa uygulanacak eylem belirtilir (REJECT veya ALLOW). |

**KoÅŸullar (Conditions)** ve **Hata MesajÄ± Ã–zelleÅŸtirme (Error Message Customization)** panellerinin detayÄ± iÃ§in [Politika Nedir?](/tr/gelistirici/politikalar/politika-nedir) sayfasÄ±nÄ± ziyaret edebilirsiniz.

## Hata KodlarÄ±
| Hata Kodu | Hata MesajÄ± | HTTP Durum Kodu |
| :-------- | :-------------------------------------------------------------------------------- | :-------------- |
| ERR-078   | API Based QUOTA policy failed! Error message is: {0}                         | 500             |
| ERR-079   | Because of reaching QUOTA limit for specified API Proxy, message is BLOCKED! | 403             |
| ERR-080   | API Based QUOTA policy failed! Error message is: {0}                         | 500             |
