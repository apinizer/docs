---
title: "SOAP tipinde API Proxy oluşturma"
description: "SOAP veya REST-SOAP-REST API Proxy'lerde SOAP Action değerini düzeltebilir. SOAP versiyonu belirleyebilir (Content-Type ve namespace bazlı), SOAPAction ve Content-Type ayarları yapabilir ve SOAP 1.1 ile SOAP 1.2 işlemlerini gerçekleştirebilir"
---

<Info>
  API proxy tipi SOAP veya REST-SOAP-REST olan Api Proxy'lerde, Apinizer'a gelen mesaj üzerinde yönlendirme sekmesinde **"SOAP Action değerini düzelt"** seçeneği seçilmiş ise aşağıdaki durumlara göre bazı değişiklikler yapılabilir. Bu değişikliklerin yapılabilmesi için öncelikle gelen mesajın SOAP versiyonu belirlenir. SOAP versiyonuna karar verilmesi için, İstek Başlığında gönderilen **Content-Type** değerine ve İstek Gövdesinde yer alan SOAP XML'in **namespace** değerine bakılır.
</Info>

<Warning>
  Bu iki değerin farklı çıkması durumunda öncelik Content-Type başlığına verilir. Content-Type değerinin boş veya anlamsız olması durumunda SOAP versiyonu, SOAP XML'in namespace değerinden belirlenir.
</Warning>

## SOAP Versiyonu Belirleme

SOAP versiyonu belirleme yöntemleri aşağıda detaylandırılmıştır:

<AccordionGroup>
  <Accordion title="Content-Type ile Belirleme">
    SOAP versiyonu değeri Content-Type ile belirleniyorsa aşağıdaki kurallar uygulanır:

    <CardGroup cols={2}>
      <Card title="SOAP 1.1" icon="code">
        **Content-Type değerleri:**
        - `text/xml`
        - `application/xop+xml` (type="text/xml" içeriyorsa)
      </Card>
      
      <Card title="SOAP 1.2" icon="code">
        **Content-Type değerleri:**
        - `application/soap+xml`
        - `application/xop+xml` (type="application/soap+xml" içeriyorsa)
      </Card>
    </CardGroup>

    **Örnekler:**

    ```http
    Content-Type: text/xml; charset=UTF-8
    → SOAP 1.1
    ```

    ```http
    Content-Type: application/soap+xml; charset=UTF-8
    → SOAP 1.2
    ```

    ```http
    Content-Type: application/xop+xml; type="text/xml"
    → SOAP 1.1
    ```

    ```http
    Content-Type: application/xop+xml; type="application/soap+xml"
    → SOAP 1.2
    ```
  </Accordion>
  
  <Accordion title="Namespace ile Belirleme">
    SOAP versiyonu değeri SOAP XML'in namespace değeri ile belirleniyorsa aşağıdaki kurallar uygulanır:

    <CardGroup cols={2}>
      <Card title="SOAP 1.1" icon="code">
        **Namespace:**
        ```
        http://schemas.xmlsoap.org/soap/envelope/
        ```
      </Card>
      
      <Card title="SOAP 1.2" icon="code">
        **Namespace:**
        ```
        http://www.w3.org/2003/05/soap-envelope
        ```
      </Card>
    </CardGroup>

    **Örnek SOAP 1.1 Mesajı:**

    ```xml
    <soap:Envelope 
      xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
      <soap:Body>
        <!-- Mesaj içeriği -->
      </soap:Body>
    </soap:Envelope>
    ```

    **Örnek SOAP 1.2 Mesajı:**

    ```xml
    <soap:Envelope 
      xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
      <soap:Body>
        <!-- Mesaj içeriği -->
      </soap:Body>
    </soap:Envelope>
    ```
  </Accordion>
</AccordionGroup>

## SOAP Versiyonuna Göre İşlemler

SOAP versiyonu değeri belirlendiğinde aşağıdaki işlemler gerçekleştirilir:

<Steps>
  <Step title="Namespace Düzeltme">
    SOAP versiyonuna göre SOAP XML'in namespace değeri düzeltilir.
  </Step>
  
  <Step title="SOAP Versiyonuna Özel İşlemler">
    Belirlenen SOAP versiyonuna göre aşağıdaki işlemler yapılır.
  </Step>
</Steps>

<AccordionGroup>
  <Accordion title="SOAP 1.1 İşlemleri">
    SOAP versiyonu 1.1 olan istekler için yapılan işlemler:

    <CardGroup cols={2}>
      <Card title="SOAPAction Header" icon="heading">
        - İstek başlığında `soapaction` anahtar kelimesi varsa yazım şekli düzeltilerek yoksa `SOAPAction` şeklinde başlık eklenir.
        - `SOAPAction` anahtar kelimesine eklenecek değer mesajın geldiği metoda ait olan ve WSDL tanımından ayrıştırılarak elde edilen SOAPAction değeridir.
        - SOAPAction değerinin başına ve sonuna yoksa tırnak işareti eklenir.
      </Card>
      
      <Card title="Content-Type" icon="file-code">
        - Content-Type değeri `text/xml` olarak belirlenir.
        - Content-Type değerine varsa Character Encoding değeri eklenir, yoksa default olarak `;charset=UTF-8` değeri eklenir.
      </Card>
    </CardGroup>

    **Örnek SOAP 1.1 İstek:**

    ```http
    POST /service HTTP/1.1
    Content-Type: text/xml; charset=UTF-8
    SOAPAction: "http://example.com/GetUser"
    
    <soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
      <soap:Body>
        <!-- İstek içeriği -->
      </soap:Body>
    </soap:Envelope>
    ```
  </Accordion>
  
  <Accordion title="SOAP 1.2 İşlemleri">
    SOAP versiyonu 1.2 olan istekler için yapılan işlemler:

    <CardGroup cols={2}>
      <Card title="Content-Type" icon="file-code">
        - Content-Type değeri `application/soap+xml` olarak belirlenir.
        - Content-Type değerine varsa Character Encoding değeri eklenir, yoksa default olarak `;charset=UTF-8` değeri eklenir.
        - Content-Type değerine `;action=<SOAPAction>` ifadesi eklenir.
      </Card>
      
      <Card title="SOAPAction" icon="info">
        SOAP 1.2'de SOAPAction header'ı kullanılmaz. Bunun yerine Content-Type içinde `action` parametresi kullanılır.
      </Card>
    </CardGroup>

    **Örnek SOAP 1.2 İstek:**

    ```http
    POST /service HTTP/1.1
    Content-Type: application/soap+xml; charset=UTF-8; action="http://example.com/GetUser"
    
    <soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
      <soap:Body>
        <!-- İstek içeriği -->
      </soap:Body>
    </soap:Envelope>
    ```

    <Tip>
      SOAP 1.2'de SOAPAction header'ı yerine Content-Type içindeki `action` parametresi kullanılır. Bu, SOAP 1.1'den önemli bir farktır.
    </Tip>
  </Accordion>
</AccordionGroup>

## Özet

<CardGroup cols={2}>
  <Card title="SOAP 1.1 Özellikleri" icon="list">
    - Namespace: `http://schemas.xmlsoap.org/soap/envelope/`
    - Content-Type: `text/xml`
    - SOAPAction header kullanılır
    - SOAPAction değeri tırnak içinde gönderilir
  </Card>
  
  <Card title="SOAP 1.2 Özellikleri" icon="list">
    - Namespace: `http://www.w3.org/2003/05/soap-envelope`
    - Content-Type: `application/soap+xml`
    - SOAPAction header kullanılmaz
    - Action bilgisi Content-Type içinde `action` parametresi ile gönderilir
  </Card>
</CardGroup>
