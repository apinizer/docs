---
title: "API Proxy Konfigürasyonu - Design"
description: "API Proxy'nin mesaj işleme akışını ve politikalarını yönetebilir, pre-flow ve post-flow politikaları ekleyebilir, conditional policies tanımlayabilir, route step yapılandırabilir ve fault handler politikaları oluşturabilir."
---

## Design Sekmesi

<CardGroup cols={2}>
  <Card title="Pre-flow Policies" icon="arrow-right">
    İstek öncesi politikalar
  </Card>
  <Card title="Conditional Policies" icon="code-branch">
    Koşullu politikalar
  </Card>
  <Card title="Route Step" icon="route">
    Backend'e yönlendirme
  </Card>
  <Card title="Post-flow Policies" icon="arrow-left">
    Yanıt sonrası politikalar
  </Card>
  <Card title="Fault Handler" icon="exclamation-triangle">
    Hata yakalama politikaları
  </Card>
</CardGroup>

## Mesaj İşleme Akışı

API Proxy'ye gelen bir mesaj şu sırayla işlenir:

```
İstemci İsteği
   │
   ▼
┌─────────────────────────────────┐
│ 1. Pre-flow Policies            │
│    - Authentication              │
│    - Authorization               │
│    - Rate Limiting               │
│    - Validation                  │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 2. Conditional Policies         │
│    - IF-THEN-ELSE yapısı         │
│    - Koşullu politika uygulama  │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 3. Route Step                    │
│    - Upstream Target seçimi      │
│    - Load balancing              │
│    - Backend'e yönlendirme      │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 4. Post-flow Policies            │
│    - Response transformation     │
│    - Header manipulation         │
│    - Logging                     │
└──────────────┬──────────────────┘
               │
               ▼
         İstemci Yanıtı
```

## Pre-flow Policies

Pre-flow politikaları, istek backend'e gönderilmeden önce çalıştırılan politikalardır.

### Kullanım Senaryoları

* **Authentication**: Kimlik doğrulama
* **Authorization**: Yetkilendirme
* **Rate Limiting**: İstek hızı sınırlama
* **Request Validation**: İstek doğrulama
* **Request Transformation**: İstek dönüştürme
* **Header Manipulation**: Header manipülasyonu

### Politika Ekleme

Pre-flow politikası eklemek için:

1. **Pre-flow** bölümüne gidin
2. **Add Policy** butonuna tıklayın
3. Eklemek istediğiniz politikayı seçin
4. Politika ayarlarını yapılandırın
5. **Save** butonuna tıklayın

### Politika Sıralaması

Politikalar, ekleme sırasına göre çalıştırılır. Politikaların sırasını değiştirmek için drag-and-drop kullanabilirsiniz.

## Conditional Policies

Conditional policies, belirli koşullara göre çalıştırılan politikalardır.

### Koşul Yapısı

Conditional policies, IF-THEN-ELSE yapısı kullanır:

```
IF (condition) THEN
  execute policies
ELSE
  execute other policies
END IF
```

### Koşul Örnekleri

**Header Bazlı:**
```
IF header.content-type == "application/json" THEN
  apply JSON transformation
ELSE
  apply XML transformation
END IF
```

**Path Bazlı:**
```
IF path == "/api/v1/users" THEN
  apply user-specific policies
ELSE
  apply default policies
END IF
```

**Method Bazlı:**
```
IF method == "POST" THEN
  apply validation policy
ELSE
  skip validation
END IF
```

### Conditional Policy Ekleme

Conditional policy eklemek için:

1. **Conditional Policies** bölümüne gidin
2. **Add Conditional Policy** butonuna tıklayın
3. Koşulu tanımlayın
4. THEN ve ELSE bloklarına politikalar ekleyin
5. **Save** butonuna tıklayın

## Route Step

Route Step, isteğin backend API'ye yönlendirildiği adımdır.

### Upstream Target

Backend API'nin adresi. Birden fazla target tanımlanabilir.

**Özellikler:**
* **Load Balancing**: Yük dengeleme
* **Failover**: Yedekleme
* **Health Check**: Sağlık kontrolü

### Load Balancing

Birden fazla upstream target varsa, load balancing stratejisi seçilebilir:

* **Round Robin**: Sırayla dağıtım
* **Least Connections**: En az bağlantılı olana
* **IP Hash**: IP bazlı hash
* **Weighted**: Ağırlıklı dağıtım

### Route Step Yapılandırması

Route Step'i yapılandırmak için:

1. **Route Step** bölümüne gidin
2. **Add Upstream Target** butonuna tıklayın
3. Backend URL'ini girin
4. Load balancing ayarlarını yapılandırın
5. **Save** butonuna tıklayın

## Post-flow Policies

Post-flow politikaları, backend'den gelen yanıt üzerinde çalıştırılan politikalardır.

### Kullanım Senaryoları

* **Response Transformation**: Yanıt dönüştürme
* **Header Manipulation**: Header manipülasyonu
* **Response Validation**: Yanıt doğrulama
* **Logging**: Loglama
* **Caching**: Önbellekleme
* **Response Masking**: Hassas veri maskeleme

### Politika Ekleme

Post-flow politikası eklemek için:

1. **Post-flow** bölümüne gidin
2. **Add Policy** butonuna tıklayın
3. Eklemek istediğiniz politikayı seçin
4. Politika ayarlarını yapılandırın
5. **Save** butonuna tıklayın

## Fault Handler Policies

Fault Handler politikaları, hata durumlarında çalıştırılan politikalardır.

### Hata Türleri

Fault Handler şu hata türlerini yakalayabilir:

* **Connection Error**: Bağlantı hatası
* **Timeout Error**: Timeout hatası
* **4xx Errors**: İstemci hataları
* **5xx Errors**: Sunucu hataları
* **Policy Error**: Politika hatası

### Fault Handler Yapılandırması

Fault Handler yapılandırmak için:

1. **Fault Handler** bölümüne gidin
2. **Add Fault Handler** butonuna tıklayın
3. Hata türünü seçin
4. Hata durumunda çalıştırılacak politikaları ekleyin
5. **Save** butonuna tıklayın

### Hata İşleme Örnekleri

**Timeout Hatası:**
```
IF error.type == "Timeout" THEN
  return custom timeout message
  log error details
END IF
```

**4xx Hatası:**
```
IF error.status >= 400 AND error.status < 500 THEN
  mask sensitive data
  return formatted error message
END IF
```

## Politika Zinciri Tasarımı

Etkili bir politika zinciri tasarlamak için:

### 1. Pre-flow Aşaması

* Authentication ve authorization politikalarını en başa koyun
* Rate limiting politikasını erken uygulayın
* Validation politikalarını backend'e göndermeden önce uygulayın

### 2. Conditional Aşaması

* Koşulları net ve anlaşılır tutun
* Gereksiz conditional policy kullanmayın
* Performansı etkileyen koşulları optimize edin

### 3. Route Aşaması

* Upstream target'ları doğru yapılandırın
* Load balancing stratejisini ihtiyaca göre seçin
* Health check'i aktif tutun

### 4. Post-flow Aşaması

* Response transformation'ı ihtiyaca göre uygulayın
* Logging politikasını ekleyin
* Hassas verileri maskeleyin

### 5. Fault Handler Aşaması

* Tüm hata türlerini yakalayın
* Kullanıcı dostu hata mesajları döndürün
* Hataları loglayın

## Kullanım Senaryoları

### Senaryo 1: Basit REST API Proxy

Basit bir REST API Proxy için politika zinciri:

**Pre-flow:**
1. API Key Authentication
2. Rate Limiting

**Route:**
1. Single Upstream Target

**Post-flow:**
1. Response Logging

### Senaryo 2: Güvenli API Proxy

Güvenli bir API Proxy için politika zinciri:

**Pre-flow:**
1. OAuth2 Authentication
2. Authorization Check
3. Rate Limiting
4. Request Validation

**Route:**
1. Load Balanced Upstream Targets

**Post-flow:**
1. Response Transformation
2. Data Masking
3. Response Logging

**Fault Handler:**
1. Error Formatting
2. Error Logging

### Senaryo 3: Transformation API Proxy

Dönüşüm yapan bir API Proxy için politika zinciri:

**Pre-flow:**
1. Authentication
2. Request Transformation (JSON to XML)

**Route:**
1. Upstream Target

**Post-flow:**
1. Response Transformation (XML to JSON)
2. Response Logging

## En İyi Uygulamalar

### Politika Sıralaması

* **Performans**: Sık kullanılan politikaları önce koyun
* **Güvenlik**: Güvenlik politikalarını erken uygulayın
* **Mantık**: Mantıksal sırayı koruyun

### Conditional Policies

* **Basitlik**: Koşulları basit tutun
* **Performans**: Karmaşık koşullardan kaçının
* **Test**: Koşulları test edin

### Error Handling

* **Kapsamlılık**: Tüm hata türlerini yakalayın
* **Bilgilendirme**: Kullanıcı dostu hata mesajları döndürün
* **Logging**: Hataları loglayın

## Sonraki Adımlar

<CardGroup cols={2}>
  <Card title="Understanding the Flow" icon="sitemap" href="/tr/gelistirici/development/akisi-anlamak">
    Mesaj işleme akışını anlama
  </Card>
  <Card title="Pre-flow Policies" icon="arrow-right" href="/tr/gelistirici/development/pre-flow-politikalari">
    Pre-flow politikaları
  </Card>
  <Card title="Post-flow Policies" icon="arrow-left" href="/tr/gelistirici/development/post-flow-politikalari">
    Post-flow politikaları
  </Card>
  <Card title="Fault Handler Policies" icon="exclamation-triangle" href="/tr/gelistirici/development/hata-giderici-politikalar">
    Fault handler politikaları
  </Card>
  <Card title="Conditional Policies" icon="code-branch" href="/tr/gelistirici/development/kosullu-politikalar">
    Koşullu politikalar
  </Card>
  <Card title="Policy Management" icon="shield" href="/tr/gelistirici/politika-yonetimi">
    Politika yönetimi
  </Card>
</CardGroup>
