---
title: "Context ve Global Variable Kullanımı"
description: "Context variable'ları ve global variable'ları kullanarak API isteklerinde dinamik değerler kullanabilirsiniz. Sistem tarafından otomatik oluşturulan context variable'ları direkt kullanabilir, script politikaları ile global variable oluşturarak policy'ler arasında veri aktarımı sağlayabilirsiniz."
---

## Variable Nedir?

Variable (değişken), API istekleri sırasında dinamik değerler kullanmanızı sağlayan bir sistemdir. Apinizer'da variable kavramı iki farklı aşamada karşınıza çıkar:

### 1. Variable Tanımı (Definition)

[Variable](/tr/concepts/temel-kavramlar/variable) dokümanında anlatılan, Project > Variables bölümünde oluşturduğunuz **variable tanımları**dır. Bu tanımlar, değişkenin nasıl oluşturulacağını ve nereden değer alacağını belirler.

**Variable Tanımı Türleri:**
- **Header (Başlık)**: HTTP header'larından değer alır
- **Parameter (Parametre)**: URL parametrelerinden değer alır
- **Body (Gövde)**: Mesaj gövdesinden değer alır
- **Context Value (Ortam Değeri)**: Sistem özelliklerinden değer alır
- **Custom Variable (Özel Değişken)**: Script ile değer atanır

### 2. Runtime Variable Kullanımı

Bu sayfada anlatılan, runtime'da `#{variableName}` formatında kullanılan değişkenlerdir. Bu değişkenler iki kategoriye ayrılır:

<CardGroup cols={2}>
  <Card title="Context Variable" icon="sparkles">
    Sistem tarafından otomatik oluşturulan değişkenler. Her istek için hazırdır ve direkt kullanılabilir.
  </Card>
  <Card title="Global Variable" icon="code">
    Variable tanımı ile oluşturulan ve script ile değer atanan değişkenler. Policy'ler arasında veri aktarımı için kullanılır.
  </Card>
</CardGroup>

<Info>
**Önemli:** Variable tanımı oluşturmak ile runtime'da variable kullanmak farklı şeylerdir. Variable tanımı, değişkenin nasıl oluşturulacağını belirler. Runtime kullanımı ise, oluşturulan değişkenin `#{variableName}` formatında kullanılmasıdır.
</Info>

## Variable Tanımı vs Runtime Variable Kullanımı

| Özellik | Variable Tanımı | Runtime Variable Kullanımı |
|---------|-----------------|----------------------------|
| **Ne Zaman** | Proje yapılandırması aşamasında | İstek işlenirken (runtime) |
| **Nerede** | Project > Variables | Policy ayarları, routing, header'lar vb. |
| **Format** | Form tabanlı tanım | `#{variableName}` formatında kullanım |
| **Amaç** | Değişkenin nasıl oluşturulacağını tanımlamak | Dinamik değerleri kullanmak |
| **Örnek** | "userId" adında Custom Variable tanımı oluşturma | `#{userId}` şeklinde kullanma |

<Note>
Variable tanımları hakkında detaylı bilgi için [Variable](/tr/concepts/temel-kavramlar/variable) sayfasına bakabilirsiniz. Bu sayfa, runtime'da variable'ların nasıl kullanılacağını anlatmaktadır.
</Note>

## İki Tür Runtime Variable: Context ve Global

Apinizer'da runtime'da kullanabileceğiniz iki tür variable vardır:

<CardGroup cols={2}>
  <Card title="Context Variable" icon="sparkles">
    Sistem tarafından otomatik oluşturulan değişkenler. Her istek için hazırdır ve direkt kullanılabilir.
  </Card>
  <Card title="Global Variable" icon="code">
    Variable tanımı ile oluşturulan ve script ile değer atanan değişkenler. Policy'ler arasında veri aktarımı için kullanılır.
  </Card>
</CardGroup>

### Context Variable Nedir?

Context variable'lar, sistem tarafından **otomatik** olarak oluşturulan ve her istek için hazır olan runtime değişkenlerdir. Bu değişkenler:

- **Variable tanımı gerektirmez** - Hiçbir tanım yapmanıza gerek yoktur
- İstek başladığında otomatik oluşturulur
- Sistem tarafından otomatik değer atanır
- Direkt `#{variableName}` formatında kullanılabilir
- İstek bilgileri, tarih/saat, hata bilgileri gibi sistem verilerini içerir

**Örnek:** `#{request.method}`, `#{dateTime.year}`, `#{message.correlationId}`, `#{error.message}`, `#{apiProxy.name}`

<Info>
Context variable'lar, Variable dokümanında anlatılan "Context Value" tipindeki variable tanımlarından **farklıdır**. Context Value tipindeki variable tanımları, form tabanlı yapılandırmada dropdown menüden sistem özelliklerini seçmenizi sağlar. Context variable'lar ise runtime'da otomatik oluşturulan ve direkt kullanılabilen değişkenlerdir.
</Info>

### Global Variable Nedir?

Global variable'lar, [Variable tanımı](/tr/concepts/temel-kavramlar/variable) ile oluşturulan ve script politikaları ile değer atanan runtime değişkenlerdir. Bu değişkenler:

- **Variable tanımı gerektirir** - Önce Project > Variables'da "Custom Variable" tipinde tanım oluşturulur
- Script politikası ile runtime'da değer atanır
- Policy'ler arasında veri aktarımı için kullanılır
- İhtiyacınıza göre özelleştirilebilir

**Örnek:** `#{userId}`, `#{tenantId}`, `#{customValue}`

<Info>
Global variable'lar, Variable dokümanında anlatılan "Custom Variable" tipindeki variable tanımlarından oluşturulur. Variable tanımı oluşturduktan sonra, script politikası ile `customVariableMap.put("variableName", "value")` şeklinde değer atayarak runtime'da kullanabilirsiniz.
</Info>

### Farklar Nelerdir?

| Özellik | Context Variable | Global Variable |
|---------|------------------|-----------------|
| **Variable Tanımı** | Gerekmez - Sistem otomatik oluşturur | Gerekir - Custom Variable tipinde tanım oluşturulur |
| **Değer Atama** | Sistem otomatik atar | Script ile değer atarsınız (`customVariableMap.put()`) |
| **Kullanım Hazırlığı** | Her zaman hazırdır | Önce Variable tanımı, sonra script ile değer atama gerekir |
| **Kapsam** | İstek bağlamı (request context) | İstek bağlamı (request context) |
| **Kullanım Amacı** | Sistem bilgilerine erişim | Policy'ler arası veri aktarımı |
| **Örnekler** | `#{request.method}`, `#{dateTime.year}`, `#{error.message}` | `#{userId}`, `#{tenantId}` |

<Note>
Her iki tür de aynı şekilde kullanılır: `#{variableName}` formatında. Sistem otomatik olarak hangi değişkenin nereden geldiğini bilir ve çözümler.
</Note>

### Variable Tanımı Türleri ve Runtime Kullanımı

Variable dokümanında anlatılan 5 tip variable tanımının runtime kullanımı:

| Variable Tanımı Türü | Runtime Kullanımı | Açıklama |
|----------------------|-------------------|----------|
| **Header** | `#{variableName}` | Variable tanımı oluşturduktan sonra, header'dan alınan değer `#{variableName}` formatında kullanılır |
| **Parameter** | `#{variableName}` | Variable tanımı oluşturduktan sonra, parametreden alınan değer `#{variableName}` formatında kullanılır |
| **Body** | `#{variableName}` | Variable tanımı oluşturduktan sonra, body'den alınan değer `#{variableName}` formatında kullanılır |
| **Context Value** | Form tabanlı kullanım | Bu tip variable tanımları, policy ayarlarında dropdown menüden seçilerek kullanılır. Runtime'da `#{...}` formatında kullanılmaz |
| **Custom Variable** | `#{variableName}` | Variable tanımı oluşturduktan sonra, script ile değer atanır ve `#{variableName}` formatında kullanılır (Global Variable) |

<Warning>
**Önemli Fark:** Context Value tipindeki variable tanımları ile Context Variable'lar karıştırılmamalıdır:
- **Context Value (Variable Tanımı)**: Form tabanlı yapılandırmada dropdown menüden sistem özelliklerini seçmenizi sağlar
- **Context Variable (Runtime)**: Sistem tarafından otomatik oluşturulan ve `#{variableName}` formatında direkt kullanılabilen değişkenlerdir
</Warning>

## Context Variable'lar

### Ne Zaman Kullanılır?

Context variable'lar, sistem tarafından otomatik oluşturulur ve her zaman kullanılabilir. İstek bilgileri, tarih/saat veya hata bilgilerine ihtiyacınız olduğunda kullanın.

### Kullanılabilir Context Variable'lar

#### Request (İstek) Değişkenleri

İstek ile ilgili bilgiler:

| Değişken | Ne İşe Yarar | Örnek Değer |
|----------|--------------|-------------|
| `#{request.method}` | HTTP metodu | `GET`, `POST`, `PUT` |
| `#{request.uri}` | Tam istek URI'si | `/api/users/123` |
| `#{request.contentType}` | İçerik tipi | `application/json` |
| `#{request.remoteAddress}` | İstemci IP adresi | `192.168.1.100` |
| `#{request.queryString}` | Query parametreleri | `?id=123&name=test` |
| `#{request.pathInfo}` | Path bilgisi | `/api/users` |
| `#{request.contextPath}` | Context path | `/apinizer` |

**Kullanım Örneği:**
```
İstek: #{request.method} #{request.uri} - IP: #{request.remoteAddress}
```

**Sonuç:**
```
İstek: GET /api/users/123 - IP: 192.168.1.100
```

#### DateTime (Tarih/Saat) Değişkenleri

Tarih ve saat bilgileri:

| Değişken | Ne İşe Yarar | Örnek Değer |
|----------|--------------|-------------|
| `#{dateTime.year}` | Yıl | `2026` |
| `#{dateTime.month}` | Ay (1-12) | `2` |
| `#{dateTime.dayOfMonth}` | Gün (1-31) | `4` |
| `#{dateTime.hour}` | Saat (0-23) | `14` |
| `#{dateTime.minute}` | Dakika (0-59) | `30` |
| `#{dateTime.second}` | Saniye (0-59) | `45` |
| `#{dateTime.timestamp}` | Unix timestamp (milisaniye) | `1707058245000` |
| `#{dateTime.formattedText}` | Formatlanmış tarih/saat | `2026-02-04 14:30:45` |

**Kullanım Örneği:**
```
Tarih: #{dateTime.formattedText} (#{dateTime.year} yılı)
```

**Sonuç:**
```
Tarih: 2026-02-04 14:30:45 (2026 yılı)
```

#### Message (Mesaj) Değişkenleri

İstek mesajı ile ilgili bilgiler:

| Değişken | Ne İşe Yarar | Örnek Değer |
|----------|--------------|-------------|
| `#{message.correlationId}` | Benzersiz istek ID'si | `abc123-def456-ghi789` |

<Info>
API Proxy veya Proxy Group üzerinde tanımlanan özel message variable'lar da burada görüntülenir.
</Info>

**Kullanım Örneği:**
```
İstek ID: #{message.correlationId}
```

**Sonuç:**
```
İstek ID: abc123-def456-ghi789
```

#### API Değişkenleri

API Proxy bilgileri:

| Değişken | Ne İşe Yarar | Örnek Değer |
|----------|--------------|-------------|
| `#{apiProxy.id}` | API Proxy ID'si | `api-proxy-123` |
| `#{apiProxy.name}` | API Proxy adı | `User Management API` |

**Kullanım Örneği:**
```
API: #{apiProxy.name} (ID: #{apiProxy.id})
```

**Sonuç:**
```
API: User Management API (ID: api-proxy-123)
```

#### Error (Hata) Değişkenleri

Hata durumlarında kullanılabilen değişkenler:

| Değişken | Ne İşe Yarar | Örnek Değer |
|----------|--------------|-------------|
| `#{error.errorCode}` | Hata kodu | `AUTH_FAILED` |
| `#{error.message}` | Hata mesajı | `Authentication failed` |
| `#{error.httpStatusCode}` | HTTP durum kodu | `401` |
| `#{error.originalMessage}` | Orijinal hata mesajı | `Invalid credentials` |
| `#{error.customizedErrorCode}` | Özelleştirilmiş hata kodu | `CUSTOM_001` |
| `#{error.customizedHttpCode}` | Özelleştirilmiş HTTP kodu | `400` |
| `#{error.customizedMessage}` | Özelleştirilmiş mesaj | `Lütfen tekrar deneyin` |
| `#{error.defaultErrorCode}` | Varsayılan hata kodu | `DEFAULT_001` |
| `#{error.defaultMessage}` | Varsayılan mesaj | `Bir hata oluştu` |
| `#{error.defaultHttpCode}` | Varsayılan HTTP kodu | `500` |

**Kullanım Örneği:**

```json
{
  "error": {
    "code": "#{error.errorCode}",
    "message": "#{error.customizedMessage}",
    "requestId": "#{message.correlationId}"
  }
}
```

**Sonuç:**
```json
{
  "error": {
    "code": "AUTH_FAILED",
    "message": "Lütfen tekrar deneyin",
    "requestId": "abc123-def456-ghi789"
  }
}
```

### Context Variable'lar Ne Zaman Oluşturulur?

- **Request değişkenleri:** İstek başladığında otomatik oluşturulur
- **DateTime değişkenleri:** İstek başladığında oluşturulur (o anki tarih/saat)
- **Message değişkenleri:** İstek başladığında oluşturulur
- **API değişkenleri:** API Proxy yüklendikten sonra oluşturulur
- **Error değişkenleri:** Hata oluştuğunda otomatik oluşturulur

## Global Variable Oluşturma ve Kullanımı

### Ne Zaman Global Variable Kullanılır?

Global variable kullanmanız gereken durumlar:

- Request body'den veri çıkarıp başka yerde kullanmak istediğinizde
- Policy'ler arasında veri aktarımı yapmak istediğinizde
- Hesaplanmış değerleri saklamak istediğinizde
- Authentication sonrası kullanıcı bilgilerini saklamak istediğinizde

### Adım Adım Kılavuz

<Steps>
  <Step title="Variable Tanımı Oluşturun">
    Project > Variables bölümüne gidin ve yeni bir Variable oluşturun. **Type** olarak **Custom Variable** seçin.
    
    <Info>
    Variable tanımları hakkında detaylı bilgi için [Variable](/tr/concepts/temel-kavramlar/variable) sayfasına bakabilirsiniz.
    </Info>
  </Step>
  
  <Step title="Script Policy ile Değer Atayın">
    Script Policy içinde global variable'a değer atayın:

    ```groovy
    // customVariableMap otomatik olarak script'e binding olarak eklenir

    // Basit değer atama
    customVariableMap.put("userId", "12345")

    // Header'dan değer alma
    String authToken = headerMapFC.get("Authorization")
    if (authToken != null) {
        customVariableMap.put("authToken", authToken)
    }

    // Body'den JSON parse edip değer çıkarma
    def jsonBody = new groovy.json.JsonSlurper().parseText(bodyTextFC)
    if (jsonBody.userId) {
        customVariableMap.put("userId", jsonBody.userId.toString())
        customVariableMap.put("userEmail", jsonBody.email ?: "")
    }
    ```
  </Step>
  
  <Step title="Global Variable'ı Kullanın">
    Oluşturduğunuz variable'ı başka policy'lerde veya ayarlarda kullanın:

    ```
    Backend URL: https://api.example.com/users/#{userId}
    Header: X-User-ID: #{userId}
    ```
  </Step>
</Steps>

### Variable Tanımında Initialize with Script Kullanımı

Variable tanımında **Initialize with Script** özelliğini kullanarak, global variable'ın başlangıç değerini otomatik olarak belirleyebilirsiniz:

**Variable Tanımı Ayarları:**
- **Name:** Variable adı (örn: `apiKey`)
- **Type:** `Custom Variable` seçin
- **Initialize with Script:** Aktif edin
- **Script Language:** `Groovy` veya `JavaScript` seçin
- **Script Body:** Variable'ı initialize edecek script'i yazın

**Script Örneği:**

```groovy
// Header'dan API key'i al
String apiKey = headerMapFC.get("X-API-Key")
if (apiKey != null) {
    customVariableMap.put("apiKey", apiKey)
} else {
    // Varsayılan değer
    customVariableMap.put("apiKey", "default-key")
}
```

<Warning>
**Initialize with Script** özelliği yalnızca değişken **hiç oluşturulmamışsa** veya **null** ise çalışır. Script içinde kullanılan variable adı, Variable tanımındaki ad ile birebir aynı olmalıdır.
</Warning>

## Kullanım Örnekleri

### Örnek 1: Hata Mesajlarında Variable Kullanımı

**Amaç:** Hata mesajlarını dinamik ve bilgilendirici hale getirmek.

**Hata Mesajı Şablonu:**

```json
{
  "error": {
    "code": "#{error.errorCode}",
    "message": "#{error.customizedMessage}",
    "requestId": "#{message.correlationId}",
    "timestamp": "#{dateTime.timestamp}",
    "path": "#{request.uri}",
    "method": "#{request.method}"
  }
}
```

**Çözümlenmiş Örnek:**

```json
{
  "error": {
    "code": "AUTH_FAILED",
    "message": "Geçersiz kullanıcı adı veya şifre",
    "requestId": "abc123-def456-ghi789",
    "timestamp": "1707058245000",
    "path": "/api/auth/login",
    "method": "POST"
  }
}
```

### Örnek 2: Backend Routing'te Global Variable Kullanımı

**Amaç:** Backend URL'lerini dinamik hale getirmek.

**Backend URL:**

```
https://#{tenantId}.api.example.com/api/v1/#{apiProxy.name}/#{request.pathInfo}
```

**Çözümlenmiş Örnek:**

```
https://tenant-123.api.example.com/api/v1/users-api/api/users
```

**Script ile tenantId Oluşturma:**

```groovy
// Script Policy - Request Pipeline

// Request body'den tenant ID çıkar
def jsonBody = new groovy.json.JsonSlurper().parseText(bodyTextFC)
if (jsonBody.tenantId) {
    customVariableMap.put("tenantId", jsonBody.tenantId.toString())
}

// Veya header'dan al
String tenantId = headerMapFC.get("X-Tenant-ID")
if (tenantId != null) {
    customVariableMap.put("tenantId", tenantId)
}
```

### Örnek 3: Response Header'larında Variable Kullanımı

**Amaç:** Response header'larına istek bilgilerini eklemek.

**Header Ayarları:**

```
X-Request-ID: #{message.correlationId}
X-API-Name: #{apiProxy.name}
X-Request-Time: #{dateTime.timestamp}
X-Request-Date: #{dateTime.formattedText}
```

**Çözümlenmiş Örnek:**

```
X-Request-ID: abc123-def456-ghi789
X-API-Name: User Management API
X-Request-Time: 1707058245000
X-Request-Date: 2026-02-04 14:30:45
```

### Örnek 4: Log Mesajlarında Variable Kullanımı

**Amaç:** Detaylı log mesajları oluşturmak.

**Log Mesajı:**

```
[#{dateTime.formattedText}] #{request.method} #{request.uri} - 
IP: #{request.remoteAddress} - 
Correlation ID: #{message.correlationId} - 
API: #{apiProxy.name} - 
User: #{userId}
```

**Çözümlenmiş Örnek:**

```
[2026-02-04 14:30:45] GET /api/users/123 - 
IP: 192.168.1.100 - 
Correlation ID: abc123-def456-ghi789 - 
API: User Management API - 
User: admin@example.com
```

## Sık Karşılaşılan Sorunlar ve Çözümleri

### Sorun 1: Variable Bulunamıyor

**Belirtiler:**
- Variable boş string (`""`) olarak çözümleniyor
- Log'da "Context variable 'xxx' not found" uyarısı var

**Nedenler:**
1. Variable henüz oluşturulmamış (policy sırası sorunu)
2. Variable ismi yanlış yazılmış
3. Script çalışmamış veya hata vermiş

**Çözümler:**

**1. Policy Sırasını Kontrol Edin:**

```
Doğru Sıra:
1. Script Policy (variable oluşturur)
2. Routing Policy (variable kullanır)

Yanlış Sıra:
1. Routing Policy (variable henüz yok!)
2. Script Policy (variable oluşturur ama çok geç)
```

**2. Variable İsmini Kontrol Edin:**

```groovy
// Script'te oluşturulan isim
customVariableMap.put("userId", "123")

// Kullanım (büyük/küçük harf duyarsız)
#{userId}   #{USERID}   #{UserId}   #{userid}
```

**3. Script Hatalarını Kontrol Edin:**

```groovy
// Hata kontrolü ekleyin
try {
    customVariableMap.put("userId", extractUserId())
} catch (Exception e) {
    logger.error("Error creating userId variable", e)
    // Varsayılan değer
    customVariableMap.put("userId", "unknown")
}
```

### Sorun 2: Variable Değeri Yanlış

**Belirtiler:**
- Variable çözümleniyor ama yanlış değer gösteriyor
- Eski değer gösteriliyor

**Nedenler:**
1. Variable override edilmiş
2. Script birden fazla kez çalışmış
3. Yanlış policy'de variable oluşturulmuş

**Çözümler:**

**1. Variable Override Kontrolü:**

```groovy
// Mevcut değeri kontrol et
String existingValue = customVariableMap.get("userId")
if (existingValue == null) {
    // Sadece yoksa oluştur
    customVariableMap.put("userId", newValue)
} else {
    logger.warn("userId already exists: ${existingValue}")
}
```

**2. Script Execution Order Kontrolü:**

Policy execution order'ı kontrol edin. Aynı variable'ı birden fazla script oluşturuyorsa, son çalışan script'in değeri kullanılır.

### Sorun 3: Script Çalışmıyor

**Belirtiler:**
- Variable oluşturulmuyor
- Script hata veriyor

**Çözümler:**

**1. Script Syntax Kontrolü:**

```groovy
// Groovy syntax kontrolü
def jsonBody = new groovy.json.JsonSlurper().parseText(bodyTextFC)
```

**2. Null Kontrolü:**

```groovy
// Güvenli kullanım
if (bodyTextFC != null && !bodyTextFC.isEmpty()) {
    def jsonBody = new groovy.json.JsonSlurper().parseText(bodyTextFC)
    if (jsonBody.userId) {
        customVariableMap.put("userId", jsonBody.userId.toString())
    }
}
```

**3. Hata Yakalama:**

```groovy
try {
    // Variable oluşturma kodu
    customVariableMap.put("userId", extractUserId())
} catch (Exception e) {
    logger.error("Error in script", e)
    // Varsayılan değer veya hata durumu
    customVariableMap.put("scriptError", "true")
}
```

## İpuçları ve En İyi Uygulamalar

### 1. İsimlendirme Kuralları

**İyi İsimler:**

```groovy
customVariableMap.put("userId", "123")
customVariableMap.put("userEmail", "user@example.com")
customVariableMap.put("tenantId", "tenant-123")
customVariableMap.put("requestId", "req-456")
```

**Kötü İsimler:**

```groovy
customVariableMap.put("x", "123")  // Anlamsız
customVariableMap.put("data", "value")  // Çok genel
customVariableMap.put("request.method", "POST")  // Context variable ile çakışma
```

**Kurallar:**
- Açıklayıcı ve anlamlı isimler kullanın
- camelCase kullanın (örn: `userId`, `userEmail`)
- Context variable isimleriyle çakışmayın
- Kısa ama açıklayıcı isimler tercih edin

### 2. Null ve Empty Kontrolü

**Güvenli Kullanım:**

```groovy
// Script içinde
String userId = customVariableMap.get("userId")
if (userId != null && !userId.isEmpty()) {
    // Kullan
    logger.info("User ID: ${userId}")
} else {
    logger.warn("User ID not found")
    // Varsayılan değer
    customVariableMap.put("userId", "guest")
}
```

**Güvensiz Kullanım:**

```groovy
// Null pointer exception riski
String userId = customVariableMap.get("userId")
logger.info("User ID: ${userId.toUpperCase()}")  // userId null ise hata!
```

### 3. Güvenlik

**Güvenli:**

```groovy
// Sadece gerekli ve güvenli bilgileri kaydet
customVariableMap.put("userId", userId)
customVariableMap.put("userEmail", userEmail)
```

**Güvensiz:**

```groovy
// Hassas bilgileri kaydetme
customVariableMap.put("password", userPassword)  // Log'da görünebilir!
customVariableMap.put("creditCard", cardNumber)  // Güvenlik riski!
customVariableMap.put("apiSecret", secretKey)    // Hassas bilgi!
```

<Warning>
**Güvenlik Kuralları:**
- Şifreleri global variable'a kaydetmeyin
- Kredi kartı bilgilerini kaydetmeyin
- API secret key'leri kaydetmeyin
- Sadece gerekli ve güvenli bilgileri kaydedin
</Warning>

### 4. Hata Yönetimi

**İyi Hata Yönetimi:**

```groovy
try {
    def jsonBody = new groovy.json.JsonSlurper().parseText(bodyTextFC)
    if (jsonBody.userId) {
        customVariableMap.put("userId", jsonBody.userId.toString())
    }
} catch (Exception e) {
    logger.error("Error parsing JSON body", e)
    // Varsayılan değer veya hata durumu
    customVariableMap.put("userId", "unknown")
    customVariableMap.put("parseError", "true")
}
```

**Kötü Hata Yönetimi:**

```groovy
// Hata kontrolü yok
def jsonBody = new groovy.json.JsonSlurper().parseText(bodyTextFC)
customVariableMap.put("userId", jsonBody.userId.toString())  // Null pointer riski!
```

### 5. UI'da Context Variable Kullanımı

Birçok policy ve ayar ekranında **Context Variable Dialog** butonu bulunur:

<Steps>
  <Step title="Context Variable Dialog'u Açın">
    Policy veya ayar ekranında **"Context Variable"** butonuna tıklayın.
  </Step>
  
  <Step title="Değişkeni Seçin">
    Açılan dialog'da kullanılabilir tüm değişkenleri görüntüleyin.
  </Step>
  
  <Step title="Değişkeni Kopyalayın">
    İstediğiniz değişkene tıklayarak kopyalayın.
  </Step>
  
  <Step title="Değişkeni Yapıştırın">
    Değişkeni ilgili alana yapıştırın.
  </Step>
</Steps>

**Dialog Kategorileri:**
- **Error Variables** (10 adet)
- **Request Variables** (7 adet)
- **Message Variables** (Dinamik)
- **API Variables** (2 adet)
- **DateTime Variables** (8 adet)

## Özet

### Hızlı Referans

**Context Variable Kullanımı:**
```
#{request.method}        → HTTP metodu
#{dateTime.formattedText} → Formatlanmış tarih/saat
#{message.correlationId} → İstek ID'si
#{apiProxy.name}         → API Proxy adı
#{error.message}         → Hata mesajı
```

**Global Variable Oluşturma:**
```groovy
// Script içinde
customVariableMap.put("variableName", "value")
```

**Global Variable Kullanımı:**
```
#{variableName}
```

<Note>
**Önemli Notlar:**
- Variable bulunamazsa boş string döner
- Policy sırası önemlidir (önce oluştur, sonra kullan)
- Context variable'lar otomatik oluşturulur, global variable'lar için önce Variable tanımı gerekir
</Note>


