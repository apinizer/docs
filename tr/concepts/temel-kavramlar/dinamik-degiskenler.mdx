---
title: "Dinamik Değişkenler"
description: "Apinizer'da politika ayarları, bağlantı konfigürasyonları ve routing adreslerinde kullanılabilen iki dinamik değişken türü: Environment Variable (${key}) ve Context Variable (#{key}). İki tür arasındaki farklar, desteklenen alanlar ve kullanım yöntemleri."
---

## Genel Bakış

Apinizer'da politika ayarları, bağlantı konfigürasyonları ve routing adresleri gibi birçok string alanda dinamik değişkenler kullanılabilir. Bu sayede sabit değerler yerine ortama, isteğe veya çalışma zamanına göre değişen değerler tanımlanabilir.

İki tür dinamik değişken vardır:

<CardGroup cols={2}>
    <Card title="Environment Variable — ${key}" icon="key">
        Ortam değişkenleri, deploy anında çözümlenir. Geliştirme, test ve üretim gibi ortamlara göre farklı değerler alabilir.
    </Card>
    <Card title="Context Variable — #{key}" icon="sparkles">
        Bağlam değişkenleri, her istekte çözümlenir. İstek bilgileri, tarih/saat gibi sistem verileri veya script ile atanan özel değerler içerir.
    </Card>
</CardGroup>

## İki Değişken Türü

| Özellik | Environment Variable (`${key}`) | Context Variable (`#{key}`) |
|---------|--------------------------------|----------------------------|
| **Format** | `${variableName}` | `#{variableName}` |
| **Çözümleme Zamanı** | Deploy anında | Her istekte |
| **Değer Kaynağı** | Environment Variable yönetim ekranından tanımlanır | Sistem otomatik oluşturur veya script ile atanır |
| **Ortam Bağımlılığı** | Evet — dev, test, prod için farklı değer | Hayır — istek bazlı |
| **Tanım Gereksinimi** | Environment Variable ekranında tanım gerekir | Sistem değişkenleri: gerekmez. Global değişkenler: Custom Variable tanımı gerekir |
| **Tipik Kullanım** | Host adları, base URL'ler, port'lar, bağlantı bilgileri | Kullanıcı bilgileri, istek detayları, tarih/saat, hata bilgileri |
| **Değişkenlik** | Deploy sonrası sabittir | Her istekte farklı olabilir |

### Environment Variable (`${key}`)

Environment Variable'lar, farklı ortamlarda (geliştirme, test, üretim) farklı değerler kullanmanızı sağlar. Deploy anında çözümlenir ve çalışma zamanında sabit kalır.

**Örnek:** `${api.hostname}` → Geliştirmede `localhost:8080`, üretimde `api.example.com`

<Info>
Environment Variable tanımlama ve yönetim hakkında detaylı bilgi için [Environment Variable](/tr/concepts/temel-kavramlar/environment-variable) sayfasına bakabilirsiniz. CRUD işlemleri ve kullanım senaryoları için [Environment Variable Yönetimi](/tr/develop/environment-variables) sayfasını inceleyebilirsiniz.
</Info>

### Context Variable (`#{key}`)

Context Variable'lar her istekte çözümlenir ve iki alt kategoriden oluşur:

**1. Sistem Context Variable'ları** — Otomatik oluşturulur, tanım gerektirmez:
- `#{request.method}`, `#{request.uri}`, `#{request.remoteAddress}`
- `#{dateTime.year}`, `#{dateTime.formattedText}`
- `#{message.correlationId}`
- `#{apiProxy.name}`, `#{apiProxy.id}`
- `#{error.effectiveErrorCode}`, `#{error.effectiveMessage}`

**2. Global Variable'lar** — Script ile oluşturulur, Custom Variable tanımı gerekir:
- `#{userId}`, `#{tenantId}`, `#{customValue}`
- Script politikasında `customVariableMap.put("key", "value")` ile değer atanır

<Info>
Variable tanımları hakkında detaylı bilgi için [Değişkenler](/tr/concepts/temel-kavramlar/variable) sayfasına bakabilirsiniz.
</Info>

### Karışık Kullanım

İki tür aynı anda kullanılabilir:

```
https://${api.hostname}/v1/users/#{userId}
```

`${api.hostname}` deploy anında çözümlenir (örn: `api.example.com`), `#{userId}` her istekte farklı değer alır.

## Desteklenen Alanlar

Dinamik değişkenler, politika ve bağlantı ayarlarında neredeyse tüm string alanlarda kullanılabilir.

### Politikalar

| Politika | Desteklenen Alanlar | Değişken Türleri |
|----------|---------------------|------------------|
| **REST API Call** | URL, header, parametre, body | `${key}` ve `#{key}` |
| **OIDC** | Token endpoint, introspection endpoint, resource endpoint, form parametreleri | `${key}` ve `#{key}` |
| **JOSE Validation / Implementation** | Dynamic key HTTP endpoint | `${key}` ve `#{key}` |
| **Authentication API** | URL, header, parametre | `${key}` ve `#{key}` |
| **Message Builder** | Template, header, form alanları | `${key}` ve `#{key}` |
| **Redaction** | Key-value listesi | `${key}` ve `#{key}` |
| **Diğer politikalar** | Metin (string) giriş alanları | `${key}` ve `#{key}` |

<Warning>
**Script politikası bu tabloda yer almaz.** Script politikasında `#{key}` placeholder mekanizması kullanılmaz çünkü değişkenlere zaten `customVariableMap` nesnesi ve `request_httpMethod`, `dateTime_year` gibi binding'ler üzerinden doğrudan erişim sağlanır. Detaylar için [Script'te Kullanım Farkı](#scriptte-kullanım-farkı) bölümüne bakınız.
</Warning>

### Bağlantılar

| Bağlantı Türü | Desteklenen Alanlar |
|---------------|---------------------|
| **Database Connection** | Host, port, kullanıcı adı, şifre, connection string |
| **LDAP Connection** | URL, base DN, kullanıcı adı, şifre |
| **Email Connection** | Host, port, kullanıcı adı |

### Diğer Alanlar

| Alan | Desteklenen Türler |
|------|-------------------|
| **Routing Adresi** | `${key}` ve `#{key}` |
| **JSON Error Response Template** | `#{key}` (hata değişkenleri dahil) |
| **XML Error Response Template** | `#{key}` (hata değişkenleri dahil) |
| **Identity Provider (DB, LDAP, API)** | `${key}` ve `#{key}` |
| **IP Group** | `${key}` ve `#{key}` |
| **Credential** | `${key}` ve `#{key}` |

<Note>
Bağlantı ayarlarında (Database, LDAP, Email) genellikle `${key}` (Environment Variable) kullanılır çünkü bu değerler ortam bazlıdır ve deploy anında çözümlenmelidir. `#{key}` (Context Variable) ise istek zamanında çözümlenir ve daha çok politika ayarlarında ve routing adreslerinde kullanılır.
</Note>

## UI'da Değişken Seçimi

Politika ve bağlantı düzenleme ekranlarında, breadcrumb alanında **"Değişken"** butonu bulunur. Bu butona tıklandığında açılan menüden iki diyaloğa erişilebilir:

### Environment Variable Diyaloğu

Menüden **"Environment Variable"** seçildiğinde açılan diyalog, tanımlanmış tüm ortam değişkenlerini listeler:

- **Global Değişkenler** — Tüm ortamlarda geçerli olan değişkenler
- **Ortama Özel Değişkenler** — Belirli ortamlar için tanımlanmış değişkenler

Değişkene tıklandığında `${variableName}` formatında panoya kopyalanır ve ilgili alana yapıştırılabilir.

### Context Variable Diyaloğu

Menüden **"Context Variable"** seçildiğinde açılan diyalog, kullanılabilir tüm bağlam değişkenlerini kategorize ederek listeler:

- **Error Variables** — Hata bilgileri
- **Request Variables** — İstek bilgileri
- **Message Variables** — Mesaj bilgileri
- **API Variables** — API Proxy bilgileri
- **DateTime Variables** — Tarih/saat bilgileri

Değişkene tıklandığında `#{variableName}` formatında panoya kopyalanır.

<Info>
Her iki diyalog da bağımsızdır. Aynı alanda hem `${key}` hem `#{key}` kullanabilirsiniz.
</Info>

## Context Variable Referansı

### Request (İstek)

| Format | Açıklama | Örnek Değer |
|--------|----------|-------------|
| `#{request.method}` | HTTP metodu | `GET`, `POST` |
| `#{request.uri}` | İstek URI'si | `/api/users/123` |
| `#{request.contentType}` | İçerik tipi | `application/json` |
| `#{request.remoteAddress}` | İstemci IP adresi | `192.168.1.100` |
| `#{request.queryString}` | Query parametreleri | `?id=123` |
| `#{request.pathInfo}` | Path bilgisi | `/api/users` |
| `#{request.contextPath}` | Context path | `/apinizer` |

### DateTime (Tarih/Saat)

| Format | Açıklama | Örnek Değer |
|--------|----------|-------------|
| `#{dateTime.year}` | Yıl | `2026` |
| `#{dateTime.month}` | Ay (1-12) | `2` |
| `#{dateTime.dayOfMonth}` | Gün (1-31) | `4` |
| `#{dateTime.dayOfWeek}` | Haftanın günü (1=Pazartesi, 7=Pazar) | `3` |
| `#{dateTime.hour}` | Saat (0-23) | `14` |
| `#{dateTime.minute}` | Dakika (0-59) | `30` |
| `#{dateTime.second}` | Saniye (0-59) | `45` |
| `#{dateTime.timestamp}` | Unix timestamp (milisaniye) | `1707058245000` |
| `#{dateTime.formattedText}` | Formatlanmış tarih/saat | `2026-02-04T14:30:45.000Z` |
| `#{date.formattedText}` | Formatlanmış tarih | `2026-02-04` |
| `#{time.formattedText}` | Formatlanmış saat | `14:30:45` |

### Message (Mesaj)

| Format | Açıklama | Örnek Değer |
|--------|----------|-------------|
| `#{message.correlationId}` | Benzersiz istek ID'si | `abc123-def456-ghi789` |

<Info>
API Proxy veya Proxy Group üzerinde tanımlanan özel message variable'lar da bu kategoride görüntülenir.
</Info>

### API

| Format | Açıklama | Örnek Değer |
|--------|----------|-------------|
| `#{apiProxy.id}` | API Proxy ID'si | `api-proxy-123` |
| `#{apiProxy.name}` | API Proxy adı | `User Management API` |

### Error (Hata)

| Format | Açıklama | Örnek Değer |
|--------|----------|-------------|
| `#{error.effectiveErrorCode}` | Nihai hata kodu | `AUTH_FAILED` |
| `#{error.effectiveMessage}` | Nihai hata mesajı | `Authentication failed` |
| `#{error.effectiveHttpCode}` | Nihai HTTP kodu | `401` |
| `#{error.customizedErrorCode}` | Özelleştirilmiş hata kodu | `CUSTOM_001` |
| `#{error.customizedHttpCode}` | Özelleştirilmiş HTTP kodu | `400` |
| `#{error.customizedMessage}` | Özelleştirilmiş mesaj | `Lütfen tekrar deneyin` |
| `#{error.defaultErrorCode}` | Varsayılan hata kodu | `DEFAULT_001` |
| `#{error.defaultMessage}` | Varsayılan mesaj | `Bir hata oluştu` |
| `#{error.defaultHttpCode}` | Varsayılan HTTP kodu | `500` |

### Script'te Kullanım Farkı

Context variable'lar script politikası içinde **farklı formatta** kullanılır. Runtime'da nokta (`.`) ile ayrılan format, script'te alt çizgi (`_`) ile yazılır:

| Runtime Format | Script Format |
|----------------|---------------|
| `#{request.method}` | `request_httpMethod` |
| `#{dateTime.year}` | `dateTime_year` |
| `#{message.correlationId}` | `message_correlationId` |
| `#{apiProxy.name}` | `apiProxy_name` |
| `#{error.effectiveErrorCode}` | `error_effectiveErrorCode` |

```groovy
// Script içinde context variable kullanımı
String method = request_httpMethod
String year = dateTime_year
String correlationId = message_correlationId
```

## Global Variable Kullanımı

Global variable'lar, Custom Variable tanımı ile oluşturulan ve script ile değer atanan değişkenlerdir. Politikalar arasında veri aktarımı için kullanılır.

<Steps>
    <Step title="Variable Tanımı Oluşturun">
        Project > Variables bölümünden **Custom Variable** tipinde yeni bir tanım oluşturun.
    </Step>

    <Step title="Script ile Değer Atayın">
        Script politikası içinde `customVariableMap.put("variableName", "value")` ile değer atayın.
    </Step>

    <Step title="Değişkeni Kullanın">
        `#{variableName}` formatında diğer politika ve ayarlarda kullanın.
    </Step>
</Steps>

**Script Örneği:**

```groovy
// Request body'den kullanıcı bilgisi çıkarma
if (bodyTextFC != null && !bodyTextFC.isEmpty()) {
    def jsonBody = new groovy.json.JsonSlurper().parseText(bodyTextFC)
    if (jsonBody.userId) {
        customVariableMap.put("userId", jsonBody.userId.toString())
    }
}

// Header'dan değer alma
String token = headerMapFC.get("X-Custom-Token")
if (token != null) {
    customVariableMap.put("customToken", token)
}
```

<Warning>
Global variable'lar script politikası çalıştıktan sonra kullanılabilir. Değişkeni kullanan politika, değer atayan script politikasından **sonra** çalışmalıdır (policy sırası önemlidir).
</Warning>

## Kullanım Örnekleri

### Hata Yanıt Şablonu

```json
{
  "error": {
    "code": "#{error.effectiveErrorCode}",
    "message": "#{error.effectiveMessage}",
    "requestId": "#{message.correlationId}",
    "timestamp": "#{dateTime.timestamp}"
  }
}
```

### Dinamik Routing

```
https://${api.hostname}/v1/#{tenantId}/users/#{request.pathInfo}
```

`${api.hostname}` deploy anında, `#{tenantId}` ve `#{request.pathInfo}` her istekte çözümlenir.

### Response Header Ekleme

```
X-Request-ID: #{message.correlationId}
X-API-Name: #{apiProxy.name}
X-Processed-At: #{dateTime.formattedText}
```

## Davranış Kuralları

- Bulunamayan `#{key}` değerleri boş string (`""`) ile değiştirilir; hata fırlatılmaz, uyarı log'u yazılır
- Bulunamayan `${key}` değerleri çözümlenemez ve olduğu gibi kalır
- Script politikasında custom variable map'e doğrudan erişim olduğu için `#{...}` placeholder mekanizması kullanılmaz
- Variable isimleri büyük/küçük harf duyarsızdır

## Sonraki Adımlar

<CardGroup cols={2}>
    <Card title="Environment Variable" icon="key" href="/tr/concepts/temel-kavramlar/environment-variable">
        Ortam değişkenlerini detaylı öğrenin
    </Card>
    <Card title="Değişkenler" icon="code" href="/tr/concepts/temel-kavramlar/variable">
        Variable tanımlarını öğrenin
    </Card>
    <Card title="Script Politikası" icon="terminal" href="/tr/develop/politikalar/script">
        Script ile değişken kullanımı
    </Card>
    <Card title="Environment Variable Yönetimi" icon="sliders" href="/tr/develop/environment-variables">
        Environment Variable CRUD işlemleri
    </Card>
</CardGroup>
