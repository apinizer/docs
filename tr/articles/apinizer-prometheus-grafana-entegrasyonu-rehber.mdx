---
title: "Apinizer'ın Prometheus ve Grafana Entegrasyonu: Kapsamlı Bir Rehber"
description: "API gateway ve önbellek performansı için Apinizer metrikleri, Prometheus ve Grafana kurulumu"
---

![Apinizer Prometheus Grafana](https://miro.medium.com/v2/resize:fit:700/1*UBNrBZPiUcyKqAIzvk5sYw.png)

Günümüzün mikroservis mimarisinde, sistem performansını ve davranışını izlemek optimal operasyonları sürdürmek için hayati önem taşır. Güçlü bir API yönetim platformu olan Apinizer, Prometheus ve Grafana gibi endüstri standardı izleme araçlarıyla entegre edilebilen sağlam metrik toplama özellikleri sunar. Bu makale, API gateway ve önbellek performansınız hakkında değerli içgörüler elde etmek için Apinizer'ın metrik özelliklerinden nasıl yararlanabileceğinize dair detaylı bir rehber sunmaktadır.

## Apinizer'ın Metrik Sistemine Genel Bakış

![Metrik sistemi](https://miro.medium.com/v2/resize:fit:700/1*9-EVt1Sur2lkFx7uGfELqA.jpeg)

Apinizer'ın metrik sistemi, Micrometer üzerine inşa edilmiştir. Platform, iki ana bileşen üzerinden geniş bir metrik yelpazesi toplar:

1. **Apinizer Gateway**: API trafiği, harici bağlantılar, JVM sağlığı ve sistem kaynakları ile ilgili metrikleri toplar
2. **Apinizer Cache**: Önbellek işlemlerini, API isteklerini, JVM performansını ve sistem sağlığını izler

Bu metrikler, API yönetim altyapınızın performansı ve sağlığı hakkında kapsamlı görünürlük sağlayarak, darboğazların proaktif olarak tanımlanmasını, sorunların giderilmesini ve kapasite planlamasını mümkün kılar.

## Apinizer Tarafından Toplanan Metrikler

![Toplanan metrikler](https://miro.medium.com/v2/resize:fit:700/1*XwwkhGl-mLlVSeYCNBrrzw.jpeg)

### Apinizer Gateway Metrikleri

Gateway bileşeni çeşitli kategorilerde metrikler toplar:

**API Trafik Metrikleri** — Gateway üzerinden geçen istekleri takip eder:

- Toplam API trafik istekleri
- Başarılı/başarısız/engellenen API istekleri
- İstek işleme süreleri (pipeline, yönlendirme, toplam)
- İstek ve yanıt boyutları
- Önbellek isabet istatistikleri

Her metrik iki formda mevcuttur: toplam metrikler ve detaylı boyutlara sahip etiketli metrikler (örn. API Kimliği, API adı başına istekler).

**Harici Bağlantı Metrikleri** — Harici servislere yapılan bağlantıları takip eder: toplam harici istekler, harici hata sayısı, harici yanıt süreleri.

**JVM Metrikleri** — Bellek kullanımı (heap, non-heap), garbage collection istatistikleri, thread sayıları ve durumları.

**Sistem Metrikleri** — CPU kullanımı, işlemci sayısı, sistem yük ortalaması, file descriptor sayıları.

### Apinizer Cache Metrikleri

**Önbellek İşlem Metrikleri:** Önbellek get/put sayıları, boyut ve giriş sayıları, işlem gecikmeleri, bellek kullanımı.

**API Metrikleri:** API istek sayıları, yanıt süreleri, hata sayıları.

**JVM ve Sistem Metrikleri:** Gateway'e benzer şekilde Cache bileşeni de JVM performansını ve sistem kaynak kullanımını takip eder.

## Prometheus Entegrasyonunun Kurulumu

### 1. Apinizer Bileşenlerinde Metriklerin Etkinleştirilmesi

**Apinizer Gateway için:** Apinizer arayüzünde Gateway Environments sayfasına gidin ve "Prometheus Metric Server" seçeneğini etkinleştirin. Bu, 9091 portu üzerinden metrik yayınlamayı aktif hale getirir.

**Apinizer Cache için:** Cache deployment'ını düzenleyin ve `METRICS_ENABLED=TRUE` ortam değişkenini ekleyin.

- Apinizer arayüzü üzerinden: Gateway Environments → Deployments & Services → Cache → Edit deployment
- Kubernetes CLI üzerinden:

```text
kubectl edit deploy -n <namespace> cache
# Aşağıdaki ortam değişkenini ekleyin
- name: METRICS_ENABLED
  value: "true"
```

### 2. Prometheus'un Metrik Toplamak için Yapılandırılması

**Sabit (Constant) Scraping:** Apinizer bileşenlerini 9091 portunda hedefleyen bir servis oluşturun, ardından Prometheus'u bu servislerden metrik toplayacak şekilde yapılandırın.

**Kubernetes Service Discovery ile Dinamik Scraping:** Deployment'a `prometheus.io/port: "9091"` ve `prometheus.io/scrape: "true"` anotasyonları ekleyin; Prometheus'u Kubernetes servis keşfini kullanacak şekilde yapılandırın.

## PromQL ile Apinizer Metriklerinin Analizi

**Gateway API Trafik Analizi** — Örnek sorgular: son saatteki toplam API istekleri, API başına istekler, başarı oranı (%), API başına ortalama yanıt süresi (ms).

**Önbellek Performans Analizi** — Önbellek get işlemleri, isabet oranı (%), mevcut önbellek girişleri.

**JVM Analizi** — Bellek kullanımı (%), çöp toplama süresi.

## Grafana Dashboard'larının Oluşturulması

Grafana'da Prometheus'u veri kaynağı olarak ayarladıktan sonra:

**API Trafik Dashboard'u:** Türe göre istek hacmi, en çok kullanılan API'ler, işlem süresi dağılımı, istek/yanıt boyutu panelleri.

**Önbellek Performans Dashboard'u:** Önbellek işlemleri (get/put), isabet oranı, bellek kullanımı.

**Sistem Sağlık Dashboard'u:** JVM bellek kullanımı, CPU kullanımı, aktif iş parçacıkları.

Örnek PromQL ifadeleri: `sum(rate(apinizer_api_traffic_total_count_total[5m]))`, `topk(5, sum by (api_name) (increase(apinizer_api_traffic_total_count_tagged_total[5m])))` vb.

## Best Practices

1. **Metrik Saklama Süresi:** Prometheus'ta uygun saklama sürelerini yapılandırın (örn. `--storage.tsdb.retention.time=7d`). Daha uzun saklama için uzak depolama düşünün.

2. **Alarm Yapılandırması:** Kritik metrikler için Prometheus AlertManager veya Grafana'da alarm kurun (yüksek API hata oranı, yüksek bellek, yavaş yanıt süreleri).

3. **Dashboard Organizasyonu:** Gateway ve Cache için ayrı dashboard'lar, ilgili metrikleri gruplayın, namespace/pod/API'ye göre filtreleme değişkenleri kullanın.

4. **Etiket Kullanımı:** `api_name` ile API'ye göre filtreleme, namespace/pod analizi, ortamlar arası karşılaştırma.

## Sonuç

Apinizer'ı Prometheus ve Grafana ile entegre etmek, API yönetim altyapınız için güçlü izleme yetenekleri sağlar. Bu entegrasyon:

- Apinizer'ın kapsamlı metrik toplama özelliği
- Prometheus'un verimli zaman serisi veritabanı ve güçlü sorgu dili
- Grafana'nın esnek ve güzel görselleştirmeleri

ile her bileşenin güçlü yönlerinden yararlanır. Metrik toplamayı doğru yapılandırarak, bilgilendirici dashboard'lar ve alarmlar ile optimal performansı sağlayabilir, sorunları hızlıca tespit edebilir ve veri odaklı kararlar alabilirsiniz.

## Kaynaklar

- [Apinizer Dökümantasyonu](https://docs.apinizer.com/apinizer-dokumantasyonu/apinizer-metriklerinin-prometheus-ve-grafana-ya-entegre-edilmesi-126910789.html)
- [Prometheus Dokümantasyonu](https://prometheus.io/docs/introduction/overview/)
- [Grafana Dokümantasyonu](https://grafana.com/docs/)
