---
title: "Ortamlar"
description: "API Proxy çalışma zamanı yürütme bağlamı oluşturabilir ve ortam yönetimi gerçekleştirebilir. Üretim, geliştirme/test ve sandbox ortamları oluşturabilir, ortam erişim adreslerini yapılandırabilir ve Kubernetes namespace yönetimi yapabilir."
---

## Ortam (Environment) Nedir?

<Info>
Ortam, bir kuruluttaki API Proxy'leri (API Proxy) için bir çalışma zamanı yürütme bağlamıdır (Runtime Execution Context). Bir veya birden fazla API Proxy'e erişilebilmesi için ortama dağıtılması gerekir. Bir API Proxy tek bir ortama veya birden çok ortama dağıtılabilir.
</Info>

<Note>
Bir ortam, API Geçit'lerini çalıştırmak için sistem kaynağı olarak yalıtılmış, izole bir alan sağlar. Apinizer platformunda birden çok ortam oluşturulmasına izin verir.

Ortam yönetimi iki şekilde gerçekleştirilir:
- Gateway ve Cache Server'lar için gereken tüm Kubernetes tanımları API Manager ekranı üzerinden oluşturulur ve yönetilir
- API Manager ekranında mevcut Kubernetes tanımlarının sadece standart verileri kaydedilir
</Note>

## Ortam Rolleri

Bir ortam, **Üretim (Production)**, **Geliştirme/Test (Development/Test)** veya **Sandbox** olarak farklı rollerde oluşturulabilir.

Burada dikkat edilmesi gereken nokta, istemcinin API Proxy'e erişebilmesi için en az bir ortama dağıtılmış  olması gerekir.
<img
  src="/images/yonetici/ortam-rolleri.png"
  alt="Ortam Rolleri"
  width="800"
  height="500"
/>

<CardGroup cols={1}>
  <Card title="Test Environment" icon="flask">
    Test environment da etkin olan API Proxy'ler veya Uygulamalar'ı test etmek amaçlı kullanılır. Donanımdaki kaynakların yeterliliğini ölçmek için de test yapılabilir.

    Eğer test ortamından uzak bir ürün geliştirme yapılırsa ilerleme konusunda sorunlar yaşatabilir.
  </Card>
  <Card title="Sandbox Environment" icon="box">
    Sandbox ortamında etkin olan API Proxy'ler ve Uygulamalar, geliştirme (development) ve test etme sürecinde kullanılır. Bu ortam, production sürecini etkilemeden ve üretim sürecine yakın olarak güvenli test yapabilme imkanı sağlar.

    Ürünün production environment üzerindeki durumunu taklit ettiği için önemlidir. Mesela, ilgili API Proxy'e poliçe ekleyip production environment üzerinde erişim öncesinde test etmeyi kolaylaştırır.
     Böylelikle production environment'ın güvenliğini sağlar ve bir geliştiricinin (developer) yanlışlıkla canlıdaki (production) bir uygulamayı değiştirme riskini ortadan kaldırmasına yardımcı olur. Ayrıca uygulamanın çalıştığından emin olarak son kullanıcının erişmesi de sağlanır.

  </Card>
  <Warning>
  **Önemli Farklar:**

  - **Test environment ve sandbox environment** arasındaki farkın ne olduğu düşünülebilir. Ürün (API Proxy ya da Uygulama), geliştirme sürecinde test etmek için **test environment**, ürün bitmiş ve son kullanıcıya çıkmadan önce gerçek kullanıcıyı simüle etmek için **sandbox environment** üzerinde etkin hale getirilir
  - API Proxy'nin kullanım amacına göre ilgili roldeki ortama kurulum gerçekleştirir. Aynı API Proxy farklı amaçlar için farklı ortamlar üzerinde etkinleştirilebilir
  - Her bir environment diğerlerinden bağımsız olarak çalışır
  </Warning>
  <Card title="Production Environment" icon="rocket">
Production oratamında etkin olan API Proxy'ler veya Uygulamalar'a son kullanıcıların kullanımı için kullanılır. Bu ortam istemcilerin yükünü taşıyabilecek şekilde tasarlanmadır.

  </Card>
</CardGroup>

## Ortam Mimarisi

Ortam, birçok API'nin birden çok ekibe veya projeye yayıldığı ortamlarda kullanılmak üzere tasarlanmıştır. Apinizer'daki Ortam kavramı birebir kubernetes'deki namespace'e denk gelmektedir.

Apinizer'da oluşturduğunuz ve dağıttığınız  ortam kubernetes'de bir namespace olarak oluşturulmaktadır. Bir ortam içinde namespace, deployment (dağıtım), pod, replica set, service ve access URL (erişim adresi) bileşenleri bulunur.

Apinizer Platformu ile oluşturulan tüm ortamlar da Kubernetes kümesinin içinde yer alır.

<Note>
**Kubernetes Namespace Kavramı:**

Kubernetes kümeleri büyük miktarda bağlantısız iş yüklerini eş zamanlı olarak yönetebilir. Kubernetes, küme içindeki objelerin karmaşasını gidermek için namespace denilen bir kavram kullanır.

Namespace'ler objelerin birbirleriyle gruplanmasına ve bu grupların bir birim gibi filtrelenip kontrol edilmesine imkan sağlar. İster özelleştirilmiş erişim kontrol politikalarını uygulamak, ister bir test ortamı için tüm birimleri ayırmak için kullanılsın, namespace'ler objeleri bir grup olarak yönetmek için güçlü ve esnek bir yapıdır.

Namespace'ler küme içindeki obje isimleri için bir faaliyet alanı sağlar. Bir namespace içindeki isimler özgün olmalı iken, farklı namespace'lerde aynı isim kullanılabilir.

Detaylı bilgi için [Kubernetes Dokümantasyonu](https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/).
</Note>

## Ortam Bileşenleri

<AccordionGroup>
  <Accordion title="Namespace" icon="folder">
    Apinizer Platformundaki ortam kavramı, Kubernetes ortamındaki Namespace kavramına karşılık gelmektedir.
  </Accordion>

  <Accordion title="Log Server" icon="file-lines">
    Oluşturulan ortamdaki tüm API Trafiğinin ve isteklerin loglanacağı Elasticsearch kümesi bağlantı tanımıdır.
  </Accordion>

  <Accordion title="Deployment (Dağıtım)" icon="server">
    Gateway Engine (Worker Server) ve Cache Server olarak iki tane deployment tanımlanır:

    - **Worker Server:** Apinizer Platform'un çekirdek (core) modülüdür, tüm API isteklerinin BackendAPI'ye yönlendirilmesinden sorumludur ve Policy Enforcement Point olarak çalışır
    - **Cache Server:** Apinizer'da gerek duyulan Cache değerlerinin tutulduğu ortamdır
  </Accordion>

  <Accordion title="Service (Servis)" icon="network-wired">
    Environment Service (Ortam servisi), Environment Deployment'da yer alan Apinizer Worker pod'una erişebilmek için oluşturulur. Servis, tüm podlara gelen istekleri karşılayan katmandır. Konum olarak podların önünde yer alır.

    Servis bilgisi her ortam oluşturulduğunda tanımlanır. Fakat küme içindeki tüm Apinizer Worker'ların bir servis ile yönetilmesi önemlidir. Ayrıca Apinizer Platformu'nda servis portları da özgün olmalıdır. Varsayılan olarak NodePort kullanılmakta ve bunun haricindeki servis tipleri Apinizer tarafından desteklenmemektedir.
  </Accordion>

  <Accordion title="Access URL (Erişim Adresi)" icon="link">
    Access URL, Proxy'nin dış erişim adresidir. `https://<your-IP-address>` şeklinde belirtilir. Dışarıdan erişim adres bilgisi kullanılarak Proxy'lere mesaj gönderilebilir.
  </Accordion>
</AccordionGroup>

## Ortam Erişim Adresi

Bir API Proxy'e, dağıtıldığı ortamın erişim adresi üzerinden erişilebilir.

### Erişim Adresi Yapısı

Bir API Proxy'nin erişimi adresi şöyle olsun:

```
http://demo.apinizer.com/apigateway/myproxy
```

| Bileşen | Açıklama |
|---------|----------|
| `http://demo.apinizer.com/` | Ortam Erişim Adresi |
| `apigateway/` | Root Context |
| `myproxy` | API Proxy Relative Path |

### Erişim Adresi Yapılandırması

Ortam için tanımlanacak erişim adresi genelde, WAF veya Nginx gibi bir load balancer'da tanımlanan DNS adresidir. Apinizer'da tanımlanan ortamlar kubernetes'de bir namespace'e karşılık gelmektedir. Namespace içinde çalışan Apinizer Worker'larına erişim için Apinizer tarafından otomatik bir NodePort tipinde Kubernetes servisi oluşturulmaktadır. Ortam oluştururken Engine Service Port'a girilen değer ile bir servis oluşturulmaktadır.

### Örnek Servis Yapılandırması

Apinizer Worker'a erişmek için örnek bir servis bilgisi:

Eğer Engine Service Port değeri **30080** (default değerdir ve her ortam için farklı olmalıdır) ise, WAF'da veya Nginx sunucunuzdaki DNS tanımına aşağıdaki gibi belirtmek gerekir:

```bash
http://kubernetes-worker-node-IP:30080/
```


