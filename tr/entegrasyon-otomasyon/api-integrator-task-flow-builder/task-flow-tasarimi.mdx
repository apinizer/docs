---
title: "Görev Akışı (Task Flow)"
description: "Birden fazla görevi entegre ederek akış şeklinde çalıştırmayı sağlar. Birçok görev (task) bir işi yerine getirmek için entegre edilerek bir akış (flow) şeklinde çalıştırılabilir. Akışta, sırasıyla çalışan görevler kendi API'leri üzerinden entegre edilirler. Akıştaki her bir görev, kendinden önce çalışan görev çıktısını kullanabilir ve görevi bir kere ya da birden fazla çalıştırabilir. Görev akışları manuel olarak tetiklenebilir, zamanlayıcı ile otomatik çalıştırılabilir veya HTTP endpoint üzerinden tetiklenebilir."
---

## Görev Akışı Özellikleri

<CardGroup cols={2}>
  <Card title="Görev Çıktısı Kullanımı" icon="arrow-right">
    Kendinden önce çalışan görev çıktısını kullanabilir.
  </Card>
  
  <Card title="Çoklu Çalıştırma" icon="repeat">
    Görevi bir kere ya da birden fazla çalıştırabilir.
  </Card>
</CardGroup>

---

## Görev Akışı Oluşturma

<Steps>
    <Step title="Task Flows Sayfasına Git">
        Ekranınızda solda bulunan navigasyon çubuğundan **Development** sekmesi altında bulunan **API Integration** içerisindeki **Task Flows** sayfasına gidin.


            <img src="/images/gelistirici/api-integrator/task-flow1.png" alt="Task Flows Listesi" width="800" />
        
    </Step>

    <Step title="Yeni Görev Akışı Oluştur">
        Sağ üst köşede bulunan **Create** butonuna basarak yeni bir Görev Akışı (Task Flow) oluşturun.
    </Step>

    <Step title="Görev Akışını İsimlendir ve Kaydet">
        Görev akışını isimlendirerek **Save and Next** butonuyla görev akışını oluşturun.

        <img src="/images/gelistirici/api-integrator/task-flow2.png" alt="Görev Akışı Oluşturma Formu" width="800" />
    </Step>
</Steps>

### Oluşturma Formu Alanları

<CardGroup cols={2}>
  <Card title="Name" icon="tag">
    **Alan:** Name
    
    **Tip:** string
    
    **Zorunlu:** Evet
    
    Görev akışını tanımlayan benzersiz isim
  </Card>
  
  <Card title="Description" icon="file-lines">
    **Alan:** Description
    
    **Tip:** string
    
    **Zorunlu:** Hayır
    
    Görev akışının içeriğine dair bilgi metni (opsiyonel)
  </Card>
</CardGroup>

---

## Görev Akışı Konfigürasyonları

<img src="/images/gelistirici/api-integrator/task-flow3.png" alt="Görev Akışı Konfigürasyon Ekranı" width="800" />

### Konfigürasyon Alanları

<AccordionGroup>
  <Accordion title="Temel Bilgiler">
    <CardGroup cols={2}>
      <Card title="Ad (Name)" icon="tag">
        Görev akışının listede görünen adıdır. Zorunludur ve proje bazında eşsiz (unique) olmalıdır.
      </Card>
      
      <Card title="Açıklama (Description)" icon="file-lines">
        Görev akışına ilişkin açıklamadır.
      </Card>
    </CardGroup>
  </Accordion>
  
  <Accordion title="Durum ve İzleme">
    <CardGroup cols={2}>
      <Card title="Durum (Status)" icon="toggle-on">
        Görev akışının aktif/pasif olma durumunu ifade eder.
      </Card>
      
      <Card title="Trace Status" icon="bug">
        Trace (Debugging) özelliğinin açık/kapalı olma durumunu ifade eder.
      </Card>
    </CardGroup>
  </Accordion>
  
  <Accordion title="Tetikleme ve Görevler">
    <CardGroup cols={2}>
      <Card title="Trigger Every" icon="clock">
        Görev akışının ne sıklıkla otomatik olarak tetikleneceğini ifade eder.
      </Card>
      
      <Card title="Görevler (Tasks)" icon="list">
        Görev akışının içeriğinde tanımlanan görevler grafik üzerine gösterilir. Ekleme, silme ve konfigürasyon işlemleri buradan gerçekleştirilir.
      </Card>
      
      <Card title="Endpoint" icon="link">
        Görev akışının REST API endpoint'i üzerinden tetiklenme seçeneğidir.
      </Card>
      
      <Card title="Eylemler (Actions)" icon="gear">
        Tanımlanan görev akışının işleyişi sırasında bir hata olması halinde gerçekleştirilecek eylemleri ifade eder.
      </Card>
    </CardGroup>
  </Accordion>
</AccordionGroup>

---

## Tetiklenme Sıklığı Konfigürasyonu (Trigger Every)

Görev akışını belirli zamanlarda otomatik çalıştırmak için zamanlayıcı tanımlayabilirsiniz.

<Steps>
    <Step title="Trigger Configuration Penceresini Aç">
        Oluşturulan görev akışının ne sıklıkla tetiklenmesi gerektiğiyle ilgili konfigürasyon **Trigger Every** altındaki **Change** butonuna basınca açılan pencere üzerinden gerçekleştirilir.

        <img src="/images/gelistirici/api-integrator/task-flow4.png" alt="Trigger Configuration" width="800" />
    </Step>

    <Step title="Değer ve Birim Alanlarını Doldur">
        Zamanlayıcı konfigürasyonu tanımlanması için **Değer** ve **Birim** alanlarını doldurun.
        <img src="/images/gelistirici/api-integrator/task-flow5.png" alt="Görev Akışı Tanım Ayarları" width="800" />

        Kullanılabilir birimler:
        - **Minute** - Dakika
        - **Hour** - Saat
        - **Custom** - Özel Quartz Cron Expression
    </Step>
</Steps>

<Tip>
    Zamanlayıcı tanımında **Custom** seçeneği seçilerek istenilen Quartz Cron Expression ile zamanlama yapılabilir.
</Tip>

---

## Görev Akışı Tanım Ayarları

Görev akışı tanım ayarları, sağ üstte bulunan **Edit** butonu üzerinden açılan pencere aracılığıyla gerçekleştirilir.

<img src="/images/gelistirici/api-integrator/task-flow6.png" alt="Görev Akışı Tanım Ayarları" width="800" />

<img src="/images/gelistirici/api-integrator/task-flow7.png" alt="Görev Akışı Tanım Ayarları Detay" width="800" />

<CardGroup cols={2}>
  <Card title="Ad (Name)" icon="tag">
    Görev akışının listede görünen adıdır. Zorunludur ve proje bazında eşsiz (unique) olmalıdır.
  </Card>
  
  <Card title="Açıklama (Description)" icon="file-lines">
    Görev akışına ilişkin açıklamadır.
  </Card>
  
  <Card title="Durum (Status)" icon="toggle-on">
    Görev akışının aktif/pasif durumu.
  </Card>
  
  <Card title="Trace Status" icon="bug">
    Görev akışı adımlarını izleme durumu. Aktif (enabled) olduğunda çalışan adımlara ait verilerin loglarda gözükmesi sağlanırken, pasif (suspend) olduğunda detaylı loglama yapılmaz.
  </Card>
</CardGroup>

---

## Görev (Task) Ayarları

### Görev (Task) Nedir?

<Info>
    API Integration modülünde, her bir sistem ya da uygulama ile yapılan entegrasyon işlemine **görev (task)** denilmektedir. Apinizer, entegrasyonları mümkün mertebe API çağrıları ile yapmayı benimsediğinden API ile çağrılabilecek endpoint'lerin her biri için bir görev/bağlantı tipi tanımlamayı benimsemiştir.
</Info>

### Görev Tipleri

<CardGroup cols={3}>
    <Card title="E-Posta Gönderme" icon="envelope" href="/gelistirici/api-integrator/email-task">
        E-posta gönderimi için kullanılır
    </Card>

    <Card title="API Çağrısı (API Call)" icon="globe" href="/gelistirici/api-integrator/api-call-task">
        Harici API'lere istek göndermek için kullanılır
    </Card>

    <Card title="Veritabanı Connector" icon="database" href="/gelistirici/api-integrator/database-task">
        Veritabanı işlemleri için kullanılır
    </Card>

    <Card title="Linux Script Çalıştırma" icon="terminal" href="/gelistirici/api-integrator/linux-script-task">
        Linux komutları çalıştırmak için kullanılır
    </Card>

    <Card title="Script (JS/Groovy)" icon="code" href="/gelistirici/api-integrator/script-task">
        JavaScript veya Groovy script çalıştırmak için kullanılır
    </Card>

    <Card title="Bildirim" icon="bell" href="/gelistirici/api-integrator/notification-task">
        Bildirim göndermek için kullanılır
    </Card>

    <Card title="SNMP" icon="network-wired" href="/gelistirici/api-integrator/snmp-task">
        SNMP protokolü işlemleri için kullanılır
    </Card>
</CardGroup>

---

## Görev Tanımlama

<Steps>
    <Step title="Görev Ekleme Butonuna Tıkla">
        Sırasıyla çalışan işlemleri (transactions) tanımlama arayüzü üzerinden yönetilir. Yeni bir görev tanımlamak için **Tasks** (görevler) altında bulunan şema üzerinde **+** butonuna basılır.

        <img src="/images/gelistirici/api-integrator/task-flow8.png" alt="Görev Ekleme" width="800" />
    </Step>

    <Step title="Görev Tipini Seç">

        Görev seçim ekranı:

        <img src="/images/gelistirici/api-integrator/task-flow9.png" alt="Görev Seçimi" width="800" />
        Hangi görev eklenmek isteniyorsa o görev seçilerek görev tanımlama işlemine devam edilir.
        <img src="/images/gelistirici/api-integrator/task-flow10.png" alt="Görev Seçimi" width="800" />
    </Step>

    <Step title="Görev Detaylarını Yapılandır">
        <Info>
            Örnek olması açısından bu belge içerisinde API Çağrısı (API Call) örneği üzerinden anlatım gerçekleştirilecektir.
        </Info>
        Aşağıdaki ekran görüntüsünde görevin çalışma adımlarının tanımlandığı pencere ekranını görebilirsiniz.

        <img src="/images/gelistirici/api-integrator/task-flow11.png" alt="API Call Konfigürasyonu" width="800" />
        <img src="/images/gelistirici/api-integrator/task-flow12.png" alt="API Call Konfigürasyonu" width="800" />
    </Step>
</Steps>

---

## Görevler Arası Veri Aktarımı

<Info>
    Görev akışı (Task Flow) içerisindeki görevlerde bir önceki görevin çıktısı sonraki görevlerin girdisi olarak kullanılabilir. Api Call'ın (Api Çağrısı) çıktısını kendisinden sonra eklenen Script politikasının girdisi olarak nasıl kullanılacağı aşağıdaki ekran görüntülerinde mevcuttur.
</Info>

<img src="/images/gelistirici/api-integrator/task-flow13.png" alt="Veri Aktarımı" width="800" />

### Output Key Kullanımı

API Call görevinin çıktısını kendisinden sonra eklenen Script politikasının girdisi olarak kullanabilirsiniz:

<img src="/images/gelistirici/api-integrator/task-flow14.png" alt="Output Key Kullanımı" width="800" />

Kendinden önceki bir API Call görevinin çıktısına Script görevi içerisinde API Call görevi tanımlanırken belirtilen değişken üzerinden menü butonu içerisinden erişebilirsiniz.

<img src="/images/gelistirici/api-integrator/task-flow15.png" alt="Script Değişken Erişimi" width="800" />

<Warning>
    Bir önceki görevin çıktısını mevcut görev içerisinde kullanmak için değişkenin çift süslü parantez içerisinde sonunda diyez (#) işareti bulunacak şekilde kullanmak gerekmektedir.

    **Örnek:** `{{myOutputKey#}}`
</Warning>

Aşağıdaki ekran görüntüsünde görüldüğü üzere Api Call görevinin çıktı değişkeni içinden, JsonPath/XPath Syntax içerisinde filtreleme işlemi gerçekleştirilerek ihtiyaç duyulan veri alınmıştır. Alınan bu veri Script görevi içerisinde LOOP_VARIABLE değişkeni olarak kullanılabilir.

<img src="/images/gelistirici/api-integrator/task-flow16.png" alt="Değişken Kullanımı" width="800" />

<Warning>
    Değişkenlerin sonundaki # işareti JsonPath/XPath'i temsil etmektedir. JsonPath'de bulunan $ operatörüne karşılık gelmektedir. Bu syntax Apinizer'a özgü bir Syntax'tır. Bu Syntax'ın detaylı kullanımı için aşağıda bulunan Görevlerdeki Ortak Alanlar tablosunu inceleyebilirsiniz.
</Warning>

Script görevinin bir sonraki adımda tanımlanacak göreve veri aktarabilmesi ise resultMap nesnesi ve script görevinin tanımlandığı form arayüzündeki değişken değeri üzerinden gerçekleştirilir.

<img src="/images/gelistirici/api-integrator/task-flow17.png" alt="Değişken Kullanımı" width="800" />

Görev akışının gerçekleştireceği görevler tanımlandıktan sonra **Execute** butonundan görev bir kere manuel tetiklenir. Görevin çalıştırılmış hali ve çıktılarına ulaşmak için ise **Details** butonuna tıklanarak görev akışının çalışma log kayıtlarına ulaşılır.

---

## Görev Akışı Detaylarını Görme

<Steps>
    <Step title="Detaylar Menüsünü Aç">
        Görev akışı listesinden detayına gidilmek istenen kaydın en sağdaki kolonunda bulunan menü tuşuna tıklayıp **Details** seçilerek loglara bakılabilir.

        <img src="/images/gelistirici/api-integrator/task-flow18.png" alt="Detaylar Menüsü" width="800" />
    </Step>

    <Step title="Log Kayıtlarını İncele">
        Görev Akışının log detayını içeren ekrana ulaşılır.

        <img src="/images/gelistirici/api-integrator/task-flow19.png" alt="Log Detayları" width="800" />
    </Step>

    <Step title="Çalışma Detaylarını Görüntüle">
        Görev akışının çalışma detaylarını incelemek için ilgili çalışma anı log kaydının yanındaki üç nokta butonuna basılır.

        <img src="/images/gelistirici/api-integrator/task-flow20.png" alt="Çalışma Detayları" width="800" />
    </Step>

    <Step title="Task Log Details">
        Görev akışı içerisindeki her bir görevin detaylı çalışma logu ve çıktılarına ulaşmak için **Task Log Details** seçilir.

        <img src="/images/gelistirici/api-integrator/task-flow21.png" alt="Task Log Details" width="800" />
    </Step>

    <Step title="Görev Çıktılarını Görüntüle">
        Açılan pencere üzerinden görev akışı içerisinde tanımlı her bir görevin çalışma logları görüntülenir. İlgili log kaydının yanında bulunan üç nokta butonuna basılarak log detayları ve görevin çıktıları görüntülenebilir.

        <img src="/images/gelistirici/api-integrator/task-flow22.png" alt="Görev Çıktıları" width="800" />

        <img src="/images/gelistirici/api-integrator/task-flow23.png" alt="Görev Çıktıları Detay" width="800" />

        API Call görevinin çıktısı:

        <img src="/images/gelistirici/api-integrator/task-flow24.png" alt="API Call Görev Çıktısı" width="800" />



    </Step>
</Steps>

<Warning>
    Görevlerin çıktı verilerini görebilmek için **Görev Akışı Tanım Ayarları** içerisindeki **Trace** seçeneği aktif olmak zorundadır. Aksi taktirde görevlerin ürettikleri sonuçlar log detay ekranında görüntülenmez.
</Warning>

---

## Görevlerdeki Ortak Alanlar

Görev oluşturulurken her tip için aynı olan bazı girdi ve çıktı alanları bulunur. Görevlerdeki ortak bilgilerin konfigürasyonu için kullanılan alanlar aşağıdaki tabloda görülmektedir.

### Ortak Alan Açıklamaları

| Alan | Açıklama |
|------|----------|
| **Bu Görevi Çalıştır (Execute This Task For)** | Bir önceki görevden üretilen sonucun, mevcut görev içinde nasıl çalıştırılacağı tipi seçilir. **Bir Kere (Once):** Mevcut görev bir kere çalıştırılır. **Döngü (Loop):** Mevcut görev önceki görevden aldığı sonuç üzerinde belirtilecek olan tanımlama ile döngü şeklinde çalıştırılır. |
| **JSON Path/XPath Söz Dizimi** | Bu seçenek, görev çalışma tipi Döngü olarak seçildiyse aktifleşir. JSON Path/XPath ile verilen değerin sonucu döngü olarak çalıştırılır. |
| **İşlem başarısız olursa devam etsin** | Bu seçenek, görev çalışma tipi Döngü olarak seçildiyse aktifleşir. Döngüdeki eylemler yürütülürken bir hata meydana gelirse, görevin çalışmasına devam etme ya da hemen durdurulması gerektiği işlemi yönetilir. |
| **Çıktı Anahtarları Liste butonu (Output Keys)** | Önceki görevlerde oluşturulan çıktı anahtarının listesi görülür. Böylelikle görev tanımı girdilerinde buradaki çıktı anahtarı kullanılabilir. |
| **Çıktı Anahtar (Output Key)** | Görev çalıştırıldığında oluşacak olan değerin atanacağı, değişken adı girilir. Bu görevden sonraki görevler, eğer bu görevin çıktısıyla işlem yapmak isterlerse bu alana girilen çıktı anahtarını kullanacaklardır. |
| **Ad (Name)** | Görevin adı yazılır. Bu bilgi, `{{taskflow.name}}` değişkeninin değeri olarak atanmaktadır. |
| **Açıklama (Description)** | Görevin açıklaması yazılır. |

<Warning>
    - Çıktı anahtarında boşluk bırakılmamalıdır.
    - Tanımlanan akışta çıktı anahtar isimleri tekil olmalıdır.
</Warning>

### Apinizer Söz Dizimi

Bu alandaki kritik nokta değerin **Apinizer'ın söz dizimine** uygun yazılmasıdır. Bu kuralda dikkat edilmesi gereken 2 unsur vardır.

<Tabs>
    <Tab title="Söz Dizimi 1: Veriyi Sorgulama">
        Söz dizilimi kuralları:
        - 2 tane süslü parantez ile açılıp kapanmalıdır
        - Söz diziminin ilk bölümünde önceki görevin output anahtar adı verilir. Sonuna `#` işareti konulur
        - Söz diziminin ikinci bölümünde output değerinin içinden alınacak değerin, veri tipine ait sorgulama diliyle (JSONPath, XPath) yazılmasıdır

        **Formül:**
        ```
        {{onceki-gorev-output-adi#<bu-kisim-ya-JSONPath-ya-da-Xpath-formatinda-yazilir>}}
        ```

        **Örnek:**
        Önceki görevlerden birinde `centralRates` adında bir sonuç üretilmektedir. Sonucun değerleri Merkez Bankasına ait kur bilgilerini içermektedir. Bu sonucun içerdiği dizideki elemanları tek tek almak için XPath ile `/Date/Currency` sorgusu yazılmıştır.

        ```
        {{centralRates#/Date/Currency}}
        ```
    </Tab>

    <Tab title="Söz Dizimi 2: Döngüdeki Veriyi Kullanma">
        Söz dizimi ile veriden alınan elemanlar, görev içinde (mail gönderirken, veri tabanı ile işlem yaparken, script yazarken vs.) kullanılabilir. Kullanabilmek için de `LOOP_VARIABLE` adındaki değişken anahtarı ile referans verilmelidir.

        **Formül:**
        ```
        {{LOOP_VARIABLE#<bu-kisim-ya-JSONPath-ya-da-Xpath-formatinda-yazilir>}}
        ```

        **Örnek:**
        ```
        {{LOOP_VARIABLE#/Currency/Name/text()}}
        ```
    </Tab>
</Tabs>

---

## Görev Akışını Tetikleme

Görev akışı üç farklı şekilde tetiklenebilir:

<Tabs>
    <Tab title="Manuel Tetikleme">
        Sağ üst köşede bulunan işaretli **Execute** butonuna her tıklandığında görev akışı tetiklenir.

        <img src="/images/gelistirici/api-integrator/task-flow25.png" alt="Manuel Tetikleme" width="800" />
    </Tab>

    <Tab title="Otomatik Tetikleme">
        Görev akışının tetiklenme sıklığı (**Trigger Every**) değeri baz alınarak Apinizer Entegratör tarafından otomatik olarak görev akışı belirtilen sıklıkta tetiklenir.

        <img src="/images/gelistirici/api-integrator/task-flow26.png" alt="Otomatik Tetikleme" width="800" />
    </Tab>

    <Tab title="Endpoint Üzerinden Tetikleme">
        Endpoint seçeneği aktif edilmesi durumunda görev akışı için özel oluşturulan erişim URL'i üzerinden yapılan her istekte görev akışı tetiklenir.

        <img src="/images/gelistirici/api-integrator/task-flow27.png" alt="Endpoint Tetikleme" width="800" />

        <Warning>
            Görev akışının erişim URL'i üzerinden tetiklenebilmesi için kullanıcı token'ını **Authorization** header'ına ekleyerek istek atmak gerekmektedir.

            Token oluşturmak için: **Sağ üstten Profil menüsü > Profilim** içerisinden giriş yapan kullanıcı ile token oluşturulabilir.
        </Warning>

        <Note>
            Endpoint üzerinden görev akışının tetiklenebilmesi için Endpoint seçeneğinin aktif ve entegratör sunucunuzun durumunun ulaşılabilir olması gerekmektedir.
        </Note>
    </Tab>
</Tabs>

---

## Görev Akışını Silme

Görev akışı listesinde silinmek istenen kaydın en sağdaki kolonunda bulunan menü tuşuna tıklayıp **Delete** seçilerek kayıt silinir.

<img src="/images/gelistirici/api-integrator/task-flow28.png" alt="Görev Akışını Silme" width="800" />

---

## Endpoint Konfigürasyonu

<Info>
    Görev akışları zamanlayıcı ile ya da execute butonu ile manuel tetiklenmekle beraber görev akışı oluşturulduğu an görev akışı için özel ve benzersiz olarak oluşturulan endpoint üzerinden HTTP istekleriyle de tetiklenebilir.
</Info>

<Steps>
    <Step title="Endpoint Seçeneğini Aktifleştir">
        Görev akışı düzenleme arayüzünden endpoint seçeneği aktif hale getirilmelidir.
    </Step>

    <Step title="Endpoint URL'ini Kullan">
        Endpoint seçeneği aktif hale getirildikten sonra görüntülenen URL'e istek atarak görev akışının tetiklenmesi sağlanabilir.

        <img src="/images/gelistirici/api-integrator/task-flow29.png" alt="Endpoint URL" width="800" />
    </Step>

    <Step title="Token Oluştur">
        Görev akışının erişim URL'i üzerinden tetiklenebilmesi için kullanıcı token'ını **Authorization** header'ına ekleyerek istek atmak gerekmektedir.

        Token oluşturmak için: **Sağ üstten Profil menüsü > Profilim** içerisinden giriş yapan kullanıcı ile token oluşturulabilir.
    </Step>
</Steps>

---

## Eylemler (Actions) Konfigürasyonu

### Eylem (Action) Nedir?

<Info>
    Eylem (Action), görev akışı (task flow) çalışma anında bir hata oluşması durumunda gerçekleştirilecek işlemleri ifade eder.
</Info>

<Steps>
    <Step title="Eylem Ekleme">
        **Eylemler (Actions)** bölümünden **+** butonuna basılarak olası bir hata durumunda gerçekleşmesi istenen görevleri tanımlayabilirsiniz.

        <img src="/images/gelistirici/api-integrator/task-flow30.png" alt="Eylem Ekleme" width="800" />
    </Step>

    <Step title="Eylem Tipini Seç">
        Açılan pencere üzerinden görev akışında olası bir hatayla karşılaşılması durumunda bir görev tanımlayarak hata durumlarından haberdar olabilir veya hata durumları için özel işlemler gerçekleştirebilirsiniz.

        <img src="/images/gelistirici/api-integrator/task-flow31.png" alt="Eylem Tipi Seçimi" width="800" />
    </Step>
</Steps>

<Tip>
    Örneğin, görev akışı başarısız olduğunda e-posta göndermek veya bir API çağrısı yapmak için eylem tanımlayabilirsiniz.
</Tip>