---
title: "Condition-based Policy Execution"
description: 'Koşullu politika çalıştırma, politikaların belirli koşullara göre çalıştırılmasını sağlar'
---

Condition-based Policy Execution (Koşullu Politika Çalıştırma), politikaların belirli koşullara göre çalıştırılmasını sağlayan bir özelliktir. Bu özellik sayesinde, mesaj içeriğine, header değerlerine, query parametrelerine veya diğer faktörlere göre farklı politikalar uygulanabilir.

## Condition-based Policy Execution Kavramı

Koşullu politika çalıştırma, IF-THEN-ELSE yapısı kullanarak politikaların koşullara bağlı olarak çalıştırılmasını sağlar:

```
IF (condition) THEN
  └─ Policy A
ELSE IF (condition) THEN
  └─ Policy B
ELSE
  └─ Policy C
```

## Koşul Türleri

### Mesaj İçeriği Koşulları

Mesaj içeriğine göre koşullar:

<CardGroup cols={2}>
  <Card title="JSONPath Expression" icon="code">
    JSON mesajlarında:
    ```
    $.user.role == "admin"
    $.products[*].price > 100
    ```
  </Card>
  <Card title="XPath Expression" icon="file-code">
    XML mesajlarında:
    ```
    /user/role = "admin"
    //product[@price > 100]
    ```
  </Card>
  <Card title="Header Değerleri" icon="file-lines">
    HTTP header'larına göre:
    ```
    request.header["Content-Type"] == "application/json"
    request.header["X-API-Version"] == "v2"
    ```
  </Card>
  <Card title="Query Parametreleri" icon="link">
    Query parametrelerine göre:
    ```
    request.query["version"] == "v2"
    request.query["format"] == "json"
    ```
  </Card>
</CardGroup>

### İstemci Koşulları

İstemci bilgilerine göre koşullar:

<AccordionGroup>
  <Accordion title="IP Adresi">
    * IP whitelist kontrolü
    * IP blacklist kontrolü
    * GeoIP bazlı kontrol
    ```
    request.client.ip in ["192.168.1.0/24"]
    ```
  </Accordion>
  
  <Accordion title="User Agent">
    * Browser kontrolü
    * Mobile device kontrolü
    ```
    request.header["User-Agent"] contains "Mobile"
    ```
  </Accordion>
  
  <Accordion title="API Key">
    * API Key değerine göre
    * API Key tipine göre
    ```
    request.header["X-API-Key"] == "premium-key"
    ```
  </Accordion>
  
  <Accordion title="Credential">
    * Kullanıcı bilgilerine göre
    * Role bazlı kontrol
    ```
    context.user.role == "admin"
    ```
  </Accordion>
</AccordionGroup>

### Zaman Koşulları

Zaman bazlı koşullar:

<CardGroup cols={2}>
  <Card title="Tarih Aralığı" icon="calendar">
    ```
    current.date >= "2024-01-01" AND
    current.date <= "2024-12-31"
    ```
  </Card>
  <Card title="Saat Aralığı" icon="clock">
    ```
    current.time >= "09:00" AND
    current.time <= "17:00"
    ```
  </Card>
  <Card title="Gün Bazlı" icon="calendar-days">
    ```
    current.day == "Monday"
    current.day in ["Monday", "Friday"]
    ```
  </Card>
  <Card title="Zaman Dilimi" icon="globe">
    ```
    current.timezone == "Europe/Istanbul"
    ```
  </Card>
</CardGroup>

### Sistem Koşulları

Sistem değişkenlerine göre koşullar:

<AccordionGroup>
  <Accordion title="Environment Variable">
    Ortam değişkenlerine göre:
    ```
    ${ENVIRONMENT} == "production"
    ${FEATURE_FLAG} == "enabled"
    ```
  </Accordion>
  
  <Accordion title="System Property">
    Sistem özelliklerine göre:
    ```
    system.property["app.version"] == "2.0"
    ```
  </Accordion>
  
  <Accordion title="Cache Değeri">
    Cache'deki değerlere göre:
    ```
    cache.get("user.status") == "active"
    ```
  </Accordion>
</AccordionGroup>

## Koşul Operatörleri

Koşullarda kullanılabilecek operatörler:

| Operatör | Açıklama | Örnek |
|----------|----------|-------|
| `==` | Eşitlik | `value == "test"` |
| `!=` | Eşitsizlik | `value != "test"` |
| `>` | Büyüktür | `value > 100` |
| `<` | Küçüktür | `value < 100` |
| `>=` | Büyük eşit | `value >= 100` |
| `<=` | Küçük eşit | `value <= 100` |
| `in` | İçinde | `value in ["a", "b", "c"]` |
| `not in` | İçinde değil | `value not in ["a", "b"]` |
| `contains` | İçerir | `value contains "test"` |
| `startsWith` | İle başlar | `value startsWith "test"` |
| `endsWith` | İle biter | `value endsWith "test"` |
| `matches` | Regex eşleşme | `value matches "^[0-9]+$"` |

## Koşul Örnekleri

### Örnek 1: Content-Type Bazlı Validation

```
IF request.header["Content-Type"] == "application/json" THEN
  └─ JSON Schema Validation Policy
ELSE IF request.header["Content-Type"] == "application/xml" THEN
  └─ XML Schema Validation Policy
ELSE
  └─ Reject Request (400 Bad Request)
```

### Örnek 2: API Version Bazlı Routing

```
IF request.query["version"] == "v1" THEN
  └─ Route to Backend v1
ELSE IF request.query["version"] == "v2" THEN
  └─ Route to Backend v2
ELSE
  └─ Route to Default Backend
```

### Örnek 3: User Role Bazlı Authorization

```
IF context.user.role == "admin" THEN
  └─ Allow All Operations
ELSE IF context.user.role == "user" THEN
  └─ Rate Limiting Policy (100 req/min)
ELSE
  └─ Reject Request (403 Forbidden)
```

### Örnek 4: IP Bazlı Rate Limiting

```
IF request.client.ip in ["192.168.1.0/24"] THEN
  └─ Rate Limiting Policy (1000 req/min)
ELSE
  └─ Rate Limiting Policy (100 req/min)
```

### Örnek 5: Time-based Access Control

```
IF current.time >= "09:00" AND current.time <= "17:00" THEN
  └─ Allow Request
ELSE
  └─ Reject Request (503 Service Unavailable)
```

## Koşul Kombinasyonları

Koşullar mantıksal operatörlerle birleştirilebilir:

### AND Operatörü

```
IF condition1 AND condition2 THEN
  └─ Policy A
```

**Örnek:**
```
IF request.header["Content-Type"] == "application/json" 
   AND request.header["X-API-Key"] == "premium-key" THEN
  └─ Premium JSON Processing Policy
```

### OR Operatörü

```
IF condition1 OR condition2 THEN
  └─ Policy A
```

**Örnek:**
```
IF request.client.ip in ["192.168.1.0/24"] 
   OR request.header["X-API-Key"] == "internal-key" THEN
  └─ Internal Access Policy
```

### NOT Operatörü

```
IF NOT condition THEN
  └─ Policy A
```

**Örnek:**
```
IF NOT request.client.ip in ["10.0.0.0/8"] THEN
  └─ External Access Rate Limiting
```

## Koşullu Politika Best Practices

<CardGroup cols={2}>
  <Card title="Koşul Sıralaması" icon="list-ol">
    * En spesifik koşulları önce yazın
    * Genel koşulları en sona bırakın
    * ELSE bloğunu mutlaka kullanın
  </Card>
  <Card title="Performans" icon="gauge">
    * Basit koşulları önce kontrol edin
    * Ağır işlemleri sona bırakın
    * Cache kullanımını değerlendirin
  </Card>
  <Card title="Okunabilirlik" icon="book">
    * Koşulları açıklayıcı isimlerle adlandırın
    * Karmaşık koşulları bölün
    * Dokümantasyon ekleyin
  </Card>
  <Card title="Test" icon="flask">
    * Tüm koşul dallarını test edin
    * Edge case'leri test edin
    * Performans testi yapın
  </Card>
</CardGroup>

## Sonraki Adımlar

<CardGroup cols={2}>
  <Card title="Message Flow & Policy Pipeline" icon="diagram-project" href="/tr/apinizer-anlama/temel-kavramlar/message-processing">
    Message Flow ve Policy Pipeline kavramını öğrenin
  </Card>
  <Card title="API Proxy'de Mesaja Politikalar Uygulanması" icon="shield" href="/tr/apinizer-anlama/temel-kavramlar/api-proxy-mesaja-politikalar-uygulanmasi">
    Politika uygulama sürecini öğrenin
  </Card>
  <Card title="Request, Response ve Error Pipelines" icon="arrows-rotate" href="/tr/apinizer-anlama/temel-kavramlar/request-response-error-pipelines">
    Pipeline'ları öğrenin
  </Card>
  <Card title="Conditional Policies" icon="code-branch" href="/tr/gelistirici/politika-yonetimi/development-tab/conditional-policies">
    Koşullu politika yapılandırması
  </Card>
</CardGroup>

