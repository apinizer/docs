---
title: "Koşullu Politika Çalıştırma"
description: "Koşullu politika çalıştırma, politikaların belirli koşullara göre çalıştırılmasını sağlar. Apinizer'da koşullar kod yazmadan, değişkenler (variables) ve form verileri kullanılarak oluşturulur. Mesaj içeriğine, header değerlerine, query parametrelerine veya diğer faktörlere göre farklı politikalar uygulanabilir."
---

## Koşullu Politika Çalıştırma Kavramı

Koşullu politika çalıştırma, politikaların belirli koşullara göre çalıştırılmasını sağlar. Apinizer'da koşullar kod yazmadan, **değişkenler (variables) ve form verileri** kullanılarak oluşturulur.

### Form Tabanlı Koşul Oluşturma

Koşullu politika oluştururken:

1. **Değişken Seçimi**: İlk değişkeni seçersiniz - bu değişken header, query parametresi, mesaj içeriği (JSONPath/XPath), context değeri veya özel bir değişken olabilir.
2. **Operatör Seçimi**: Karşılaştırma operatörünü dropdown menüden seçersiniz (eşitlik, büyüktür, içerir, vb.).
3. **Değer Kaynağı**: İkinci değerin kaynağını belirlersiniz:
   - **Sabit Değer**: Sabit bir değer girersiniz
   - **Değişken**: Başka bir değişken seçersiniz
4. **Nested Koşullar**: Karmaşık mantık için alt koşullar ekleyerek AND, OR, NOT operatörleriyle koşulları birleştirirsiniz.

Bu yaklaşım sayesinde kod yazmadan, form alanlarını doldurarak ve değişkenleri seçerek koşullu politikalar oluşturabilirsiniz.

## Koşul Türleri

### Mesaj İçeriği Koşulları

Mesaj içeriğine göre koşullar:

<CardGroup cols={2}>
  <Card title="JSONPath Expression" icon="code">
    JSON mesajlarında:
    ```
    $.user.role == "admin"
    $.products[*].price > 100
    ```
  </Card>
  <Card title="XPath Expression" icon="file-code">
    XML mesajlarında:
    ```
    /user/role = "admin"
    //product[@price > 100]
    ```
  </Card>
  <Card title="Header Değerleri" icon="file-lines">
    HTTP header'larına göre:
    ```
    request.header["Content-Type"] == "application/json"
    request.header["X-API-Version"] == "v2"
    ```
  </Card>
  <Card title="Query Parametreleri" icon="link">
    Query parametrelerine göre:
    ```
    request.query["version"] == "v2"
    request.query["format"] == "json"
    ```
  </Card>
</CardGroup>

### İstemci Koşulları

İstemci bilgilerine göre koşullar:

<AccordionGroup>
  <Accordion title="IP Adresi">
    * IP whitelist kontrolü
    * IP blacklist kontrolü
    * GeoIP bazlı kontrol
    ```
    request.client.ip in ["192.168.1.0/24"]
    ```
  </Accordion>
  
  <Accordion title="User Agent">
    * Browser kontrolü
    * Mobile device kontrolü
    ```
    request.header["User-Agent"] contains "Mobile"
    ```
  </Accordion>
  
  <Accordion title="API Key">
    * API Key değerine göre
    * API Key tipine göre
    ```
    request.header["X-API-Key"] == "premium-key"
    ```
  </Accordion>
  
  <Accordion title="Credential">
    * Kullanıcı bilgilerine göre
    * Role bazlı kontrol
    ```
    context.user.role == "admin"
    ```
  </Accordion>
</AccordionGroup>

### Zaman Koşulları

Zaman bazlı koşullar:

<CardGroup cols={2}>
  <Card title="Tarih Aralığı" icon="calendar">
    ```
    current.date >= "2024-01-01" AND
    current.date <= "2024-12-31"
    ```
  </Card>
  <Card title="Saat Aralığı" icon="clock">
    ```
    current.time >= "09:00" AND
    current.time <= "17:00"
    ```
  </Card>
  <Card title="Gün Bazlı" icon="calendar-days">
    ```
    current.day == "Monday"
    current.day in ["Monday", "Friday"]
    ```
  </Card>
  <Card title="Zaman Dilimi" icon="globe">
    ```
    current.timezone == "Europe/Istanbul"
    ```
  </Card>
</CardGroup>

### Sistem Koşulları

Sistem değişkenlerine göre koşullar:

<AccordionGroup>
  <Accordion title="Environment Variable">
    Ortam değişkenlerine göre:
    ```
    ${ENVIRONMENT} == "production"
    ${FEATURE_FLAG} == "enabled"
    ```
  </Accordion>
  
  <Accordion title="System Property">
    Sistem özelliklerine göre:
    ```
    system.property["app.version"] == "2.0"
    ```
  </Accordion>
  
  <Accordion title="Cache Değeri">
    Cache'deki değerlere göre:
    ```
    cache.get("user.status") == "active"
    ```
  </Accordion>
</AccordionGroup>

## Koşul Operatörleri

Koşullarda kullanılabilecek operatörler:

| Operatör | Açıklama | Örnek |
|----------|----------|-------|
| `==` | Eşitlik | `value == "test"` |
| `!=` | Eşitsizlik | `value != "test"` |
| `>` | Büyüktür | `value > 100` |
| `<` | Küçüktür | `value < 100` |
| `>=` | Büyük eşit | `value >= 100` |
| `<=` | Küçük eşit | `value <= 100` |
| `in` | İçinde | `value in ["a", "b", "c"]` |
| `not in` | İçinde değil | `value not in ["a", "b"]` |
| `contains` | İçerir | `value contains "test"` |
| `startsWith` | İle başlar | `value startsWith "test"` |
| `endsWith` | İle biter | `value endsWith "test"` |
| `matches` | Regex eşleşme | `value matches "^[0-9]+$"` |

## Koşul Oluşturma Örnekleri

Aşağıdaki örneklerde, form tabanlı yaklaşımla koşulların nasıl oluşturulduğu gösterilmektedir:

### Örnek 1: Content-Type Bazlı Validation

**Senaryo**: Content-Type header'ına göre farklı validation politikaları uygulanacak.

**Form Yapılandırması**:
- **İlk Değişken**: Header değişkeni seçilir → `Content-Type`
- **Operatör**: Eşitlik seçilir
- **Değer Kaynağı**: Sabit değer seçilir
- **İkinci Değer**: `application/json` girilir

**Sonuç**: Content-Type `application/json` ise JSON Schema Validation Policy çalışır.

**Alternatif Koşul** (alt koşul):
- İlk koşul: Content-Type `application/xml` ise → XML Schema Validation Policy
- Diğer durumlar: Diğer tüm durumlar → Reject Request (400 Bad Request)

### Örnek 2: API Version Bazlı Routing

**Senaryo**: Query parametresindeki version değerine göre farklı backend'lere yönlendirme yapılacak.

**Form Yapılandırması**:
- **İlk Değişken**: Query parametre değişkeni seçilir → `version`
- **Operatör**: Eşitlik seçilir
- **Değer Kaynağı**: Sabit değer seçilir
- **İkinci Değer**: `v1` girilir

**Sonuç**: Version `v1` ise Backend v1'e route edilir.

**Alternatif Koşullar**:
- Version `v2` ise → Backend v2'ye route
- Diğer durumlar → Default Backend'e route

### Örnek 3: User Role Bazlı Authorization

**Senaryo**: Kullanıcı rolüne göre farklı politika uygulanacak.

**Form Yapılandırması**:
- **İlk Değişken**: Context değeri seçilir → `context.user.role`
- **Operatör**: Eşitlik seçilir
- **Değer Kaynağı**: Sabit değer seçilir
- **İkinci Değer**: `admin` girilir

**Sonuç**: Role `admin` ise tüm işlemlere izin verilir.

**Alternatif Koşullar**:
- Role `user` ise → Rate Limiting Policy (100 req/min)
- Diğer durumlar → Reject Request (403 Forbidden)

### Örnek 4: IP Bazlı Rate Limiting

**Senaryo**: IP adresine göre farklı rate limit değerleri uygulanacak.

**Form Yapılandırması**:
- **İlk Değişken**: Client IP değişkeni seçilir → `request.client.ip`
- **Operatör**: İçinde seçilir
- **Değer Kaynağı**: Sabit değer seçilir
- **İkinci Değer**: `["192.168.1.0/24"]` girilir

**Sonuç**: IP belirtilen aralıkta ise Rate Limiting Policy (1000 req/min) uygulanır.

**Alternatif Koşul**:
- Diğer durumlar → Rate Limiting Policy (100 req/min)

### Örnek 5: Time-based Access Control (Alt Koşullar)

**Senaryo**: Çalışma saatleri içinde erişim izni verilecek.

**Form Yapılandırması** (Alt koşullarla AND mantığı):
- **Ana Koşul**: AND seçilir
- **İlk Alt Koşul**:
  - Değişken: `current.time`
  - Operatör: Büyük eşit
  - Değer: `09:00`
- **İkinci Alt Koşul**:
  - Değişken: `current.time`
  - Operatör: Küçük eşit
  - Değer: `17:00`

**Sonuç**: Saat 09:00-17:00 arası ise istek kabul edilir, aksi halde reddedilir (503 Service Unavailable).

## Nested Koşullar (Koşul Kombinasyonları)

Karmaşık mantık için nested koşullar oluşturabilirsiniz. Form tabanlı yaklaşımda alt koşullar ekleyerek koşulları birleştirirsiniz:

### AND Operatörü

**Form Yapılandırması**:
- **Ana Koşul Kriteri**: AND seçilir
- **İlk Alt Koşul**:
  - Değişken: Header → `Content-Type`
  - Operatör: Eşitlik
  - Değer: `application/json`
- **İkinci Alt Koşul**:
  - Değişken: Header → `X-API-Key`
  - Operatör: Eşitlik
  - Değer: `premium-key`

**Sonuç**: Her iki koşul da sağlanırsa Premium JSON Processing Policy çalışır.

### OR Operatörü

**Form Yapılandırması**:
- **Ana Koşul Kriteri**: OR seçilir
- **İlk Alt Koşul**:
  - Değişken: Client IP → `request.client.ip`
  - Operatör: İçinde
  - Değer: `["192.168.1.0/24"]`
- **İkinci Alt Koşul**:
  - Değişken: Header → `X-API-Key`
  - Operatör: Eşitlik
  - Değer: `internal-key`

**Sonuç**: Koşullardan biri sağlanırsa Internal Access Policy çalışır.

### NOT Operatörü

**Form Yapılandırması**:
- **Ana Koşul Kriteri**: NOT seçilir
- **Alt Koşul**:
  - Değişken: Client IP → `request.client.ip`
  - Operatör: İçinde
  - Değer: `["10.0.0.0/8"]`

**Sonuç**: IP belirtilen aralıkta değilse External Access Rate Limiting uygulanır.

### Değişken Karşılaştırması

Koşullarda sadece sabit değerlerle değil, **değişkenler arası karşılaştırma** da yapabilirsiniz:

**Form Yapılandırması**:
- **İlk Değişken**: `request.header["Content-Type"]`
- **Operatör**: Eşitlik
- **Değer Kaynağı**: Değişken seçilir
- **İkinci Değişken**: `context.preferred.contentType`

**Sonuç**: İki değişken birbirine eşitse politika çalışır.

## Koşullu Politika Best Practices

<CardGroup cols={2}>
  <Card title="Değişken Seçimi" icon="list-check">
    * Mevcut değişkenleri kullanın, gereksiz yeni değişken oluşturmayın
    * Değişken tiplerini doğru seçin (Header, Query Parametresi, Mesaj İçeriği, Context Değeri)
    * JSONPath/XPath ifadelerini doğru yazın
  </Card>
  <Card title="Koşul Sıralaması" icon="list-ol">
    * En spesifik koşulları önce ekleyin
    * Genel koşulları en sona bırakın
    * ELSE durumunu mutlaka tanımlayın
  </Card>
  <Card title="Nested Koşullar" icon="sitemap">
    * Karmaşık mantık için nested koşulları kullanın
    * AND/OR/NOT operatörlerini doğru seçin
    * Koşul derinliğini makul tutun (okunabilirlik için)
  </Card>
  <Card title="Değer Kaynağı" icon="arrows-left-right">
    * Sabit değerler için sabit değer seçeneğini kullanın
    * Dinamik karşılaştırmalar için değişken seçeneğini kullanın
    * Değişkenler arası karşılaştırma yaparken veri tiplerine dikkat edin
  </Card>
  <Card title="Performans" icon="gauge">
    * Basit koşulları önce kontrol edin
    * Ağır işlemleri (JSONPath/XPath) sona bırakın
    * Cache kullanımını değerlendirin
  </Card>
  <Card title="Test ve Doğrulama" icon="flask">
    * Tüm koşul dallarını test edin
    * Edge case'leri test edin (boş değerler, null, vb.)
    * Değişken değerlerinin runtime'da mevcut olduğundan emin olun
  </Card>
</CardGroup>

## Sonraki Adımlar

<CardGroup cols={2}>
  <Card title="Değişkenler (Variables)" icon="code" href="/tr/apinizer-anlama/temel-kavramlar/variable">
    Değişken kavramını ve kullanımını öğrenin
  </Card>
  <Card title="Mesaj İşleme ve Politika Uygulama" icon="diagram-project" href="/tr/apinizer-anlama/temel-kavramlar/mesaj-isleme-ve-politika-uygulama">
    Mesaj akışı ve politika uygulama sürecini öğrenin
  </Card>
  <Card title="Mesaj İşleme ve Politika Uygulama" icon="diagram-project" href="/tr/apinizer-anlama/temel-kavramlar/mesaj-isleme-ve-politika-uygulama">
    Pipeline'ları öğrenin
  </Card>
  <Card title="Politika Nedir?" icon="shield" href="/tr/apinizer-anlama/temel-kavramlar/politika-nedir">
    Politika kavramını detaylı öğrenin
  </Card>
</CardGroup>

