---
title: 'Message Flow and Policy Management'
description: 'Mesaj akışı sırasında istek ve yanıt mesajlarına uygulanacak politikaların biçimlendirilmesi'
---

# Mesaj Akışı ve Politika Yönetimi

## Mesaj Akışı

Geliştirme sekmesi, mesaj akışı sırasında istek ve yanıt mesajlarına uygulanacak politikaların biçimlendirildiği sekmedir. Arayüz de bu akışı gösterecek şekilde tasarlanmıştır. Böylece kullanıcı görsel olarak bir istek mesajının hangi politikalar hangi sırada uygulandıktan sonra Backend API'ye gönderileceğini ve Backend API'den dönen yanıt mesajı istemciye iletilmeden önce hangi sırada hangi politikaların uygulanacağını görme olanağı kazanır.

İstemci ile Backend API arasındaki akış,

- İstemciden çıkıp Backend API'ye giden istek mesajını sembolize eden bir ok,
- Backend API'den çıkıp İstemciye giden yanıt mesajını sembolize eden bir ok,
- İstek ya da yanıt mesajı üzerinde uygulanan politikaları ve uygulanma sırasını gösteren ikonlar

ile gösterilmektedir.

Bu bölümde politikaların detaylarına girilmeyecektir. Politikalarla ilgili detaylı bilgi için [Politikalar (Policies)](https://docs.apinizer.com/apinizer-dokumantasyonu/politikalar-policies-1179919.html) sayfasına bakılabilir.

### İstemci (Client)

Arayüzde sol taraftaki çerçeve içinde gösterilir. API Proxy'e istek gönderen paydaştır. Akışı başlatır. İstemciden çıkan mesaj, politikalar uygulandıktan sonra Backend API'ye ulaşır.

![İstemci](https://docs.apinizer.com/apinizer-dokumantasyonu/files/153224827/153224847/1/1763126443079/image-2025-11-14_16-20-43.png)

### Backend API

API Proxy ile istemcinin doğrudan erişimine kapatılan ve istemciden saklanan, istekleri API Proxy'den alıp yanıtlarını API Proxy'e döndüren orijinal API'dir. Arayüzünde sağ taraftaki çerçeve ile gösterilir. Backend API'nin yanıtı, politikalar uygulandıktan sonra İstemciye gönderilir.

![Backend API](https://docs.apinizer.com/apinizer-dokumantasyonu/files/153224827/153224849/1/1763126534513/image-2025-11-14_16-22-14.png)

Backend API kutusundaki **API** bağlantısına tıklandığı zaman Backend API'nin API Tanım Belgesi görüntülenir.

![API Tanım Belgesi](https://docs.apinizer.com/apinizer-dokumantasyonu/files/153224827/153224878/1/1763186621078/image-2025-11-15_9-3-41.png)

## Mesaj İşleme Süreci

API Proxy'de mesajlara politikaların uygulanması, mesajın API Proxy'ye girişinden çıkışına kadar geçen süreçte politikaların nasıl ve hangi sırayla çalıştırıldığını tanımlar.

Bir mesaj API Proxy'ye geldiğinde şu adımlar izlenir:

```
İstemci İsteği
   │
   ▼
┌─────────────────────────────────┐
│ 1. Mesaj Alınır                │
│    - Request parse edilir       │
│    - Header'lar okunur          │
│    - Body parse edilir          │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 2. Pre-flow Çalıştırılır        │
│    - Authentication             │
│    - Authorization              │
│    - Rate Limiting              │
│    - Validation                 │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 3. Koşullar Kontrol Edilir     │
│    - IF-THEN-ELSE yapısı        │
│    - Conditional policies       │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 4. Yönlendirme Yapılır         │
│    - Upstream Target seçilir    │
│    - Load balancing uygulanır  │
└──────────────┬──────────────────┘
               │
               ▼
         Backend API
               │
               ▼
┌─────────────────────────────────┐
│ 5. Post-flow Çalıştırılır      │
│    - Response Transformation    │
│    - Data Masking               │
│    - Logging                    │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 6. Yanıt Gönderilir            │
│    - Response formatlanır      │
│    - İstemciye gönderilir       │
└─────────────────────────────────┘
```

## Politika Yönetimi

Politikalar, istek ve yanıt mesajları üzerinde gerçekleştirilmesi istenen güvenlik, mesajları filtreleme, doğrulama, dönüştürme ya da zenginleştirme, kısmen iş mantığı uygulama, hata yönetimi vb. işlemleri tarif etmek üzere yapılan konfigürasyonlardır. API Gateway, İstemci ile Backend API arasındaki mesaj akışı sırasında, bu konfigürasyonlar ile kendisine tanıtılan politikaları işletir.

Bu bölümde genel olarak politikalar üzerinde yapılabilecek işlemler anlatılmaktadır. Herhangi bir politika hakkında detaylı bilgi edinmek için [Politikalar (Policies)](https://docs.apinizer.com/apinizer-dokumantasyonu/politikalar-policies-1179919.html) bölümünden ilgili politikaya ilişkin dokümantasyona bakabilirsiniz.

### Politikaların Yeri ve Çalışma Sırası

Politikalar 3 farklı noktaya eklenebilir:

- API Proxy Grubu
- API Proxy
- Metot/Endpoint

Bir API Proxy Grubuna eklenen bir politika, sadece istek API Proxy Grup üzerinden gelmiş ise işletilir.

Bir API Proxy'ye eklenen bir politika, o API Proxy'nin bütün metot/endpoint'leri için işletilir.

Bir metot/endpoint'e eklenen bir politika, yalnızca o metot/endpoint için işletilir.

Aşağıdaki görselde bu 3 noktaya da eklenmiş olan politikalara ilişkin bir örnek bulunmaktadır.

Görselde **GET - findByStatus** adlı metot/endoint'i seçilmiş olan API Proxy'nin, **Proxy Group - 1** adlı bir API Proxy Grubu'na eklenmiş olduğu görülmektedir.

İşaretlenmiş olan alanlar, politikaların nereye eklendiğine bağlı olarak görüntülendikleri yerlerdir.

- 1 numaralı çerçeve ile işaretlenen alanda, bu API Proxy için herhangi bir metot/endpoint seçilmeden, bütün metot/endpoint'ler için geçerli olacak şekilde eklenmiş ve istek mesajlarına uygulanacak olan politikalar görülür. **Hepsi (All)** yazısı bunu ifade eder.
- 2 numaralı çerçeve ile işaretlenen alanda, seçilmiş olan metot/endpoint için geçerli olacak şekilde ve istek mesajlarına uygulanacak olan politikalar görülür.
- 3 numaralı çerçeve ile işaretlenen alanda, seçilmiş olan metot/endpoint için geçerli olacak şekilde ve yanıt mesajlarına uygulanacak olan politikalar görülür.
- 4 numaralı çerçeve ile işaretlenen alanda, bu API Proxy için herhangi bir metot/endpoint seçilmeden, bütün metot/endpoint'ler için geçerli olacak şekilde eklenmiş ve yanıt mesajlarına uygulanacak olan politikalar görülür. **Hepsi (All)** yazısı bunu ifade eder.

![Politika Yerleşimi](https://docs.apinizer.com/apinizer-dokumantasyonu/files/153224827/153224831/1/1763126135176/image-2024-9-6_17-33-7.png)

Bu API Proxy herhangi bir API Proxy Grubuna eklenmiş, eklenen API Proxy Grupta politikalar bulunuyor ve istek API Proxy Grup üzerinden geldiyse request hattındakiler uygulanır daha sonra response hattı üzerindeki politikalar da uygulanır. Ancak bu sayfada gösterilmez.

API Proxy'nin herhangi bir metot/endpoint'i için herhangi bir politikanın eklenmiş olması durumunda metot/endpoint yanında çark ikonu bulunur.

Eğer API Proxy'nin belirli bir metot/endpoint'i seçilmezse (ya da **Hepsi (All)**) seçilirse, aşağıdaki görselde gösterildiği gibi 2 bölge görünür.

![Tüm Metotlar](https://docs.apinizer.com/apinizer-dokumantasyonu/files/153224827/153224855/1/1763129141211/image-2025-11-14_17-5-41.png)

- 1 numaralı çerçeve ile işaretlenen alanda, bu API Proxy'nin bütün metot/endpoint'leri için geçerli olacak şekilde eklenmiş ve istek mesajlarına uygulanacak olan politikalar görülür.
- 2 numaralı çerçeve ile işaretlenen alanda, bu API Proxy'nin bütün metot/endpoint'leri için geçerli olacak şekilde eklenmiş ve yanıt mesajlarına uygulanacak olan politikalar görülür.

## Politikaların İşletilme Sırası

Politikalar, mesajın akış sırasında;

- İstek mesajı için API Proxy Grup → API Proxy → metot/endpoint sırasıyla
- Yanıt mesajı için metot/endpoint → API Proxy → API Proxy Grup sırasıyla

işletilir. Her seviyede, o seviyedeki politikalar mesajın akış yönündeki sıralamaya göre işleme alınır.

Aşağıdaki görselde bu durum özetlenmiş, politikaların işleme alınma sıraları numaralandırılarak gösterilmiştir.

![Politika İşletilme Sırası](https://docs.apinizer.com/apinizer-dokumantasyonu/files/153224827/153224860/1/1763129872125/image-2025-11-14_17-17-52.png)

### Politikaların Uygulanma Sırası

Politikalar tanımlandıkları sırayla çalıştırılır. Bu sıra kritik öneme sahiptir:

<CardGroup cols={2}>
  <Card title="1. Pre-flow Policies" icon="arrow-down">
    İstek backend'e gönderilmeden önce çalışan politikalar:
    * Authentication
    * Authorization
    * Rate Limiting
    * Validation
  </Card>
  <Card title="2. Conditional Policies" icon="code-branch">
    Koşullara bağlı olarak çalışan politikalar:
    * IF-THEN-ELSE yapısı
    * Mesaj içeriğine göre
    * Header değerlerine göre
  </Card>
  <Card title="3. Route Step" icon="route">
    Backend'e yönlendirme:
    * Upstream Target seçimi
    * Load balancing
    * Failover
  </Card>
  <Card title="4. Post-flow Policies" icon="arrow-up">
    Backend'den yanıt geldikten sonra çalışan politikalar:
    * Response Transformation
    * Data Masking
    * Logging
  </Card>
</CardGroup>

### Hata Durumunda Politikaların İşletilme Sırası

Hata durumunda işletilecek olan politikalar "Hata Politikası Ekle" seçeneği ile eklenir.

Akışın herhangi bir noktasında hata olması durumunda normal akış kesilerek öncelikle varsa hata yanıt şablonu hata mesajına uygulanır.

Sonrasında "Hata Politikaları" hattına eklenen politikalar sağdan sola doğru sırasıyla işletilir.

## Politika Uygulama Örnekleri

### Örnek 1: Basit Mesaj İşleme

```
İstek: GET /api/v1/products
   │
   ▼
1. Pre-flow: OAuth2 Authentication ✓
   │
   ▼
2. Pre-flow: Rate Limiting ✓
   │
   ▼
3. Route: Backend'e yönlendirme
   │
   ▼
4. Post-flow: Response Logging ✓
   │
   ▼
Yanıt: 200 OK
```

### Örnek 2: Koşullu Politika Uygulama

```
İstek: POST /api/v1/products
   │
   ▼
1. Pre-flow: OAuth2 Authentication ✓
   │
   ▼
2. Conditional Policy:
   IF Content-Type == "application/json" THEN
      └─ JSON Schema Validation ✓
   ELSE IF Content-Type == "application/xml" THEN
      └─ XML Schema Validation ✓
   │
   ▼
3. Route: Backend'e yönlendirme
   │
   ▼
4. Post-flow: Response Transformation ✓
   │
   ▼
Yanıt: 201 Created
```

### Örnek 3: Hata Durumunda Politika Uygulama

```
İstek: GET /api/v1/products
   │
   ▼
1. Pre-flow: OAuth2 Authentication ✗ (Token geçersiz)
   │
   ▼
2. Fault Handler Policy:
   └─ Error Response Transformation
   └─ Error Logging
   │
   ▼
Yanıt: 401 Unauthorized
```

## Politika Uygulama Detayları

### Pre-flow Policies

İstek backend'e gönderilmeden önce çalışan politikalar:

<AccordionGroup>
  <Accordion title="Güvenlik Politikaları">
    * **Authentication**: Kimlik doğrulama
      * OAuth2 / OIDC / JWT
      * Basic / Digest Authentication
      * mTLS
    * **Authorization**: Yetkilendirme
      * IP Whitelist/Blacklist
      * API Key kontrolü
      * Role-based Access Control
  </Accordion>
  
  <Accordion title="Trafik Yönetimi">
    * **Rate Limiting**: İstek hızı sınırlama
    * **Quota Management**: Kota yönetimi
    * **Time Restriction**: Zaman kısıtlaması
  </Accordion>
  
  <Accordion title="Doğrulama">
    * **Schema Validation**: JSON/XML şema doğrulama
    * **Message Size**: Mesaj boyutu kontrolü
    * **Content-Type**: İçerik tipi kontrolü
  </Accordion>
</AccordionGroup>

### Post-flow Policies

Backend'den yanıt geldikten sonra çalışan politikalar:

<AccordionGroup>
  <Accordion title="Response Transformation">
    * **Format Conversion**: JSON ↔ XML dönüştürme
    * **Data Mapping**: Veri eşleştirme
    * **Field Removal**: Alan kaldırma
    * **Field Addition**: Alan ekleme
  </Accordion>
  
  <Accordion title="Data Masking">
    * **Sensitive Data Masking**: Hassas veri maskeleme
    * **Field Encryption**: Alan şifreleme
    * **PII Protection**: Kişisel bilgi koruma
  </Accordion>
  
  <Accordion title="Logging">
    * **Request Logging**: İstek kaydı
    * **Response Logging**: Yanıt kaydı
    * **Audit Logging**: Denetim kaydı
  </Accordion>
</AccordionGroup>

## Politika Uygulama Best Practices

<CardGroup cols={2}>
  <Card title="Sıralama Önceliği" icon="list-ol">
    * Güvenlik politikaları önce çalışmalı
    * Rate limiting authentication'dan sonra
    * Validation transformation'dan önce
  </Card>
  <Card title="Performans" icon="gauge">
    * Ağır işlemleri sona bırakın
    * Cache kullanımını değerlendirin
    * Gereksiz politikaları kaldırın
  </Card>
  <Card title="Hata Yönetimi" icon="triangle-exclamation">
    * Fault handler politikaları tanımlayın
    * Hata mesajlarını özelleştirin
    * Hata loglama yapın
  </Card>
  <Card title="Test" icon="flask">
    * Politikaları ayrı ayrı test edin
    * Senaryo bazlı test yapın
    * Performans testi yapın
  </Card>
</CardGroup>

### Akışa Politika Ekleme

Bir politika eklemek için;

- Politikanın eklenmek istediği varlık seçilir. Örneğin API Proxy'nin bütün metot/endpoint'leri için uygulanması istenen bir politika için, o API Proxy'nin metot/endpoint alanında **Hepsi (All)** seçilir.
- Politikanın istek mesajına mı yanıt mesajına mı ekleneceğine göre uygun alandaki **+ Politika Ekle (Add Policy)** ikonuna tıklanır.

![Politika Ekleme](https://docs.apinizer.com/apinizer-dokumantasyonu/files/153224827/153224862/1/1763130276316/image-2025-11-14_17-24-36.png)

- Açılan pencereden eklenmek istenen politikanın tipi seçilir. Bu pencerede görünen politika tipleri, aktif API Proxy'nin tipine ve hangi bölge politika eklenmek istendiğine göre değişir.

![Politika Tipi Seçimi](https://docs.apinizer.com/apinizer-dokumantasyonu/files/153224827/153224864/1/1763131297754/image-2025-11-14_17-41-38.png)

Eklenmek istenen politika seçildiğinde, o politikaya ilişkin konfigürasyon bilgisinin girilebileceği bir pencere açılır. Bu pencereden farklı şekillerde politika eklenebilir:

- Var olan bir global politikayı eklemek için politika penceresinde, en üstte politika tipinin yanındaki **Global Politikalardan Seç (Select From Global Policies)** bağlantısına tıklanır. Açılan pencereden uygun politika seçilerek işlem tamamlanır.

![Global Politika Seçimi](https://docs.apinizer.com/apinizer-dokumantasyonu/files/153224827/153224873/1/1763185153369/image-2025-11-15_8-39-14.png)

- Yerel politika oluşturmak için herhangi özel işlem yapmadan açılan pencerede girilen veriler ile yerel politika oluşturulması sağlanır.

### Akıştaki Politikayı Güncelleme

Var olan bir politikanın ikonuna tıklandığı zaman, o politikanın bilgilerinin güncellenebileceği bir pencere açılır.

![Politika Güncelleme](https://docs.apinizer.com/apinizer-dokumantasyonu/files/153224827/153224866/1/1763132334529/image-2025-11-14_17-58-54.png)

### Seçilen Politikayı Activate/Deactivate Etme

Bir politika, eklenmiş olduğu metot/endpoint ya da API Proxy'den silinmeden geçici olarak kullanımdan kaldırılabilir. Bunun için politika güncellenmek üzere açılır ve açılan pencerenin en üst kısmındaki **Deactivate** tuşuna tıklanır.

![Politika Deactivate](https://docs.apinizer.com/apinizer-dokumantasyonu/files/153224827/153224876/1/1763186372088/image-2025-11-15_8-59-32.png)

### Bütün Politikaları Activate/Deactivate Etme

Metot/endpoint bölümünde, orta bölümün alt kısmında **Bütün Politikaları Kapat (Disable All Policies)** bağlantısı belirir. Bu bağlantıya tıklandığı zaman, eğer **Hepsi (All)** seçeneğinde ise API Proxy üzerine eklenmiş olan bütün politikalar; eğer herhangi bir metot içerisindeyse sadece o metot içerisinde eklenmiş olan tüm politikalar devre dışı kalır. Kullanımdan kaldırılmış olan politikalar daha sonra politika güncelleme penceresinden tek tek ya da **Bütün Politikaları Aç (Activate All Policies)** bağlantısına tıklanarak toplu olarak yeniden etkinleştirilebilir.

![Tüm Politikaları Kapatma](https://docs.apinizer.com/apinizer-dokumantasyonu/files/153224827/153224867/1/1763132418905/image-2025-11-14_18-0-19.png)

Politikalar devre dışı kaldığında, ikonların renkleri değişerek gri bir görünüme kavuşur.

![Devre Dışı Politikalar](https://docs.apinizer.com/apinizer-dokumantasyonu/files/153224827/153224868/1/1763132492190/image-2025-11-14_18-1-32.png)

Eğer API Proxy bir API Proxy Grubu'na eklenmişse ve bu API Proxy Grubu üzerinden politikalar uygulanmışsa, bütün politikaların kapatılması API Proxy Grubu'ndan gelen politikaları etkilemez, bu politikalar aktif olarak kalır.

### Akıştan Politika Kaldırma

Fare silinmek istenen politikanın üzerine getirildiğinde, politikayı silecek bir ikon belirir. Bu ikona tıklanarak politika silinebilir.

![Politika Silme](https://docs.apinizer.com/apinizer-dokumantasyonu/files/153224827/153224874/1/1763186096578/image-2025-11-15_8-54-56.png)

Geliştirme sekmesinde gerçekleştirilen politika silme işleminde;

- politika yerel ise tamamen silinir,
- politika global ise yalnızca bu metot/endpoint ya da API Proxy ile ilişkisi kaldırılır, politikanın kendisi silinmez. Daha sonra tekrar eklenebilir. Bir global politikanın tamamen silinmesi isteniyorsa, silme işleminin [Global Politikalar (Global Policies)](https://docs.apinizer.com/apinizer-dokumantasyonu/global-politikalar-global-policies-13272066.html) arayüzlerinden yapılması gerekir.
