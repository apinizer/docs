---
title: "API Proxy'de Mesaja Politikalar Uygulanması"
description: 'API Proxy'de mesajlara politikaların nasıl uygulandığını ve mesaj işleme sürecini açıklar'
---

API Proxy'de mesajlara politikaların uygulanması, mesajın API Proxy'ye girişinden çıkışına kadar geçen süreçte politikaların nasıl ve hangi sırayla çalıştırıldığını tanımlar.

## Mesaj İşleme Süreci

Bir mesaj API Proxy'ye geldiğinde şu adımlar izlenir:

```
İstemci İsteği
   │
   ▼
┌─────────────────────────────────┐
│ 1. Mesaj Alınır                │
│    - Request parse edilir       │
│    - Header'lar okunur          │
│    - Body parse edilir          │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 2. Pre-flow Çalıştırılır        │
│    - Authentication             │
│    - Authorization              │
│    - Rate Limiting              │
│    - Validation                 │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 3. Koşullar Kontrol Edilir     │
│    - IF-THEN-ELSE yapısı        │
│    - Conditional policies       │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 4. Yönlendirme Yapılır         │
│    - Upstream Target seçilir    │
│    - Load balancing uygulanır  │
└──────────────┬──────────────────┘
               │
               ▼
         Backend API
               │
               ▼
┌─────────────────────────────────┐
│ 5. Post-flow Çalıştırılır      │
│    - Response Transformation    │
│    - Data Masking               │
│    - Logging                    │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 6. Yanıt Gönderilir            │
│    - Response formatlanır      │
│    - İstemciye gönderilir       │
└─────────────────────────────────┘
```

## Politikaların Uygulanma Sırası

Politikalar tanımlandıkları sırayla çalıştırılır. Bu sıra kritik öneme sahiptir:

<CardGroup cols={2}>
  <Card title="1. Pre-flow Policies" icon="arrow-down">
    İstek backend'e gönderilmeden önce çalışan politikalar:
    * Authentication
    * Authorization
    * Rate Limiting
    * Validation
  </Card>
  <Card title="2. Conditional Policies" icon="code-branch">
    Koşullara bağlı olarak çalışan politikalar:
    * IF-THEN-ELSE yapısı
    * Mesaj içeriğine göre
    * Header değerlerine göre
  </Card>
  <Card title="3. Route Step" icon="route">
    Backend'e yönlendirme:
    * Upstream Target seçimi
    * Load balancing
    * Failover
  </Card>
  <Card title="4. Post-flow Policies" icon="arrow-up">
    Backend'den yanıt geldikten sonra çalışan politikalar:
    * Response Transformation
    * Data Masking
    * Logging
  </Card>
</CardGroup>

## Politika Uygulama Örnekleri

### Örnek 1: Basit Mesaj İşleme

```
İstek: GET /api/v1/products
   │
   ▼
1. Pre-flow: OAuth2 Authentication ✓
   │
   ▼
2. Pre-flow: Rate Limiting ✓
   │
   ▼
3. Route: Backend'e yönlendirme
   │
   ▼
4. Post-flow: Response Logging ✓
   │
   ▼
Yanıt: 200 OK
```

### Örnek 2: Koşullu Politika Uygulama

```
İstek: POST /api/v1/products
   │
   ▼
1. Pre-flow: OAuth2 Authentication ✓
   │
   ▼
2. Conditional Policy:
   IF Content-Type == "application/json" THEN
      └─ JSON Schema Validation ✓
   ELSE IF Content-Type == "application/xml" THEN
      └─ XML Schema Validation ✓
   │
   ▼
3. Route: Backend'e yönlendirme
   │
   ▼
4. Post-flow: Response Transformation ✓
   │
   ▼
Yanıt: 201 Created
```

### Örnek 3: Hata Durumunda Politika Uygulama

```
İstek: GET /api/v1/products
   │
   ▼
1. Pre-flow: OAuth2 Authentication ✗ (Token geçersiz)
   │
   ▼
2. Fault Handler Policy:
   └─ Error Response Transformation
   └─ Error Logging
   │
   ▼
Yanıt: 401 Unauthorized
```

## Politika Uygulama Detayları

### Pre-flow Policies

İstek backend'e gönderilmeden önce çalışan politikalar:

<AccordionGroup>
  <Accordion title="Güvenlik Politikaları">
    * **Authentication**: Kimlik doğrulama
      * OAuth2 / OIDC / JWT
      * Basic / Digest Authentication
      * mTLS
    * **Authorization**: Yetkilendirme
      * IP Whitelist/Blacklist
      * API Key kontrolü
      * Role-based Access Control
  </Accordion>
  
  <Accordion title="Trafik Yönetimi">
    * **Rate Limiting**: İstek hızı sınırlama
    * **Quota Management**: Kota yönetimi
    * **Time Restriction**: Zaman kısıtlaması
  </Accordion>
  
  <Accordion title="Doğrulama">
    * **Schema Validation**: JSON/XML şema doğrulama
    * **Message Size**: Mesaj boyutu kontrolü
    * **Content-Type**: İçerik tipi kontrolü
  </Accordion>
</AccordionGroup>

### Post-flow Policies

Backend'den yanıt geldikten sonra çalışan politikalar:

<AccordionGroup>
  <Accordion title="Response Transformation">
    * **Format Conversion**: JSON ↔ XML dönüştürme
    * **Data Mapping**: Veri eşleştirme
    * **Field Removal**: Alan kaldırma
    * **Field Addition**: Alan ekleme
  </Accordion>
  
  <Accordion title="Data Masking">
    * **Sensitive Data Masking**: Hassas veri maskeleme
    * **Field Encryption**: Alan şifreleme
    * **PII Protection**: Kişisel bilgi koruma
  </Accordion>
  
  <Accordion title="Logging">
    * **Request Logging**: İstek kaydı
    * **Response Logging**: Yanıt kaydı
    * **Audit Logging**: Denetim kaydı
  </Accordion>
</AccordionGroup>

## Politika Uygulama Best Practices

<CardGroup cols={2}>
  <Card title="Sıralama Önceliği" icon="list-ol">
    * Güvenlik politikaları önce çalışmalı
    * Rate limiting authentication'dan sonra
    * Validation transformation'dan önce
  </Card>
  <Card title="Performans" icon="gauge">
    * Ağır işlemleri sona bırakın
    * Cache kullanımını değerlendirin
    * Gereksiz politikaları kaldırın
  </Card>
  <Card title="Hata Yönetimi" icon="triangle-exclamation">
    * Fault handler politikaları tanımlayın
    * Hata mesajlarını özelleştirin
    * Hata loglama yapın
  </Card>
  <Card title="Test" icon="flask">
    * Politikaları ayrı ayrı test edin
    * Senaryo bazlı test yapın
    * Performans testi yapın
  </Card>
</CardGroup>

## Sonraki Adımlar

<CardGroup cols={2}>
  <Card title="Message Flow & Policy Pipeline" icon="diagram-project" href="/tr/apinizer-anlama/temel-kavramlar/message-processing">
    Message Flow ve Policy Pipeline kavramını öğrenin
  </Card>
  <Card title="Condition-based Policy Execution" icon="code-branch" href="/tr/apinizer-anlama/temel-kavramlar/condition-based-policy-execution">
    Koşullu politika çalıştırmayı öğrenin
  </Card>
  <Card title="Request, Response ve Error Pipelines" icon="arrows-rotate" href="/tr/apinizer-anlama/temel-kavramlar/request-response-error-pipelines">
    Pipeline'ları öğrenin
  </Card>
  <Card title="Policy Nedir?" icon="shield" href="/tr/apinizer-anlama/temel-kavramlar/policy-nedir">
    Politika kavramını öğrenin
  </Card>
</CardGroup>

