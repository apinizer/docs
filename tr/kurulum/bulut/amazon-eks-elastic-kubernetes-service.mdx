---
title: "Amazon EKS"
description: "Amazon EKS (Elastic Kubernetes Service) üzerinde Apinizer kurulumunu ve yapılandırmasını sağlar. AWS EKS cluster kurulumu, kaynaklarının oluşturulması ve Apinizer'ın EKS üzerinde kurulum adımlarını sunar. VPC, IAM rolleri, worker node'lar ve Apinizer deployment yapılandırmalarını içerir."
---

<Note>
  Bu dokümanda, Amazon EKS (Elastic Kubernetes Service) üzerinde Apinizer kurulumu için gerekli adımlar anlatılmaktadır. İlk 6 bölümde, en baştan başlayarak adım adım AWS EKS kurulumu, kaynaklarının oluşturulması ve kullanılması adımları anlatılmaktadır. Eğer AWS üzerinde hazır bir EKS cluster'ı varsa doğrudan [7. bölümden](#eksye-apinizerın-kurulumu) başlanılabilir.
</Note>

## 1. Giriş

### Minimum Sistem Gereksinimi

AWS EKS Cluster'a Apinizer kurulumu için, Node Group içinde tanımlanacak Compute Node'ların toplam CPU Core'ları en az **6 core** olmalıdır.

<CardGroup cols={2}>
  <Card title="t3.medium Örneği" icon="server">
    **t3.medium** tipinde sunucu seçildiyse 3 tane olması gerekir.
  </Card>
  <Card title="t3.xlarge Örneği" icon="server">
    **t3.xlarge** tipinde sunucu eklerseniz 2 tane yeterli olacaktır.
  </Card>
</CardGroup>

### AWS EKS (Elastic Kubernetes Service) Nedir?

**Amazon Elastic Kubernetes Service (Amazon EKS)**, kendi Kubernetes Control Plane (Master) veya node'larınızı (Worker Nodes) kurmanıza, çalıştırmanıza ve bakımını yapmanıza gerek kalmadan Kubernetes'i AWS'de çalıştırmak için kullanabileceğiniz yönetilen bir hizmettir.

**Kubernetes**, kapsayıcılı uygulamaların dağıtımını, ölçeklenmesini ve yönetimini otomatikleştirmek için açık kaynaklı bir sistemdir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/eks-overview.png" alt="Amazon EKS Overview" width="1000" height="431" />
</Frame>

## 2. EKS VPC ve Subnetleri Yapılandırın

### AWS VPC ve Subnet Nedir?

**Amazon AWS VPC (Virtual Private Cloud)**, AWS içinde yer alan bir özel bir sanal ağdır. Başka bir ifade ile, AWS'in network alt yapı bileşeni denilebilir. AWS üzerinde oluşturulacak tüm bileşenlerin birbirleri ile iletişim sağlamaları için Amazon AWS tarafından geliştirilmiş gelişmiş bir sanal ağ altyapısıdır.

VPC içinde kendi kullanımımıza özel network'ler, subnetler, gateway'ler oluşturabilir. Bunlara ait Route tabloları ile kullanım farklı network'ler ve subnet aralarındaki bağlantılar sağlanabilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/vpc-topology.png" alt="VPC Topology" width="1000" height="758" />
</Frame>

**VPC Subnet:** AWS üzerinde belirli bir network oluşturduktan sonra bu network'e ait alt ağlar oluşturulabilir. Aşağıdaki adımları takip ederek AWS VPC üzerinde subnet oluşturulabilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/vpc-subnets.png" alt="VPC Subnets" width="1000" height="1319" />
</Frame>

EKS için VPC ve Subnet'lerin doğru ayarlanması ve AWS dokümanında belirtildiği gibi subnetlerin tanımlanması gerekmektedir. Eğer, VPC ve subnet tanımlanmasını bilmiyorsanız AWS'nin hazır template'ini kullanabilirsiniz.

Detaylar için: [AWS EKS VPC Dokümantasyonu](https://docs.aws.amazon.com/eks/latest/userguide/create-public-private-vpc.html)

### AWS VPC Oluşturma ve Yapılandırma

Aşağıdaki adımları takip ettiğinizde EKS için uygun olan network yapısı otomatik olarak kurulacaktır.

Detaylar için: [AWS CloudFormation Console](https://console.aws.amazon.com/cloudformation/)

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/23-vpc-cloudformation.png" alt="AWS CloudFormation Console" width="1000" height="700" />
</Frame>

## 3. EKS IAM Rolleri Yapılandırma

### AWS Identity and Access Management (IAM) Role Nedir?

**AWS Identity and Access Management'ı (IAM)** kullanarak, AWS hizmetlerine ve kaynaklarına kimlerin hangi koşullarda erişebileceğini belirleyebilirsiniz.

IAM, AWS hesabınızın bir özelliğidir ve ek ücret olmadan sunulur. IAM yapısı itibariyle bir instance, bir veri tabanı gibi çalışan bir şey değil tamamıyla yetkileri bizler için yöneten kimin hangi servise ne tür bir şekilde erişebileceğinden, kullanılan AWS hesabına erişimi olan bütün kullanıcıları yönetebilmektedir.

IAM ana konsept itibariyle **6 ana başlığı** kendi içerisinde yönetmektedir:
- Kullanıcılar
- Gruplar
- Roller
- IAM Access Policies
- API Keys
- Password policy, MFA

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/iam-overview.jpg" alt="IAM Overview" width="1000" height="434" />
</Frame>

<Note>
Detaylı bilgi için: [AWS IAM Nedir?](https://emirozbirdeveloper.medium.com/aws-iam-kimsin-sen-c84b677387b9)
</Note>

### AWS IAM Oluşturma ve Yapılandırma

Sol menüden **Roles** sayfasına giderek yeni **Role** oluşturulur.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/55-iam-roles-page.png" alt="IAM Roles Sayfası" width="1000" />
</Frame>

Bu bölümde iki adet **Role** oluşturmamız gerekiyor. Birincisi, **EKS cluster** için kullanılacak olan Role, ikincisi ise EKS içindeki **Worker Node Group**'ların kullanacağı Role bilgisidir.

#### 1. EKS Cluster'ın Kullanacağı Rolü Oluşturma

Rol oluşturmak için sırasıyla verilen görsellerdeki işlemler gerçekleştirilmelidir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/54-iam-roles.png" alt="IAM Roles" width="200" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/53-iam-create-role.png" alt="Create Role" width="1000" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/52-iam-eks-service.png" alt="EKS Service" width="1000" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/51-iam-permissions.png" alt="Permissions" width="1000" />
</Frame>

Gelen sayfada herhangi bir key-value bilgisi girmeden devam edilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/50-iam-review.png" alt="Review" width="1000" />
</Frame>

EKS Cluster'ın kullanacağı IAM rolü oluşturulmalıdır. Bu rol, EKS cluster'ının AWS servislerine erişmesi için gerekli izinleri içermelidir.

#### 2. EKS Cluster Worker Node Group'ların Kullanacağı Rolü Oluşturma

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/48-iam-worker-role.png" alt="Worker Node Role" width="1000" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/47-iam-worker-policies.png" alt="Worker Policies" width="1000" />
</Frame>

Bu Role için aşağıdaki Policy'ler seçilmelidir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/46-iam-worker-policies-alt.png" alt="Worker Policies Alt" width="1000" />
</Frame>

Worker Node Group'ların kullanacağı IAM rolü oluşturulmalıdır. Bu rol, worker node'ların AWS servislerine (EC2, EBS, ELB vb.) erişmesi için gerekli izinleri içermelidir.

## 4. EKS Master Node Kurulumu

### AWS EKS (Elastic Kubernetes Service) Oluşturma ve Yapılandırma

Yukarıdaki adımları tamamladıktan sonra, AWS EKS kurulumuna başlanılabilir.

Arama bölümüne EKS yazarak sürece devam edilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/45-eks-search.png" alt="EKS Search" width="1000" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/44-eks-create.png" alt="EKS Create" width="1000" />
</Frame>

Cluster adını, kullanmak istediğimiz kubernetes versiyonunu ve daha önce oluşturmuş olduğumuz IAM rolü seçilir.

<Steps>
  <Step title="Kümeyi yapılandırma">
    Cluster adı, Kubernetes versiyonu ve IAM rolü seçilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/43-eks-cluster-config.png" alt="Cluster Config" width="1000" />
</Frame>
  </Step>
  <Step title="Ağ iletişimini belirtme">
    VPC ve subnet'ler seçilir. EKS için en az 2 subnet seçilmesi önerilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/22-eks-subnet.png" alt="Subnet" width="1000" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/42-eks-network.png" alt="Network" width="600" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/41-eks-security-group.png" alt="Security Group" width="1000" />
</Frame>
  </Step>
  <Step title="Günlüğe kaydetmeyi yapılandırma">
    CloudWatch Log Group seçilir veya yeni bir log group oluşturulur. Bu bölüm, isteğe uygun şekilde yapılandırılabilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/40-eks-logging.png" alt="Logging" width="600" />
</Frame>
  </Step>
  <Step title="İncele ve oluştur">
    Son olarak tanımlanan bilgilerin görülmektedir. Bu aşamada bir yanlışlık görülmemektedir. **Create** diyerek cluster oluşturmaya başlanır.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/39-eks-creating.png" alt="Creating" width="600" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/38-eks-review.png" alt="Review" width="1000" height="206" />
</Frame>
  </Step>
</Steps>

<Note>
EKS Cluster'ı oluşturmaktadır. Bu işlem tahmini 5 dakika sürüyor. Bu işlem devam ederken, Client bilgisayarımızdan EKS'ya erişip yönetebilmemiz gerekli araçlarını indirerek yapılandırabilinir.
</Note>

## 5. AWS CLI ve kubectl'i Kurma ve Yapılandırma

Aşağıdaki adreslerden gerekli olan araçları indirin. Bu dökümanda Client bilgisayar olarak Windows kullanılacağı için Windows'a uygun olan versiyonlar indirilmektedir.

### AWS CLI Kurulumu

İndirilen **.msi** uzantılı aracı kurduktan sonra, aşağıdaki gibi Cluster bilgilerinize uygun olarak yapılandırılır.

Detaylar için: [AWS CLI Getting Started Guide](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html)

<Steps>
  <Step title="IAM service'e giderek Credential bilgilerini alma">
    IAM Console'dan Access Key ve Secret Key bilgileri alınır.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/37-iam-user.png" alt="IAM User" width="1000" />
</Frame>

Gelen ekrandan **Manage access keys** butonuna tıklayarak **Access** bilgilerine gidilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/36-iam-manage-access-keys.png" alt="Manage Access Keys" width="1000" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/35-access-key-dialog.png" alt="Access Key Dialog" width="600" />
</Frame>

Aşağıdaki gelen pencerede **Access Key** ve **Secret** bilgileri görülür. Pencereyi kapatmadan önce bu bilgiler bir yere kayıt edilmelidir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/34-access-key-secret.png" alt="Access Key Secret" width="600" />
</Frame>
  </Step>
  <Step title="Windows CLI'da AWS konfigürasyonu yapma">
    ```powershell
    aws configure
    ```
    
    Burada daha önce kayıt edilen **Access Key** ve **Secret** bilgilerini girerek yapılandırma işlemi başlatılır.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/33-aws-cli-access-key.png" alt="AWS CLI Access Key" width="1000" />
</Frame>
  </Step>
</Steps>

### KUBECTL Kurulumu

Kubectl, cluster versiyonu ile aynı olacak şekilde indirilmelidir.

Detaylar için: [AWS EKS kubectl Installation Guide](https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html)

<Steps>
  <Step title="KUBECTL'i indirme">
    Kubectl Windows için indirilir ve PATH'e eklenir.
  </Step>
  <Step title="Windows client makinesinde EKS Cluster'a bağlanmak için gerekli bilgileri tanımlama">
    ```powershell
    # Örnek Yapılandırma Komutu
    aws eks update-kubeconfig --region [EKS_Region] --name [EKS_Cluster_Name]
    ```
    
    Burada **region** bilgisi, aşağıdaki resimde görüldüğü gibi üst menüden alınabilir. Aynı şekilde cluster ismi EKS sayfasına giderek alınabilir.

<Note>
Bize gerekli olan **eu-central-1** olan bölümdür.
</Note>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/32-aws-region.png" alt="AWS Region" width="200" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/31-eks-cluster-name.png" alt="EKS Cluster Name" width="1000" height="146" />
</Frame>
  </Step>
</Steps>

Cluster durumunu kontrol etmek için:

```powershell
aws eks --region eu-central-1 describe-cluster --name apinizer-eks-cluster1 --query cluster.status
```

Eğer birden fazla cluster yönetiliyorsa aşağıdaki gibi **kubeconfig** bilgisini güncellenmelidir:

```powershell
aws eks --region eu-central-1 update-kubeconfig --name apinizer-eks-cluster2
```

## 6. EKS Worker Node'ları Oluşturma

Bu bölümde, EKS için Worker Node'ların oluşturulması anlatılmaktadır. Tekrardan AWS Console'a giderek aşağıdaki adımlar uygulanmalıdır.

<Steps>
  <Step title="Node Group Oluşturma">
    EKS Console'dan "Add Node Group" seçeneği ile yeni bir node group oluşturulur.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/29-node-group-create.png" alt="Node Group Create" width="1000" height="395" />
</Frame>
  </Step>
  <Step title="Node Group Yapılandırma">
    Node group için:
    - Node group adı
    - IAM rolü (daha önce oluşturulan worker node rolü)
    - Instance type (örn: t3.medium, t3.xlarge)
    - Disk boyutu
    
    seçilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/28-node-group-config.png" alt="Node Group Config" width="1000" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/27-node-group-config-alt.png" alt="Node Group Config Alt" width="154" />
</Frame>
  </Step>
  <Step title="Hesaplama ve Ölçeklendirme Yapılandırmasını Ayarlama">
    Node group için minimum, maksimum ve desired node sayıları belirlenir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/26-node-group-scaling.png" alt="Node Group Scaling" width="1000" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/25-node-group-scaling-alt.png" alt="Node Group Scaling Alt" width="1000" />
</Frame>
  </Step>
  <Step title="Ağ İletişimini Belirtme">
    Subnet'ler seçilir ve SSH key pair belirlenir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/21-node-group-network.png" alt="Node Group Network" width="1000" />
</Frame>
  </Step>
  <Step title="İncele ve Oluştur">
    Son olarak tanımlanan bilgilerin görülmektedir. Bu aşamada bir yanlışlık görülmüyorsa **Create** diyerek cluster oluşturmaya başlanır.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/20-node-group-review.png" alt="Node Group Review" width="1000" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/24-node-group-creating.png" alt="Node Group Creating" width="1000" />
</Frame>
  </Step>
</Steps>

Bu işlem tahmini olarak 5 dakika sürmektedir. Kurulum tamamlanıp aktifleştirildikten sonra daha önce yapılandırılan kubectl ile deployment vs. işleri yapabilir.

Node Group kurulumu tamamlandığını gösteren görsel aşağıdadır:

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/19-node-group-ready-alt.png" alt="Node Group Ready Alt" width="1000" height="130" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/18-node-group-ready.png" alt="Node Group Ready" width="1000" height="257" />
</Frame>

## 7. EKS Kurulumu Test ve Örnek Deployment

Bu aşamadan, daha önce kurulumunu ve tanımlamalarını yapılan kubectl ile kubernetes cluster'ı kontrol edip ve örnek bir nginx uygulaması ile test edilmesi anlatılmaktadır.

### AWS EKS Ortam Test

Aşağıdaki komutları takip ederek kubernetes cluster kaynakları kontrol edilmelidir.

```powershell
aws eks --region eu-central-1 describe-cluster --name apinizer-eks-cluster --query cluster.status
aws eks --region eu-central-1 update-kubeconfig --name apinizer-eks-cluster
kubectl get nodes
```

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/30-aws-cli-configure.png" alt="AWS CLI Configure" width="1000" />
</Frame>

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/56-kubectl-nodes.png" alt="kubectl get nodes" width="1000" />
</Frame>

### Örnek Uygulama Yükleme ve Test Etme

Bu bölümde, örnek olarak aşağıdaki .yaml dosyasında tanımlanmış olan Nginx uygulaması, kubernetes cluster'ına yüklenmesi anlatılmaktadır ve expose edildikten sonra test edilmektedir.

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-nginx
spec:
  selector:
    matchLabels:
      run: my-nginx
  replicas: 4
  template:
    metadata:
      labels:
        run: my-nginx
    spec:
      containers:
      - name: my-nginx
        image: nginx
        ports:
        - containerPort: 80
```

```powershell
kubectl apply -f nginx.yaml
kubectl get pods
```

Uygulama, kubernetes cluster'a başarılı olarak yüklendiği görülmektedir.

Aşağıdaki komut ile uygulamayı servis olarak açın:

```powershell
kubectl expose deployment/my-nginx --port=80 --target-port=80 --name=my-nginx-service --type=LoadBalancer
kubectl get svc
```

Test için:

```powershell
curl -k <EXTERNAL-IP>
```

## 8. EKS'ye Apinizer'ın Kurulumu

Bu başlık altında anlatılanlar Apinizer kurulum dokümanlarından farklı olarak Apinizer'ı servis olarak açmanın tanımını anlatmaktadır.

### Apinizer Yönetim Konsolu kurulumu

Apinizer için **.yaml** dosyası oluşturulup AWS EKS cluster'ına yüklenmelidir.

Kurulum ve Konfigürasyon dokümanına belirtildiği gibi **Replicaset MongoDB** ve **Elasticsearch**'e ihtiyaç vardır.

- MongoDB için [MongoDB Atlas](https://account.mongodb.com/account/register) adresine giderek bir hesap oluşturun ve kısıtlı bir DB boyutuna kadar ücretsiz olarak kullanılabilir. Apinizer MongoDB'de sadece konfigürasyon tanımlarını tuttuğu için büyük boyutlu bir veritabanına ihtiyacı yoktur.

- Benzer şekilde Elasticsearch içinde [Elastic Cloud](https://cloud.elastic.co/registration) adresine giderek cloud ortamında bir elastic servisi kullanarak Apinizer tanımlanabilir.

Ya da AWS'de bir **EC2** sunucusuna **Replicaset MongoDB** ve **Elasticsearch** kurulumu yaparak tanımlanabilir.

Örnek bir **apinizer-deployment.yaml** dosyası ayarları aşağıdadır:

```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: apinizer
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: manager
  namespace: apinizer
spec:
  replicas: 1
  selector:
    matchLabels:
      app: manager
      version: 'v1'
  template:
    metadata:
      labels:
        app: manager
        version: 'v1'
    spec:
      containers:
      - name: manager
        image: apinizercloud/manager:2023.01.1
        imagePullPolicy: IfNotPresent
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: prod
        - name: SPRING_DATA_MONGODB_DATABASE
          value: apinizerdb-aws
        - name: SPRING_DATA_MONGODB_URI
          value: 'YOUR_MONGODB_URL'
        - name: JAVA_OPTS
          value: ' -Xmx1400m -Xms1400m'
        resources:
          requests:
            memory: '2Gi'
            cpu: '1'
          limits:
            memory: '2Gi'
            cpu: '1'
        ports:
        - name: http
          containerPort: 8080
```

```powershell
kubectl apply -f apinizer-deployment.yaml
kubectl get pods -n apinizer
```

Apinizer Yönetim Konsolu EKS ortamına yüklendikten sonra, MongoDB veritabanına **apinizerdb** isminde bir veritabanı oluşacaktır. **general_settings** tablosuna Apinizer tarafından size verilen lisans anahtarı girilmelidir.

Apinizer Yönetim Konsolu üzerinden Kubernetes kaynaklarına erişim ve yönetim için aşağıdaki izinlerin tanımlanması yapılmalıdır.

Örnek bir **service.yaml** dosyası ayarları aşağıdadır:

```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: kube-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin-user
  namespace: kube-system
```

Örnek bir **adminuser.yaml** dosyası ayarları aşağıdadır:

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: admin-user
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: admin-user
  namespace: kube-system
```

```powershell
kubectl apply -f service.yaml
kubectl apply -f adminuser.yaml
kubectl create clusterrolebinding permissive-binding --clusterrole=cluster-admin --user=admin --user=kubelet --group=system:serviceaccounts
kubectl create clusterrolebinding apinizer -n kube-system --clusterrole=cluster-admin --serviceaccount=kube-system:apinizer
```

### Apinizer Yönetim Konsolu için Erişim Servisi Oluşturma

Kurulum tamamlandıktan sonra Apinizer Yönetim Konsolu'na erişim için bir servis gerekmektedir.

Aşağıdaki adımlar takip ederek bir servis oluşturulur. Dış IP alımında bazen bir iki dakika geçmesi gerekebilir.

```powershell
kubectl expose -n apinizer deployment.apps/manager --port=80 --target-port=8080 --name=apinizer-console-service --type=LoadBalancer
kubectl get svc -n apinizer
```

Service oluşturulduktan sonra, **EXTERNAL-IP** adresinden Apinizer Yönetim Konsolu'na erişilebilir.

### Apinizer Yönetim Konsolu Giriş

Adım 2'deki servis erişim adresi, tarayıcının adres çubuğuna yazılarak giriş yapılır. Default kullanıcı adı şifre için Apinizer destek ekibine ulaşabilirsiniz.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/17-apinizer-console-login.png" alt="Apinizer Console Login" width="1000" />
</Frame>

## 9. Apinizer Konfigurasyonları

### Log Sunucularının Tanımlanması

Apinizer, API trafiğini ve metrik bilgilerini, Elasticsearch veri tabanında tutar. Kurulum işlemine devam edebilmek için Elasticsearch cluster tanımlarının yapılması gerekmektedir.

Apinizer Yönetim Konsolu uygulamasında menüden **Administration → Server Management → Elasticsearch Kümeleri** sayfasına gidilir.

**Elasticsearch cluster tanımlama ayarlarını içeren görsele aşağıda yer verilmiştir:**

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/03-elasticsearch-cluster.png" alt="Elasticsearch Cluster" width="1000" height="521" />
</Frame>

Elasticsearch sunucu bağlantısını, Apinizer ile test etmek için **Test Connection** butonu kullanılabilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/16-elasticsearch-test.png" alt="Elasticsearch Test" width="1000" />
</Frame>

### Ortam (Environment) Tanımlama

Bir *API Proxy*'nin erişilebilir olması için en az bir ortamın yüklenmesi (*deploy*) gerekmektedir. Apinizer, bir API Proxy'nin birden fazla ortama yüklenmesine de izin verir.

Apinizer Yönetim Konsolu uygulamasında menüden **Administration → Server Management → Gateway Environment** sayfasına gidilir.

**Ortam tanımlama ayarlarını içeren görsele aşağıda yer verilmiştir:**

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/02-gateway-environment.png" alt="Gateway Environment" width="1000" height="461" />
</Frame>

Aşağıdaki değerler sunucuların varsayılan değerleridir. Cluster kaynaklarınıza uygun olarak değiştirilebilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/15-environment-config.png" alt="Environment Config" width="1000" height="482" />
</Frame>

**Create Environment** butonuna tıklanarak ortam tanımlama işlemi tamamlanır.

Ortamların listelendiğinde ekranda ilgili ortamın durumunu gösteren **Unpublished** butonuna ve sonrasında **Publish** butonuna tıklanarak **Prod** tipindeki ortam EKS'ye deploy edilmektedir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/01-environment-publish.png" alt="Environment Publish" width="1000" />
</Frame>

<Note>
Ortamı yükleme işlemi tahminen 3 dakika içinde EKS'ya yüklenmiş olacaktır.
</Note>

<Note>
Ortam tanımlama ve yayın işlemleri ile ilgili detaylı bilgi almak için [Environment sayfasına](/tr/kurulum/apinizer/environment) bakınız.
</Note>

### Ortamı (Environment) Servis Olarak Açma

Son olarak yayınladığımız Ortamda çalışacak API'lere erişmek için bir servis oluşturulması gerekiyor.

```powershell
kubectl expose -n prod deployment.apps/worker --port=80 --target-port=8091 --name=apinizer-worker-service --type=LoadBalancer
kubectl get svc -n prod
```

AWS tarafından üretilen **LoadBalancer (EXTERNAL-IP)** değerini, tanımlanan Prod Ortamının Access URL değeri olarak atanmalıdır.

İlk olarak, ortamın düzenlendiği sayfanın **Environment Info** tablosundaki düzenleme butonuna tıklanır.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/14-environment-edit.png" alt="Environment Edit" width="1000" height="108" />
</Frame>

Sonrasında edit tuşuna tıklanarak ortamın Access URL bilgisi değiştirilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/13-environment-access-url.png" alt="Environment Access URL" width="1000" />
</Frame>

## 10. Apinizer'da İlk API'yi Yayınlama ve Test Etme

En son adımda örnek bir API tanım dosyası üzerinden Apinizer'a bir API'yi API Proxy olarak açılması anlatılmaktadır.

API Proxy'nin kayıt edileceği proje, navbar menüsünden seçilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/12-api-proxy-project.png" alt="API Proxy Project" width="1000" height="200" />
</Frame>

Apinizer Yönetim Konsolu uygulamasındaki proje menüsündenden **Development → API Proxies** sayfasına gidilir.

Yeni API Proxy tanımlamak için **+ Proxy** butonuna tıklanır.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/11-add-proxy.png" alt="Add Proxy" width="204" />
</Frame>

Aşağıdaki görselde seçili link ile API Proxy'nin nereden oluşturulacağı kaynağı seçilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/10-api-source.png" alt="API Source" width="1000" height="304" />
</Frame>

API Tanım dosyasının linki girilerek **Parse** edilir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/09-api-parse.png" alt="API Parse" width="1000" height="111" />
</Frame>

API Proxy bilgileri girilerek **Save** butonuna tıklanır.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/08-api-save.png" alt="API Save" width="1000" />
</Frame>

API Proxy'yi yüklemek (deploy) için aşağıdaki görselde seçili olan **Deploy** butonu kullanılır.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/07-api-deploy.png" alt="API Deploy" width="1000" />
</Frame>

Yükleme işlemi onaylanır.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/06-api-deploy-confirm.png" alt="API Deploy Confirm" width="1000" />
</Frame>

API Proxy'nin **Develop** tabından test edilmek istenen uç noktaya (endpoint) gelip, **Test Endpoint** butonuna tıklanır.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/05-api-test-endpoint.png" alt="API Test Endpoint" width="1000" height="532" />
</Frame>

Test etme diyaloğunu içeren görsele aşağıda verilmiştir.

<Frame>
  <img src="/images/kurulum/bulut/amazon-eks/04-api-test-dialog.png" alt="API Test Dialog" width="1000" height="398" />
</Frame>

<Note>
API Proxy ile ilgili detaylı bilgi için [Geliştirici Kılavuzuna (Developer Guide)](/tr/gelistirici) bakınız.

Test Konsoluyla ilgili detaylı bilgi almak için [Test Console sayfasına](/tr/api-portal/test-araclari) bakınız.
</Note>
