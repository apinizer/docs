---
title: "Apinizer'da Geolocation Kullanarak Coğrafi Erişim Kontrolü"
description: "Apinizer platformu üzerinde geolocation özelliği kullanarak belirli şehirlerden gelen istekleri engelleyebilir veya izin verebilir, MaxMind GeoLite2 City veritabanını entegre edebilir ve X-Forwarded-For header bilgisi ile coğrafi erişim kontrolü sağlayabilir."
---

## Genel Bakış

Apinizer platformu üzerinde **geolocation** (coğrafi konum) özelliği kullanılarak belirli şehirlerden gelen isteklerin nasıl **engelleneceğini** veya **izin verileceğini** yapılandırabilirsiniz.

Çalışma sonunda, bu gelen isteklerin hangi şehirlerden geldiğini görselleştirmek için **Kibana Map** üzerinden gösterim yapabilirsiniz.

## Geolocation Verisi Sağlama

Bu veriyi sağlamak için [MaxMind](https://www.maxmind.com/), [IpGeolocation](http://ipgeolocation.io) hizmetlerinden yararlanabilirsiniz. Bu hizmetler, IP ve şehir bilgisini içeren veritabanlarını indirmenize olanak tanır.

<Info>
Apinizer, **geolocation** verisini elde etmek için genellikle istemci IP adresini kullanır. Gelen IP adresi, bir veritabanı üzerinden sorgulanarak isteğin hangi şehirden geldiği belirlenir.
</Info>

### MaxMind GeoLite2 City Veritabanı İndirme

**MaxMind'in** sunduğu ücretsiz **GeoLite2 City** **veritabanını** indirerek kullanabilirsiniz.

Sayfaya kayıt işlemi tamamlandıktan sonra, aşağıda belirtilen kırmızı işaretli alana giderek GeoLite2 City bölümünde zip dosyasını indiriyoruz ve bunu çıkartarak .mmdb uzantılı dosyamızı elde ediyoruz:

![MaxMind GeoLite2 City İndirme](/images/maxmind-geolite2-download.png)

## Geolocation Veritabanının Apinizer'a Entegrasyonu

**Administration → System Settings → IP Geolocation Setting** sayfasından **.mmdb** uzantılı dosya buraya eklenir ve deploy edilir.

![IP Geolocation Setting](/images/ip-geolocation-setting.png)

## XFF Aktifleştirme ve Allowed/Blocked IP List Politikası Ekleme

Apinizer üzerinden, **X-Forwarded-For (XFF)** header bilgisi kullanılarak, isteklerde **(request)** istemcinin **(client)** gerçek **IP** adresi **belirlenebilir**.

<Tip>
**Allowed IP** politikası ile belirli IP adreslerinden veya belirli şehirlerden gelen isteklere **izin verilebilir**. **Blocked IP** politikası kullanılarak ise bu istekler **engellenebilir**.
</Tip>

### XFF Aktifleştirme

XFF bilgisini kullanabilmek için, Proxy ayarları üzerinden Settings sekmesinde aktif edebilirsiniz:

![XFF Aktifleştirme](/images/xff-enable.png)

### Blocked IP List Politikası Ekleme

Bu Proxy'e Blocked IP List politikasını ekleyerek, İstanbul üzerinden gelen istekleri engelleyelim:

![Blocked IP List Politikası](/images/blocked-ip-list-policy.png)

IP Geolocation alanından İstanbul seçilir ve kaydedilir:

![IP Geolocation İstanbul Seçimi](/images/ip-geolocation-istanbul.png)

## Erişimin Engellenmesi ve Sonuç

İstanbul lokasyonundaki bir IP adresi ile servise yapılan istekte erişim engellendi:

![Erişim Engellendi](/images/access-blocked.png)

### Özet

<Check>
- Apinizer platformu üzerinde İstanbul'dan gelen istekleri nasıl engellediğimizi anlattık.
- MaxMind'in sunduğu GeoLite2 City veritabanını indirip, bu veriyi Apinizer'a entegre ettik.
- X-Forwarded-For (XFF) header bilgisi ile istemcilerin gerçek IP adreslerini belirleyerek, belirli şehirlerden gelen istekleri kontrol ettik.
- İstanbul'dan gelen istekleri engellemek için Block Ip List politikalarını kullanarak, İstanbul'u seçtik ve bu şehirden gelen erişimi başarıyla engelledik.
</Check>

<Warning>
Kibana üzerinden gelen isteklerin hangi şehirlerden geldiğini görselleştirmek için [Kibana Maps ile Coğrafi Görselleştirme](/tr/operasyon/yonetici-kilavuzlari/kibana-maps-cografi-gorsellestirme) sayfasına bakabilirsiniz.
</Warning>
