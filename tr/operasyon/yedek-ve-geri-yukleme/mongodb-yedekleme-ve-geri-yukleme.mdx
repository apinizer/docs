---
title: "MongoDB Yedekleme ve Geri Yükleme"
description: "Apinizer platformunda tüm yapılandırmaları MongoDB veritabanında saklar ve veritabanının düzenli olarak yedeklenmesi gereklidir. Platform, mongodump ve mongorestore komutları ile yedekleme ve geri yükleme işlemlerini gerçekleştirebilir ve Replica Set MongoDB veritabanı ile çalışır."
---

## Yedekleme (Backup)

<Warning>
  Apinizer, Replica Set MongoDB veritabanı ile çalışmaktadır. MongoDB sunucusu üzerinden backup alırken bu duruma dikkat edilmesi gerekmektedir.
</Warning>

```bash mongodump
mongodump \
  --host=<PRIMARY_MONGODB_IP> \
  --port=<PRIMARY_MONGODB_PORT> \
  --authenticationDatabase admin \
  --username apinizer \
  --password <MONGO_PASSWORD> \
  --db <DATABASE_NAME> \
  --gzip \
  --archive=/home/apinizer/apinizer-backup--v<CURRENT_VERSION>--<BACKUP_DATE>--01.archive
```

<Info>
Yedekleme dosya isimlendirmesinde yedeğin alındığı **tarih** ve **Apinizer sürüm bilgisinin** kullanılması önerilir. Bu sayede:
- Hangi yedeğin hangi sistem versiyonuna ait olduğu kolayca anlaşılır
- Geri yükleme işlemlerinde versiyon uyumsuzlukları önlenir
- Arşivlenen yedeklerin yönetimi kolaylaşır
</Info>

<Warning>
  **Eğer uygulama logları ya da audit logları gibi yüksek yer kaplayabilecek kısımlar dahil edilmek istenmezse, şu komutla ayrılabilirler:**

  `--excludeCollection apinizer_log --excludeCollection audit_event`

  Ancak bu işlem verinin yedeksizliğine yol açacağı için önerilmemektedir.
</Warning>

Detaylı bilgi için [MongoDB dökümantasyonunu inceleyebilirsiniz](https://docs.mongodb.com/manual/reference/program/mongodump/).

---

## Geri Yükleme (Restore)

Apinizer konfigürasyon verilerini yedekten geri yüklemek için, oluşturduğunuz yedek dosyaları kullanılır. Bu işlem Linux shell üzerinde `mongorestore` komutuyla yapılır.

### Temel Geri Yükleme Komutu

Aşağıdaki komut kullanılarak daha önce alınmış olan yedek dosyası geri yüklenebilir:

```bash mongorestore
mongorestore \
  --drop \
  --host=<PRIMARY_MONGODB_IP> \
  --port=<PRIMARY_MONGODB_PORT> \
  --username=apinizer \
  --authenticationDatabase=admin \
  --gzip \
  --archive=/home/apinizer/apinizer-backup-v<CURRENT_VERSION>--<BACKUP_DATE>--01.archive
```

<Warning>
`--drop` parametresi kullanıldığında mevcut koleksiyonlar silinir ve yeniden oluşturulur. Bu işlem geri alınamaz, bu nedenle dikkatli kullanılmalıdır.
</Warning>

### Replica Set'e Geri Yükleme

Primary MongoDB sunucusunu hedef göstermeden tüm replica set'e geri yükleme yapan örnek komut:

```bash mongorestore
mongorestore \
  --drop \
  --host apinizer-replicaset/10.0.0.1:25080,10.0.0.2:25080,10.0.0.3:25080 \
  --username apinizer \
  --password "123456" \
  --gzip \
  --archive=/home/apinizer/apinizer-backup-v2024092--20241231--01.archive
```

### Tek Koleksiyon Geri Yükleme

Tüm veritabanı değil sadece tek bir koleksiyon yedeklenmişse, bunu geri yüklemek için:

```bash mongorestore
mongorestore \
  --drop \
  --host 10.0.0.1 \
  --port 25080 \
  --authenticationDatabase "admin" \
  -d apinizerdb \
  -u apinizer \
  -p "123456" \
  --collection=api_proxy \
  /home/apinizer/apinizerdb/api_proxy.bson
```

## Detaylı Bilgi

Detaylı bilgi için [MongoDB dökümantasyonunu inceleyebilirsiniz](https://docs.mongodb.com/manual/reference/program/mongodump/).
