---
title: "İlk Sorgunun Yavaş Gelmesi"
description: "İlk Sorgunun Yavaş Gelmesi"
---

*   *   *   *   * 

  * [Apinizer Dokümantasyonu](/apinizer-dokumantasyonu/apinizer-dokuemantasyonuna-hos-geldiniz-1179695.html)
  * [Sorun Giderme](/apinizer-dokumantasyonu/sorun-giderme-6685033.html)
  * [Elasticsearch Olası Sorunları ve Çözümleri](/apinizer-dokumantasyonu/elasticsearch-olasi-sorunlari-ve-coezuemleri-75810288.html)
  * Current: İlk Sorgunun Yavaş Gelmesi

# İlk Sorgunun Yavaş Gelmesi

Elasticsearch'de varsayılan olarak, bir shard 30 saniye boyunca aranmazsa refresh durur. Bir sonraki arama refresh'i tetikler ve aramadan önce refresh çalışır.

Belirli bir süre sorgulamalara ara verildiğinde bu durum, Elasticsearch sorgularının _ilk çalışmasının çok uzun sürmesine sebep olur._

Bunun önüne geçilmesi için aşağıdaki iki ayar değiştirilebilir:

1) Bir shard'ın, aramanın idle olduğu kabul edilene kadar ne kadar süreyle arama alamayacağı veya istek alamayacağını belirten değeri değiştirmek.
```bash
    index.search.idle.after=30sn
    
```



  * Bu değer arttırıldığında, refresh işlemi için iki sorgu arasında geçmesi gereken süre artar.
  * Bu sorunu sadece biraz daha uzun vadede olması için öteler.
  * Eğer sık sorgulanan bir sistem ise düşünülebilir.

2) Index'te yapılan son değişiklikleri arama için görünür hale getiren refresh işleminin ne sıklıkta gerçekleştirileceğini belirten değeri değiştirmek.
```bash
    index.refresh_interval=1sn
    
```



  * Bu değer arttırıldığında refresh'in belirli sürelerde otomatik yapılması sağlanır.
  * Bu sorgu sonuçlarında belirli süre boyunca güncel olmayan verilerin gelebilmesine ve sistem kaynaklarının daha fazla tüketilmesine yol açar.
  * Eğer sık sorgulanma yapılmıyorsa ama sorgulama yapan uygulamanın performanslı olması gerekiyorsa ayarlanması önem arz eder.
  * Bu yenileme süresinin fine-tune edilmesi ihtiyacınıza göre değişir.

## Index Ayarını Değiştirme

"elasticsearch.yml" dosyasında index bazlı ayarlar yapılamaz.

Index bazlı ayarlar ya index template kullanarak ya da index ayar api'si kullanılarak değiştirilebilir.

### API Kullanımı

Aşağıda tüm indexlerde bu ayarın API kullanımı ile ayarlanması gösterilmiştir:
```bash
    curl -X PUT "&#60;ELASTICSEARCH_IP&#62;:9200/_all/_settings?preserve_existing=true&ignore_unavailable=true" --header 'Content-Type:application/json' -d'{ "index" : {"refresh_interval" : "5s"}}'
```



Aşağıda sadece belirtilen indexde bu ayarın API kullanımı ile ayarlanması gösterilmiştir:
```bash
    curl -X PUT "&#60;ELASTICSEARCH_IP&#62;:9200/apinizer-log-apiproxy-&#60;INDEX_KEY&#62;/_settings?preserve_existing=true&ignore_unavailable=true" --header 'Content-Type:application/json' -d'{ "index" : {"refresh_interval" : "5s"}}'
```



### Index Template Kullanımı

Aşağıda sadece ilgili index için Index Template kullanılarak bu ayarın ayarlanması gösterilmiştir:
```bash
    &#123;
        "data_stream": {
        },
        "index_patterns": [
            "&#60;INDEX_PATTERN_NAME&#62;"
        ],
        "template": {
            "mappings": { ... },
            "settings": {
                "index": {
                    "lifecycle": {
                        "name": "&#60;ILM_POLICY_NAME&#62;"
                    },
                    "number_of_replicas": "0",
                    "number_of_shards": "1",
                    "refresh_interval": "5sn"
                }
            }
        }
    &#125;
```



×