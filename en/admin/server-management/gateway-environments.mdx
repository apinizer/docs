---
title: "Gateway Environments"
description: "You can create Kubernetes environments, configure Gateway Engine and Cache server, publish environments, and perform metric monitoring. You can configure API Proxy traffic log connectors and manage JWT token validation keys."
---

<Info>
Environment is a runtime execution context for API Proxies in an organization. This section describes environment creation and related operations.
</Info>

<Info>
This appears when the **Kubernetes Namespace and Resources are managed with Apinizer** option is marked as Active from the System General Settings screen.
</Info>

## Environment Creation

Images containing general definition information when creating an environment are shown below:

<img
  src="/images/yonetici/ortam-olusturma.png"
  alt="Environment Creation"
  width="1000"
  height="600"
/>


Fields containing general definition information when creating an environment:

| Field | Description |
|------|----------|
| **Type**  | A value appropriate to the license and the environment used must be selected. Test or Production can be selected. |
| **Communication Protocol Type** (Communication Protocol Type) | One of HTTP, gRPC, HTTP+Websocket communication protocols can be selected. |
| **Name**  | The name of the environment. Corresponds to the namespace in Kubernetes. |
| **Key** (Key) | A shortened key specific to the environment used for the created environment. |
| **Node List** (Node List) | Select which kubernetes servers the created environment will run on. |
| **Project** (Project) | Projects where the environment can be used can be selected from here, or the selection can be left empty for use in all projects. |
| **Access URL Address** (Access URL) | The external access address of API Proxies running within the environment. |
| **Description**  | Can be used for management convenience and important notes. |
| **Gateway Server Access URL** | The service access address of nodeport or ingress type required for configurations made in Apinizer Management Console to be loaded to Gateway Pods. |
| **Cache Server Access URL** | The service access address required for configurations made in Apinizer Management Console to be loaded to Cache Pods. |

<Warning>
**Communication Protocol Type Selection:**

The type selected here determines which environment API Proxies can be deployed to:
- REST and SOAP API Proxies → to environments of type **HTTP**
- gRPC API Proxies → to environments of type **gRPC**
- Websocket API Proxies → to environments of type **HTTP+Websocket**
</Warning>

<Tip>
**Project Selection:** If a project is selected, it means that only API Proxies within that project can be deployed to this environment.
</Tip>

### API Proxy Traffic Log Connectors

Log connectors where all API Proxy Traffic and extensions in the environment will be logged are defined here.

An image containing API Proxy Traffic Log Connector definitions is shown below:
<img
  src="/images/yonetici/log-konnektor.png"
  alt="API Proxy Traffic Log Connector"
  width="1000"
  height="600"
/>

For more information about adding connectors to the environment, see [this page](/en/admin/server-management/adding-connectors-to-gateway-environments).

## Gateway Engine and Cache Server Settings

Gateway engine and Cache server correspond to pods in the Kubernetes environment.

- **Gateway engine** (`apinizer-worker`): The core module of the Apinizer Platform, responsible for routing all API requests to BackendAPI and works as Policy Enforcement Point
- **Cache server** (`apinizer-cache`): The environment where Cache values required in Apinizer are stored

Images containing Gateway engine and Cache server definitions are shown below:
<img
  src="/images/yonetici/getway-engine.png"
  alt="Gateway Engine and Cache Server Definitions"
  width="1000"
  height="600"
/>

### Gateway Engine Configuration

<AccordionGroup>
  <Accordion title="Basic Settings" icon="sliders">
    | Field | Description |
    |------|----------|
    | **Count** (Count) | The number of Gateway engines corresponds to the "replicas" value in Kubernetes deployment. |
    | **CPU** | The maximum number of CPU cores the pod will use. |
    | **Memory** (Memory) | The maximum memory value the pod will use. |
    | **Memory Unit** (Memory Unit) | The unit of the value required for memory is selected; MB, GB. |

    **Recommended Values:**

    | CPU | Memory Size |
    |-----|---------------|
    | 1   | 2GB           |
    | 2   | 4GB           |
    | 4   | 6GB           |
    | 8   | 10GB          |
  </Accordion>

  <Accordion title="Service Access Information" icon="network-wired">
    - **HTTP Enabled** (HTTP Enabled): Comes selected by default
    - **HTTPS Enabled** (HTTPS Enabled): This option is also selected if HTTPS is desired, in this case the necessary files for encryption must be uploaded
    - **mTLS**: Can only be selected when HTTPS setting is open since it runs on HTTPS protocol

    **Keystore and Truststore:** When HTTPS protocol is selected, keystore and truststore files can be uploaded in JKS or PFX format.

    **Service Ports:** A service port in the range 30080-32767 is entered. The service will be created as NodePort in Kubernetes.
  </Accordion>

  <Accordion title="Additional Variables" icon="code">
    Default and optional variables and their values to be run in the pod are defined.

    **Important Variables:**

    | Variable | Target Environment | Description |
    |----------|-------------|----------|
    | `JAVA_OPTS` | All | Sets JVM Heap values |
    | `tuneWorkerThreads` | HTTP Worker, HTTP+Websocket, Management API | Minimum Worker thread count of the server |
    | `tuneWorkerMaxThreads` | HTTP Worker, HTTP+Websocket, Management API | Maximum Worker thread count of the server |
    | `tuneBufferSize` | HTTP Worker, HTTP+Websocket, Management API | Buffer area the thread will use for write operations |
    | `tuneIoThreads` | HTTP Worker, HTTP+Websocket, Management API | IO Thread count |
    | `logLevel` | All | Application log level (ERROR, WARNING, INFO, DEBUG, TRACE, OFF) |

    <Tip>
    **Recommended Thread Values by CPU:**

    | CPU | tuneWorkerThreads | tuneWorkerMaxThreads |
    |-----|-------------------|----------------------|
    | 1   | 512               | 1024                 |
    | 2   | 1024              | 2048                 |
    | 4   | 2048              | 4096                 |
    | 8   | 4096              | 8192                 |
    </Tip>
  </Accordion>

  <Accordion title="gRPC Protocol Specific Settings" icon="g">
    If Gateway Management API will communicate with gateway pods over HTTPS:

    - The **Create HTTPS service for API Gateway Management API access** option is selected
    - Keystore and truststore files can be uploaded in JKS or PFX format
    - Gateway Server Access URL is entered

    Example: `https://worker-http-service.prod.svc.cluster.local:8443`
  </Accordion>

  <Accordion title="Security Configuration" icon="shield">
    Security configuration can be made with Additional Variables:

    | Variable | Description | Default Value |
    |----------|----------|------------------|
    | `jdkTLSVersions` | TLS protocol versions to be supported | TLSv1, TLSv1.1, TLSv1.2, TLSv1.3 |
    | `jdkTLSDisabledAlgorithms` | TLS algorithms to be disabled for security reasons | RC4, DES, MD5withRSA, DH keySize < 768... |
    | `jdkCipherSuites` | Encryption suites to be used | JDK default value |

    <Warning>
    **Security Recommendations:**
    - TLSv1.2 and higher versions should be used
    - GCM mode encryption suites should be preferred
    - Weak algorithms (RC4, DES, 3DES) should be disabled
    - Key sizes should be at an adequate security level (at least 2048 bits for RSA, at least 224 bits for EC)
    </Warning>
  </Accordion>
</AccordionGroup>

### Cache Server Configuration

<AccordionGroup>
  <Accordion title="Basic Settings" icon="database">
    | Field | Description |
    |------|----------|
    | **Cache Count** | The number of Caches is equivalent to the replicaSet in the Kubernetes Cluster. |
    | **CPU** | The maximum number of CPU cores the pod will use. |
    | **Memory** | The maximum memory value the pod will use. |

    **Recommended Values:**

    | CPU | Memory Size |
    |-----|---------------|
    | 1   | 2GB + Estimated Cache Size |
    | 2   | 4GB + Estimated Cache Size |
    | 4   | 6GB + Estimated Cache Size |
    | 8   | 10GB + Estimated Cache Size |

    <Info>
    You can reduce memory requirement per thread by using values like `-Xss256k` or `-Xss128k`.
    </Info>
  </Accordion>

  <Accordion title="Cache Server Additional Variables" icon="gear">
    **Tomcat Settings:**

    | Variable | Description | Recommended Values by CPU |
    |----------|----------|-------------------------------|
    | `SERVER_TOMCAT_MAX_THREADS` | Maximum concurrent requests Tomcat can handle | 1 CPU: 256, 2 CPU: 1024, 4 CPU: 2048, 8 CPU: 4096 |
    | `SERVER_TOMCAT_MIN_SPARE_THREADS` | Minimum thread count Tomcat will always keep ready | 1 CPU: 128, 2 CPU: 256, 4 CPU: 512, 8 CPU: 1024 |
    | `SERVER_TOMCAT_MAX_CONNECTIONS` | Maximum connection count Tomcat can accept simultaneously | 1 CPU: 2048, 2 CPU: 4096, 4 CPU: 8192, 8 CPU: 16384 |

    **Hazelcast Settings:**

    | Variable | Description | Default |
    |----------|----------|------------|
    | `HAZELCAST_CLIENT_SMART` | Whether the Hazelcast client will use smart routing | true |
    | `HAZELCAST_MAPCONFIG_BACKUPCOUNT` | How many backup copies of Hazelcast map data will be stored | 1 |
    | `HAZELCAST_PARTITION_COUNT` | Hazelcast partition count | 271 |
    | `CACHE_SERVICE_NAME` | Service name required for Cache to access other cache pods via kubernetes | cache-hzservice |

    <Warning>
    **HAZELCAST_OPERATION_RESPONSEQUEUE_IDLESTRATEGY**

    If you set this parameter to "backoff": The pod will continuously use 90-100% of the CPU limit. This may provide 5-10% performance increase but consumes the CPU resource limit of the Cache pod.
    </Warning>
  </Accordion>
</AccordionGroup>

## Setting Host Aliases

### What is Host Alias?

IP addresses on the network can sometimes be placed behind host names. If these are not defined in nameserver or host file, or if Apinizer cannot resolve them somehow, Host Alias definition must be made for worker pods to resolve these names.

On Kubernetes, alias host names can be given to host names or corresponding IP addresses. This setting is defined within the deployment.yaml file.

**Example Usage:**

| IP Address | Host Aliases |
|------------|--------------|
| 10.10.10.10 | alias_name, other_alias_name |

An image containing Host alias settings is shown below:
<img
  src="/images/yonetici/host-takma-adi.png"
  alt="Host Alias Settings"
  width="1000"
  height="600"
/>


## Environment Publishing

<Steps>
  <Step title="Select Unpublished Environment">
    To publish an environment, click the **Unpublished** button.
    <img
      src="/images/yonetici/step-1.png"
      alt="Unpublished Environment Selection"
      width="600"
      height="400"
    />
  </Step>

  <Step title="Confirm Operation">
    Click the **Publish** button from the window that appears to confirm the operation, and the environment is deployed to the kubernetes server.
     <img
          src="/images/yonetici/step2.png"
          alt="Environment Publishing Confirmation"
          width="600"
          height="400"
        />
  </Step>
</Steps>

## Environment Republishing

<Steps>
  <Step title="Select Published Environment">
    Hover over an environment that is in published status and click the **Published** button.
     <img
              src="/images/yonetici/step3.png"
              alt="Published Environment Selection"
              width="600"
              height="400"
            />
  </Step>

  <Step title="Republish">
    Click the **Republish** button from the window that appears to confirm the operation.
     <img
              src="/images/yonetici/step4.png"
              alt="Environment Republishing Confirmation"
              width="600"
              height="400"
            />
  </Step>
</Steps>

<Info>
After the Environment Republish operation, Pods are also restarted.
</Info>

<Warning>
Republish operation is required for changes made here to take effect. Compared to version update, it should be noted that there will be a few minutes of interruption in this operation.
</Warning>

## JWT Token Validation Key

If the environment has been saved, the JWT Token Validation Key has been generated. This token is the value of the private key involved in token generation via Apinizer Token Service for authentication policies.

To access this information, go to the **JWT Token Validation Keys** tab.

**Available Operations:**

- **Redeploy:** Reloading the current key to servers without making changes
- **Regenerate & Deploy:** Generating a new key and loading it to servers
- **Upload & Deploy:** Uploading a PEM Encoded Private Key file to generate a new key
 <img
              src="/images/yonetici/jwt-token.png"
              alt="JWT Token Validation Key"
              width="1000"
              height="600"
            />

## Environment Deletion

By selecting the environment, information related to the environment is deleted from the database by saying **Remove Environment** from the **Remove Environment** tab at the bottom.

 <img
              src="/images/yonetici/environment-silme.png"
              alt="Environment Deletion"
              width="1000"
              height="600"
            />
<Danger>
**Warning:** When the deletion operation is completed, all API Proxy deployments registered in this environment are also deleted and API Proxies previously deployed to this environment can no longer be accessed through this environment.
</Danger>

## Cache Monitor

Requests can be cached and responded to without going to Backend API with the settings in the Cache section of the General Information tab of the API Proxy screen. At the same time, quota and throttle policies are also managed through the cache pod.

To monitor cache operations, see details, and delete them on an environment basis, go to this page from the **Cache** link of the environment.
<img
              src="/images/yonetici/on-bellek.png"
              alt="Cache Monitor"
              width="800"
              height="500"
            />

An image containing the Cache Monitor is shown below:
<img
              src="/images/yonetici/on-bellek2.png"
              alt="Cache Monitor Detail"
              width="1000"
              height="600"
            />


## Metric Monitor

To monitor the status of Worker and Cache pods on Kubernetes, click the **Pods** link of the relevant environment from the environment list.
An image containing the Pods screen is shown below:

<img
              src="/images/yonetici/metrik.png"
              alt="Metric Monitor"
              width="1000"
              height="600"
            />

<Info>
If you want to access metrics of all environments, click [the all environment metrics page](/en/admin/server-management/kubernetes-resources).
</Info>

