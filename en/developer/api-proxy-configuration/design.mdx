---
title: 'API Proxy Configuration - Design'
description: 'Policy management, Pre-flow and Post-flow policies, Conditional policies, Route step, Fault handler policies'
---

The API Proxy Design tab (also known as the Development tab) allows you to manage the message processing flow and policies of the API Proxy. This tab includes pre-flow policies, conditional policies, route step, post-flow policies, and fault handler policies.

## Design Tab

The **Design** tab (Development tab) on the API Proxy detail page contains the message processing flow and policies of the API Proxy. This tab consists of the following sections:

<CardGroup cols={2}>
  <Card title="Pre-flow Policies" icon="arrow-right">
    Pre-request policies
  </Card>
  <Card title="Conditional Policies" icon="code-branch">
    Conditional policies
  </Card>
  <Card title="Route Step" icon="route">
    Routing to backend
  </Card>
  <Card title="Post-flow Policies" icon="arrow-left">
    Post-response policies
  </Card>
  <Card title="Fault Handler" icon="exclamation-triangle">
    Error handling policies
  </Card>
</CardGroup>

## Message Processing Flow

A message arriving at the API Proxy is processed in the following order:

```
Client Request
   │
   ▼
┌─────────────────────────────────┐
│ 1. Pre-flow Policies            │
│    - Authentication              │
│    - Authorization               │
│    - Rate Limiting               │
│    - Validation                  │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 2. Conditional Policies         │
│    - IF-THEN-ELSE structure      │
│    - Conditional policy execution│
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 3. Route Step                    │
│    - Upstream Target selection   │
│    - Load balancing              │
│    - Routing to backend         │
└──────────────┬──────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│ 4. Post-flow Policies           │
│    - Response transformation     │
│    - Header manipulation        │
│    - Logging                     │
└──────────────┬──────────────────┘
               │
               ▼
         Client Response
```

## Pre-flow Policies

Pre-flow policies are policies executed before the request is sent to the backend.

### Usage Scenarios

* **Authentication**: Identity verification
* **Authorization**: Authorization
* **Rate Limiting**: Request rate limiting
* **Request Validation**: Request validation
* **Request Transformation**: Request transformation
* **Header Manipulation**: Header manipulation

### Adding Policies

To add a pre-flow policy:

1. Go to the **Pre-flow** section
2. Click the **Add Policy** button
3. Select the policy you want to add
4. Configure policy settings
5. Click the **Save** button

### Policy Ordering

Policies are executed in the order they are added. You can use drag-and-drop to change the order of policies.

## Conditional Policies

Conditional policies are policies executed based on specific conditions.

### Condition Structure

Conditional policies use IF-THEN-ELSE structure:

```
IF (condition) THEN
  execute policies
ELSE
  execute other policies
END IF
```

### Condition Examples

**Header-based:**
```
IF header.content-type == "application/json" THEN
  apply JSON transformation
ELSE
  apply XML transformation
END IF
```

**Path-based:**
```
IF path == "/api/v1/users" THEN
  apply user-specific policies
ELSE
  apply default policies
END IF
```

**Method-based:**
```
IF method == "POST" THEN
  apply validation policy
ELSE
  skip validation
END IF
```

### Adding Conditional Policy

To add a conditional policy:

1. Go to the **Conditional Policies** section
2. Click the **Add Conditional Policy** button
3. Define the condition
4. Add policies to THEN and ELSE blocks
5. Click the **Save** button

## Route Step

Route Step is the step where the request is routed to the backend API.

### Upstream Target

The address of the backend API. Multiple targets can be defined.

**Features:**
* **Load Balancing**: Load balancing
* **Failover**: Backup
* **Health Check**: Health check

### Load Balancing

If there are multiple upstream targets, a load balancing strategy can be selected:

* **Round Robin**: Sequential distribution
* **Least Connections**: To the one with least connections
* **IP Hash**: IP-based hash
* **Weighted**: Weighted distribution

### Route Step Configuration

To configure Route Step:

1. Go to the **Route Step** section
2. Click the **Add Upstream Target** button
3. Enter the backend URL
4. Configure load balancing settings
5. Click the **Save** button

## Post-flow Policies

Post-flow policies are policies executed on the response from the backend.

### Usage Scenarios

* **Response Transformation**: Response transformation
* **Header Manipulation**: Header manipulation
* **Response Validation**: Response validation
* **Logging**: Logging
* **Caching**: Caching
* **Response Masking**: Sensitive data masking

### Adding Policies

To add a post-flow policy:

1. Go to the **Post-flow** section
2. Click the **Add Policy** button
3. Select the policy you want to add
4. Configure policy settings
5. Click the **Save** button

## Fault Handler Policies

Fault Handler policies are policies executed in error situations.

### Error Types

Fault Handler can catch the following error types:

* **Connection Error**: Connection error
* **Timeout Error**: Timeout error
* **4xx Errors**: Client errors
* **5xx Errors**: Server errors
* **Policy Error**: Policy error

### Fault Handler Configuration

To configure Fault Handler:

1. Go to the **Fault Handler** section
2. Click the **Add Fault Handler** button
3. Select the error type
4. Add policies to be executed in error situations
5. Click the **Save** button

### Error Handling Examples

**Timeout Error:**
```
IF error.type == "Timeout" THEN
  return custom timeout message
  log error details
END IF
```

**4xx Error:**
```
IF error.status >= 400 AND error.status < 500 THEN
  mask sensitive data
  return formatted error message
END IF
```

## Policy Chain Design

To design an effective policy chain:

### 1. Pre-flow Stage

* Put authentication and authorization policies first
* Apply rate limiting policy early
* Apply validation policies before sending to backend

### 2. Conditional Stage

* Keep conditions clear and understandable
* Don't use unnecessary conditional policies
* Optimize conditions that affect performance

### 3. Route Stage

* Configure upstream targets correctly
* Select load balancing strategy according to needs
* Keep health check active

### 4. Post-flow Stage

* Apply response transformation as needed
* Add logging policy
* Mask sensitive data

### 5. Fault Handler Stage

* Catch all error types
* Return user-friendly error messages
* Log errors

## Usage Scenarios

### Scenario 1: Simple REST API Proxy

Policy chain for a simple REST API Proxy:

**Pre-flow:**
1. API Key Authentication
2. Rate Limiting

**Route:**
1. Single Upstream Target

**Post-flow:**
1. Response Logging

### Scenario 2: Secure API Proxy

Policy chain for a secure API Proxy:

**Pre-flow:**
1. OAuth2 Authentication
2. Authorization Check
3. Rate Limiting
4. Request Validation

**Route:**
1. Load Balanced Upstream Targets

**Post-flow:**
1. Response Transformation
2. Data Masking
3. Response Logging

**Fault Handler:**
1. Error Formatting
2. Error Logging

### Scenario 3: Transformation API Proxy

Policy chain for a transformation API Proxy:

**Pre-flow:**
1. Authentication
2. Request Transformation (JSON to XML)

**Route:**
1. Upstream Target

**Post-flow:**
1. Response Transformation (XML to JSON)
2. Response Logging

## Best Practices

### Policy Ordering

* **Performance**: Put frequently used policies first
* **Security**: Apply security policies early
* **Logic**: Maintain logical order

### Conditional Policies

* **Simplicity**: Keep conditions simple
* **Performance**: Avoid complex conditions
* **Testing**: Test conditions

### Error Handling

* **Comprehensiveness**: Catch all error types
* **Informativeness**: Return user-friendly error messages
* **Logging**: Log errors

## Next Steps

<CardGroup cols={2}>
  <Card title="Understanding the Flow" icon="sitemap" href="/en/developer/policy-management/understanding-the-flow">
    Understanding message processing flow
  </Card>
  <Card title="Pre-flow Policies" icon="arrow-right" href="/en/developer/policy-management/pre-flow-policies">
    Pre-flow policies
  </Card>
  <Card title="Post-flow Policies" icon="arrow-left" href="/en/developer/policy-management/post-flow-policies">
    Post-flow policies
  </Card>
  <Card title="Fault Handler Policies" icon="exclamation-triangle" href="/en/developer/policy-management/fault-handler-policies">
    Fault handler policies
  </Card>
  <Card title="Conditional Policies" icon="code-branch" href="/en/developer/policy-management/conditional-policies">
    Conditional policies
  </Card>
  <Card title="Policy Management" icon="shield" href="/en/developer/policy-management">
    Policy management
  </Card>
</CardGroup>
