---
title: "Task-to-Task SOAP XML Data Transfer and Usage"
description: "You can transfer SOAP XML data between API Integrator tasks. You can read data from a web service that returns SOAP XML data and send each element in the array-type elements in the returned result to another API in a loop."
---



**Scenario:** A web service that returns SOAP XML data will be called, and each of the array-type elements in the returned result will be sent to another API in a specific format.

In this case, two API Call connectors should be added as tasks. The first is for reading and the other is for writing in a loop.

## Task-1: Reading data with API Call connector

<Steps>
  <Step title="Add API Call task">
    Click the API Call option from the dialog listing tasks.
  </Step>
  <Step title="Select Once mode">
    Select the "Once" option to indicate that the task will run once.
  </Step>
  <Step title="Enter web service access information">
    Enter the relevant web service access information where data reading will be performed.
  </Step>
  <Step title="Set output key information">
    To use the data returned from the web service in the next task, set the output key information to **"soapResponse"**. (You can name this value as you wish.)
  </Step>
</Steps>

<img
    src="/images/tutorials/api-entagratoru/soap1.png"
    alt="Task-2: Sending data to API with API Call connector"
    width="1000"
    style={{ borderRadius: '0.5rem' }}
/>

When this task runs, the following SOAP XML Data is returned in this example, meaning the **soapResponse** value will contain the following data:

```xml
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:example="http://www.example.com">
 <soapenv:Header></soapenv:Header>
 <soapenv:Body>
  <example:users>
   <example:user>
    <example:id>1</example:id>
    <example:name>user 1</example:name>
    <example:description>description of user 1</example:description>
   </example:user>
   <example:user>
    <example:id>2</example:id>
    <example:name>user 2</example:name>
    <example:description>description of user 2</example:description>
   </example:user>
   <example:user>
    <example:id>3</example:id>
    <example:name>user 3</example:name>
    <example:description>description of user 3</example:description>
   </example:user>
  </example:users>
 </soapenv:Body>
</soapenv:Envelope>
```

## Task-2: Sending data to API with API Call connector

<Steps>
  <Step title="Add API Call task">
    Click the API Call option from the dialog listing tasks.
  </Step>
  <Step title="Select Loop mode">
    Select the "Loop" option to indicate that work will be done in a loop on the array data from the previous task.
  </Step>
  <Step title="Specify XPath">
    Write as XPath which part of the output key information value entered in the previous task **("soapResponse")** should be processed as an array.
    
    When writing XPath, add the **"#/"** sign to the key information **("soapResponse")** to indicate that XML operations will be performed on the previous data. Then enter the path where the array elements are located as XPath. Since SOAP XML usually contains namespaces, writing XPath with these namespaces can be difficult. In this case, it is recommended to write the **local-name()** method within the XPath. For this example, the following should be written in the XPath field:

    ```
    {{soapResponse#//*[local-name()='Items']/*[local-name()='Item']}}
    ```
  </Step>
  <Step title="Enter target API access information">
    Enter the relevant API access information where the data will be sent.
  </Step>
  <Step title="Enter template message information">
    Enter the template message information you want to send. If you want to use the values of elements in the loop within the template message information, add the relevant data within the element to the template using the **"LOOP_VARIABLE"** expression. Along with LOOP_VARIABLE, the XPath information to access the SOAP XML data within the element indicated as the target for the loop must be entered.
  </Step>
</Steps>

<img
    src="/images/tutorials/api-entagratoru/soap2.png"
    alt="Task-2: Sending data to API with API Call connector"
    width="1000"
    style={{ borderRadius: '0.5rem' }}
/>

In this example, when the expression **"{{soapResponse#//*[local-name()='Items']/*[local-name()='Item']}}"** is executed on the **soapResponse** data returned from the previous task, 3 elements are returned, indicating that this task will run 3 times.

In the first run, the LOOP_VARIABLE value will contain the following XML.

```xml
<example:user>
 <example:id>1</example:id>
 <example:name>user 1</example:name>
 <example:description>description of user 1</example:description>
</example:user>
```

Let's assume the template to be executed on this XML is as follows:

```json
{
 "test_id":"{{LOOP_VARIABLE#//*[local-name()='id']/text()}}",
 "test_name":"{{LOOP_VARIABLE#//*[local-name()='name']/text()}}",
 "test_description":"{{LOOP_VARIABLE#//*[local-name()='description']/text()}}"
}
```

Note that the XPath used next to LOOP_VARIABLE to get the target data ends with the text() method.

In this case, the request body to be sent with API Call will be as follows:

```json
{
 "test_id": "1",
 "test_name": "user 1",
 "test_description": "Description of user 1"
}
```

