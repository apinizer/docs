---
title: Application of JWT Authentication Policy to REST API via Security Manager Provider
description: "Explains how to apply JWT Authentication policy to Swagger Petstore REST API via Security Manager provider. Includes all steps from credential creation to adding policy, token creation to testing."
---

The numbering in the diagram below corresponds to the **order of operations**.

- **Security Manager** in **Apinizer** requests **JWT type authentication** information from **API Client**. If this authentication is correct, the flow continues.
- **Apinizer** makes a request to **Backend API**.
- **Backend API** responds to **Apinizer**.
- **Apinizer** responds to **API Client**.
<img src="/images/tutorials/jwt1.png" alt="Scenario Diagram" width="800" />
## Creating API Proxy

<img src="/images/tutorials/senaryo2.png" alt="Scenario Diagram" width="200" />

Access to the REST API named Swagger Petstore can be provided from [https://petstore.swagger.io/](https://petstore.swagger.io/).

Click the **API Proxies** option under the **Development** menu.

<Info>
  Since no **proxy** definition has been made before on the opened page, the text **No records found!** appears.
</Info>

Click the **Create** button in the top right corner and start creating a new **proxy**.
<img src="/images/tutorials/senaryo3.png" alt="Scenario Diagram" width="800" />


In this section, it is necessary to select what type the **API Proxy** to be created is.

Since the type of API to be used in this scenario will be **Swagger 2.X**, this type is selected.

Click on the **Enter URL** expression to switch to the screen where the address of the API to be used will be entered.
<img src="/images/tutorials/senaryo4.png" alt="Scenario Diagram" width="800" />

Enter the **address to be accessed** in the URL section and click the **Parse** button.
<img src="/images/tutorials/senaryo5.png" alt="Scenario Diagram" width="800" />



After the Parse operation is performed, settings for the API Proxy can be made:

- The **Usage** field specifies who will use the created API Proxy. Options such as **publisher, consumer, publisher and consumer** are available here.
- The **Sharing Type** field specifies the sharing type of the created API Proxy. Options such as **external, internal, external and internal** are available here.
- One or both of the two API addresses under the **Addresses** tab can be selected. If both addresses are selected, Apinizer will perform the **Load Balance** operation itself.
- **Relative Path** is the address where the created API Proxy will be opened for access.
- The **Category List** field also allows categorization of the created API Proxy.

<img src="/images/tutorials/senaryo6.png" alt="Scenario Diagram" width="800" />


After these settings are made, the API Proxy is saved.

After the save operation, click the **Develop** tab on the opened page.
<img src="/images/tutorials/senaryo7.png" alt="Scenario Diagram" width="800" />


<Info>
  Policies to be added with the **All** expression above these endpoints can be applied to **all endpoints**.
</Info>

The created API Proxy is deployed. For this, click the **Deploy** button in the middle section above.
<img src="/images/tutorials/senaryo8.png" alt="Scenario Diagram" width="800" />


## Creating Credentials

The information for the **Credential** to be added will be **username = apinizer**, **password = 123123aA**.

For this, go to the **Identity Management** menu.

Here, click the **Credentials** menu under the **Credential Management** menu.
<img src="/images/tutorials/senaryo9.png" alt="Scenario Diagram" width="200" />


Click the **Create** button in the top right corner on the opened screen.
<img src="/images/tutorials/senaryo10.png" alt="Scenario Diagram" width="600" />

Here, the required fields are filled as previously specified and the created **credential** is saved by clicking the **Save and Deploy** button.
<img src="/images/tutorials/senaryo11.png" alt="Scenario Diagram" width="800" />


The proxy that this **credential element** will provide access to must be selected. Hover over the created **credential** and click the **Edit** option from the menu on the side.
<img src="/images/tutorials/senaryo12.png" alt="Scenario Diagram" width="800" />

Click the **API Proxy ACL** tab from the opened screen, and click the button in this tab.
<img src="/images/tutorials/api-proxy-acl.png" alt="Scenario Diagram" width="800" />


On the opened page, **API Proxies** in the project currently being worked on are listed. The **proxy** named **Swagger Petstore** is selected.

Click the **Add** button to specify that the created **Credential** element will have access to this **proxy**.
<img src="/images/tutorials/senaryo14.png" alt="Scenario Diagram" width="600" />


Click the **Save and Deploy** button in the top right corner and save the operation.

## Adding Authentication Policy

The **JWT Authentication** policy can now be added.

Go to the page where API Proxies are listed and select the proxy named **Swagger Petstore** from here.

Then go to the **Develop** tab and click the **Add Policy** button.

On the opened page, the **JWT Authentication** policy is selected.
<img src="/images/tutorials/jwt2.png" alt="Scenario Diagram" width="800" />

If the expressions on this screen are examined one by one,

- The **Grant Type** field specifies how user information of the **token service** to be used will be verified. If the **Client Credentials** expression is selected, **(Identity/Role/Group) Service** cannot be used.
- The **Show API Key** field displays the **API proxy key** values belonging to the created proxy.
- With the **Token Never Expires** field, no time value is assigned to the created token and it can be used as desired. If this option is not selected, a menu appears immediately below as shown in the image below.
- The **Token Expires In** field specifies how long the token will be valid. This specification can be adjusted with time expressions in the dropdown menu.
- The **Refresh Token Allowed** field activates the renewal feature of the created token. If this option is selected, a field appears for setting how many times it can be renewed, and the image for this field is shown below.
- **Refresh Token Count** specifies how many times the token can be renewed.
- The **Refresh Token Expires In** field specifies the lifetime of the renewed token.
- The **JWT Signature Algorithm** field specifies which **algorithm** will be used to generate the **token** to be produced.
- The **Allow URL Parameters** field allows information to be sent only in the message body when a request is sent for token generation. If this information is desired to be sent as "URL Parameter", this option must be selected, but this situation will create a security risk and is not recommended.
<Warning>
  With the **Clear Authentication Information** field, if there is any authentication information in the message going to the backend API, this information is deleted and not sent to the **backend API**. Activating this setting is always recommended unless there is a special situation.
</Warning>

- With the **Add Client Info to Header** field, when authentication is successfully performed, it sends the authorized username to the backend API by placing it in the header. When this option is checked, an input field containing **X-Authenticated-UserId** appears immediately below. This field is the default name of the header information.
<img src="/images/tutorials/jwt3.png" alt="Scenario Diagram" width="800" />

After making the settings to be used in this scenario, click the **Save** button in the top right corner.
<img src="/images/tutorials/jwt4.png" alt="Scenario Diagram" width="800" />


For the operation to be valid, the proxy must be **Deployed**.


## Creating Token for Authentication

The Public Key information belonging to the relevant proxy is obtained from the **Show API Key** option in the JWT Authentication policy.
<img src="/images/tutorials/token1.png" alt="Scenario Diagram" width="400" />


Then go to the **Test Console** menu under the **Test** menu.
<img src="/images/tutorials/token2.png" alt="Scenario Diagram" width="200" />


After coming to this screen, click the **New** button under the **Collection** tab and create a new **Collection**.

Write **JWT** in the **Name** field and click the **Save** button.
<img src="/images/tutorials/token3.png" alt="Scenario Diagram" width="400" />

If the expressions on this screen are examined one by one,

- Select the method type from the **Method** field.
- Write the address where the token will be received in the URL field.
- Since the message content will be in the **body** section, select the **body** expression from the tab below.
- Write the values required to obtain the token here and click the **Send** button.

<img src="/images/tutorials/token4.png" alt="Scenario Diagram" width="800" />


The **access_token** information in the response has been created to use in the proxy where the **JWT Authentication** policy is created.

This token is copied.

Switch back to the page where the API proxy is located.
<img src="/images/tutorials/token5.png" alt="Scenario Diagram" width="800" />


## Testing the API Proxy

Select the proxy named **Swagger Petstore**.

Select the endpoint named **"/pet/{petId}"** under the **Develop** tab.

Click the **Test Endpoint** expression to test this endpoint.


Enter the desired **petId** value as **"1"** in the URL, and when the **Send** button is pressed, it is seen that the returned response is an error message.
<img src="/images/tutorials/senaryo20.png" alt="Scenario Diagram" width="800" />



<Warning>
  It is seen that this error is related to the applied **JWT Authentication** policy. Because no **authentication** information has been placed in the **header** in any way.
</Warning>

This time, place the **Authorization header** in the **header** and use the obtained **token information** here.

When the **Send** button is clicked, a successful response is received.
<img src="/images/tutorials/jwt6.png" alt="Scenario Diagram" width="800" />


